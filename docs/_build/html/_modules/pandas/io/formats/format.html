<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pandas.io.formats.format &mdash; BabyDragon  documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            BabyDragon
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tasks:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tasks/llm_task.html">llm_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tasks/multi_kernel_task.html">multi_kernel_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tasks/base_task.html">base_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tasks/topic_tree_task.html">topic_tree_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tasks/embedding_task.html">embedding_task</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Memory/Kernels:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/kernels/memory_kernel.html">memory_kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/kernels/kernel_clustering.html">kernel_clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/kernels/multi_kernel.html">multi_kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/kernels/multi_kernel_visualization.html">multi_kernel_visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/kernels/kernel_utils.html">kernel_utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Memory/Threads:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/threads/base_thread.html">base_thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/threads/fifo_thread.html">fifo_thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/threads/vector_thread.html">vector_thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/threads/todo/python_thread.html">python_thread</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Memory/Indexes:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/python_index.html">python_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/memory_index.html">memory_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/pandas_index.html">pandas_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/todo/youtube_index.html">youtube_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/todo/parquet_index.html">parquet_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/todo/wiki_index.html">wiki_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/todo/gutenberg_index.html">gutenberg_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/todo/github_index.html">github_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/todo/multi_index.html">multi_index</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Chat:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../chat/base_chat.html">base_chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chat/memory_chat.html">memory_chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chat/chat.html">chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chat/prompts/perspective_prompt.html">perspective_prompt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chat/prompts/default_prompts.html">default_prompts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Utils:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../utils/multithreading.html">multithreading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../utils/pandas.html">pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../utils/hf_datasets.html">hf_datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../utils/chatml.html">chatml</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Models/embedders:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../models/embedders/ada2.html">ada2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../models/embedders/cohere.html">cohere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../models/embedders/sbert.html">sbert</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Models/generators:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../models/generators/cohere.html">cohere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../models/generators/chatgpt.html">chatgpt</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Processors:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/github_processors.html">github_processors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/os_processor.html">os_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/git_metadata.html">git_metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/visitors.html">visitors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/python_parser.html">python_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/todo/subs_parser.html">subs_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/todo/latex_parser.html">latex_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/todo/md_parser.html">md_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/todo/wiki_parser.html">wiki_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/todo/git_processor.html">git_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/todo/arxiv_processor.html">arxiv_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/todo/wiki_processor.html">wiki_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/todo/chatgpt_processor.html">chatgpt_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/todo/mit_course_processor.html">mit_course_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/todo/youtube_processor.html">youtube_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/todo/pubmed_processor.html">pubmed_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/todo/gutenberg_processor.html">gutenberg_processor</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Apps:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../apps/auto_perspective/perspective.html">perspective</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">BabyDragon</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pandas.io.formats.format</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pandas.io.formats.format</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Internal module for formatting output data in csv, html, xml,</span>
<span class="sd">and latex files. This module also applies to display formatting.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">csv</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">QUOTE_NONE</span><span class="p">,</span>
    <span class="n">QUOTE_NONNUMERIC</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">get_terminal_size</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">IO</span><span class="p">,</span>
    <span class="n">TYPE_CHECKING</span><span class="p">,</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Final</span><span class="p">,</span>
    <span class="n">Generator</span><span class="p">,</span>
    <span class="n">Hashable</span><span class="p">,</span>
    <span class="n">Iterable</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Mapping</span><span class="p">,</span>
    <span class="n">Sequence</span><span class="p">,</span>
    <span class="n">cast</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">unicodedata</span> <span class="kn">import</span> <span class="n">east_asian_width</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pandas._config.config</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_option</span><span class="p">,</span>
    <span class="n">set_option</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">pandas._libs</span> <span class="kn">import</span> <span class="n">lib</span>
<span class="kn">from</span> <span class="nn">pandas._libs.missing</span> <span class="kn">import</span> <span class="n">NA</span>
<span class="kn">from</span> <span class="nn">pandas._libs.tslibs</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">NaT</span><span class="p">,</span>
    <span class="n">Timedelta</span><span class="p">,</span>
    <span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">get_unit_from_dtype</span><span class="p">,</span>
    <span class="n">iNaT</span><span class="p">,</span>
    <span class="n">periods_per_day</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas._libs.tslibs.nattype</span> <span class="kn">import</span> <span class="n">NaTType</span>
<span class="kn">from</span> <span class="nn">pandas._typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ArrayLike</span><span class="p">,</span>
    <span class="n">Axes</span><span class="p">,</span>
    <span class="n">ColspaceArgType</span><span class="p">,</span>
    <span class="n">ColspaceType</span><span class="p">,</span>
    <span class="n">CompressionOptions</span><span class="p">,</span>
    <span class="n">FilePath</span><span class="p">,</span>
    <span class="n">FloatFormatType</span><span class="p">,</span>
    <span class="n">FormattersType</span><span class="p">,</span>
    <span class="n">IndexLabel</span><span class="p">,</span>
    <span class="n">StorageOptions</span><span class="p">,</span>
    <span class="n">WriteBuffer</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">pandas.core.dtypes.common</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">is_categorical_dtype</span><span class="p">,</span>
    <span class="n">is_complex_dtype</span><span class="p">,</span>
    <span class="n">is_datetime64_dtype</span><span class="p">,</span>
    <span class="n">is_extension_array_dtype</span><span class="p">,</span>
    <span class="n">is_float</span><span class="p">,</span>
    <span class="n">is_float_dtype</span><span class="p">,</span>
    <span class="n">is_integer</span><span class="p">,</span>
    <span class="n">is_integer_dtype</span><span class="p">,</span>
    <span class="n">is_list_like</span><span class="p">,</span>
    <span class="n">is_numeric_dtype</span><span class="p">,</span>
    <span class="n">is_scalar</span><span class="p">,</span>
    <span class="n">is_timedelta64_dtype</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.dtypes.dtypes</span> <span class="kn">import</span> <span class="n">DatetimeTZDtype</span>
<span class="kn">from</span> <span class="nn">pandas.core.dtypes.missing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">isna</span><span class="p">,</span>
    <span class="n">notna</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">pandas.core.arrays</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Categorical</span><span class="p">,</span>
    <span class="n">DatetimeArray</span><span class="p">,</span>
    <span class="n">TimedeltaArray</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.arrays.string_</span> <span class="kn">import</span> <span class="n">StringDtype</span>
<span class="kn">from</span> <span class="nn">pandas.core.base</span> <span class="kn">import</span> <span class="n">PandasObject</span>
<span class="kn">import</span> <span class="nn">pandas.core.common</span> <span class="k">as</span> <span class="nn">com</span>
<span class="kn">from</span> <span class="nn">pandas.core.construction</span> <span class="kn">import</span> <span class="n">extract_array</span>
<span class="kn">from</span> <span class="nn">pandas.core.indexes.api</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Index</span><span class="p">,</span>
    <span class="n">MultiIndex</span><span class="p">,</span>
    <span class="n">PeriodIndex</span><span class="p">,</span>
    <span class="n">ensure_index</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.indexes.datetimes</span> <span class="kn">import</span> <span class="n">DatetimeIndex</span>
<span class="kn">from</span> <span class="nn">pandas.core.indexes.timedeltas</span> <span class="kn">import</span> <span class="n">TimedeltaIndex</span>
<span class="kn">from</span> <span class="nn">pandas.core.reshape.concat</span> <span class="kn">import</span> <span class="n">concat</span>

<span class="kn">from</span> <span class="nn">pandas.io.common</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">check_parent_directory</span><span class="p">,</span>
    <span class="n">stringify_path</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.io.formats</span> <span class="kn">import</span> <span class="n">printing</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">Series</span><span class="p">,</span>
    <span class="p">)</span>


<span class="n">common_docstring</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Parameters</span>
<span class="s2">        ----------</span>
<span class="s2">        buf : str, Path or StringIO-like, optional, default None</span>
<span class="s2">            Buffer to write to. If None, the output is returned as a string.</span>
<span class="s2">        columns : sequence, optional, default None</span>
<span class="s2">            The subset of columns to write. Writes all columns by default.</span>
<span class="s2">        col_space : </span><span class="si">%(col_space_type)s</span><span class="s2">, optional</span>
<span class="s2">            </span><span class="si">%(col_space)s</span><span class="s2">.</span>
<span class="s2">        header : </span><span class="si">%(header_type)s</span><span class="s2">, optional</span>
<span class="s2">            </span><span class="si">%(header)s</span><span class="s2">.</span>
<span class="s2">        index : bool, optional, default True</span>
<span class="s2">            Whether to print index (row) labels.</span>
<span class="s2">        na_rep : str, optional, default &#39;NaN&#39;</span>
<span class="s2">            String representation of ``NaN`` to use.</span>
<span class="s2">        formatters : list, tuple or dict of one-param. functions, optional</span>
<span class="s2">            Formatter functions to apply to columns&#39; elements by position or</span>
<span class="s2">            name.</span>
<span class="s2">            The result of each function must be a unicode string.</span>
<span class="s2">            List/tuple must be of length equal to the number of columns.</span>
<span class="s2">        float_format : one-parameter function, optional, default None</span>
<span class="s2">            Formatter function to apply to columns&#39; elements if they are</span>
<span class="s2">            floats. This function must return a unicode string and will be</span>
<span class="s2">            applied only to the non-``NaN`` elements, with ``NaN`` being</span>
<span class="s2">            handled by ``na_rep``.</span>

<span class="s2">            .. versionchanged:: 1.2.0</span>

<span class="s2">        sparsify : bool, optional, default True</span>
<span class="s2">            Set to False for a DataFrame with a hierarchical index to print</span>
<span class="s2">            every multiindex key at each row.</span>
<span class="s2">        index_names : bool, optional, default True</span>
<span class="s2">            Prints the names of the indexes.</span>
<span class="s2">        justify : str, default None</span>
<span class="s2">            How to justify the column labels. If None uses the option from</span>
<span class="s2">            the print configuration (controlled by set_option), &#39;right&#39; out</span>
<span class="s2">            of the box. Valid values are</span>

<span class="s2">            * left</span>
<span class="s2">            * right</span>
<span class="s2">            * center</span>
<span class="s2">            * justify</span>
<span class="s2">            * justify-all</span>
<span class="s2">            * start</span>
<span class="s2">            * end</span>
<span class="s2">            * inherit</span>
<span class="s2">            * match-parent</span>
<span class="s2">            * initial</span>
<span class="s2">            * unset.</span>
<span class="s2">        max_rows : int, optional</span>
<span class="s2">            Maximum number of rows to display in the console.</span>
<span class="s2">        max_cols : int, optional</span>
<span class="s2">            Maximum number of columns to display in the console.</span>
<span class="s2">        show_dimensions : bool, default False</span>
<span class="s2">            Display DataFrame dimensions (number of rows by number of columns).</span>
<span class="s2">        decimal : str, default &#39;.&#39;</span>
<span class="s2">            Character recognized as decimal separator, e.g. &#39;,&#39; in Europe.</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="n">_VALID_JUSTIFY_PARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;left&quot;</span><span class="p">,</span>
    <span class="s2">&quot;right&quot;</span><span class="p">,</span>
    <span class="s2">&quot;center&quot;</span><span class="p">,</span>
    <span class="s2">&quot;justify&quot;</span><span class="p">,</span>
    <span class="s2">&quot;justify-all&quot;</span><span class="p">,</span>
    <span class="s2">&quot;start&quot;</span><span class="p">,</span>
    <span class="s2">&quot;end&quot;</span><span class="p">,</span>
    <span class="s2">&quot;inherit&quot;</span><span class="p">,</span>
    <span class="s2">&quot;match-parent&quot;</span><span class="p">,</span>
    <span class="s2">&quot;initial&quot;</span><span class="p">,</span>
    <span class="s2">&quot;unset&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">return_docstring</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Returns</span>
<span class="s2">        -------</span>
<span class="s2">        str or None</span>
<span class="s2">            If buf is None, returns the result as a string. Otherwise returns</span>
<span class="s2">            None.</span>
<span class="s2">    &quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">CategoricalFormatter</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">categorical</span><span class="p">:</span> <span class="n">Categorical</span><span class="p">,</span>
        <span class="n">buf</span><span class="p">:</span> <span class="n">IO</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">length</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">na_rep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NaN&quot;</span><span class="p">,</span>
        <span class="n">footer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">categorical</span> <span class="o">=</span> <span class="n">categorical</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">buf</span> <span class="k">if</span> <span class="n">buf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">StringIO</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span> <span class="o">=</span> <span class="n">na_rep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">footer</span> <span class="o">=</span> <span class="n">footer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quoting</span> <span class="o">=</span> <span class="n">QUOTE_NONNUMERIC</span>

    <span class="k">def</span> <span class="nf">_get_footer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">footer</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">footer</span><span class="p">:</span>
                <span class="n">footer</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span>
            <span class="n">footer</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categorical</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">level_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorical</span><span class="o">.</span><span class="n">_repr_categories_info</span><span class="p">()</span>

        <span class="c1"># Levels are added in a newline</span>
        <span class="k">if</span> <span class="n">footer</span><span class="p">:</span>
            <span class="n">footer</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">footer</span> <span class="o">+=</span> <span class="n">level_info</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_formatted_values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">format_array</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">categorical</span><span class="o">.</span><span class="n">_internal_get_values</span><span class="p">(),</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">float_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">na_rep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span><span class="p">,</span>
            <span class="n">quoting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quoting</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">categorical</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorical</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">categorical</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">footer</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_footer</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="n">fmt_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatted_values</span><span class="p">()</span>

        <span class="n">fmt_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fmt_values</span><span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fmt_values</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="n">values</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">footer</span><span class="p">:</span>
            <span class="n">footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_footer</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">footer</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">SeriesFormatter</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">series</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span>
        <span class="n">buf</span><span class="p">:</span> <span class="n">IO</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">length</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">header</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">na_rep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NaN&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">float_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">max_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">min_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">series</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">buf</span> <span class="k">if</span> <span class="n">buf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span> <span class="o">=</span> <span class="n">na_rep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="n">max_rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_rows</span> <span class="o">=</span> <span class="n">min_rows</span>

        <span class="k">if</span> <span class="n">float_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">float_format</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.float_format&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="n">float_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adj</span> <span class="o">=</span> <span class="n">get_adjustment</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_chk_truncate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_chk_truncate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr_row_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>

        <span class="n">min_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_rows</span>
        <span class="n">max_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rows</span>
        <span class="c1"># truncation determined by max_rows, actual truncated number of rows</span>
        <span class="c1"># used below by min_rows</span>
        <span class="n">is_truncated_vertically</span> <span class="o">=</span> <span class="n">max_rows</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_rows</span><span class="p">)</span>
        <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
        <span class="k">if</span> <span class="n">is_truncated_vertically</span><span class="p">:</span>
            <span class="n">max_rows</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">max_rows</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">min_rows</span><span class="p">:</span>
                <span class="c1"># if min_rows is set (not None or 0), set max_rows to minimum</span>
                <span class="c1"># of both</span>
                <span class="n">max_rows</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_rows</span><span class="p">,</span> <span class="n">max_rows</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">max_rows</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">row_num</span> <span class="o">=</span> <span class="n">max_rows</span>
                <span class="n">series</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">max_rows</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">row_num</span> <span class="o">=</span> <span class="n">max_rows</span> <span class="o">//</span> <span class="mi">2</span>
                <span class="n">series</span> <span class="o">=</span> <span class="n">concat</span><span class="p">((</span><span class="n">series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">row_num</span><span class="p">],</span> <span class="n">series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="n">row_num</span><span class="p">:]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr_row_num</span> <span class="o">=</span> <span class="n">row_num</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr_row_num</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr_series</span> <span class="o">=</span> <span class="n">series</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_truncated_vertically</span> <span class="o">=</span> <span class="n">is_truncated_vertically</span>

    <span class="k">def</span> <span class="nf">_get_footer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">name</span>
        <span class="n">footer</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">PeriodIndex</span><span class="p">,</span> <span class="n">TimedeltaIndex</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">footer</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Freq: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">freqstr</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">footer</span><span class="p">:</span>
                <span class="n">footer</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span>

            <span class="n">series_name</span> <span class="o">=</span> <span class="n">printing</span><span class="o">.</span><span class="n">pprint_thing</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">escape_chars</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">footer</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Name: </span><span class="si">{</span><span class="n">series_name</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="s2">&quot;truncate&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_truncated_vertically</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">footer</span><span class="p">:</span>
                <span class="n">footer</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span>
            <span class="n">footer</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtype_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr_series</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dtype_name</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">footer</span><span class="p">:</span>
                    <span class="n">footer</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span>
                <span class="n">footer</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;dtype: </span><span class="si">{</span><span class="n">printing</span><span class="o">.</span><span class="n">pprint_thing</span><span class="p">(</span><span class="n">dtype_name</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># level infos are added to the end and in a new line, like it is done</span>
        <span class="c1"># for Categoricals</span>
        <span class="k">if</span> <span class="n">is_categorical_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr_series</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="n">level_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_series</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">_repr_categories_info</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">footer</span><span class="p">:</span>
                <span class="n">footer</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">footer</span> <span class="o">+=</span> <span class="n">level_info</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_formatted_index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_series</span><span class="o">.</span><span class="n">index</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">MultiIndex</span><span class="p">):</span>
            <span class="n">have_header</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="n">fmt_index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">have_header</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">fmt_index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fmt_index</span><span class="p">,</span> <span class="n">have_header</span>

    <span class="k">def</span> <span class="nf">_get_formatted_values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">format_array</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr_series</span><span class="o">.</span><span class="n">_values</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">float_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">float_format</span><span class="p">,</span>
            <span class="n">na_rep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span><span class="p">,</span>
            <span class="n">leading_space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_series</span>
        <span class="n">footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_footer</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">([], </span><span class="si">{</span><span class="n">footer</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="n">fmt_index</span><span class="p">,</span> <span class="n">have_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatted_index</span><span class="p">()</span>
        <span class="n">fmt_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatted_values</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_truncated_vertically</span><span class="p">:</span>
            <span class="n">n_header_rows</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">row_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_row_num</span>
            <span class="n">row_num</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">row_num</span><span class="p">)</span>
            <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adj</span><span class="o">.</span><span class="n">len</span><span class="p">(</span><span class="n">fmt_values</span><span class="p">[</span><span class="n">row_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">width</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">dot_str</span> <span class="o">=</span> <span class="s2">&quot;...&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dot_str</span> <span class="o">=</span> <span class="s2">&quot;..&quot;</span>
            <span class="c1"># Series uses mode=center because it has single value columns</span>
            <span class="c1"># DataFrame uses mode=left</span>
            <span class="n">dot_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adj</span><span class="o">.</span><span class="n">justify</span><span class="p">([</span><span class="n">dot_str</span><span class="p">],</span> <span class="n">width</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">fmt_values</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">row_num</span> <span class="o">+</span> <span class="n">n_header_rows</span><span class="p">,</span> <span class="n">dot_str</span><span class="p">)</span>
            <span class="n">fmt_index</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">row_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adj</span><span class="o">.</span><span class="n">adjoin</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="n">fmt_index</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">fmt_values</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adj</span><span class="o">.</span><span class="n">adjoin</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">fmt_values</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="ow">and</span> <span class="n">have_header</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fmt_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">result</span>

        <span class="k">if</span> <span class="n">footer</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">footer</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">TextAdjustment</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.encoding&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">justify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">max_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">printing</span><span class="o">.</span><span class="n">justify</span><span class="p">(</span><span class="n">texts</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">adjoin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">space</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="n">lists</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">printing</span><span class="o">.</span><span class="n">adjoin</span><span class="p">(</span>
            <span class="n">space</span><span class="p">,</span> <span class="o">*</span><span class="n">lists</span><span class="p">,</span> <span class="n">strlen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">len</span><span class="p">,</span> <span class="n">justfunc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">justify</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">EastAsianTextAdjustment</span><span class="p">(</span><span class="n">TextAdjustment</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.unicode.ambiguous_as_wide&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ambiguous_width</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ambiguous_width</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Definition of East Asian Width</span>
        <span class="c1"># https://unicode.org/reports/tr11/</span>
        <span class="c1"># Ambiguous width can be changed by option</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_EAW_MAP</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Na&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate display width considering unicode East Asian Width</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_EAW_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">east_asian_width</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ambiguous_width</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">text</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">justify</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">max_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="c1"># re-calculate padding space per str considering East Asian Width</span>
        <span class="k">def</span> <span class="nf">_get_pad</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">max_len</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">_get_pad</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">_get_pad</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">_get_pad</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">get_adjustment</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">TextAdjustment</span><span class="p">:</span>
    <span class="n">use_east_asian_width</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.unicode.east_asian_width&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_east_asian_width</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">EastAsianTextAdjustment</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">TextAdjustment</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">get_dataframe_repr_params</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the parameters used to repr(dataFrame) calls using DataFrame.to_string.</span>

<span class="sd">    Supplying these parameters to DataFrame.to_string is equivalent to calling</span>
<span class="sd">    ``repr(DataFrame)``. This is useful if you want to adjust the repr output.</span>

<span class="sd">    .. versionadded:: 1.4.0</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame([[1, 2], [3, 4]])</span>
<span class="sd">    &gt;&gt;&gt; repr_params = pd.io.formats.format.get_dataframe_repr_params()</span>
<span class="sd">    &gt;&gt;&gt; repr(df) == df.to_string(**repr_params)</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pandas.io.formats</span> <span class="kn">import</span> <span class="n">console</span>

    <span class="k">if</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.expand_frame_repr&quot;</span><span class="p">):</span>
        <span class="n">line_width</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">get_console_size</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_width</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;max_rows&quot;</span><span class="p">:</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">),</span>
        <span class="s2">&quot;min_rows&quot;</span><span class="p">:</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.min_rows&quot;</span><span class="p">),</span>
        <span class="s2">&quot;max_cols&quot;</span><span class="p">:</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.max_columns&quot;</span><span class="p">),</span>
        <span class="s2">&quot;max_colwidth&quot;</span><span class="p">:</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">),</span>
        <span class="s2">&quot;show_dimensions&quot;</span><span class="p">:</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.show_dimensions&quot;</span><span class="p">),</span>
        <span class="s2">&quot;line_width&quot;</span><span class="p">:</span> <span class="n">line_width</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span> <span class="nf">get_series_repr_params</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the parameters used to repr(Series) calls using Series.to_string.</span>

<span class="sd">    Supplying these parameters to Series.to_string is equivalent to calling</span>
<span class="sd">    ``repr(series)``. This is useful if you want to adjust the series repr output.</span>

<span class="sd">    .. versionadded:: 1.4.0</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; ser = pd.Series([1, 2, 3, 4])</span>
<span class="sd">    &gt;&gt;&gt; repr_params = pd.io.formats.format.get_series_repr_params()</span>
<span class="sd">    &gt;&gt;&gt; repr(ser) == ser.to_string(**repr_params)</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_terminal_size</span><span class="p">()</span>
    <span class="n">max_rows</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">height</span>
        <span class="k">if</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">else</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">min_rows</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">height</span>
        <span class="k">if</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">else</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.min_rows&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;min_rows&quot;</span><span class="p">:</span> <span class="n">min_rows</span><span class="p">,</span>
        <span class="s2">&quot;max_rows&quot;</span><span class="p">:</span> <span class="n">max_rows</span><span class="p">,</span>
        <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.show_dimensions&quot;</span><span class="p">),</span>
    <span class="p">}</span>


<span class="k">class</span> <span class="nc">DataFrameFormatter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for processing dataframe formatting options and data.&quot;&quot;&quot;</span>

    <span class="vm">__doc__</span> <span class="o">=</span> <span class="vm">__doc__</span> <span class="k">if</span> <span class="vm">__doc__</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="vm">__doc__</span> <span class="o">+=</span> <span class="n">common_docstring</span> <span class="o">+</span> <span class="n">return_docstring</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">frame</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">columns</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">col_space</span><span class="p">:</span> <span class="n">ColspaceArgType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">header</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">na_rep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NaN&quot;</span><span class="p">,</span>
        <span class="n">formatters</span><span class="p">:</span> <span class="n">FormattersType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">justify</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">float_format</span><span class="p">:</span> <span class="n">FloatFormatType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sparsify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">index_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">max_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">min_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">show_dimensions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">decimal</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">bold_rows</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">escape</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_columns</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_colspace</span><span class="p">(</span><span class="n">col_space</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span> <span class="o">=</span> <span class="n">na_rep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_formatters</span><span class="p">(</span><span class="n">formatters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">justify</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_justify</span><span class="p">(</span><span class="n">justify</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="n">float_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sparsify</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_sparsify</span><span class="p">(</span><span class="n">sparsify</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_index_names</span> <span class="o">=</span> <span class="n">index_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decimal</span> <span class="o">=</span> <span class="n">decimal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bold_rows</span> <span class="o">=</span> <span class="n">bold_rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">escape</span> <span class="o">=</span> <span class="n">escape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="n">max_rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_rows</span> <span class="o">=</span> <span class="n">min_rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_cols</span> <span class="o">=</span> <span class="n">max_cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_dimensions</span> <span class="o">=</span> <span class="n">show_dimensions</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_cols_fitted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_max_cols_fitted</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_rows_fitted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_max_rows_fitted</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adj</span> <span class="o">=</span> <span class="n">get_adjustment</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_strcols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render a DataFrame to a list of columns (as lists of strings).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">strcols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_strcols_without_index</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">str_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatted_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span><span class="p">)</span>
            <span class="n">strcols</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">str_index</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">strcols</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">should_show_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_dimensions</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_dimensions</span> <span class="o">==</span> <span class="s2">&quot;truncate&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_truncated</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_truncated</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_truncated_horizontally</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_truncated_vertically</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_truncated_horizontally</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_cols_fitted</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_cols_fitted</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_truncated_vertically</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_rows_fitted</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rows_fitted</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dimensions_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">[</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows x </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> columns]&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_index_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_has_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_column_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_has_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">show_row_idx_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">has_index_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_index_names</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">show_col_idx_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">has_column_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_index_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_rows_displayed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_rows</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_initialize_sparsify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sparsify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sparsify</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.multi_sparse&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sparsify</span>

    <span class="k">def</span> <span class="nf">_initialize_formatters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">formatters</span><span class="p">:</span> <span class="n">FormattersType</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FormattersType</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">formatters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">formatters</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">formatters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">formatters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Formatters length(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">formatters</span><span class="p">)</span><span class="si">}</span><span class="s2">) should match &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;DataFrame number of columns(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_initialize_justify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">justify</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">justify</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.colheader_justify&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">justify</span>

    <span class="k">def</span> <span class="nf">_initialize_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Index</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># GH 47231 - columns doesn&#39;t have to be `Sequence[str]`</span>
            <span class="c1"># Will fix in later PR</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">ensure_index</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">Axes</span><span class="p">,</span> <span class="n">columns</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">cols</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span>

    <span class="k">def</span> <span class="nf">_initialize_colspace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_space</span><span class="p">:</span> <span class="n">ColspaceArgType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColspaceType</span><span class="p">:</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">ColspaceType</span>

        <span class="k">if</span> <span class="n">col_space</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col_space</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="n">col_space</span><span class="p">}</span>
            <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">column</span><span class="p">:</span> <span class="n">col_space</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col_space</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">col_space</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">column</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Col_space is defined for an unknown column: </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">col_space</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_space</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Col_space length(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">col_space</span><span class="p">)</span><span class="si">}</span><span class="s2">) should match &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;DataFrame number of columns(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">col_space</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_calc_max_cols_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of columns fitting the screen.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_in_terminal</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_cols</span>

        <span class="n">width</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_terminal_size</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_screen_narrow</span><span class="p">(</span><span class="n">width</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">width</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_cols</span>

    <span class="k">def</span> <span class="nf">_calc_max_rows_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of rows with data fitting the screen.&quot;&quot;&quot;</span>
        <span class="n">max_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_in_terminal</span><span class="p">():</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_terminal_size</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># rows available to fill with actual data</span>
                <span class="k">return</span> <span class="n">height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_number_of_auxillary_rows</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_screen_short</span><span class="p">(</span><span class="n">height</span><span class="p">):</span>
                <span class="n">max_rows</span> <span class="o">=</span> <span class="n">height</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rows</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rows</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_max_rows</span><span class="p">(</span><span class="n">max_rows</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_adjust_max_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adjust max_rows using display logic.</span>

<span class="sd">        See description here:</span>
<span class="sd">        https://pandas.pydata.org/docs/dev/user_guide/options.html#frequently-used-options</span>

<span class="sd">        GH #37359</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_rows</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_rows</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_rows</span><span class="p">:</span>
                <span class="c1"># if truncated, set max_rows showed to min_rows</span>
                <span class="n">max_rows</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_rows</span><span class="p">,</span> <span class="n">max_rows</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">max_rows</span>

    <span class="k">def</span> <span class="nf">_is_in_terminal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the output is to be shown in terminal.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_cols</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_is_screen_narrow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_width</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_cols</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_width</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_is_screen_short</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_height</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_number_of_auxillary_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get number of rows occupied by prompt, dots and dimension info.&quot;&quot;&quot;</span>
        <span class="n">dot_row</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">prompt_row</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">num_rows</span> <span class="o">=</span> <span class="n">dot_row</span> <span class="o">+</span> <span class="n">prompt_row</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_dimensions</span><span class="p">:</span>
            <span class="n">num_rows</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions_info</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
            <span class="n">num_rows</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">num_rows</span>

    <span class="k">def</span> <span class="nf">truncate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether the frame should be truncated. If so, slice the frame up.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_truncated_horizontally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_horizontally</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_truncated_vertically</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_vertically</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_truncate_horizontally</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove columns, which are not to be displayed and adjust formatters.</span>

<span class="sd">        Attributes affected:</span>
<span class="sd">            - tr_frame</span>
<span class="sd">            - formatters</span>
<span class="sd">            - tr_col_num</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_cols_fitted</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">col_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_cols_fitted</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">col_num</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="n">col_num</span><span class="p">]</span>
            <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="n">col_num</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span> <span class="o">=</span> <span class="n">concat</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># truncate formatter</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formatters</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">formatters</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">formatters</span><span class="p">[:</span><span class="n">col_num</span><span class="p">],</span>
                    <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">formatters</span><span class="p">[</span><span class="o">-</span><span class="n">col_num</span><span class="p">:],</span>
                <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col_num</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_cols</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="n">col_num</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr_col_num</span> <span class="o">=</span> <span class="n">col_num</span>

    <span class="k">def</span> <span class="nf">_truncate_vertically</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove rows, which are not to be displayed.</span>

<span class="sd">        Attributes affected:</span>
<span class="sd">            - tr_frame</span>
<span class="sd">            - tr_row_num</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rows_fitted</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">row_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rows_fitted</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">row_num</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">head</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">row_num</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">tail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="n">row_num</span><span class="p">:,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span> <span class="o">=</span> <span class="n">concat</span><span class="p">((</span><span class="n">head</span><span class="p">,</span> <span class="n">tail</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row_num</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rows</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">row_num</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr_row_num</span> <span class="o">=</span> <span class="n">row_num</span>

    <span class="k">def</span> <span class="nf">_get_strcols_without_index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="n">strcols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_list_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span><span class="p">):</span>
                <span class="n">fmt_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">fmt_values</span> <span class="o">=</span> <span class="n">_make_fixed_width</span><span class="p">(</span>
                    <span class="n">strings</span><span class="o">=</span><span class="n">fmt_values</span><span class="p">,</span>
                    <span class="n">justify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">justify</span><span class="p">,</span>
                    <span class="n">minimum</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_space</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                    <span class="n">adj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adj</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">strcols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fmt_values</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">strcols</span>

        <span class="k">if</span> <span class="n">is_list_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">):</span>
            <span class="c1"># cast here since can&#39;t be bool if is_list_like</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Writing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> cols &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;but got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">)</span><span class="si">}</span><span class="s2"> aliases&quot;</span>
                <span class="p">)</span>
            <span class="n">str_columns</span> <span class="o">=</span> <span class="p">[[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">str_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatted_column_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_row_idx_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">str_columns</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span><span class="p">):</span>
            <span class="n">cheader</span> <span class="o">=</span> <span class="n">str_columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">header_colwidth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_space</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj</span><span class="o">.</span><span class="n">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cheader</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">fmt_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">fmt_values</span> <span class="o">=</span> <span class="n">_make_fixed_width</span><span class="p">(</span>
                <span class="n">fmt_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">justify</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="n">header_colwidth</span><span class="p">,</span> <span class="n">adj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adj</span>
            <span class="p">)</span>

            <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj</span><span class="o">.</span><span class="n">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fmt_values</span><span class="p">),</span> <span class="n">header_colwidth</span><span class="p">)</span>
            <span class="n">cheader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adj</span><span class="o">.</span><span class="n">justify</span><span class="p">(</span><span class="n">cheader</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">justify</span><span class="p">)</span>
            <span class="n">strcols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cheader</span> <span class="o">+</span> <span class="n">fmt_values</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">strcols</span>

    <span class="k">def</span> <span class="nf">format_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_frame</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">format_array</span><span class="p">(</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_values</span><span class="p">,</span>
            <span class="n">formatter</span><span class="p">,</span>
            <span class="n">float_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">float_format</span><span class="p">,</span>
            <span class="n">na_rep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span><span class="p">,</span>
            <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col_space</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
            <span class="n">decimal</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decimal</span><span class="p">,</span>
            <span class="n">leading_space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_formatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formatters</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">is_integer</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_integer</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_formatted_column_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="kn">from</span> <span class="nn">pandas.core.indexes.multi</span> <span class="kn">import</span> <span class="n">sparsify_labels</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">columns</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">MultiIndex</span><span class="p">):</span>
            <span class="n">fmt_columns</span> <span class="o">=</span> <span class="n">columns</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sparsify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">adjoin</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">fmt_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">fmt_columns</span><span class="p">))</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">_values</span>

            <span class="c1"># if we have a Float level, they don&#39;t use leading space at all</span>
            <span class="n">restrict_formatting</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">level</span><span class="o">.</span><span class="n">is_floating</span> <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">columns</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>
            <span class="n">need_leadsp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fmt_columns</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">is_numeric_dtype</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">)))</span>

            <span class="k">def</span> <span class="nf">space_format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">y</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatters</span>
                    <span class="ow">and</span> <span class="n">need_leadsp</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">restrict_formatting</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">y</span>
                <span class="k">return</span> <span class="n">y</span>

            <span class="n">str_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">([</span><span class="n">space_format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fmt_columns</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparsify</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_columns</span><span class="p">):</span>
                <span class="n">str_columns</span> <span class="o">=</span> <span class="n">sparsify_labels</span><span class="p">(</span><span class="n">str_columns</span><span class="p">)</span>

            <span class="n">str_columns</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">str_columns</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmt_columns</span> <span class="o">=</span> <span class="n">columns</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">dtypes</span>
            <span class="n">need_leadsp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fmt_columns</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">is_numeric_dtype</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">)))</span>
            <span class="n">str_columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">x</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="n">need_leadsp</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">else</span> <span class="n">x</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fmt_columns</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="c1"># self.str_columns = str_columns</span>
        <span class="k">return</span> <span class="n">str_columns</span>

    <span class="k">def</span> <span class="nf">_get_formatted_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="c1"># Note: this is only used by to_string() and to_latex(), not by</span>
        <span class="c1"># to_html(). so safe to cast col_space here.</span>
        <span class="n">col_space</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_space</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">index</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">(</span><span class="s2">&quot;__index__&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">MultiIndex</span><span class="p">):</span>
            <span class="n">fmt_index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">sparsify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sparsify</span><span class="p">,</span>
                <span class="n">adjoin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_row_idx_names</span><span class="p">,</span>
                <span class="n">formatter</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmt_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_row_idx_names</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="n">fmt</span><span class="p">)]</span>

        <span class="n">fmt_index</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">tuple</span><span class="p">(</span>
                <span class="n">_make_fixed_width</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="n">col_space</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">adj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adj</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fmt_index</span>
        <span class="p">]</span>

        <span class="n">adjoined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adj</span><span class="o">.</span><span class="n">adjoin</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">fmt_index</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># empty space for columns</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_col_idx_names</span><span class="p">:</span>
            <span class="n">col_header</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_column_name_list</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col_header</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">columns</span><span class="o">.</span><span class="n">nlevels</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">col_header</span> <span class="o">+</span> <span class="n">adjoined</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">adjoined</span>

    <span class="k">def</span> <span class="nf">_get_column_name_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]:</span>
        <span class="n">names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">MultiIndex</span><span class="p">):</span>
            <span class="n">names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">columns</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">columns</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">names</span>


<span class="k">class</span> <span class="nc">DataFrameRenderer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for creating dataframe output in multiple formats.</span>

<span class="sd">    Called in pandas.core.generic.NDFrame:</span>
<span class="sd">        - to_csv</span>
<span class="sd">        - to_latex</span>

<span class="sd">    Called in pandas.core.frame.DataFrame:</span>
<span class="sd">        - to_html</span>
<span class="sd">        - to_string</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fmt : DataFrameFormatter</span>
<span class="sd">        Formatter with the formatting options.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="p">:</span> <span class="n">DataFrameFormatter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span>

    <span class="k">def</span> <span class="nf">to_latex</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">buf</span><span class="p">:</span> <span class="n">FilePath</span> <span class="o">|</span> <span class="n">WriteBuffer</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">column_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">longtable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">multicolumn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">multicolumn_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">multirow</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">caption</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render a DataFrame to a LaTeX tabular/longtable environment output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pandas.io.formats.latex</span> <span class="kn">import</span> <span class="n">LatexFormatter</span>

        <span class="n">latex_formatter</span> <span class="o">=</span> <span class="n">LatexFormatter</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">,</span>
            <span class="n">longtable</span><span class="o">=</span><span class="n">longtable</span><span class="p">,</span>
            <span class="n">column_format</span><span class="o">=</span><span class="n">column_format</span><span class="p">,</span>
            <span class="n">multicolumn</span><span class="o">=</span><span class="n">multicolumn</span><span class="p">,</span>
            <span class="n">multicolumn_format</span><span class="o">=</span><span class="n">multicolumn_format</span><span class="p">,</span>
            <span class="n">multirow</span><span class="o">=</span><span class="n">multirow</span><span class="p">,</span>
            <span class="n">caption</span><span class="o">=</span><span class="n">caption</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
            <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">latex_formatter</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">save_to_buffer</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">buf</span><span class="o">=</span><span class="n">buf</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_html</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">buf</span><span class="p">:</span> <span class="n">FilePath</span> <span class="o">|</span> <span class="n">WriteBuffer</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">classes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">notebook</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">border</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">table_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">render_links</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render a DataFrame to a html table.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        buf : str, path object, file-like object, or None, default None</span>
<span class="sd">            String, path object (implementing ``os.PathLike[str]``), or file-like</span>
<span class="sd">            object implementing a string ``write()`` function. If None, the result is</span>
<span class="sd">            returned as a string.</span>
<span class="sd">        encoding : str, default utf-8</span>
<span class="sd">            Set character encoding.</span>
<span class="sd">        classes : str or list-like</span>
<span class="sd">            classes to include in the `class` attribute of the opening</span>
<span class="sd">            ``&lt;table&gt;`` tag, in addition to the default &quot;dataframe&quot;.</span>
<span class="sd">        notebook : {True, False}, optional, default False</span>
<span class="sd">            Whether the generated HTML is for IPython Notebook.</span>
<span class="sd">        border : int</span>
<span class="sd">            A ``border=border`` attribute is included in the opening</span>
<span class="sd">            ``&lt;table&gt;`` tag. Default ``pd.options.display.html.border``.</span>
<span class="sd">        table_id : str, optional</span>
<span class="sd">            A css id is included in the opening `&lt;table&gt;` tag if specified.</span>
<span class="sd">        render_links : bool, default False</span>
<span class="sd">            Convert URLs to HTML links.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pandas.io.formats.html</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">HTMLFormatter</span><span class="p">,</span>
            <span class="n">NotebookFormatter</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">Klass</span> <span class="o">=</span> <span class="n">NotebookFormatter</span> <span class="k">if</span> <span class="n">notebook</span> <span class="k">else</span> <span class="n">HTMLFormatter</span>

        <span class="n">html_formatter</span> <span class="o">=</span> <span class="n">Klass</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">,</span>
            <span class="n">classes</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span>
            <span class="n">border</span><span class="o">=</span><span class="n">border</span><span class="p">,</span>
            <span class="n">table_id</span><span class="o">=</span><span class="n">table_id</span><span class="p">,</span>
            <span class="n">render_links</span><span class="o">=</span><span class="n">render_links</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">html_formatter</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">save_to_buffer</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">buf</span><span class="o">=</span><span class="n">buf</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">buf</span><span class="p">:</span> <span class="n">FilePath</span> <span class="o">|</span> <span class="n">WriteBuffer</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">line_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render a DataFrame to a console-friendly tabular output.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        buf : str, path object, file-like object, or None, default None</span>
<span class="sd">            String, path object (implementing ``os.PathLike[str]``), or file-like</span>
<span class="sd">            object implementing a string ``write()`` function. If None, the result is</span>
<span class="sd">            returned as a string.</span>
<span class="sd">        encoding: str, default utf-8</span>
<span class="sd">            Set character encoding.</span>
<span class="sd">        line_width : int, optional</span>
<span class="sd">            Width to wrap a line in characters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pandas.io.formats.string</span> <span class="kn">import</span> <span class="n">StringFormatter</span>

        <span class="n">string_formatter</span> <span class="o">=</span> <span class="n">StringFormatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="n">line_width</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string_formatter</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">save_to_buffer</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">buf</span><span class="o">=</span><span class="n">buf</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_csv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path_or_buf</span><span class="p">:</span> <span class="n">FilePath</span> <span class="o">|</span> <span class="n">WriteBuffer</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">|</span> <span class="n">WriteBuffer</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
        <span class="n">columns</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">index_label</span><span class="p">:</span> <span class="n">IndexLabel</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
        <span class="n">compression</span><span class="p">:</span> <span class="n">CompressionOptions</span> <span class="o">=</span> <span class="s2">&quot;infer&quot;</span><span class="p">,</span>
        <span class="n">quoting</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">quotechar</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span>
        <span class="n">lineterminator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">date_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">doublequote</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">escapechar</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;strict&quot;</span><span class="p">,</span>
        <span class="n">storage_options</span><span class="p">:</span> <span class="n">StorageOptions</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render dataframe as comma-separated file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pandas.io.formats.csvs</span> <span class="kn">import</span> <span class="n">CSVFormatter</span>

        <span class="k">if</span> <span class="n">path_or_buf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">created_buffer</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">path_or_buf</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">created_buffer</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">csv_formatter</span> <span class="o">=</span> <span class="n">CSVFormatter</span><span class="p">(</span>
            <span class="n">path_or_buf</span><span class="o">=</span><span class="n">path_or_buf</span><span class="p">,</span>
            <span class="n">lineterminator</span><span class="o">=</span><span class="n">lineterminator</span><span class="p">,</span>
            <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
            <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
            <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
            <span class="n">quoting</span><span class="o">=</span><span class="n">quoting</span><span class="p">,</span>
            <span class="n">cols</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
            <span class="n">index_label</span><span class="o">=</span><span class="n">index_label</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
            <span class="n">quotechar</span><span class="o">=</span><span class="n">quotechar</span><span class="p">,</span>
            <span class="n">date_format</span><span class="o">=</span><span class="n">date_format</span><span class="p">,</span>
            <span class="n">doublequote</span><span class="o">=</span><span class="n">doublequote</span><span class="p">,</span>
            <span class="n">escapechar</span><span class="o">=</span><span class="n">escapechar</span><span class="p">,</span>
            <span class="n">storage_options</span><span class="o">=</span><span class="n">storage_options</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">csv_formatter</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">created_buffer</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path_or_buf</span><span class="p">,</span> <span class="n">StringIO</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">path_or_buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
            <span class="n">path_or_buf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">content</span>

        <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">save_to_buffer</span><span class="p">(</span>
    <span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">buf</span><span class="p">:</span> <span class="n">FilePath</span> <span class="o">|</span> <span class="n">WriteBuffer</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform serialization. Write to buf or return as string if buf is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">get_buffer</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># error: &quot;WriteBuffer[str]&quot; has no attribute &quot;getvalue&quot;</span>
            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>  <span class="c1"># type: ignore[attr-defined]</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">get_buffer</span><span class="p">(</span>
    <span class="n">buf</span><span class="p">:</span> <span class="n">FilePath</span> <span class="o">|</span> <span class="n">WriteBuffer</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">WriteBuffer</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="n">Generator</span><span class="p">[</span><span class="n">StringIO</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Context manager to open, yield and close buffer for filenames or Path-like</span>
<span class="sd">    objects, otherwise yield buf unchanged.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">buf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="n">stringify_path</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;utf-8&quot;</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;buf is not a file name and encoding is specified.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">):</span>
        <span class="c1"># Incompatible types in &quot;yield&quot; (actual type &quot;Union[str, WriteBuffer[str],</span>
        <span class="c1"># StringIO]&quot;, expected type &quot;Union[WriteBuffer[str], StringIO]&quot;)</span>
        <span class="k">yield</span> <span class="n">buf</span>  <span class="c1"># type: ignore[misc]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">check_parent_directory</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># GH#30034 open instead of codecs.open prevents a file leak</span>
            <span class="c1">#  if we have an invalid encoding argument.</span>
            <span class="c1"># newline=&quot;&quot; is needed to roundtrip correctly on</span>
            <span class="c1">#  windows test_to_latex_filename</span>
            <span class="k">yield</span> <span class="n">f</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;buf is not a file name and it has no write method&quot;</span><span class="p">)</span>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># Array formatters</span>


<span class="k">def</span> <span class="nf">format_array</span><span class="p">(</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">formatter</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">float_format</span><span class="p">:</span> <span class="n">FloatFormatType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">na_rep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NaN&quot;</span><span class="p">,</span>
    <span class="n">digits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">space</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">justify</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span>
    <span class="n">decimal</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">leading_space</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">quoting</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fallback_formatter</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Format an array for printing.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    values</span>
<span class="sd">    formatter</span>
<span class="sd">    float_format</span>
<span class="sd">    na_rep</span>
<span class="sd">    digits</span>
<span class="sd">    space</span>
<span class="sd">    justify</span>
<span class="sd">    decimal</span>
<span class="sd">    leading_space : bool, optional, default True</span>
<span class="sd">        Whether the array should be formatted with a leading space.</span>
<span class="sd">        When an array as a column of a Series or DataFrame, we do want</span>
<span class="sd">        the leading space to pad between columns.</span>

<span class="sd">        When formatting an Index subclass</span>
<span class="sd">        (e.g. IntervalIndex._format_native_types), we don&#39;t want the</span>
<span class="sd">        leading space since it should be left-aligned.</span>
<span class="sd">    fallback_formatter</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[str]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fmt_klass</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">GenericArrayFormatter</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">is_datetime64_dtype</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
        <span class="n">fmt_klass</span> <span class="o">=</span> <span class="n">Datetime64Formatter</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">DatetimeTZDtype</span><span class="p">):</span>
        <span class="n">fmt_klass</span> <span class="o">=</span> <span class="n">Datetime64TZFormatter</span>
    <span class="k">elif</span> <span class="n">is_timedelta64_dtype</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
        <span class="n">fmt_klass</span> <span class="o">=</span> <span class="n">Timedelta64Formatter</span>
    <span class="k">elif</span> <span class="n">is_extension_array_dtype</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
        <span class="n">fmt_klass</span> <span class="o">=</span> <span class="n">ExtensionArrayFormatter</span>
    <span class="k">elif</span> <span class="n">is_float_dtype</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_complex_dtype</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
        <span class="n">fmt_klass</span> <span class="o">=</span> <span class="n">FloatArrayFormatter</span>
    <span class="k">elif</span> <span class="n">is_integer_dtype</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
        <span class="n">fmt_klass</span> <span class="o">=</span> <span class="n">IntArrayFormatter</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fmt_klass</span> <span class="o">=</span> <span class="n">GenericArrayFormatter</span>

    <span class="k">if</span> <span class="n">space</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">space</span> <span class="o">=</span> <span class="mi">12</span>

    <span class="k">if</span> <span class="n">float_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">float_format</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.float_format&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">digits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">digits</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.precision&quot;</span><span class="p">)</span>

    <span class="n">fmt_obj</span> <span class="o">=</span> <span class="n">fmt_klass</span><span class="p">(</span>
        <span class="n">values</span><span class="p">,</span>
        <span class="n">digits</span><span class="o">=</span><span class="n">digits</span><span class="p">,</span>
        <span class="n">na_rep</span><span class="o">=</span><span class="n">na_rep</span><span class="p">,</span>
        <span class="n">float_format</span><span class="o">=</span><span class="n">float_format</span><span class="p">,</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">formatter</span><span class="p">,</span>
        <span class="n">space</span><span class="o">=</span><span class="n">space</span><span class="p">,</span>
        <span class="n">justify</span><span class="o">=</span><span class="n">justify</span><span class="p">,</span>
        <span class="n">decimal</span><span class="o">=</span><span class="n">decimal</span><span class="p">,</span>
        <span class="n">leading_space</span><span class="o">=</span><span class="n">leading_space</span><span class="p">,</span>
        <span class="n">quoting</span><span class="o">=</span><span class="n">quoting</span><span class="p">,</span>
        <span class="n">fallback_formatter</span><span class="o">=</span><span class="n">fallback_formatter</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">fmt_obj</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">GenericArrayFormatter</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">values</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">digits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
        <span class="n">formatter</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">na_rep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NaN&quot;</span><span class="p">,</span>
        <span class="n">space</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">float_format</span><span class="p">:</span> <span class="n">FloatFormatType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">justify</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span>
        <span class="n">decimal</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">quoting</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fixed_width</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">leading_space</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">fallback_formatter</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digits</span> <span class="o">=</span> <span class="n">digits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span> <span class="o">=</span> <span class="n">na_rep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">space</span> <span class="o">=</span> <span class="n">space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">formatter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="n">float_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">justify</span> <span class="o">=</span> <span class="n">justify</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decimal</span> <span class="o">=</span> <span class="n">decimal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quoting</span> <span class="o">=</span> <span class="n">quoting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_width</span> <span class="o">=</span> <span class="n">fixed_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">leading_space</span> <span class="o">=</span> <span class="n">leading_space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fallback_formatter</span> <span class="o">=</span> <span class="n">fallback_formatter</span>

    <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">fmt_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_strings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_make_fixed_width</span><span class="p">(</span><span class="n">fmt_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">justify</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">float_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">float_format</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.float_format&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">float_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">precision</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.precision&quot;</span><span class="p">)</span>
                <span class="n">float_format</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_trim_zeros_single_float</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2"> .</span><span class="si">{</span><span class="n">precision</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">float_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">float_format</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_formatter</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">quote_strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quoting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">quoting</span> <span class="o">!=</span> <span class="n">QUOTE_NONE</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
                <span class="n">printing</span><span class="o">.</span><span class="n">pprint_thing</span><span class="p">,</span>
                <span class="n">escape_chars</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">),</span>
                <span class="n">quote_strings</span><span class="o">=</span><span class="n">quote_strings</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">def</span> <span class="nf">_format</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">is_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># try block for np.isnat specifically</span>
                    <span class="c1"># determine na_rep if x is None or NaT-like</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s2">&quot;None&quot;</span>
                    <span class="k">elif</span> <span class="n">x</span> <span class="ow">is</span> <span class="n">NA</span><span class="p">:</span>
                        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">NA</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">x</span> <span class="ow">is</span> <span class="n">NaT</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnat</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                        <span class="k">return</span> <span class="s2">&quot;NaT&quot;</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                    <span class="c1"># np.isnat only handles datetime or timedelta objects</span>
                    <span class="k">pass</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">PandasObject</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">StringDtype</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># object dtype</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">formatter</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

        <span class="n">vals</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">extract_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;ExtensionArray formatting should use ExtensionArrayFormatter&quot;</span>
            <span class="p">)</span>
        <span class="n">inferred</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">map_infer</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">is_float</span><span class="p">)</span>
        <span class="n">is_float_type</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">inferred</span>
            <span class="c1"># vals may have 2 or more dimensions</span>
            <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">notna</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="o">.</span><span class="n">shape</span><span class="p">))))</span>
        <span class="p">)</span>
        <span class="n">leading_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leading_space</span>
        <span class="k">if</span> <span class="n">leading_space</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">leading_space</span> <span class="o">=</span> <span class="n">is_float_type</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>

        <span class="n">fmt_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_float_type</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">leading_space</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fmt_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">_format</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">is_float_type</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">fmt_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">float_format</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">leading_space</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="c1"># False specifically, so that the default is</span>
                    <span class="c1"># to include a space if we get here.</span>
                    <span class="n">tpl</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{v}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tpl</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="si">{v}</span><span class="s2">&quot;</span>
                <span class="n">fmt_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="n">_format</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">fmt_values</span>


<span class="k">class</span> <span class="nc">FloatArrayFormatter</span><span class="p">(</span><span class="n">GenericArrayFormatter</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># float_format is expected to be a string</span>
        <span class="c1"># formatter should be used to pass a function</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">float_format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># GH21625, GH22270</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixed_width</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">float_format</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">float_format</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_value_formatter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">float_format</span><span class="p">:</span> <span class="n">FloatFormatType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a function to be applied on each value to format it&quot;&quot;&quot;</span>
        <span class="c1"># the float_format parameter supersedes self.float_format</span>
        <span class="k">if</span> <span class="n">float_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">float_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">float_format</span>

        <span class="c1"># we are going to compose different functions, to first convert to</span>
        <span class="c1"># a string, then replace the decimal symbol, and finally chop according</span>
        <span class="c1"># to the threshold</span>

        <span class="c1"># when there is no float_format, we use str instead of &#39;%g&#39;</span>
        <span class="c1"># because str(0.0) = &#39;0.0&#39; while &#39;%g&#39; % 0.0 = &#39;0&#39;</span>
        <span class="k">if</span> <span class="n">float_format</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">base_formatter</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">float_format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># for mypy</span>
                <span class="c1"># error: &quot;str&quot; not callable</span>
                <span class="c1"># error: Unexpected keyword argument &quot;value&quot; for &quot;__call__&quot; of</span>
                <span class="c1"># &quot;EngFormatter&quot;</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="n">float_format</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>  <span class="c1"># type: ignore[operator,call-arg]</span>
                    <span class="k">if</span> <span class="n">notna</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span>
                <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">base_formatter</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="n">notna</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimal</span> <span class="o">!=</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">decimal_formatter</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">base_formatter</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimal</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">decimal_formatter</span> <span class="o">=</span> <span class="n">base_formatter</span>

        <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">decimal_formatter</span>

        <span class="k">def</span> <span class="nf">formatter</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">notna</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">decimal_formatter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">decimal_formatter</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span>

        <span class="k">return</span> <span class="n">formatter</span>

    <span class="k">def</span> <span class="nf">get_result_as_array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the float values converted into strings using</span>
<span class="sd">        the parameters given at initialisation, as a numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">format_with_na_rep</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">formatter</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">na_rep</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">isna</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">formatted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">formatter</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span> <span class="k">else</span> <span class="n">na_rep</span>
                    <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">mask</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
                <span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">formatted</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">format_with_na_rep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_width</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.chop_threshold&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># if we have a fixed_width, we&#39;ll need to try different float_format</span>
        <span class="k">def</span> <span class="nf">format_values_with</span><span class="p">(</span><span class="n">float_format</span><span class="p">):</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_formatter</span><span class="p">(</span><span class="n">float_format</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>

            <span class="c1"># default formatter leaves a space to the left when formatting</span>
            <span class="c1"># floats, must be consistent for left-justifying NaNs (GH #25061)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">justify</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
                <span class="n">na_rep</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">na_rep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span>

            <span class="c1"># separate the wheat from the chaff</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>
            <span class="n">is_complex</span> <span class="o">=</span> <span class="n">is_complex_dtype</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">format_with_na_rep</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">formatter</span><span class="p">,</span> <span class="n">na_rep</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_width</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_complex</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">_trim_zeros_complex</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimal</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">_trim_zeros_float</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimal</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">values</span>

        <span class="c1"># There is a special default string when we are fixed-width</span>
        <span class="c1"># The default is otherwise to use str instead of a formatting string</span>
        <span class="n">float_format</span><span class="p">:</span> <span class="n">FloatFormatType</span> <span class="o">|</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">float_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_width</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">leading_space</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">fmt_str</span> <span class="o">=</span> <span class="s2">&quot;{value: .</span><span class="si">{digits:d}</span><span class="s2">f}&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fmt_str</span> <span class="o">=</span> <span class="s2">&quot;{value:.</span><span class="si">{digits:d}</span><span class="s2">f}&quot;</span>
                <span class="n">float_format</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">fmt_str</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">float_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">float_format</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">float_format</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">float_format</span> <span class="o">%</span> <span class="n">value</span>

        <span class="n">formatted_values</span> <span class="o">=</span> <span class="n">format_values_with</span><span class="p">(</span><span class="n">float_format</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_width</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">formatted_values</span>

        <span class="c1"># we need do convert to engineering format if some values are too small</span>
        <span class="c1"># and would appear as 0, or if some values are too big and take too</span>
        <span class="c1"># much space</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">formatted_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">formatted_values</span><span class="p">)</span>
            <span class="n">too_long</span> <span class="o">=</span> <span class="n">maxlen</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="mi">6</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">too_long</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>
            <span class="n">abs_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="c1"># this is pretty arbitrary for now</span>
            <span class="c1"># large values: more that 8 characters including decimal symbol</span>
            <span class="c1"># and first digit, hence &gt; 1e6</span>
            <span class="n">has_large_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">abs_vals</span> <span class="o">&gt;</span> <span class="mf">1e6</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
            <span class="n">has_small_values</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">abs_vals</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">digits</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">abs_vals</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">has_small_values</span> <span class="ow">or</span> <span class="p">(</span><span class="n">too_long</span> <span class="ow">and</span> <span class="n">has_large_values</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">leading_space</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">fmt_str</span> <span class="o">=</span> <span class="s2">&quot;{value: .</span><span class="si">{digits:d}</span><span class="s2">e}&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmt_str</span> <span class="o">=</span> <span class="s2">&quot;{value:.</span><span class="si">{digits:d}</span><span class="s2">e}&quot;</span>
            <span class="n">float_format</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">fmt_str</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span>
            <span class="n">formatted_values</span> <span class="o">=</span> <span class="n">format_values_with</span><span class="p">(</span><span class="n">float_format</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">formatted_values</span>

    <span class="k">def</span> <span class="nf">_format_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_result_as_array</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">IntArrayFormatter</span><span class="p">(</span><span class="n">GenericArrayFormatter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_format_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">leading_space</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">formatter_str</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">formatter_str</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2"> d</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="ow">or</span> <span class="n">formatter_str</span>
        <span class="n">fmt_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">formatter</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">fmt_values</span>


<span class="k">class</span> <span class="nc">Datetime64Formatter</span><span class="p">(</span><span class="n">GenericArrayFormatter</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">Series</span> <span class="o">|</span> <span class="n">DatetimeIndex</span> <span class="o">|</span> <span class="n">DatetimeArray</span><span class="p">,</span>
        <span class="n">nat_rep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NaT&quot;</span><span class="p">,</span>
        <span class="n">date_format</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nat_rep</span> <span class="o">=</span> <span class="n">nat_rep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_format</span> <span class="o">=</span> <span class="n">date_format</span>

    <span class="k">def</span> <span class="nf">_format_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;we by definition have DO NOT have a TZ&quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">DatetimeIndex</span><span class="p">):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>

        <span class="n">fmt_values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">_format_native_types</span><span class="p">(</span>
            <span class="n">na_rep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nat_rep</span><span class="p">,</span> <span class="n">date_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date_format</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">fmt_values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">ExtensionArrayFormatter</span><span class="p">(</span><span class="n">GenericArrayFormatter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_format_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">extract_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span>
        <span class="n">fallback_formatter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">formatter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fallback_formatter</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">_formatter</span><span class="p">(</span><span class="n">boxed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">Categorical</span><span class="p">):</span>
            <span class="c1"># Categorical is special for now, so that we can preserve tzinfo</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">_internal_get_values</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="n">fmt_values</span> <span class="o">=</span> <span class="n">format_array</span><span class="p">(</span>
            <span class="n">array</span><span class="p">,</span>
            <span class="n">formatter</span><span class="p">,</span>
            <span class="n">float_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">float_format</span><span class="p">,</span>
            <span class="n">na_rep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">na_rep</span><span class="p">,</span>
            <span class="n">digits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">digits</span><span class="p">,</span>
            <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="p">,</span>
            <span class="n">justify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">justify</span><span class="p">,</span>
            <span class="n">decimal</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decimal</span><span class="p">,</span>
            <span class="n">leading_space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">leading_space</span><span class="p">,</span>
            <span class="n">quoting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quoting</span><span class="p">,</span>
            <span class="n">fallback_formatter</span><span class="o">=</span><span class="n">fallback_formatter</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">fmt_values</span>


<span class="k">def</span> <span class="nf">format_percentiles</span><span class="p">(</span>
    <span class="n">percentiles</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Outputs rounded and formatted percentiles.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    percentiles : list-like, containing floats from interval [0,1]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    formatted : list of strings</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Rounding precision is chosen so that: (1) if any two elements of</span>
<span class="sd">    ``percentiles`` differ, they remain different after rounding</span>
<span class="sd">    (2) no entry is *rounded* to 0% or 100%.</span>
<span class="sd">    Any non-integer is always rounded to at least 1 decimal place.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Keeps all entries different after rounding:</span>

<span class="sd">    &gt;&gt;&gt; format_percentiles([0.01999, 0.02001, 0.5, 0.666666, 0.9999])</span>
<span class="sd">    [&#39;1.999%&#39;, &#39;2.001%&#39;, &#39;50%&#39;, &#39;66.667%&#39;, &#39;99.99%&#39;]</span>

<span class="sd">    No element is rounded to 0% or 100% (unless already equal to it).</span>
<span class="sd">    Duplicates are allowed:</span>

<span class="sd">    &gt;&gt;&gt; format_percentiles([0, 0.5, 0.02001, 0.5, 0.666666, 0.9999])</span>
<span class="sd">    [&#39;0%&#39;, &#39;50%&#39;, &#39;2.0%&#39;, &#39;50%&#39;, &#39;66.67%&#39;, &#39;99.99%&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">percentiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">percentiles</span><span class="p">)</span>

    <span class="c1"># It checks for np.NaN as well</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">is_numeric_dtype</span><span class="p">(</span><span class="n">percentiles</span><span class="p">)</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">percentiles</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">percentiles</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;percentiles should all be in the interval [0,1]&quot;</span><span class="p">)</span>

    <span class="n">percentiles</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">percentiles</span>
    <span class="n">percentiles_round_type</span> <span class="o">=</span> <span class="n">percentiles</span><span class="o">.</span><span class="n">round</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">int_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">percentiles_round_type</span><span class="p">,</span> <span class="n">percentiles</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">int_idx</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">percentiles_round_type</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">out</span><span class="p">]</span>

    <span class="n">unique_pcts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">percentiles</span><span class="p">)</span>
    <span class="n">to_begin</span> <span class="o">=</span> <span class="n">unique_pcts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">unique_pcts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">to_end</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">unique_pcts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">unique_pcts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="c1"># Least precision that keeps percentiles unique after rounding</span>
    <span class="n">prec</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ediff1d</span><span class="p">(</span><span class="n">unique_pcts</span><span class="p">,</span> <span class="n">to_begin</span><span class="o">=</span><span class="n">to_begin</span><span class="p">,</span> <span class="n">to_end</span><span class="o">=</span><span class="n">to_end</span><span class="p">)))</span>
    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">prec</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">percentiles</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
    <span class="n">out</span><span class="p">[</span><span class="n">int_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">percentiles</span><span class="p">[</span><span class="n">int_idx</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="n">out</span><span class="p">[</span><span class="o">~</span><span class="n">int_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">percentiles</span><span class="p">[</span><span class="o">~</span><span class="n">int_idx</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">out</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">is_dates_only</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">DatetimeArray</span> <span class="o">|</span> <span class="n">Index</span> <span class="o">|</span> <span class="n">DatetimeIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="c1"># return a boolean if we are only dates (and don&#39;t have a timezone)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">Index</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">DatetimeArray</span><span class="p">,</span> <span class="n">DatetimeIndex</span><span class="p">)):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">values_int</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">asi8</span>
    <span class="n">consider_values</span> <span class="o">=</span> <span class="n">values_int</span> <span class="o">!=</span> <span class="n">iNaT</span>
    <span class="c1"># error: Argument 1 to &quot;py_get_unit_from_dtype&quot; has incompatible type</span>
    <span class="c1"># &quot;Union[dtype[Any], ExtensionDtype]&quot;; expected &quot;dtype[Any]&quot;</span>
    <span class="n">reso</span> <span class="o">=</span> <span class="n">get_unit_from_dtype</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
    <span class="n">ppd</span> <span class="o">=</span> <span class="n">periods_per_day</span><span class="p">(</span><span class="n">reso</span><span class="p">)</span>

    <span class="c1"># TODO: can we reuse is_date_array_normalized?  would need a skipna kwd</span>
    <span class="n">even_days</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">consider_values</span><span class="p">,</span> <span class="n">values_int</span> <span class="o">%</span> <span class="n">ppd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">even_days</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_format_datetime64</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">NaTType</span> <span class="o">|</span> <span class="n">Timestamp</span><span class="p">,</span> <span class="n">nat_rep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NaT&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="n">NaT</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">nat_rep</span>

    <span class="c1"># Timestamp.__str__ falls back to datetime.datetime.__str__ = isoformat(sep=&#39; &#39;)</span>
    <span class="c1"># so it already uses string formatting rather than strftime (faster).</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_format_datetime64_dateonly</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">NaTType</span> <span class="o">|</span> <span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">nat_rep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NaT&quot;</span><span class="p">,</span>
    <span class="n">date_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">NaTType</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">nat_rep</span>

    <span class="k">if</span> <span class="n">date_format</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">date_format</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Timestamp._date_repr relies on string formatting (faster than strftime)</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">_date_repr</span>


<span class="k">def</span> <span class="nf">get_format_datetime64</span><span class="p">(</span>
    <span class="n">is_dates_only_</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">nat_rep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NaT&quot;</span><span class="p">,</span> <span class="n">date_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a formatter callable taking a datetime64 as input and providing</span>
<span class="sd">    a string as output&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">is_dates_only_</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_format_datetime64_dateonly</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">nat_rep</span><span class="o">=</span><span class="n">nat_rep</span><span class="p">,</span> <span class="n">date_format</span><span class="o">=</span><span class="n">date_format</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_format_datetime64</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nat_rep</span><span class="o">=</span><span class="n">nat_rep</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_format_datetime64_from_values</span><span class="p">(</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">DatetimeArray</span> <span class="o">|</span> <span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">date_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;given values and a date_format, return a string format&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># We don&#39;t actually care about the order of values, and DatetimeIndex</span>
        <span class="c1">#  only accepts 1D values</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">ido</span> <span class="o">=</span> <span class="n">is_dates_only</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ido</span><span class="p">:</span>
        <span class="c1"># Only dates and no timezone: provide a default format</span>
        <span class="k">return</span> <span class="n">date_format</span> <span class="ow">or</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">date_format</span>


<span class="k">class</span> <span class="nc">Datetime64TZFormatter</span><span class="p">(</span><span class="n">Datetime64Formatter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_format_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;we by definition have a TZ&quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
        <span class="n">ido</span> <span class="o">=</span> <span class="n">is_dates_only</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="ow">or</span> <span class="n">get_format_datetime64</span><span class="p">(</span>
            <span class="n">ido</span><span class="p">,</span> <span class="n">date_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date_format</span>
        <span class="p">)</span>
        <span class="n">fmt_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">formatter</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">fmt_values</span>


<span class="k">class</span> <span class="nc">Timedelta64Formatter</span><span class="p">(</span><span class="n">GenericArrayFormatter</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">TimedeltaIndex</span><span class="p">,</span>
        <span class="n">nat_rep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NaT&quot;</span><span class="p">,</span>
        <span class="n">box</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nat_rep</span> <span class="o">=</span> <span class="n">nat_rep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="n">box</span>

    <span class="k">def</span> <span class="nf">_format_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="ow">or</span> <span class="n">get_format_timedelta64</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">nat_rep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nat_rep</span><span class="p">,</span> <span class="n">box</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">box</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">formatter</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">get_format_timedelta64</span><span class="p">(</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">TimedeltaIndex</span> <span class="o">|</span> <span class="n">TimedeltaArray</span><span class="p">,</span>
    <span class="n">nat_rep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="s2">&quot;NaT&quot;</span><span class="p">,</span>
    <span class="n">box</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a formatter function for a range of timedeltas.</span>
<span class="sd">    These will all have the same format argument</span>

<span class="sd">    If box, then show the return in quotes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values_int</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>

    <span class="n">consider_values</span> <span class="o">=</span> <span class="n">values_int</span> <span class="o">!=</span> <span class="n">iNaT</span>

    <span class="n">one_day_nanos</span> <span class="o">=</span> <span class="mi">86400</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">9</span>
    <span class="c1"># error: Unsupported operand types for % (&quot;ExtensionArray&quot; and &quot;int&quot;)</span>
    <span class="n">not_midnight</span> <span class="o">=</span> <span class="n">values_int</span> <span class="o">%</span> <span class="n">one_day_nanos</span> <span class="o">!=</span> <span class="mi">0</span>  <span class="c1"># type: ignore[operator]</span>
    <span class="c1"># error: Argument 1 to &quot;__call__&quot; of &quot;ufunc&quot; has incompatible type</span>
    <span class="c1"># &quot;Union[Any, ExtensionArray, ndarray]&quot;; expected</span>
    <span class="c1"># &quot;Union[Union[int, float, complex, str, bytes, generic],</span>
    <span class="c1"># Sequence[Union[int, float, complex, str, bytes, generic]],</span>
    <span class="c1"># Sequence[Sequence[Any]], _SupportsArray]&quot;</span>
    <span class="n">both</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">consider_values</span><span class="p">,</span> <span class="n">not_midnight</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
    <span class="n">even_days</span> <span class="o">=</span> <span class="n">both</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">even_days</span><span class="p">:</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;long&quot;</span>

    <span class="k">def</span> <span class="nf">_formatter</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">is_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">nat_rep</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Timedelta</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">Timedelta</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># Timedelta._repr_base uses string formatting (faster than strftime)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">_repr_base</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">box</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">_formatter</span>


<span class="k">def</span> <span class="nf">_make_fixed_width</span><span class="p">(</span>
    <span class="n">strings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">justify</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span>
    <span class="n">minimum</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">adj</span><span class="p">:</span> <span class="n">TextAdjustment</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">justify</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">strings</span>

    <span class="k">if</span> <span class="n">adj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">adjustment</span> <span class="o">=</span> <span class="n">get_adjustment</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">adjustment</span> <span class="o">=</span> <span class="n">adj</span>

    <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">adjustment</span><span class="o">.</span><span class="n">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">minimum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">max_len</span><span class="p">)</span>

    <span class="n">conf_max</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">conf_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_len</span> <span class="o">&gt;</span> <span class="n">conf_max</span><span class="p">:</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="n">conf_max</span>

    <span class="k">def</span> <span class="nf">just</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">conf_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">conf_max</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">adjustment</span><span class="o">.</span><span class="n">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_len</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span> <span class="n">max_len</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">just</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">adjustment</span><span class="o">.</span><span class="n">justify</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">justify</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">_trim_zeros_complex</span><span class="p">(</span><span class="n">str_complexes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">decimal</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Separates the real and imaginary parts from the complex number, and</span>
<span class="sd">    executes the _trim_zeros_float method on each of those.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trimmed</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_trim_zeros_float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([j+-])&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">decimal</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">str_complexes</span>
    <span class="p">]</span>

    <span class="c1"># pad strings to the length of the longest trimmed string for alignment</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">trimmed</span><span class="p">]</span>
    <span class="n">max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
    <span class="n">padded</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">s</span><span class="p">[:</span> <span class="o">-</span><span class="p">((</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>  <span class="c1"># real part</span>
        <span class="o">+</span> <span class="p">(</span><span class="n">max_length</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">*</span> <span class="s2">&quot;0&quot;</span>
        <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="p">((</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="o">-</span><span class="p">((</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)]</span>  <span class="c1"># + / -</span>
        <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="p">((</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># imaginary part</span>
        <span class="o">+</span> <span class="p">(</span><span class="n">max_length</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">*</span> <span class="s2">&quot;0&quot;</span>
        <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">trimmed</span><span class="p">,</span> <span class="n">lengths</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">padded</span>


<span class="k">def</span> <span class="nf">_trim_zeros_single_float</span><span class="p">(</span><span class="n">str_float</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trims trailing zeros after a decimal point,</span>
<span class="sd">    leaving just one if necessary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">str_float</span> <span class="o">=</span> <span class="n">str_float</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">str_float</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
        <span class="n">str_float</span> <span class="o">+=</span> <span class="s2">&quot;0&quot;</span>

    <span class="k">return</span> <span class="n">str_float</span>


<span class="k">def</span> <span class="nf">_trim_zeros_float</span><span class="p">(</span>
    <span class="n">str_floats</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">decimal</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trims the maximum number of trailing zeros equally from</span>
<span class="sd">    all numbers containing decimals, leaving just one if</span>
<span class="sd">    necessary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trimmed</span> <span class="o">=</span> <span class="n">str_floats</span>
    <span class="n">number_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;^\s*[\+-]?[0-9]+\</span><span class="si">{</span><span class="n">decimal</span><span class="si">}</span><span class="s2">[0-9]*$&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_number_with_decimal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">number_regex</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">should_trim</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine if an array of strings should be trimmed.</span>

<span class="sd">        Returns True if all numbers containing decimals (defined by the</span>
<span class="sd">        above regular expression) within the array end in a zero, otherwise</span>
<span class="sd">        returns False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span> <span class="k">if</span> <span class="n">is_number_with_decimal</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">should_trim</span><span class="p">(</span><span class="n">trimmed</span><span class="p">):</span>
        <span class="n">trimmed</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">is_number_with_decimal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">trimmed</span><span class="p">]</span>

    <span class="c1"># leave one 0 after the decimal points if need be.</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">x</span> <span class="o">+</span> <span class="s2">&quot;0&quot;</span> <span class="k">if</span> <span class="n">is_number_with_decimal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">decimal</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">trimmed</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">_has_names</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="n">Index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">MultiIndex</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">com</span><span class="o">.</span><span class="n">any_not_none</span><span class="p">(</span><span class="o">*</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>


<span class="k">class</span> <span class="nc">EngFormatter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formats float values according to engineering format.</span>

<span class="sd">    Based on matplotlib.ticker.EngFormatter</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># The SI engineering prefixes</span>
    <span class="n">ENG_PREFIXES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">-</span><span class="mi">24</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">21</span><span class="p">:</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">18</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">12</span><span class="p">:</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">9</span><span class="p">:</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">6</span><span class="p">:</span> <span class="s2">&quot;u&quot;</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="mi">6</span><span class="p">:</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span>
        <span class="mi">9</span><span class="p">:</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span>
        <span class="mi">12</span><span class="p">:</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span>
        <span class="mi">15</span><span class="p">:</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span>
        <span class="mi">18</span><span class="p">:</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span>
        <span class="mi">21</span><span class="p">:</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span>
        <span class="mi">24</span><span class="p">:</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_eng_prefix</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_eng_prefix</span> <span class="o">=</span> <span class="n">use_eng_prefix</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formats a number in engineering notation, appending a letter</span>
<span class="sd">        representing the power of 1000 of the original number. Some examples:</span>
<span class="sd">        &gt;&gt;&gt; format_eng = EngFormatter(accuracy=0, use_eng_prefix=True)</span>
<span class="sd">        &gt;&gt;&gt; format_eng(0)</span>
<span class="sd">        &#39; 0&#39;</span>
<span class="sd">        &gt;&gt;&gt; format_eng = EngFormatter(accuracy=1, use_eng_prefix=True)</span>
<span class="sd">        &gt;&gt;&gt; format_eng(1_000_000)</span>
<span class="sd">        &#39; 1.0M&#39;</span>
<span class="sd">        &gt;&gt;&gt; format_eng = EngFormatter(accuracy=2, use_eng_prefix=False)</span>
<span class="sd">        &gt;&gt;&gt; format_eng(&quot;-1e-6&quot;)</span>
<span class="sd">        &#39;-1.00E-06&#39;</span>

<span class="sd">        @param num: the value to represent</span>
<span class="sd">        @type num: either a numeric value or a string that can be converted to</span>
<span class="sd">                   a numeric value (as per decimal.Decimal constructor)</span>

<span class="sd">        @return: engineering formatted string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dnum</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">Decimal</span><span class="o">.</span><span class="n">is_nan</span><span class="p">(</span><span class="n">dnum</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;NaN&quot;</span>

        <span class="k">if</span> <span class="n">Decimal</span><span class="o">.</span><span class="n">is_infinite</span><span class="p">(</span><span class="n">dnum</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;inf&quot;</span>

        <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">dnum</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">dnum</span> <span class="o">=</span> <span class="o">-</span><span class="n">dnum</span>

        <span class="k">if</span> <span class="n">dnum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pow10</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dnum</span><span class="o">.</span><span class="n">log10</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pow10</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">pow10</span> <span class="o">=</span> <span class="n">pow10</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ENG_PREFIXES</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">pow10</span> <span class="o">=</span> <span class="n">pow10</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ENG_PREFIXES</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">int_pow10</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pow10</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_eng_prefix</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENG_PREFIXES</span><span class="p">[</span><span class="n">int_pow10</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">int_pow10</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;E-</span><span class="si">{</span><span class="o">-</span><span class="n">int_pow10</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;E+</span><span class="si">{</span><span class="n">int_pow10</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">mant</span> <span class="o">=</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">dnum</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">pow10</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="n">format_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{mant: g}{prefix}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">format_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2">mant: .</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">f</span><span class="se">}}{{</span><span class="s2">prefix</span><span class="se">}}</span><span class="s2">&quot;</span>

        <span class="n">formatted</span> <span class="o">=</span> <span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mant</span><span class="o">=</span><span class="n">mant</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">formatted</span>


<div class="viewcode-block" id="set_eng_float_format"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.set_eng_float_format">[docs]</a><span class="k">def</span> <span class="nf">set_eng_float_format</span><span class="p">(</span><span class="n">accuracy</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">use_eng_prefix</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Format float representation in DataFrame with SI notation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    accuracy : int, default 3</span>
<span class="sd">        Number of decimal digits after the floating point.</span>
<span class="sd">    use_eng_prefix : bool, default False</span>
<span class="sd">        Whether to represent a value with SI prefixes.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame([1e-9, 1e-3, 1, 1e3, 1e6])</span>
<span class="sd">    &gt;&gt;&gt; df</span>
<span class="sd">                  0</span>
<span class="sd">    0  1.000000e-09</span>
<span class="sd">    1  1.000000e-03</span>
<span class="sd">    2  1.000000e+00</span>
<span class="sd">    3  1.000000e+03</span>
<span class="sd">    4  1.000000e+06</span>

<span class="sd">    &gt;&gt;&gt; pd.set_eng_float_format(accuracy=1)</span>
<span class="sd">    &gt;&gt;&gt; df</span>
<span class="sd">             0</span>
<span class="sd">    0  1.0E-09</span>
<span class="sd">    1  1.0E-03</span>
<span class="sd">    2  1.0E+00</span>
<span class="sd">    3  1.0E+03</span>
<span class="sd">    4  1.0E+06</span>

<span class="sd">    &gt;&gt;&gt; pd.set_eng_float_format(use_eng_prefix=True)</span>
<span class="sd">    &gt;&gt;&gt; df</span>
<span class="sd">            0</span>
<span class="sd">    0  1.000n</span>
<span class="sd">    1  1.000m</span>
<span class="sd">    2   1.000</span>
<span class="sd">    3  1.000k</span>
<span class="sd">    4  1.000M</span>

<span class="sd">    &gt;&gt;&gt; pd.set_eng_float_format(accuracy=1, use_eng_prefix=True)</span>
<span class="sd">    &gt;&gt;&gt; df</span>
<span class="sd">          0</span>
<span class="sd">    0  1.0n</span>
<span class="sd">    1  1.0m</span>
<span class="sd">    2   1.0</span>
<span class="sd">    3  1.0k</span>
<span class="sd">    4  1.0M</span>

<span class="sd">    &gt;&gt;&gt; pd.set_option(&quot;display.float_format&quot;, None)  # unset option</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.float_format&quot;</span><span class="p">,</span> <span class="n">EngFormatter</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">use_eng_prefix</span><span class="p">))</span></div>


<span class="k">def</span> <span class="nf">get_level_lengths</span><span class="p">(</span>
    <span class="n">levels</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">sentinel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">object</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For each index in each level the function returns lengths of indexes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    levels : list of lists</span>
<span class="sd">        List of values on for level.</span>
<span class="sd">    sentinel : string, optional</span>
<span class="sd">        Value which states that no new index starts on there.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Returns list of maps. For each level returns map of indexes (key is index</span>
<span class="sd">    in row and value is length of index).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">control</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">:</span>
        <span class="n">last_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">lengths</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">control</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="n">sentinel</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">control</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">lengths</span><span class="p">[</span><span class="n">last_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">last_index</span>
                <span class="n">last_index</span> <span class="o">=</span> <span class="n">i</span>

        <span class="n">lengths</span><span class="p">[</span><span class="n">last_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="o">-</span> <span class="n">last_index</span>

        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">buffer_put_lines</span><span class="p">(</span><span class="n">buf</span><span class="p">:</span> <span class="n">WriteBuffer</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Appends lines to a buffer.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    buf</span>
<span class="sd">        The buffer to write to</span>
<span class="sd">    lines</span>
<span class="sd">        The lines to append.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
    <span class="n">buf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Tommaso Furlanello, and Daniel Hug.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>