<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pandas.core.arrays.categorical &mdash; BabyDragon  documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            BabyDragon
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tasks:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tasks/llm_task.html">llm_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tasks/multi_kernel_task.html">multi_kernel_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tasks/base_task.html">base_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tasks/topic_tree_task.html">topic_tree_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tasks/embedding_task.html">embedding_task</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Memory/Kernels:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/kernels/memory_kernel.html">memory_kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/kernels/kernel_clustering.html">kernel_clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/kernels/multi_kernel.html">multi_kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/kernels/multi_kernel_visualization.html">multi_kernel_visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/kernels/kernel_utils.html">kernel_utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Memory/Threads:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/threads/base_thread.html">base_thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/threads/fifo_thread.html">fifo_thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/threads/vector_thread.html">vector_thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/threads/todo/python_thread.html">python_thread</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Memory/Indexes:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/python_index.html">python_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/memory_index.html">memory_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/pandas_index.html">pandas_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/todo/youtube_index.html">youtube_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/todo/parquet_index.html">parquet_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/todo/wiki_index.html">wiki_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/todo/gutenberg_index.html">gutenberg_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/todo/github_index.html">github_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory/indexes/todo/multi_index.html">multi_index</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Chat:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../chat/base_chat.html">base_chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chat/memory_chat.html">memory_chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chat/chat.html">chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chat/prompts/perspective_prompt.html">perspective_prompt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chat/prompts/default_prompts.html">default_prompts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Utils:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../utils/multithreading.html">multithreading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../utils/pandas.html">pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../utils/hf_datasets.html">hf_datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../utils/chatml.html">chatml</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Models/embedders:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../models/embedders/ada2.html">ada2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../models/embedders/cohere.html">cohere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../models/embedders/sbert.html">sbert</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Models/generators:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../models/generators/cohere.html">cohere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../models/generators/chatgpt.html">chatgpt</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Processors:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/github_processors.html">github_processors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/os_processor.html">os_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/git_metadata.html">git_metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/visitors.html">visitors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/python_parser.html">python_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/todo/subs_parser.html">subs_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/todo/latex_parser.html">latex_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/todo/md_parser.html">md_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/todo/wiki_parser.html">wiki_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/parsers/todo/git_processor.html">git_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/todo/arxiv_processor.html">arxiv_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/todo/wiki_processor.html">wiki_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/todo/chatgpt_processor.html">chatgpt_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/todo/mit_course_processor.html">mit_course_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/todo/youtube_processor.html">youtube_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/todo/pubmed_processor.html">pubmed_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../processors/todo/gutenberg_processor.html">gutenberg_processor</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Apps:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../apps/auto_perspective/perspective.html">perspective</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">BabyDragon</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pandas.core.arrays.categorical</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pandas.core.arrays.categorical</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">csv</span> <span class="kn">import</span> <span class="n">QUOTE_NONNUMERIC</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">get_terminal_size</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TYPE_CHECKING</span><span class="p">,</span>
    <span class="n">Hashable</span><span class="p">,</span>
    <span class="n">Iterator</span><span class="p">,</span>
    <span class="n">Literal</span><span class="p">,</span>
    <span class="n">Sequence</span><span class="p">,</span>
    <span class="n">TypeVar</span><span class="p">,</span>
    <span class="n">cast</span><span class="p">,</span>
    <span class="n">overload</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pandas._config</span> <span class="kn">import</span> <span class="n">get_option</span>

<span class="kn">from</span> <span class="nn">pandas._libs</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">NaT</span><span class="p">,</span>
    <span class="n">algos</span> <span class="k">as</span> <span class="n">libalgos</span><span class="p">,</span>
    <span class="n">lib</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas._libs.arrays</span> <span class="kn">import</span> <span class="n">NDArrayBacked</span>
<span class="kn">from</span> <span class="nn">pandas._typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ArrayLike</span><span class="p">,</span>
    <span class="n">AstypeArg</span><span class="p">,</span>
    <span class="n">AxisInt</span><span class="p">,</span>
    <span class="n">Dtype</span><span class="p">,</span>
    <span class="n">NpDtype</span><span class="p">,</span>
    <span class="n">Ordered</span><span class="p">,</span>
    <span class="n">Shape</span><span class="p">,</span>
    <span class="n">SortKind</span><span class="p">,</span>
    <span class="n">npt</span><span class="p">,</span>
    <span class="n">type_t</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.compat.numpy</span> <span class="kn">import</span> <span class="n">function</span> <span class="k">as</span> <span class="n">nv</span>
<span class="kn">from</span> <span class="nn">pandas.util._validators</span> <span class="kn">import</span> <span class="n">validate_bool_kwarg</span>

<span class="kn">from</span> <span class="nn">pandas.core.dtypes.cast</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">coerce_indexer_dtype</span><span class="p">,</span>
    <span class="n">find_common_type</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.dtypes.common</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ensure_int64</span><span class="p">,</span>
    <span class="n">ensure_platform_int</span><span class="p">,</span>
    <span class="n">is_any_real_numeric_dtype</span><span class="p">,</span>
    <span class="n">is_bool_dtype</span><span class="p">,</span>
    <span class="n">is_categorical_dtype</span><span class="p">,</span>
    <span class="n">is_datetime64_dtype</span><span class="p">,</span>
    <span class="n">is_dict_like</span><span class="p">,</span>
    <span class="n">is_dtype_equal</span><span class="p">,</span>
    <span class="n">is_extension_array_dtype</span><span class="p">,</span>
    <span class="n">is_hashable</span><span class="p">,</span>
    <span class="n">is_integer_dtype</span><span class="p">,</span>
    <span class="n">is_list_like</span><span class="p">,</span>
    <span class="n">is_scalar</span><span class="p">,</span>
    <span class="n">is_timedelta64_dtype</span><span class="p">,</span>
    <span class="n">needs_i8_conversion</span><span class="p">,</span>
    <span class="n">pandas_dtype</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.dtypes.dtypes</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CategoricalDtype</span><span class="p">,</span>
    <span class="n">ExtensionDtype</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.dtypes.generic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ABCIndex</span><span class="p">,</span>
    <span class="n">ABCSeries</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.dtypes.missing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">is_valid_na_for_dtype</span><span class="p">,</span>
    <span class="n">isna</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">pandas.core</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">algorithms</span><span class="p">,</span>
    <span class="n">arraylike</span><span class="p">,</span>
    <span class="n">ops</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.accessor</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PandasDelegate</span><span class="p">,</span>
    <span class="n">delegate_names</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.algorithms</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">factorize</span><span class="p">,</span>
    <span class="n">take_nd</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.arrays._mixins</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">NDArrayBackedExtensionArray</span><span class="p">,</span>
    <span class="n">ravel_compat</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.base</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ExtensionArray</span><span class="p">,</span>
    <span class="n">NoNewAttributesMixin</span><span class="p">,</span>
    <span class="n">PandasObject</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">pandas.core.common</span> <span class="k">as</span> <span class="nn">com</span>
<span class="kn">from</span> <span class="nn">pandas.core.construction</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">extract_array</span><span class="p">,</span>
    <span class="n">sanitize_array</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.ops.common</span> <span class="kn">import</span> <span class="n">unpack_zerodim_and_defer</span>
<span class="kn">from</span> <span class="nn">pandas.core.sorting</span> <span class="kn">import</span> <span class="n">nargsort</span>
<span class="kn">from</span> <span class="nn">pandas.core.strings.object_array</span> <span class="kn">import</span> <span class="n">ObjectStringArrayMixin</span>

<span class="kn">from</span> <span class="nn">pandas.io.formats</span> <span class="kn">import</span> <span class="n">console</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">Index</span><span class="p">,</span>
        <span class="n">Series</span><span class="p">,</span>
    <span class="p">)</span>


<span class="n">CategoricalT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;CategoricalT&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;Categorical&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_cat_compare_op</span><span class="p">(</span><span class="n">op</span><span class="p">):</span>
    <span class="n">opname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;__</span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">__&quot;</span>
    <span class="n">fill_value</span> <span class="o">=</span> <span class="n">op</span> <span class="ow">is</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span>

    <span class="nd">@unpack_zerodim_and_defer</span><span class="p">(</span><span class="n">opname</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">hashable</span> <span class="o">=</span> <span class="n">is_hashable</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_list_like</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hashable</span><span class="p">:</span>
            <span class="c1"># in hashable case we may have a tuple that is itself a category</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Lengths must match.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">opname</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;__lt__&quot;</span><span class="p">,</span> <span class="s2">&quot;__gt__&quot;</span><span class="p">,</span> <span class="s2">&quot;__le__&quot;</span><span class="p">,</span> <span class="s2">&quot;__ge__&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;Unordered Categoricals can only compare equality or not&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Categorical</span><span class="p">):</span>
            <span class="c1"># Two Categoricals can only be compared if the categories are</span>
            <span class="c1"># the same (maybe up to ordering, depending on ordered)</span>

            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Categoricals can only be compared if &#39;categories&#39; are the same.&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_categories_match_up_to_permutation</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">categories</span><span class="p">):</span>
                <span class="c1"># both unordered and different order</span>
                <span class="n">other_codes</span> <span class="o">=</span> <span class="n">recode_for_categories</span><span class="p">(</span>
                    <span class="n">other</span><span class="o">.</span><span class="n">codes</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">categories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">other_codes</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_codes</span>

            <span class="n">ret</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">,</span> <span class="n">other_codes</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_codes</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">other_codes</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">ret</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">fill_value</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="k">if</span> <span class="n">hashable</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">other</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unbox_scalar</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">opname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;__eq__&quot;</span><span class="p">,</span> <span class="s2">&quot;__ge__&quot;</span><span class="p">,</span> <span class="s2">&quot;__gt__&quot;</span><span class="p">}:</span>
                    <span class="c1"># GH#29820 performance trick; get_loc will always give i&gt;=0,</span>
                    <span class="c1">#  so in the cases (__ne__, __le__, __lt__) the setting</span>
                    <span class="c1">#  here is a no-op, so can be skipped.</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="n">ret</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">fill_value</span>
                <span class="k">return</span> <span class="n">ret</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ops</span><span class="o">.</span><span class="n">invalid_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># allow categorical vs object dtype array comparisons for equality</span>
            <span class="c1"># these are only positional comparisons</span>
            <span class="k">if</span> <span class="n">opname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;__eq__&quot;</span><span class="p">,</span> <span class="s2">&quot;__ne__&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot compare a Categorical for op </span><span class="si">{</span><span class="n">opname</span><span class="si">}</span><span class="s2"> with &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">If you want to compare values, &quot;</span>
                    <span class="s2">&quot;use &#39;np.asarray(cat) &lt;op&gt; other&#39;.&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ExtensionArray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">needs_i8_conversion</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
                <span class="c1"># We would return NotImplemented here, but that messes up</span>
                <span class="c1">#  ExtensionIndex&#39;s wrapped methods</span>
                <span class="k">return</span> <span class="n">op</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">opname</span><span class="p">)(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">opname</span>

    <span class="k">return</span> <span class="n">func</span>


<span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">container</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper for membership check for ``key`` in ``cat``.</span>

<span class="sd">    This is a helper method for :method:`__contains__`</span>
<span class="sd">    and :class:`CategoricalIndex.__contains__`.</span>

<span class="sd">    Returns True if ``key`` is in ``cat.categories`` and the</span>
<span class="sd">    location of ``key`` in ``categories`` is in ``container``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cat : :class:`Categorical`or :class:`categoricalIndex`</span>
<span class="sd">    key : a hashable object</span>
<span class="sd">        The key to check membership for.</span>
<span class="sd">    container : Container (e.g. list-like or mapping)</span>
<span class="sd">        The container to check for membership in.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    is_in : bool</span>
<span class="sd">        True if ``key`` is in ``self.categories`` and location of</span>
<span class="sd">        ``key`` in ``categories`` is in ``container``, else False.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This method does not check for NaN values. Do that separately</span>
<span class="sd">    before calling this method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">hash</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="c1"># get location of key in categories.</span>
    <span class="c1"># If a KeyError, the key isn&#39;t in categories, so logically</span>
    <span class="c1">#  can&#39;t be in container either.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># loc is the location of key in categories, but also the *value*</span>
    <span class="c1"># for key in container. So, `key` may be in categories,</span>
    <span class="c1"># but still not in `container`. Example (&#39;b&#39; in categories,</span>
    <span class="c1"># but not in values):</span>
    <span class="c1"># &#39;b&#39; in Categorical([&#39;a&#39;], categories=[&#39;a&#39;, &#39;b&#39;])  # False</span>
    <span class="k">if</span> <span class="n">is_scalar</span><span class="p">(</span><span class="n">loc</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">container</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># if categories is an IntervalIndex, loc is an array.</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">loc_</span> <span class="ow">in</span> <span class="n">container</span> <span class="k">for</span> <span class="n">loc_</span> <span class="ow">in</span> <span class="n">loc</span><span class="p">)</span>


<div class="viewcode-block" id="Categorical"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical">[docs]</a><span class="k">class</span> <span class="nc">Categorical</span><span class="p">(</span><span class="n">NDArrayBackedExtensionArray</span><span class="p">,</span> <span class="n">PandasObject</span><span class="p">,</span> <span class="n">ObjectStringArrayMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represent a categorical variable in classic R / S-plus fashion.</span>

<span class="sd">    `Categoricals` can only take on a limited, and usually fixed, number</span>
<span class="sd">    of possible values (`categories`). In contrast to statistical categorical</span>
<span class="sd">    variables, a `Categorical` might have an order, but numerical operations</span>
<span class="sd">    (additions, divisions, ...) are not possible.</span>

<span class="sd">    All values of the `Categorical` are either in `categories` or `np.nan`.</span>
<span class="sd">    Assigning values outside of `categories` will raise a `ValueError`. Order</span>
<span class="sd">    is defined by the order of the `categories`, not lexical order of the</span>
<span class="sd">    values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    values : list-like</span>
<span class="sd">        The values of the categorical. If categories are given, values not in</span>
<span class="sd">        categories will be replaced with NaN.</span>
<span class="sd">    categories : Index-like (unique), optional</span>
<span class="sd">        The unique categories for this categorical. If not given, the</span>
<span class="sd">        categories are assumed to be the unique values of `values` (sorted, if</span>
<span class="sd">        possible, otherwise in the order in which they appear).</span>
<span class="sd">    ordered : bool, default False</span>
<span class="sd">        Whether or not this categorical is treated as a ordered categorical.</span>
<span class="sd">        If True, the resulting categorical will be ordered.</span>
<span class="sd">        An ordered categorical respects, when sorted, the order of its</span>
<span class="sd">        `categories` attribute (which in turn is the `categories` argument, if</span>
<span class="sd">        provided).</span>
<span class="sd">    dtype : CategoricalDtype</span>
<span class="sd">        An instance of ``CategoricalDtype`` to use for this categorical.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    categories : Index</span>
<span class="sd">        The categories of this categorical</span>
<span class="sd">    codes : ndarray</span>
<span class="sd">        The codes (integer positions, which point to the categories) of this</span>
<span class="sd">        categorical, read only.</span>
<span class="sd">    ordered : bool</span>
<span class="sd">        Whether or not this Categorical is ordered.</span>
<span class="sd">    dtype : CategoricalDtype</span>
<span class="sd">        The instance of ``CategoricalDtype`` storing the ``categories``</span>
<span class="sd">        and ``ordered``.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    from_codes</span>
<span class="sd">    __array__</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the categories do not validate.</span>
<span class="sd">    TypeError</span>
<span class="sd">        If an explicit ``ordered=True`` is given but no `categories` and the</span>
<span class="sd">        `values` are not sortable.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    CategoricalDtype : Type for categorical data.</span>
<span class="sd">    CategoricalIndex : An Index with an underlying ``Categorical``.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    See the `user guide</span>
<span class="sd">    &lt;https://pandas.pydata.org/pandas-docs/stable/user_guide/categorical.html&gt;`__</span>
<span class="sd">    for more.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; pd.Categorical([1, 2, 3, 1, 2, 3])</span>
<span class="sd">    [1, 2, 3, 1, 2, 3]</span>
<span class="sd">    Categories (3, int64): [1, 2, 3]</span>

<span class="sd">    &gt;&gt;&gt; pd.Categorical([&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;])</span>
<span class="sd">    [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="sd">    Categories (3, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>

<span class="sd">    Missing values are not included as a category.</span>

<span class="sd">    &gt;&gt;&gt; c = pd.Categorical([1, 2, 3, 1, 2, 3, np.nan])</span>
<span class="sd">    &gt;&gt;&gt; c</span>
<span class="sd">    [1, 2, 3, 1, 2, 3, NaN]</span>
<span class="sd">    Categories (3, int64): [1, 2, 3]</span>

<span class="sd">    However, their presence is indicated in the `codes` attribute</span>
<span class="sd">    by code `-1`.</span>

<span class="sd">    &gt;&gt;&gt; c.codes</span>
<span class="sd">    array([ 0,  1,  2,  0,  1,  2, -1], dtype=int8)</span>

<span class="sd">    Ordered `Categoricals` can be sorted according to the custom order</span>
<span class="sd">    of the categories and can have a min and max value.</span>

<span class="sd">    &gt;&gt;&gt; c = pd.Categorical([&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;], ordered=True,</span>
<span class="sd">    ...                    categories=[&#39;c&#39;, &#39;b&#39;, &#39;a&#39;])</span>
<span class="sd">    &gt;&gt;&gt; c</span>
<span class="sd">    [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="sd">    Categories (3, object): [&#39;c&#39; &lt; &#39;b&#39; &lt; &#39;a&#39;]</span>
<span class="sd">    &gt;&gt;&gt; c.min()</span>
<span class="sd">    &#39;c&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># For comparisons, so that numpy uses our implementation if the compare</span>
    <span class="c1"># ops, which raise</span>
    <span class="n">__array_priority__</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="c1"># tolist is not actually deprecated, just suppressed in the __dir__</span>
    <span class="n">_hidden_attrs</span> <span class="o">=</span> <span class="n">PandasObject</span><span class="o">.</span><span class="n">_hidden_attrs</span> <span class="o">|</span> <span class="nb">frozenset</span><span class="p">([</span><span class="s2">&quot;tolist&quot;</span><span class="p">])</span>
    <span class="n">_typ</span> <span class="o">=</span> <span class="s2">&quot;categorical&quot;</span>

    <span class="n">_dtype</span><span class="p">:</span> <span class="n">CategoricalDtype</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">values</span><span class="p">,</span>
        <span class="n">categories</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ordered</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">Dtype</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fastpath</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="o">.</span><span class="n">_from_values_or_dtype</span><span class="p">(</span>
            <span class="n">values</span><span class="p">,</span> <span class="n">categories</span><span class="p">,</span> <span class="n">ordered</span><span class="p">,</span> <span class="n">dtype</span>
        <span class="p">)</span>
        <span class="c1"># At this point, dtype is always a CategoricalDtype, but</span>
        <span class="c1"># we may have dtype.categories be None, and we need to</span>
        <span class="c1"># infer categories in a factorization step further below</span>

        <span class="k">if</span> <span class="n">fastpath</span><span class="p">:</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="n">coerce_indexer_dtype</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">ordered</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">update_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_list_like</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="c1"># GH#38433</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Categorical input must be list-like&quot;</span><span class="p">)</span>

        <span class="c1"># null_mask indicates missing values we want to exclude from inference.</span>
        <span class="c1"># This means: only missing values in list-likes (not arrays/ndframes).</span>
        <span class="n">null_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># sanitize input</span>
        <span class="k">if</span> <span class="n">is_categorical_dtype</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dtype</span><span class="o">.</span><span class="n">categories</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">categories</span><span class="p">,</span> <span class="n">dtype</span><span class="o">.</span><span class="n">ordered</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">ABCIndex</span><span class="p">,</span> <span class="n">ABCSeries</span><span class="p">,</span> <span class="n">ExtensionArray</span><span class="p">)):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">convert_to_list_like</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># By convention, empty lists result in object dtype:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># preempt sanitize_array from raising ValueError</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                        <span class="s2">&quot;&gt; 1 ndim Categorical are not supported at this time&quot;</span>
                    <span class="p">)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">sanitize_array</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># i.e. must be a list</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">sanitize_array</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">null_mask</span> <span class="o">=</span> <span class="n">isna</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">null_mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="c1"># We remove null values here, then below will re-insert</span>
                    <span class="c1">#  them, grep &quot;full_codes&quot;</span>
                    <span class="n">arr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">null_mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>

                    <span class="c1"># GH#44900 Do not cast to float if we have only missing values</span>
                    <span class="k">if</span> <span class="n">arr_list</span> <span class="ow">or</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">:</span>
                        <span class="n">sanitize_dtype</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sanitize_dtype</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span>

                    <span class="n">arr</span> <span class="o">=</span> <span class="n">sanitize_array</span><span class="p">(</span><span class="n">arr_list</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">sanitize_dtype</span><span class="p">)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">arr</span>

        <span class="k">if</span> <span class="n">dtype</span><span class="o">.</span><span class="n">categories</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">codes</span><span class="p">,</span> <span class="n">categories</span> <span class="o">=</span> <span class="n">factorize</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">codes</span><span class="p">,</span> <span class="n">categories</span> <span class="o">=</span> <span class="n">factorize</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dtype</span><span class="o">.</span><span class="n">ordered</span><span class="p">:</span>
                    <span class="c1"># raise, as we don&#39;t have a sortable data structure and so</span>
                    <span class="c1"># the user should give us one by specifying categories</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;&#39;values&#39; is not ordered, please &quot;</span>
                        <span class="s2">&quot;explicitly specify the categories order &quot;</span>
                        <span class="s2">&quot;by passing in a categories argument.&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>

            <span class="c1"># we&#39;re inferring from values</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">dtype</span><span class="o">.</span><span class="n">ordered</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">is_categorical_dtype</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="n">old_codes</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">_codes</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="n">recode_for_categories</span><span class="p">(</span>
                <span class="n">old_codes</span><span class="p">,</span> <span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">,</span> <span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="n">_get_codes_for_values</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">null_mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="c1"># Reinsert -1 placeholders for previously removed missing values</span>
            <span class="n">full_codes</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">null_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">codes</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">full_codes</span><span class="p">[</span><span class="o">~</span><span class="n">null_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">codes</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="n">full_codes</span>

        <span class="n">dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">ordered</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">update_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">coerce_indexer_dtype</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CategoricalDtype</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The :class:`~pandas.api.types.CategoricalDtype` for this instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_internal_fill_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="c1"># using the specific numpy integer instead of python int to get</span>
        <span class="c1">#  the correct dtype back from _quantile in the all-NA case</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ndarray</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">return</span> <span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_sequence</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">scalars</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Dtype</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Categorical</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Categorical</span><span class="p">(</span><span class="n">scalars</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">)</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">astype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">DTypeLike</span><span class="p">,</span> <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">astype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">ExtensionDtype</span><span class="p">,</span> <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExtensionArray</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">astype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">AstypeArg</span><span class="p">,</span> <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArrayLike</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">astype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">AstypeArg</span><span class="p">,</span> <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArrayLike</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Coerce this type to another dtype</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dtype : numpy dtype or pandas type</span>
<span class="sd">        copy : bool, default True</span>
<span class="sd">            By default, astype always returns a newly allocated object.</span>
<span class="sd">            If copy is set to False and dtype is categorical, the original</span>
<span class="sd">            object is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">pandas_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">dtype</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">copy</span> <span class="k">else</span> <span class="bp">self</span>

        <span class="k">elif</span> <span class="n">is_categorical_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">CategoricalDtype</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>

            <span class="c1"># GH 10696/18593/18630</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">update_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">copy</span> <span class="k">else</span> <span class="bp">self</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">ExtensionDtype</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">is_integer_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot convert float NaN to integer&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># GH8628 (PERF): astype category codes instead of astyping array</span>
            <span class="n">new_cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">_values</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_cats</span> <span class="o">=</span> <span class="n">new_cats</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">)</span>
                <span class="n">fill_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">_na_value</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_na_for_dtype</span><span class="p">(</span><span class="n">fill_value</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
                    <span class="n">fill_value</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">item_from_zerodim</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">_na_value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span>
                <span class="ne">TypeError</span><span class="p">,</span>  <span class="c1"># downstream error msg for CategoricalIndex is misleading</span>
                <span class="ne">ValueError</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Cannot cast </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> dtype to </span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">take_nd</span><span class="p">(</span>
                <span class="n">new_cats</span><span class="p">,</span> <span class="n">ensure_platform_int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="Categorical.to_list"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.to_list">[docs]</a>    <span class="k">def</span> <span class="nf">to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Alias for tolist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_inferred_categories</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">inferred_categories</span><span class="p">,</span> <span class="n">inferred_codes</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">true_values</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a Categorical from inferred values.</span>

<span class="sd">        For inferred categories (`dtype` is None) the categories are sorted.</span>
<span class="sd">        For explicit `dtype`, the `inferred_categories` are cast to the</span>
<span class="sd">        appropriate type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        inferred_categories : Index</span>
<span class="sd">        inferred_codes : Index</span>
<span class="sd">        dtype : CategoricalDtype or &#39;category&#39;</span>
<span class="sd">        true_values : list, optional</span>
<span class="sd">            If none are provided, the default ones are</span>
<span class="sd">            &quot;True&quot;, &quot;TRUE&quot;, and &quot;true.&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Categorical</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">Index</span><span class="p">,</span>
            <span class="n">to_datetime</span><span class="p">,</span>
            <span class="n">to_numeric</span><span class="p">,</span>
            <span class="n">to_timedelta</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">cats</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="n">inferred_categories</span><span class="p">)</span>
        <span class="n">known_categories</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">CategoricalDtype</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dtype</span><span class="o">.</span><span class="n">categories</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">known_categories</span><span class="p">:</span>
            <span class="c1"># Convert to a specialized type with `dtype` if specified.</span>
            <span class="k">if</span> <span class="n">is_any_real_numeric_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">):</span>
                <span class="n">cats</span> <span class="o">=</span> <span class="n">to_numeric</span><span class="p">(</span><span class="n">inferred_categories</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">is_datetime64_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">):</span>
                <span class="n">cats</span> <span class="o">=</span> <span class="n">to_datetime</span><span class="p">(</span><span class="n">inferred_categories</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">is_timedelta64_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">):</span>
                <span class="n">cats</span> <span class="o">=</span> <span class="n">to_timedelta</span><span class="p">(</span><span class="n">inferred_categories</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">is_bool_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">true_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">true_values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;TRUE&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">]</span>

                <span class="c1"># error: Incompatible types in assignment (expression has type</span>
                <span class="c1"># &quot;ndarray&quot;, variable has type &quot;Index&quot;)</span>
                <span class="n">cats</span> <span class="o">=</span> <span class="n">cats</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">true_values</span><span class="p">)</span>  <span class="c1"># type: ignore[assignment]</span>

        <span class="k">if</span> <span class="n">known_categories</span><span class="p">:</span>
            <span class="c1"># Recode from observation order to dtype.categories order.</span>
            <span class="n">categories</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">categories</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="n">recode_for_categories</span><span class="p">(</span><span class="n">inferred_codes</span><span class="p">,</span> <span class="n">cats</span><span class="p">,</span> <span class="n">categories</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">cats</span><span class="o">.</span><span class="n">is_monotonic_increasing</span><span class="p">:</span>
            <span class="c1"># Sort categories and recode for unknown categories.</span>
            <span class="n">unsorted</span> <span class="o">=</span> <span class="n">cats</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">categories</span> <span class="o">=</span> <span class="n">cats</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>

            <span class="n">codes</span> <span class="o">=</span> <span class="n">recode_for_categories</span><span class="p">(</span><span class="n">inferred_codes</span><span class="p">,</span> <span class="n">unsorted</span><span class="p">,</span> <span class="n">categories</span><span class="p">)</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">cats</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="n">inferred_codes</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">fastpath</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="Categorical.from_codes"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.from_codes">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_codes</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">codes</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Dtype</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Categorical</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a Categorical type from codes and categories or dtype.</span>

<span class="sd">        This constructor is useful if you already have codes and</span>
<span class="sd">        categories/dtype and so do not need the (computation intensive)</span>
<span class="sd">        factorization step, which is usually done on the constructor.</span>

<span class="sd">        If your data does not follow this convention, please use the normal</span>
<span class="sd">        constructor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        codes : array-like of int</span>
<span class="sd">            An integer array, where each integer points to a category in</span>
<span class="sd">            categories or dtype.categories, or else is -1 for NaN.</span>
<span class="sd">        categories : index-like, optional</span>
<span class="sd">            The categories for the categorical. Items need to be unique.</span>
<span class="sd">            If the categories are not given here, then they must be provided</span>
<span class="sd">            in `dtype`.</span>
<span class="sd">        ordered : bool, optional</span>
<span class="sd">            Whether or not this categorical is treated as an ordered</span>
<span class="sd">            categorical. If not given here or in `dtype`, the resulting</span>
<span class="sd">            categorical will be unordered.</span>
<span class="sd">        dtype : CategoricalDtype or &quot;category&quot;, optional</span>
<span class="sd">            If :class:`CategoricalDtype`, cannot be used together with</span>
<span class="sd">            `categories` or `ordered`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Categorical</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; dtype = pd.CategoricalDtype([&#39;a&#39;, &#39;b&#39;], ordered=True)</span>
<span class="sd">        &gt;&gt;&gt; pd.Categorical.from_codes(codes=[0, 1, 0, 1], dtype=dtype)</span>
<span class="sd">        [&#39;a&#39;, &#39;b&#39;, &#39;a&#39;, &#39;b&#39;]</span>
<span class="sd">        Categories (2, object): [&#39;a&#39; &lt; &#39;b&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="o">.</span><span class="n">_from_values_or_dtype</span><span class="p">(</span>
            <span class="n">categories</span><span class="o">=</span><span class="n">categories</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="n">ordered</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">dtype</span><span class="o">.</span><span class="n">categories</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;The categories must be provided in &#39;categories&#39; or &quot;</span>
                <span class="s2">&quot;&#39;dtype&#39;. Both were None.&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_extension_array_dtype</span><span class="p">(</span><span class="n">codes</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_integer_dtype</span><span class="p">(</span><span class="n">codes</span><span class="p">):</span>
            <span class="c1"># Avoid the implicit conversion of Int to object</span>
            <span class="k">if</span> <span class="n">isna</span><span class="p">(</span><span class="n">codes</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;codes cannot contain NA values&quot;</span><span class="p">)</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="n">codes</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">codes</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">codes</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_integer_dtype</span><span class="p">(</span><span class="n">codes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;codes need to be array-like integers&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">codes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">codes</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span> <span class="ow">or</span> <span class="n">codes</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;codes need to be between -1 and len(categories)-1&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">fastpath</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="c1"># Categories/Codes/Ordered</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">categories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Index</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The categories of this categorical.</span>

<span class="sd">        Setting assigns new values to each category (effectively a rename of</span>
<span class="sd">        each individual category).</span>

<span class="sd">        The assigned value has to be a list-like object. All items must be</span>
<span class="sd">        unique and the number of items in the new categories must be the same</span>
<span class="sd">        as the number of items in the old categories.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the new categories do not validate as categories or if the</span>
<span class="sd">            number of new categories is unequal the number of old categories</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        rename_categories : Rename categories.</span>
<span class="sd">        reorder_categories : Reorder categories.</span>
<span class="sd">        add_categories : Add new categories.</span>
<span class="sd">        remove_categories : Remove the specified categories.</span>
<span class="sd">        remove_unused_categories : Remove categories which are not used.</span>
<span class="sd">        set_categories : Set the categories to the specified ones.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ordered</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Ordered</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether the categories have an ordered relationship.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">ordered</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">codes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The category codes of this categorical.</span>

<span class="sd">        Codes are an array of integers which are the positions of the actual</span>
<span class="sd">        values in the categories array.</span>

<span class="sd">        There is no setter, use the other categorical methods and the normal item</span>
<span class="sd">        setter to change values in the categorical.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ndarray[int]</span>
<span class="sd">            A non-writable view of the `codes` array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
        <span class="n">v</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">_set_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">categories</span><span class="p">,</span> <span class="n">fastpath</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets new categories inplace</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fastpath : bool, default False</span>
<span class="sd">           Don&#39;t perform validation of the categories for uniqueness or nulls</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; c = pd.Categorical([&#39;a&#39;, &#39;b&#39;])</span>
<span class="sd">        &gt;&gt;&gt; c</span>
<span class="sd">        [&#39;a&#39;, &#39;b&#39;]</span>
<span class="sd">        Categories (2, object): [&#39;a&#39;, &#39;b&#39;]</span>

<span class="sd">        &gt;&gt;&gt; c._set_categories(pd.Index([&#39;a&#39;, &#39;c&#39;]))</span>
<span class="sd">        &gt;&gt;&gt; c</span>
<span class="sd">        [&#39;a&#39;, &#39;c&#39;]</span>
<span class="sd">        Categories (2, object): [&#39;a&#39;, &#39;c&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fastpath</span><span class="p">:</span>
            <span class="n">new_dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="o">.</span><span class="n">_from_fastpath</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">fastpath</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;new categories need to have the same number of &quot;</span>
                <span class="s2">&quot;items as the old categories!&quot;</span>
            <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ndarray</span><span class="p">,</span> <span class="n">new_dtype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">CategoricalDtype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Categorical</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal method for directly updating the CategoricalDtype</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dtype : CategoricalDtype</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        We don&#39;t do any validation here. It&#39;s assumed that the dtype is</span>
<span class="sd">        a (valid) instance of `CategoricalDtype`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="n">recode_for_categories</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">,</span> <span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">codes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">fastpath</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="Categorical.set_ordered"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.set_ordered">[docs]</a>    <span class="k">def</span> <span class="nf">set_ordered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Categorical</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the ordered attribute to the boolean value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : bool</span>
<span class="sd">           Set whether this categorical is ordered (True) or not (False).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">NDArrayBacked</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">cat</span><span class="o">.</span><span class="n">_ndarray</span><span class="p">,</span> <span class="n">new_dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cat</span></div>

<div class="viewcode-block" id="Categorical.as_ordered"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.as_ordered">[docs]</a>    <span class="k">def</span> <span class="nf">as_ordered</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Categorical</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the Categorical to be ordered.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Categorical</span>
<span class="sd">            Ordered Categorical.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_ordered</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Categorical.as_unordered"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.as_unordered">[docs]</a>    <span class="k">def</span> <span class="nf">as_unordered</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Categorical</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the Categorical to be unordered.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Categorical</span>
<span class="sd">            Unordered Categorical.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_ordered</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Categorical.set_categories"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.set_categories">[docs]</a>    <span class="k">def</span> <span class="nf">set_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_categories</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rename</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the categories to the specified new_categories.</span>

<span class="sd">        `new_categories` can include new categories (which will result in</span>
<span class="sd">        unused categories) or remove old categories (which results in values</span>
<span class="sd">        set to NaN). If `rename==True`, the categories will simple be renamed</span>
<span class="sd">        (less or more items than in old categories will result in values set to</span>
<span class="sd">        NaN or in unused categories respectively).</span>

<span class="sd">        This method can be used to perform more than one action of adding,</span>
<span class="sd">        removing, and reordering simultaneously and is therefore faster than</span>
<span class="sd">        performing the individual steps via the more specialised methods.</span>

<span class="sd">        On the other hand this methods does not do checks (e.g., whether the</span>
<span class="sd">        old categories are included in the new categories on a reorder), which</span>
<span class="sd">        can result in surprising changes, for example when using special string</span>
<span class="sd">        dtypes, which does not considers a S1 string equal to a single char</span>
<span class="sd">        python string.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_categories : Index-like</span>
<span class="sd">           The categories in new order.</span>
<span class="sd">        ordered : bool, default False</span>
<span class="sd">           Whether or not the categorical is treated as a ordered categorical.</span>
<span class="sd">           If not given, do not change the ordered information.</span>
<span class="sd">        rename : bool, default False</span>
<span class="sd">           Whether or not the new_categories should be considered as a rename</span>
<span class="sd">           of the old categories or as reordered categories.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Categorical with reordered categories.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If new_categories does not validate as categories</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        rename_categories : Rename categories.</span>
<span class="sd">        reorder_categories : Reorder categories.</span>
<span class="sd">        add_categories : Add new categories.</span>
<span class="sd">        remove_categories : Remove the specified categories.</span>
<span class="sd">        remove_unused_categories : Remove categories which are not used.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">ordered</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ordered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">ordered</span>
        <span class="n">new_dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">new_categories</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="n">ordered</span><span class="p">)</span>

        <span class="n">cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rename</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cat</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">cat</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span>
            <span class="p">):</span>
                <span class="c1"># remove all _codes which are larger and set to -1/NaN</span>
                <span class="n">cat</span><span class="o">.</span><span class="n">_codes</span><span class="p">[</span><span class="n">cat</span><span class="o">.</span><span class="n">_codes</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">_codes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="n">recode_for_categories</span><span class="p">(</span>
                <span class="n">cat</span><span class="o">.</span><span class="n">codes</span><span class="p">,</span> <span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">,</span> <span class="n">new_dtype</span><span class="o">.</span><span class="n">categories</span>
            <span class="p">)</span>
        <span class="n">NDArrayBacked</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">codes</span><span class="p">,</span> <span class="n">new_dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cat</span></div>

<div class="viewcode-block" id="Categorical.rename_categories"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.rename_categories">[docs]</a>    <span class="k">def</span> <span class="nf">rename_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_categories</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Categorical</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rename categories.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_categories : list-like, dict-like or callable</span>

<span class="sd">            New categories which will replace old categories.</span>

<span class="sd">            * list-like: all items must be unique and the number of items in</span>
<span class="sd">              the new categories must match the existing number of categories.</span>

<span class="sd">            * dict-like: specifies a mapping from</span>
<span class="sd">              old categories to new. Categories not contained in the mapping</span>
<span class="sd">              are passed through and extra categories in the mapping are</span>
<span class="sd">              ignored.</span>

<span class="sd">            * callable : a callable that is called on all items in the old</span>
<span class="sd">              categories and whose return values comprise the new categories.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Categorical</span>
<span class="sd">            Categorical with renamed categories.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If new categories are list-like and do not have the same number of</span>
<span class="sd">            items than the current categories or do not validate as categories</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        reorder_categories : Reorder categories.</span>
<span class="sd">        add_categories : Add new categories.</span>
<span class="sd">        remove_categories : Remove the specified categories.</span>
<span class="sd">        remove_unused_categories : Remove categories which are not used.</span>
<span class="sd">        set_categories : Set the categories to the specified ones.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; c = pd.Categorical([&#39;a&#39;, &#39;a&#39;, &#39;b&#39;])</span>
<span class="sd">        &gt;&gt;&gt; c.rename_categories([0, 1])</span>
<span class="sd">        [0, 0, 1]</span>
<span class="sd">        Categories (2, int64): [0, 1]</span>

<span class="sd">        For dict-like ``new_categories``, extra keys are ignored and</span>
<span class="sd">        categories not in the dictionary are passed through</span>

<span class="sd">        &gt;&gt;&gt; c.rename_categories({&#39;a&#39;: &#39;A&#39;, &#39;c&#39;: &#39;C&#39;})</span>
<span class="sd">        [&#39;A&#39;, &#39;A&#39;, &#39;b&#39;]</span>
<span class="sd">        Categories (2, object): [&#39;A&#39;, &#39;b&#39;]</span>

<span class="sd">        You may also provide a callable to create the new categories</span>

<span class="sd">        &gt;&gt;&gt; c.rename_categories(lambda x: x.upper())</span>
<span class="sd">        [&#39;A&#39;, &#39;A&#39;, &#39;B&#39;]</span>
<span class="sd">        Categories (2, object): [&#39;A&#39;, &#39;B&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">is_dict_like</span><span class="p">(</span><span class="n">new_categories</span><span class="p">):</span>
            <span class="n">new_categories</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">new_categories</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">new_categories</span><span class="p">):</span>
            <span class="n">new_categories</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_categories</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">]</span>

        <span class="n">cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">cat</span><span class="o">.</span><span class="n">_set_categories</span><span class="p">(</span><span class="n">new_categories</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cat</span></div>

<div class="viewcode-block" id="Categorical.reorder_categories"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.reorder_categories">[docs]</a>    <span class="k">def</span> <span class="nf">reorder_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_categories</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reorder categories as specified in new_categories.</span>

<span class="sd">        `new_categories` need to include all old categories and no new category</span>
<span class="sd">        items.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_categories : Index-like</span>
<span class="sd">           The categories in new order.</span>
<span class="sd">        ordered : bool, optional</span>
<span class="sd">           Whether or not the categorical is treated as a ordered categorical.</span>
<span class="sd">           If not given, do not change the ordered information.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Categorical</span>
<span class="sd">            Categorical with reordered categories.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the new categories do not contain all old category items or any</span>
<span class="sd">            new ones</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        rename_categories : Rename categories.</span>
<span class="sd">        add_categories : Add new categories.</span>
<span class="sd">        remove_categories : Remove the specified categories.</span>
<span class="sd">        remove_unused_categories : Remove categories which are not used.</span>
<span class="sd">        set_categories : Set the categories to the specified ones.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_categories</span><span class="p">)</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">new_categories</span><span class="p">)</span><span class="o">.</span><span class="n">empty</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;items in new_categories are not the same as in old categories&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_categories</span><span class="p">(</span><span class="n">new_categories</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="n">ordered</span><span class="p">)</span></div>

<div class="viewcode-block" id="Categorical.add_categories"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.add_categories">[docs]</a>    <span class="k">def</span> <span class="nf">add_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_categories</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Categorical</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add new categories.</span>

<span class="sd">        `new_categories` will be included at the last/highest place in the</span>
<span class="sd">        categories and will be unused directly after this call.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_categories : category or list-like of category</span>
<span class="sd">           The new categories to be included.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Categorical</span>
<span class="sd">            Categorical with new categories added.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the new categories include old categories or do not validate as</span>
<span class="sd">            categories</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        rename_categories : Rename categories.</span>
<span class="sd">        reorder_categories : Reorder categories.</span>
<span class="sd">        remove_categories : Remove the specified categories.</span>
<span class="sd">        remove_unused_categories : Remove categories which are not used.</span>
<span class="sd">        set_categories : Set the categories to the specified ones.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; c = pd.Categorical([&#39;c&#39;, &#39;b&#39;, &#39;c&#39;])</span>
<span class="sd">        &gt;&gt;&gt; c</span>
<span class="sd">        [&#39;c&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="sd">        Categories (2, object): [&#39;b&#39;, &#39;c&#39;]</span>

<span class="sd">        &gt;&gt;&gt; c.add_categories([&#39;d&#39;, &#39;a&#39;])</span>
<span class="sd">        [&#39;c&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="sd">        Categories (4, object): [&#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;a&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_list_like</span><span class="p">(</span><span class="n">new_categories</span><span class="p">):</span>
            <span class="n">new_categories</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_categories</span><span class="p">]</span>
        <span class="n">already_included</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">new_categories</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">already_included</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;new categories must not include old categories: </span><span class="si">{</span><span class="n">already_included</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">new_categories</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">Series</span>

            <span class="n">dtype</span> <span class="o">=</span> <span class="n">find_common_type</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">new_categories</span><span class="o">.</span><span class="n">dtype</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">new_categories</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_categories</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_categories</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_categories</span><span class="p">)</span>

        <span class="n">new_dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">new_categories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered</span><span class="p">)</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="n">coerce_indexer_dtype</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">_ndarray</span><span class="p">,</span> <span class="n">new_dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>
        <span class="n">NDArrayBacked</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">codes</span><span class="p">,</span> <span class="n">new_dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cat</span></div>

<div class="viewcode-block" id="Categorical.remove_categories"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.remove_categories">[docs]</a>    <span class="k">def</span> <span class="nf">remove_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">removals</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the specified categories.</span>

<span class="sd">        `removals` must be included in the old categories. Values which were in</span>
<span class="sd">        the removed categories will be set to NaN</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        removals : category or list of categories</span>
<span class="sd">           The categories which should be removed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Categorical</span>
<span class="sd">            Categorical with removed categories.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the removals are not contained in the categories</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        rename_categories : Rename categories.</span>
<span class="sd">        reorder_categories : Reorder categories.</span>
<span class="sd">        add_categories : Add new categories.</span>
<span class="sd">        remove_unused_categories : Remove categories which are not used.</span>
<span class="sd">        set_categories : Set the categories to the specified ones.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; c = pd.Categorical([&#39;a&#39;, &#39;c&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;])</span>
<span class="sd">        &gt;&gt;&gt; c</span>
<span class="sd">        [&#39;a&#39;, &#39;c&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>
<span class="sd">        Categories (4, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>

<span class="sd">        &gt;&gt;&gt; c.remove_categories([&#39;d&#39;, &#39;a&#39;])</span>
<span class="sd">        [NaN, &#39;c&#39;, &#39;b&#39;, &#39;c&#39;, NaN]</span>
<span class="sd">        Categories (2, object): [&#39;b&#39;, &#39;c&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">Index</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_list_like</span><span class="p">(</span><span class="n">removals</span><span class="p">):</span>
            <span class="n">removals</span> <span class="o">=</span> <span class="p">[</span><span class="n">removals</span><span class="p">]</span>

        <span class="n">removals</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="n">removals</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">new_categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">removals</span><span class="p">)</span>
        <span class="n">not_included</span> <span class="o">=</span> <span class="n">removals</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_included</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">not_included</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">not_included</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;removals must all be in old categories: </span><span class="si">{</span><span class="n">not_included</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_categories</span><span class="p">(</span><span class="n">new_categories</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered</span><span class="p">,</span> <span class="n">rename</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Categorical.remove_unused_categories"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.remove_unused_categories">[docs]</a>    <span class="k">def</span> <span class="nf">remove_unused_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Categorical</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove categories which are not used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Categorical</span>
<span class="sd">            Categorical with unused categories dropped.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        rename_categories : Rename categories.</span>
<span class="sd">        reorder_categories : Reorder categories.</span>
<span class="sd">        add_categories : Add new categories.</span>
<span class="sd">        remove_categories : Remove the specified categories.</span>
<span class="sd">        set_categories : Set the categories to the specified ones.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; c = pd.Categorical([&#39;a&#39;, &#39;c&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;])</span>
<span class="sd">        &gt;&gt;&gt; c</span>
<span class="sd">        [&#39;a&#39;, &#39;c&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>
<span class="sd">        Categories (4, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>

<span class="sd">        &gt;&gt;&gt; c[2] = &#39;a&#39;</span>
<span class="sd">        &gt;&gt;&gt; c[4] = &#39;c&#39;</span>
<span class="sd">        &gt;&gt;&gt; c</span>
<span class="sd">        [&#39;a&#39;, &#39;c&#39;, &#39;a&#39;, &#39;c&#39;, &#39;c&#39;]</span>
<span class="sd">        Categories (4, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>

<span class="sd">        &gt;&gt;&gt; c.remove_unused_categories()</span>
<span class="sd">        [&#39;a&#39;, &#39;c&#39;, &#39;a&#39;, &#39;c&#39;, &#39;c&#39;]</span>
<span class="sd">        Categories (2, object): [&#39;a&#39;, &#39;c&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx</span><span class="p">,</span> <span class="n">inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">idx</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># na sentinel</span>
            <span class="n">idx</span><span class="p">,</span> <span class="n">inv</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">inv</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">new_categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">new_dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="o">.</span><span class="n">_from_fastpath</span><span class="p">(</span>
            <span class="n">new_categories</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered</span>
        <span class="p">)</span>
        <span class="n">new_codes</span> <span class="o">=</span> <span class="n">coerce_indexer_dtype</span><span class="p">(</span><span class="n">inv</span><span class="p">,</span> <span class="n">new_dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>

        <span class="n">cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">NDArrayBacked</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">new_codes</span><span class="p">,</span> <span class="n">new_dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cat</span></div>

    <span class="c1"># ------------------------------------------------------------------</span>

<div class="viewcode-block" id="Categorical.map"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.map">[docs]</a>    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapper</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Map categories using an input mapping or function.</span>

<span class="sd">        Maps the categories to new categories. If the mapping correspondence is</span>
<span class="sd">        one-to-one the result is a :class:`~pandas.Categorical` which has the</span>
<span class="sd">        same order property as the original, otherwise a :class:`~pandas.Index`</span>
<span class="sd">        is returned. NaN values are unaffected.</span>

<span class="sd">        If a `dict` or :class:`~pandas.Series` is used any unmapped category is</span>
<span class="sd">        mapped to `NaN`. Note that if this happens an :class:`~pandas.Index`</span>
<span class="sd">        will be returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mapper : function, dict, or Series</span>
<span class="sd">            Mapping correspondence.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.Categorical or pandas.Index</span>
<span class="sd">            Mapped categorical.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        CategoricalIndex.map : Apply a mapping correspondence on a</span>
<span class="sd">            :class:`~pandas.CategoricalIndex`.</span>
<span class="sd">        Index.map : Apply a mapping correspondence on an</span>
<span class="sd">            :class:`~pandas.Index`.</span>
<span class="sd">        Series.map : Apply a mapping correspondence on a</span>
<span class="sd">            :class:`~pandas.Series`.</span>
<span class="sd">        Series.apply : Apply more complex functions on a</span>
<span class="sd">            :class:`~pandas.Series`.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; cat = pd.Categorical([&#39;a&#39;, &#39;b&#39;, &#39;c&#39;])</span>
<span class="sd">        &gt;&gt;&gt; cat</span>
<span class="sd">        [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="sd">        Categories (3, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="sd">        &gt;&gt;&gt; cat.map(lambda x: x.upper())</span>
<span class="sd">        [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;]</span>
<span class="sd">        Categories (3, object): [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;]</span>
<span class="sd">        &gt;&gt;&gt; cat.map({&#39;a&#39;: &#39;first&#39;, &#39;b&#39;: &#39;second&#39;, &#39;c&#39;: &#39;third&#39;})</span>
<span class="sd">        [&#39;first&#39;, &#39;second&#39;, &#39;third&#39;]</span>
<span class="sd">        Categories (3, object): [&#39;first&#39;, &#39;second&#39;, &#39;third&#39;]</span>

<span class="sd">        If the mapping is one-to-one the ordering of the categories is</span>
<span class="sd">        preserved:</span>

<span class="sd">        &gt;&gt;&gt; cat = pd.Categorical([&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], ordered=True)</span>
<span class="sd">        &gt;&gt;&gt; cat</span>
<span class="sd">        [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="sd">        Categories (3, object): [&#39;a&#39; &lt; &#39;b&#39; &lt; &#39;c&#39;]</span>
<span class="sd">        &gt;&gt;&gt; cat.map({&#39;a&#39;: 3, &#39;b&#39;: 2, &#39;c&#39;: 1})</span>
<span class="sd">        [3, 2, 1]</span>
<span class="sd">        Categories (3, int64): [3 &lt; 2 &lt; 1]</span>

<span class="sd">        If the mapping is not one-to-one an :class:`~pandas.Index` is returned:</span>

<span class="sd">        &gt;&gt;&gt; cat.map({&#39;a&#39;: &#39;first&#39;, &#39;b&#39;: &#39;second&#39;, &#39;c&#39;: &#39;first&#39;})</span>
<span class="sd">        Index([&#39;first&#39;, &#39;second&#39;, &#39;first&#39;], dtype=&#39;object&#39;)</span>

<span class="sd">        If a `dict` is used, all unmapped categories are mapped to `NaN` and</span>
<span class="sd">        the result is an :class:`~pandas.Index`:</span>

<span class="sd">        &gt;&gt;&gt; cat.map({&#39;a&#39;: &#39;first&#39;, &#39;b&#39;: &#39;second&#39;})</span>
<span class="sd">        Index([&#39;first&#39;, &#39;second&#39;, nan], dtype=&#39;object&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapper</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_codes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">categories</span><span class="o">=</span><span class="n">new_categories</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># NA values are represented in self._codes with -1</span>
            <span class="c1"># np.take causes NA values to take final element in new_categories</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_codes</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">new_categories</span> <span class="o">=</span> <span class="n">new_categories</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_categories</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">new_categories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">)</span></div>

    <span class="fm">__eq__</span> <span class="o">=</span> <span class="n">_cat_compare_op</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">)</span>
    <span class="fm">__ne__</span> <span class="o">=</span> <span class="n">_cat_compare_op</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">ne</span><span class="p">)</span>
    <span class="fm">__lt__</span> <span class="o">=</span> <span class="n">_cat_compare_op</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">lt</span><span class="p">)</span>
    <span class="fm">__gt__</span> <span class="o">=</span> <span class="n">_cat_compare_op</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">gt</span><span class="p">)</span>
    <span class="fm">__le__</span> <span class="o">=</span> <span class="n">_cat_compare_op</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">le</span><span class="p">)</span>
    <span class="fm">__ge__</span> <span class="o">=</span> <span class="n">_cat_compare_op</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">ge</span><span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------</span>
    <span class="c1"># Validators; ideally these can be de-duplicated</span>

    <span class="k">def</span> <span class="nf">_validate_setitem_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_hashable</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># wrap scalars and hashable-listlikes in list</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_listlike</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_scalar</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a user-facing fill_value to a representation to use with our</span>
<span class="sd">        underlying ndarray, raising TypeError if this is not possible.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fill_value : object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fill_value : int</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">is_valid_na_for_dtype</span><span class="p">(</span><span class="n">fill_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="n">fill_value</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">fill_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">:</span>
            <span class="n">fill_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unbox_scalar</span><span class="p">(</span><span class="n">fill_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot setitem on a Categorical with a new &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;category (</span><span class="si">{</span><span class="n">fill_value</span><span class="si">}</span><span class="s2">), set the categories first&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">fill_value</span>

    <span class="c1"># -------------------------------------------------------------</span>

    <span class="nd">@ravel_compat</span>
    <span class="k">def</span> <span class="nf">__array__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">NpDtype</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The numpy array interface.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.array</span>
<span class="sd">            A numpy array of either the specified dtype or,</span>
<span class="sd">            if dtype==None (default), the same dtype as</span>
<span class="sd">            categorical.categories.dtype.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">take_nd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_dtype_equal</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
        <span class="c1"># When we&#39;re a Categorical[ExtensionArray], like Interval,</span>
        <span class="c1"># we need to ensure __array__ gets all the way to an</span>
        <span class="c1"># ndarray.</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__array_ufunc__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ufunc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ufunc</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># for binary ops, use our custom dunder methods</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">maybe_dispatch_ufunc_to_dunder_op</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">ufunc</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">NotImplemented</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">if</span> <span class="s2">&quot;out&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># e.g. test_numpy_ufuncs_out</span>
            <span class="k">return</span> <span class="n">arraylike</span><span class="o">.</span><span class="n">dispatch_ufunc_with_out</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">ufunc</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;reduce&quot;</span><span class="p">:</span>
            <span class="c1"># e.g. TestCategoricalAnalytics::test_min_max_ordered</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">arraylike</span><span class="o">.</span><span class="n">dispatch_reduction_ufunc</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">ufunc</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">NotImplemented</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">result</span>

        <span class="c1"># for all other cases, raise for now (similarly as what happens in</span>
        <span class="c1"># Series.__array_prepare__)</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Object with dtype </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> cannot perform &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;the numpy op </span><span class="si">{</span><span class="n">ufunc</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Necessary for making this object picklable&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__setstate__</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;_dtype&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_dtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;_categories&quot;</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_ordered&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="s2">&quot;_codes&quot;</span> <span class="ow">in</span> <span class="n">state</span> <span class="ow">and</span> <span class="s2">&quot;_ndarray&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
            <span class="c1"># backward compat, changed what is property vs attribute</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_ndarray&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_codes&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__setstate__</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nbytes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="o">.</span><span class="n">nbytes</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">nbytes</span>

<div class="viewcode-block" id="Categorical.memory_usage"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.memory_usage">[docs]</a>    <span class="k">def</span> <span class="nf">memory_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Memory usage of my values</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        deep : bool</span>
<span class="sd">            Introspect the data deeply, interrogate</span>
<span class="sd">            `object` dtypes for system-level memory consumption</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bytes used</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Memory usage does not include memory consumed by elements that</span>
<span class="sd">        are not components of the array if deep=False</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        numpy.ndarray.nbytes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="o">.</span><span class="n">nbytes</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">)</span></div>

<div class="viewcode-block" id="Categorical.isna"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.isna">[docs]</a>    <span class="k">def</span> <span class="nf">isna</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detect missing values</span>

<span class="sd">        Missing values (-1 in .codes) are detected.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray[bool] of whether my values are null</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        isna : Top-level isna.</span>
<span class="sd">        isnull : Alias of isna.</span>
<span class="sd">        Categorical.notna : Boolean inverse of Categorical.isna.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span></div>

    <span class="n">isnull</span> <span class="o">=</span> <span class="n">isna</span>

<div class="viewcode-block" id="Categorical.notna"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.notna">[docs]</a>    <span class="k">def</span> <span class="nf">notna</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inverse of isna</span>

<span class="sd">        Both missing values (-1 in .codes) and NA as a category are detected as</span>
<span class="sd">        null.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray[bool] of whether my values are not null</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        notna : Top-level notna.</span>
<span class="sd">        notnull : Alias of notna.</span>
<span class="sd">        Categorical.isna : Boolean inverse of Categorical.notna.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span></div>

    <span class="n">notnull</span> <span class="o">=</span> <span class="n">notna</span>

<div class="viewcode-block" id="Categorical.value_counts"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.value_counts">[docs]</a>    <span class="k">def</span> <span class="nf">value_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dropna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a Series containing counts of each category.</span>

<span class="sd">        Every category will have an entry, even those with a count of 0.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dropna : bool, default True</span>
<span class="sd">            Don&#39;t include counts of NaN.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        counts : Series</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        Series.value_counts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">CategoricalIndex</span><span class="p">,</span>
            <span class="n">Series</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">code</span><span class="p">,</span> <span class="n">cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span>
        <span class="n">ncat</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cat</span><span class="p">),</span> <span class="n">code</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">ix</span><span class="p">,</span> <span class="n">clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ncat</span><span class="p">),</span> <span class="n">mask</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">dropna</span> <span class="ow">or</span> <span class="n">clean</span><span class="p">:</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="n">code</span> <span class="k">if</span> <span class="n">clean</span> <span class="k">else</span> <span class="n">code</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">minlength</span><span class="o">=</span><span class="n">ncat</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">ncat</span><span class="p">))</span>
            <span class="n">ix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">ix</span> <span class="o">=</span> <span class="n">coerce_indexer_dtype</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_backing_data</span><span class="p">(</span><span class="n">ix</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Series</span><span class="p">(</span>
            <span class="n">count</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">CategoricalIndex</span><span class="p">(</span><span class="n">ix</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span></div>

    <span class="c1"># error: Argument 2 of &quot;_empty&quot; is incompatible with supertype</span>
    <span class="c1"># &quot;NDArrayBackedExtensionArray&quot;; supertype defines the argument type as</span>
    <span class="c1"># &quot;ExtensionDtype&quot;</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_empty</span><span class="p">(</span>  <span class="c1"># type: ignore[override]</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">type_t</span><span class="p">[</span><span class="n">Categorical</span><span class="p">],</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">CategoricalDtype</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Categorical</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analogous to np.empty(shape, dtype=dtype)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        shape : tuple[int]</span>
<span class="sd">        dtype : CategoricalDtype</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_sequence</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

        <span class="c1"># We have to use np.zeros instead of np.empty otherwise the resulting</span>
        <span class="c1">#  ndarray may contain codes not supported by this dtype, in which</span>
        <span class="c1">#  case repr(result) could segfault.</span>
        <span class="n">backing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">arr</span><span class="o">.</span><span class="n">_ndarray</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">_from_backing_data</span><span class="p">(</span><span class="n">backing</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_internal_get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the values.</span>

<span class="sd">        For internal compatibility with pandas formatting.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray or Index</span>
<span class="sd">            A numpy array of the same dtype as categorical.categories.dtype or</span>
<span class="sd">            Index if datetime / periods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if we are a datetime and period index, return Index to keep metadata</span>
        <span class="k">if</span> <span class="n">needs_i8_conversion</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">NaT</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_integer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span> <span class="ow">and</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;object&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Categorical.check_for_ordered"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.check_for_ordered">[docs]</a>    <span class="k">def</span> <span class="nf">check_for_ordered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;assert that we are ordered&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Categorical is not ordered for operation </span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;you can use .as_ordered() to change the &quot;</span>
                <span class="s2">&quot;Categorical to an ordered one</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Categorical.argsort"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.argsort">[docs]</a>    <span class="k">def</span> <span class="nf">argsort</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">ascending</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">kind</span><span class="p">:</span> <span class="n">SortKind</span> <span class="o">=</span> <span class="s2">&quot;quicksort&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the indices that would sort the Categorical.</span>

<span class="sd">        Missing values are sorted at the end.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ascending : bool, default True</span>
<span class="sd">            Whether the indices should result in an ascending</span>
<span class="sd">            or descending sort.</span>
<span class="sd">        kind : {&#39;quicksort&#39;, &#39;mergesort&#39;, &#39;heapsort&#39;, &#39;stable&#39;}, optional</span>
<span class="sd">            Sorting algorithm.</span>
<span class="sd">        **kwargs:</span>
<span class="sd">            passed through to :func:`numpy.argsort`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray[np.intp]</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        numpy.ndarray.argsort</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        While an ordering is applied to the category values, arg-sorting</span>
<span class="sd">        in this context refers more to organizing and grouping together</span>
<span class="sd">        based on matching category values. Thus, this function can be</span>
<span class="sd">        called on an unordered Categorical instance unlike the functions</span>
<span class="sd">        &#39;Categorical.min&#39; and &#39;Categorical.max&#39;.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; pd.Categorical([&#39;b&#39;, &#39;b&#39;, &#39;a&#39;, &#39;c&#39;]).argsort()</span>
<span class="sd">        array([2, 0, 1, 3])</span>

<span class="sd">        &gt;&gt;&gt; cat = pd.Categorical([&#39;b&#39;, &#39;b&#39;, &#39;a&#39;, &#39;c&#39;],</span>
<span class="sd">        ...                      categories=[&#39;c&#39;, &#39;b&#39;, &#39;a&#39;],</span>
<span class="sd">        ...                      ordered=True)</span>
<span class="sd">        &gt;&gt;&gt; cat.argsort()</span>
<span class="sd">        array([3, 0, 1, 2])</span>

<span class="sd">        Missing values are placed at the end</span>

<span class="sd">        &gt;&gt;&gt; cat = pd.Categorical([2, None, 1])</span>
<span class="sd">        &gt;&gt;&gt; cat.argsort()</span>
<span class="sd">        array([2, 0, 1])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">sort_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">inplace</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
        <span class="n">ascending</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
        <span class="n">na_position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Categorical</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">sort_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">],</span> <span class="n">ascending</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span> <span class="n">na_position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="o">...</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>

<div class="viewcode-block" id="Categorical.sort_values"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.sort_values">[docs]</a>    <span class="k">def</span> <span class="nf">sort_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ascending</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">na_position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Categorical</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sort the Categorical by category value returning a new</span>
<span class="sd">        Categorical by default.</span>

<span class="sd">        While an ordering is applied to the category values, sorting in this</span>
<span class="sd">        context refers more to organizing and grouping together based on</span>
<span class="sd">        matching category values. Thus, this function can be called on an</span>
<span class="sd">        unordered Categorical instance unlike the functions &#39;Categorical.min&#39;</span>
<span class="sd">        and &#39;Categorical.max&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        inplace : bool, default False</span>
<span class="sd">            Do operation in place.</span>
<span class="sd">        ascending : bool, default True</span>
<span class="sd">            Order ascending. Passing False orders descending. The</span>
<span class="sd">            ordering parameter provides the method by which the</span>
<span class="sd">            category values are organized.</span>
<span class="sd">        na_position : {&#39;first&#39;, &#39;last&#39;} (optional, default=&#39;last&#39;)</span>
<span class="sd">            &#39;first&#39; puts NaNs at the beginning</span>
<span class="sd">            &#39;last&#39; puts NaNs at the end</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Categorical or None</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        Categorical.sort</span>
<span class="sd">        Series.sort_values</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; c = pd.Categorical([1, 2, 2, 1, 5])</span>
<span class="sd">        &gt;&gt;&gt; c</span>
<span class="sd">        [1, 2, 2, 1, 5]</span>
<span class="sd">        Categories (3, int64): [1, 2, 5]</span>
<span class="sd">        &gt;&gt;&gt; c.sort_values()</span>
<span class="sd">        [1, 1, 2, 2, 5]</span>
<span class="sd">        Categories (3, int64): [1, 2, 5]</span>
<span class="sd">        &gt;&gt;&gt; c.sort_values(ascending=False)</span>
<span class="sd">        [5, 2, 2, 1, 1]</span>
<span class="sd">        Categories (3, int64): [1, 2, 5]</span>

<span class="sd">        &gt;&gt;&gt; c = pd.Categorical([1, 2, 2, 1, 5])</span>

<span class="sd">        &#39;sort_values&#39; behaviour with NaNs. Note that &#39;na_position&#39;</span>
<span class="sd">        is independent of the &#39;ascending&#39; parameter:</span>

<span class="sd">        &gt;&gt;&gt; c = pd.Categorical([np.nan, 2, 2, np.nan, 5])</span>
<span class="sd">        &gt;&gt;&gt; c</span>
<span class="sd">        [NaN, 2, 2, NaN, 5]</span>
<span class="sd">        Categories (2, int64): [2, 5]</span>
<span class="sd">        &gt;&gt;&gt; c.sort_values()</span>
<span class="sd">        [2, 2, 5, NaN, NaN]</span>
<span class="sd">        Categories (2, int64): [2, 5]</span>
<span class="sd">        &gt;&gt;&gt; c.sort_values(ascending=False)</span>
<span class="sd">        [5, 2, 2, NaN, NaN]</span>
<span class="sd">        Categories (2, int64): [2, 5]</span>
<span class="sd">        &gt;&gt;&gt; c.sort_values(na_position=&#39;first&#39;)</span>
<span class="sd">        [NaN, NaN, 2, 2, 5]</span>
<span class="sd">        Categories (2, int64): [2, 5]</span>
<span class="sd">        &gt;&gt;&gt; c.sort_values(ascending=False, na_position=&#39;first&#39;)</span>
<span class="sd">        [NaN, NaN, 5, 2, 2]</span>
<span class="sd">        Categories (2, int64): [2, 5]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inplace</span> <span class="o">=</span> <span class="n">validate_bool_kwarg</span><span class="p">(</span><span class="n">inplace</span><span class="p">,</span> <span class="s2">&quot;inplace&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">na_position</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;first&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;invalid na_position: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">na_position</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sorted_idx</span> <span class="o">=</span> <span class="n">nargsort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">,</span> <span class="n">na_position</span><span class="o">=</span><span class="n">na_position</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">[</span><span class="n">sorted_idx</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_backing_data</span><span class="p">(</span><span class="n">codes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">[</span><span class="n">sorted_idx</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_rank</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">axis</span><span class="p">:</span> <span class="n">AxisInt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;average&quot;</span><span class="p">,</span>
        <span class="n">na_option</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;keep&quot;</span><span class="p">,</span>
        <span class="n">ascending</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">pct</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See Series.rank.__doc__.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="n">vff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values_for_rank</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">algorithms</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span>
            <span class="n">vff</span><span class="p">,</span>
            <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">na_option</span><span class="o">=</span><span class="n">na_option</span><span class="p">,</span>
            <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">,</span>
            <span class="n">pct</span><span class="o">=</span><span class="n">pct</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_values_for_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For correctly ranking ordered categorical data. See GH#15420</span>

<span class="sd">        Ordered categorical data should be ranked on the basis of</span>
<span class="sd">        codes with -1 translated to NaN.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.array</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">Series</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">codes</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">values</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
                <span class="n">values</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">elif</span> <span class="n">is_any_real_numeric_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#  reorder the categories (so rank can use the float codes)</span>
            <span class="c1">#  instead of passing an object array to rank</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rename_categories</span><span class="p">(</span>
                    <span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="c1"># NDArrayBackedExtensionArray compat</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ndarray</span>

    <span class="k">def</span> <span class="nf">_box_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_unbox_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="c1"># searchsorted is very performance sensitive. By converting codes</span>
        <span class="c1"># to same dtype as self.codes, we get much faster performance.</span>
        <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ndarray</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">code</span>

    <span class="c1"># ------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an Iterator over the values of this Categorical.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal_get_values</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if `key` is in this Categorical.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if key is a NaN, check if any NaN is in self.</span>
        <span class="k">if</span> <span class="n">is_valid_na_for_dtype</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">)</span>

    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="c1"># Rendering Methods</span>

    <span class="k">def</span> <span class="nf">_formatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boxed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Defer to CategoricalFormatter&#39;s formatter.</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_tidy_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_vals</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">footer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a short repr displaying only max_vals and an optional (but default</span>
<span class="sd">        footer)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">max_vals</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">head</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[:</span><span class="n">num</span><span class="p">]</span><span class="o">.</span><span class="n">_get_repr</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">footer</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">max_vals</span> <span class="o">-</span> <span class="n">num</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">_get_repr</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">footer</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">head</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, ..., </span><span class="si">{</span><span class="n">tail</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">footer</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_repr_footer</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the base repr for the categories</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_categories</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">10</span>
            <span class="k">if</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.max_categories&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">else</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.max_categories&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="kn">from</span> <span class="nn">pandas.io.formats</span> <span class="kn">import</span> <span class="nb">format</span> <span class="k">as</span> <span class="n">fmt</span>

        <span class="n">format_array</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">format_array</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">QUOTE_NONNUMERIC</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_categories</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">max_categories</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">head</span> <span class="o">=</span> <span class="n">format_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">[:</span><span class="n">num</span><span class="p">])</span>
            <span class="n">tail</span> <span class="o">=</span> <span class="n">format_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="o">-</span><span class="n">num</span><span class="p">:])</span>
            <span class="n">category_strs</span> <span class="o">=</span> <span class="n">head</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;...&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">tail</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">category_strs</span> <span class="o">=</span> <span class="n">format_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>

        <span class="c1"># Strip all leading spaces, which format_array adds for columns...</span>
        <span class="n">category_strs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">category_strs</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">category_strs</span>

    <span class="k">def</span> <span class="nf">_repr_categories_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a string representation of the footer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">category_strs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_categories</span><span class="p">()</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">levheader</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Categories (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2">): &quot;</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_terminal_size</span><span class="p">()</span>
        <span class="n">max_width</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.width&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">width</span>
        <span class="k">if</span> <span class="n">console</span><span class="o">.</span><span class="n">in_ipython_frontend</span><span class="p">():</span>
            <span class="c1"># 0 = no breaks</span>
            <span class="n">max_width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">levstring</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">cur_col_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">levheader</span><span class="p">)</span>  <span class="c1"># header</span>
        <span class="n">sep_len</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot; &lt; &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered</span> <span class="k">else</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="p">)</span>
        <span class="n">linesep</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sep</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>  <span class="c1"># remove whitespace</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">category_strs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">max_width</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">cur_col_len</span> <span class="o">+</span> <span class="n">sep_len</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_width</span><span class="p">:</span>
                <span class="n">levstring</span> <span class="o">+=</span> <span class="n">linesep</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">levheader</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">cur_col_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">levheader</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># header + a whitespace</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">start</span><span class="p">:</span>
                <span class="n">levstring</span> <span class="o">+=</span> <span class="n">sep</span>
                <span class="n">cur_col_len</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">levstring</span> <span class="o">+=</span> <span class="n">val</span>
            <span class="n">start</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># replace to simple save space by</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">levheader</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">levstring</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &lt; ... &lt; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; ... &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span>

    <span class="k">def</span> <span class="nf">_repr_footer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_categories_info</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_get_repr</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">na_rep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NaN&quot;</span><span class="p">,</span> <span class="n">footer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">pandas.io.formats</span> <span class="kn">import</span> <span class="nb">format</span> <span class="k">as</span> <span class="n">fmt</span>

        <span class="n">formatter</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">CategoricalFormatter</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">na_rep</span><span class="o">=</span><span class="n">na_rep</span><span class="p">,</span> <span class="n">footer</span><span class="o">=</span><span class="n">footer</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        String representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_maxlen</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_maxlen</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tidy_repr</span><span class="p">(</span><span class="n">_maxlen</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_repr</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_maxlen</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_repr</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">footer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[], </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># ------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_validate_listlike</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># NB: here we assume scalar-like tuples have already been excluded</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">extract_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># require identical categories set</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Categorical</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dtype_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot set a Categorical with another, &quot;</span>
                    <span class="s2">&quot;without identical categories&quot;</span>
                <span class="p">)</span>
            <span class="c1"># is_dtype_equal implies categories_match_up_to_permutation</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_with_my_categories</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">_codes</span>

        <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">Index</span>

        <span class="c1"># tupleize_cols=False for e.g. test_fillna_iterable_category GH#41914</span>
        <span class="n">to_add</span> <span class="o">=</span> <span class="n">Index</span><span class="o">.</span><span class="n">_with_infer</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">tupleize_cols</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">categories</span>
        <span class="p">)</span>

        <span class="c1"># no assignments of values not in categories, but it&#39;s always ok to set</span>
        <span class="c1"># something to np.nan</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_add</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">isna</span><span class="p">(</span><span class="n">to_add</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot setitem on a Categorical with a new &quot;</span>
                <span class="s2">&quot;category, set the categories first&quot;</span>
            <span class="p">)</span>

        <span class="n">codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">codes</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ndarray</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_reverse_indexer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">intp</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the inverse of a categorical, returning</span>
<span class="sd">        a dict of categories -&gt; indexers.</span>

<span class="sd">        *This is an internal function*</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[Hashable, np.ndarray[np.intp]]</span>
<span class="sd">            dict of categories -&gt; indexers</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; c = pd.Categorical(list(&#39;aabca&#39;))</span>
<span class="sd">        &gt;&gt;&gt; c</span>
<span class="sd">        [&#39;a&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;a&#39;]</span>
<span class="sd">        Categories (3, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="sd">        &gt;&gt;&gt; c.categories</span>
<span class="sd">        Index([&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], dtype=&#39;object&#39;)</span>
<span class="sd">        &gt;&gt;&gt; c.codes</span>
<span class="sd">        array([0, 0, 1, 2, 0], dtype=int8)</span>
<span class="sd">        &gt;&gt;&gt; c._reverse_indexer()</span>
<span class="sd">        {&#39;a&#39;: array([0, 1, 4]), &#39;b&#39;: array([2]), &#39;c&#39;: array([3])}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">libalgos</span><span class="o">.</span><span class="n">groupsort_indexer</span><span class="p">(</span>
            <span class="n">ensure_platform_int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codes</span><span class="p">),</span> <span class="n">categories</span><span class="o">.</span><span class="n">size</span>
        <span class="p">)</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">ensure_int64</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">_result</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">counts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">_result</span><span class="p">))</span>

    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="c1"># Reductions</span>

<div class="viewcode-block" id="Categorical.min"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.min">[docs]</a>    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">skipna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The minimum value of the object.</span>

<span class="sd">        Only ordered `Categoricals` have a minimum!</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If the `Categorical` is not `ordered`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        min : the minimum of this `Categorical`, NA value if empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nv</span><span class="o">.</span><span class="n">validate_minmax_axis</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">nv</span><span class="o">.</span><span class="n">validate_min</span><span class="p">((),</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_for_ordered</span><span class="p">(</span><span class="s2">&quot;min&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">na_value</span>

        <span class="n">good</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">good</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">skipna</span> <span class="ow">and</span> <span class="n">good</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">pointer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">[</span><span class="n">good</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pointer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_reduction_result</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">pointer</span><span class="p">)</span></div>

<div class="viewcode-block" id="Categorical.max"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.max">[docs]</a>    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">skipna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The maximum value of the object.</span>

<span class="sd">        Only ordered `Categoricals` have a maximum!</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If the `Categorical` is not `ordered`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        max : the maximum of this `Categorical`, NA if array is empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nv</span><span class="o">.</span><span class="n">validate_minmax_axis</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">nv</span><span class="o">.</span><span class="n">validate_max</span><span class="p">((),</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_for_ordered</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">na_value</span>

        <span class="n">good</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">good</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">skipna</span> <span class="ow">and</span> <span class="n">good</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">pointer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">[</span><span class="n">good</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pointer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_reduction_result</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">pointer</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dropna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Categorical</span><span class="p">:</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codes</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">dropna</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>

        <span class="n">res_codes</span> <span class="o">=</span> <span class="n">algorithms</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
        <span class="n">res_codes</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">res_codes</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">res_codes</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">codes</span><span class="o">.</span><span class="n">dtype</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_backing_data</span><span class="p">(</span><span class="n">res_codes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="c1"># ExtensionArray Interface</span>

<div class="viewcode-block" id="Categorical.unique"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.unique">[docs]</a>    <span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the ``Categorical`` which ``categories`` and ``codes`` are</span>
<span class="sd">        unique.</span>

<span class="sd">        .. versionchanged:: 1.3.0</span>

<span class="sd">            Previously, unused categories were dropped from the new categories.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Categorical</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        pandas.unique</span>
<span class="sd">        CategoricalIndex.unique</span>
<span class="sd">        Series.unique : Return unique values of Series object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; pd.Categorical(list(&quot;baabc&quot;)).unique()</span>
<span class="sd">        [&#39;b&#39;, &#39;a&#39;, &#39;c&#39;]</span>
<span class="sd">        Categories (3, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="sd">        &gt;&gt;&gt; pd.Categorical(list(&quot;baab&quot;), categories=list(&quot;abc&quot;), ordered=True).unique()</span>
<span class="sd">        [&#39;b&#39;, &#39;a&#39;]</span>
<span class="sd">        Categories (3, object): [&#39;a&#39; &lt; &#39;b&#39; &lt; &#39;c&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=useless-parent-delegation</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_cast_quantile_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="c1"># make sure we have correct itemsize for resulting codes</span>
        <span class="k">assert</span> <span class="n">res_values</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ndarray</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">return</span> <span class="n">res_values</span>

<div class="viewcode-block" id="Categorical.equals"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if categorical arrays are equal.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : `Categorical`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Categorical</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_categories_match_up_to_permutation</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_with_my_categories</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_codes</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_codes</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_concat_same_type</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">CategoricalT</span><span class="p">],</span> <span class="n">to_concat</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">CategoricalT</span><span class="p">],</span> <span class="n">axis</span><span class="p">:</span> <span class="n">AxisInt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CategoricalT</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">pandas.core.dtypes.concat</span> <span class="kn">import</span> <span class="n">union_categoricals</span>

        <span class="n">first</span> <span class="o">=</span> <span class="n">to_concat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">&gt;=</span> <span class="n">first</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;axis </span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2"> is out of bounds for array of dimension </span><span class="si">{</span><span class="n">first</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Flatten, concatenate then reshape</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">to_concat</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>

            <span class="c1"># pass correctly-shaped to union_categoricals</span>
            <span class="n">tc_flat</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">to_concat</span><span class="p">:</span>
                <span class="n">tc_flat</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">obj</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>

            <span class="n">res_flat</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_concat_same_type</span><span class="p">(</span><span class="n">tc_flat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">res_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">union_categoricals</span><span class="p">(</span><span class="n">to_concat</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># ------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_encode_with_my_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Categorical</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Categorical</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Re-encode another categorical using this Categorical&#39;s categories.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This assumes we have already checked</span>
<span class="sd">        self._categories_match_up_to_permutation(other).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Indexing on codes is more efficient if categories are the same,</span>
        <span class="c1">#  so we can apply some optimizations based on the degree of</span>
        <span class="c1">#  dtype-matching.</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="n">recode_for_categories</span><span class="p">(</span>
            <span class="n">other</span><span class="o">.</span><span class="n">codes</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">categories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_backing_data</span><span class="p">(</span><span class="n">codes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_categories_match_up_to_permutation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Categorical</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if categoricals are the same dtype</span>
<span class="sd">          same categories, and same ordered</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : Categorical</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="nb">hash</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

<div class="viewcode-block" id="Categorical.describe"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.describe">[docs]</a>    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Describes this Categorical</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        description: `DataFrame`</span>
<span class="sd">            A dataframe with frequency and counts by category.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="n">counts</span> <span class="o">/</span> <span class="n">counts</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">Index</span>
        <span class="kn">from</span> <span class="nn">pandas.core.reshape.concat</span> <span class="kn">import</span> <span class="n">concat</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">concat</span><span class="p">([</span><span class="n">counts</span><span class="p">,</span> <span class="n">freqs</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">Index</span><span class="p">([</span><span class="s2">&quot;counts&quot;</span><span class="p">,</span> <span class="s2">&quot;freqs&quot;</span><span class="p">])</span>
        <span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;categories&quot;</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Categorical.isin"><a class="viewcode-back" href="../../../../utils/pandas.html#pandas.Categorical.isin">[docs]</a>    <span class="k">def</span> <span class="nf">isin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether `values` are contained in Categorical.</span>

<span class="sd">        Return a boolean NumPy Array showing whether each element in</span>
<span class="sd">        the Categorical matches an element in the passed sequence of</span>
<span class="sd">        `values` exactly.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        values : set or list-like</span>
<span class="sd">            The sequence of values to test. Passing in a single string will</span>
<span class="sd">            raise a ``TypeError``. Instead, turn a single string into a</span>
<span class="sd">            list of one element.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray[bool]</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">          * If `values` is not a set or list-like</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        pandas.Series.isin : Equivalent method on Series.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; s = pd.Categorical([&#39;lama&#39;, &#39;cow&#39;, &#39;lama&#39;, &#39;beetle&#39;, &#39;lama&#39;,</span>
<span class="sd">        ...                &#39;hippo&#39;])</span>
<span class="sd">        &gt;&gt;&gt; s.isin([&#39;cow&#39;, &#39;lama&#39;])</span>
<span class="sd">        array([ True,  True,  True, False,  True, False])</span>

<span class="sd">        Passing a single string as ``s.isin(&#39;lama&#39;)`` will raise an error. Use</span>
<span class="sd">        a list of one element instead:</span>

<span class="sd">        &gt;&gt;&gt; s.isin([&#39;lama&#39;])</span>
<span class="sd">        array([ True, False,  True, False,  True, False])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_list_like</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="n">values_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;only list-like objects are allowed to be passed &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;to isin(), you passed a [</span><span class="si">{</span><span class="n">values_type</span><span class="si">}</span><span class="s2">]&quot;</span>
            <span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">sanitize_array</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">null_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">isna</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
        <span class="n">code_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">code_values</span> <span class="o">=</span> <span class="n">code_values</span><span class="p">[</span><span class="n">null_mask</span> <span class="o">|</span> <span class="p">(</span><span class="n">code_values</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">algorithms</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codes</span><span class="p">,</span> <span class="n">code_values</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">to_replace</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">Index</span>

        <span class="n">inplace</span> <span class="o">=</span> <span class="n">validate_bool_kwarg</span><span class="p">(</span><span class="n">inplace</span><span class="p">,</span> <span class="s2">&quot;inplace&quot;</span><span class="p">)</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">inplace</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">isna</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">removals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">to_replace</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">removals</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">removals</span><span class="p">)]</span>
            <span class="n">new_cat</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">remove_categories</span><span class="p">(</span><span class="n">removals</span><span class="p">)</span>
            <span class="n">NDArrayBacked</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">new_cat</span><span class="o">.</span><span class="n">codes</span><span class="p">,</span> <span class="n">new_cat</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="n">ser</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span>
        <span class="n">ser</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="n">to_replace</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

        <span class="n">all_values</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="n">ser</span><span class="p">)</span>

        <span class="c1"># GH51016: maintain order of existing categories</span>
        <span class="n">idxr</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">get_indexer_for</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span>
        <span class="n">locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ser</span><span class="p">))</span>
        <span class="n">locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">idxr</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">locs</span><span class="p">,</span> <span class="n">idxr</span><span class="p">)</span>
        <span class="n">locs</span> <span class="o">=</span> <span class="n">locs</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>

        <span class="n">new_categories</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>
        <span class="n">new_categories</span> <span class="o">=</span> <span class="n">new_categories</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
        <span class="n">new_categories</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="n">new_categories</span><span class="p">)</span>
        <span class="n">new_codes</span> <span class="o">=</span> <span class="n">recode_for_categories</span><span class="p">(</span>
            <span class="n">cat</span><span class="o">.</span><span class="n">_codes</span><span class="p">,</span> <span class="n">all_values</span><span class="p">,</span> <span class="n">new_categories</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">new_dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">new_categories</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">ordered</span><span class="p">)</span>
        <span class="n">NDArrayBacked</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">new_codes</span><span class="p">,</span> <span class="n">new_dtype</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cat</span>

    <span class="c1"># ------------------------------------------------------------------------</span>
    <span class="c1"># String methods interface</span>
    <span class="k">def</span> <span class="nf">_str_map</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">na_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;object&quot;</span><span class="p">),</span> <span class="n">convert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">):</span>
        <span class="c1"># Optimization to apply the callable `f` to the categories once</span>
        <span class="c1"># and rebuild the result by `take`ing from the result with the codes.</span>
        <span class="c1"># Returns the same type as the object-dtype implementation though.</span>
        <span class="kn">from</span> <span class="nn">pandas.core.arrays</span> <span class="kn">import</span> <span class="n">PandasArray</span>

        <span class="n">categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">codes</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">PandasArray</span><span class="p">(</span><span class="n">categories</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span><span class="o">.</span><span class="n">_str_map</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">na_value</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">take_nd</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">codes</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">na_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_str_get_dummies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span><span class="p">):</span>
        <span class="c1"># sep may not be in categories. Just bail on this.</span>
        <span class="kn">from</span> <span class="nn">pandas.core.arrays</span> <span class="kn">import</span> <span class="n">PandasArray</span>

        <span class="k">return</span> <span class="n">PandasArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span><span class="o">.</span><span class="n">_str_get_dummies</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span></div>


<span class="c1"># The Series.cat accessor</span>


<span class="nd">@delegate_names</span><span class="p">(</span>
    <span class="n">delegate</span><span class="o">=</span><span class="n">Categorical</span><span class="p">,</span> <span class="n">accessors</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;categories&quot;</span><span class="p">,</span> <span class="s2">&quot;ordered&quot;</span><span class="p">],</span> <span class="n">typ</span><span class="o">=</span><span class="s2">&quot;property&quot;</span>
<span class="p">)</span>
<span class="nd">@delegate_names</span><span class="p">(</span>
    <span class="n">delegate</span><span class="o">=</span><span class="n">Categorical</span><span class="p">,</span>
    <span class="n">accessors</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;rename_categories&quot;</span><span class="p">,</span>
        <span class="s2">&quot;reorder_categories&quot;</span><span class="p">,</span>
        <span class="s2">&quot;add_categories&quot;</span><span class="p">,</span>
        <span class="s2">&quot;remove_categories&quot;</span><span class="p">,</span>
        <span class="s2">&quot;remove_unused_categories&quot;</span><span class="p">,</span>
        <span class="s2">&quot;set_categories&quot;</span><span class="p">,</span>
        <span class="s2">&quot;as_ordered&quot;</span><span class="p">,</span>
        <span class="s2">&quot;as_unordered&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">typ</span><span class="o">=</span><span class="s2">&quot;method&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">class</span> <span class="nc">CategoricalAccessor</span><span class="p">(</span><span class="n">PandasDelegate</span><span class="p">,</span> <span class="n">PandasObject</span><span class="p">,</span> <span class="n">NoNewAttributesMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Accessor object for categorical properties of the Series values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : Series or CategoricalIndex</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; s = pd.Series(list(&quot;abbccc&quot;)).astype(&quot;category&quot;)</span>
<span class="sd">    &gt;&gt;&gt; s</span>
<span class="sd">    0    a</span>
<span class="sd">    1    b</span>
<span class="sd">    2    b</span>
<span class="sd">    3    c</span>
<span class="sd">    4    c</span>
<span class="sd">    5    c</span>
<span class="sd">    dtype: category</span>
<span class="sd">    Categories (3, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>

<span class="sd">    &gt;&gt;&gt; s.cat.categories</span>
<span class="sd">    Index([&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], dtype=&#39;object&#39;)</span>

<span class="sd">    &gt;&gt;&gt; s.cat.rename_categories(list(&quot;cba&quot;))</span>
<span class="sd">    0    c</span>
<span class="sd">    1    b</span>
<span class="sd">    2    b</span>
<span class="sd">    3    a</span>
<span class="sd">    4    a</span>
<span class="sd">    5    a</span>
<span class="sd">    dtype: category</span>
<span class="sd">    Categories (3, object): [&#39;c&#39;, &#39;b&#39;, &#39;a&#39;]</span>

<span class="sd">    &gt;&gt;&gt; s.cat.reorder_categories(list(&quot;cba&quot;))</span>
<span class="sd">    0    a</span>
<span class="sd">    1    b</span>
<span class="sd">    2    b</span>
<span class="sd">    3    c</span>
<span class="sd">    4    c</span>
<span class="sd">    5    c</span>
<span class="sd">    dtype: category</span>
<span class="sd">    Categories (3, object): [&#39;c&#39;, &#39;b&#39;, &#39;a&#39;]</span>

<span class="sd">    &gt;&gt;&gt; s.cat.add_categories([&quot;d&quot;, &quot;e&quot;])</span>
<span class="sd">    0    a</span>
<span class="sd">    1    b</span>
<span class="sd">    2    b</span>
<span class="sd">    3    c</span>
<span class="sd">    4    c</span>
<span class="sd">    5    c</span>
<span class="sd">    dtype: category</span>
<span class="sd">    Categories (5, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;]</span>

<span class="sd">    &gt;&gt;&gt; s.cat.remove_categories([&quot;a&quot;, &quot;c&quot;])</span>
<span class="sd">    0    NaN</span>
<span class="sd">    1      b</span>
<span class="sd">    2      b</span>
<span class="sd">    3    NaN</span>
<span class="sd">    4    NaN</span>
<span class="sd">    5    NaN</span>
<span class="sd">    dtype: category</span>
<span class="sd">    Categories (1, object): [&#39;b&#39;]</span>

<span class="sd">    &gt;&gt;&gt; s1 = s.cat.add_categories([&quot;d&quot;, &quot;e&quot;])</span>
<span class="sd">    &gt;&gt;&gt; s1.cat.remove_unused_categories()</span>
<span class="sd">    0    a</span>
<span class="sd">    1    b</span>
<span class="sd">    2    b</span>
<span class="sd">    3    c</span>
<span class="sd">    4    c</span>
<span class="sd">    5    c</span>
<span class="sd">    dtype: category</span>
<span class="sd">    Categories (3, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>

<span class="sd">    &gt;&gt;&gt; s.cat.set_categories(list(&quot;abcde&quot;))</span>
<span class="sd">    0    a</span>
<span class="sd">    1    b</span>
<span class="sd">    2    b</span>
<span class="sd">    3    c</span>
<span class="sd">    4    c</span>
<span class="sd">    5    c</span>
<span class="sd">    dtype: category</span>
<span class="sd">    Categories (5, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;]</span>

<span class="sd">    &gt;&gt;&gt; s.cat.as_ordered()</span>
<span class="sd">    0    a</span>
<span class="sd">    1    b</span>
<span class="sd">    2    b</span>
<span class="sd">    3    c</span>
<span class="sd">    4    c</span>
<span class="sd">    5    c</span>
<span class="sd">    dtype: category</span>
<span class="sd">    Categories (3, object): [&#39;a&#39; &lt; &#39;b&#39; &lt; &#39;c&#39;]</span>

<span class="sd">    &gt;&gt;&gt; s.cat.as_unordered()</span>
<span class="sd">    0    a</span>
<span class="sd">    1    b</span>
<span class="sd">    2    b</span>
<span class="sd">    3    c</span>
<span class="sd">    4    c</span>
<span class="sd">    5    c</span>
<span class="sd">    dtype: category</span>
<span class="sd">    Categories (3, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_freeze</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_categorical_dtype</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Can only use .cat accessor with a &#39;category&#39; dtype&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_delegate_property_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_delegate_property_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">new_values</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">new_values</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">codes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return Series of codes as well as the index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">Series</span>

        <span class="k">return</span> <span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">codes</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_delegate_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">Series</span>

        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Series</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>


<span class="c1"># utility routines</span>


<span class="k">def</span> <span class="nf">_get_codes_for_values</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">categories</span><span class="p">:</span> <span class="n">Index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    utility routine to turn values into codes given the specified categories</span>

<span class="sd">    If `values` is known to be a Categorical, use recode_for_categories instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="n">_get_codes_for_values</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">categories</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">codes</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">codes</span> <span class="o">=</span> <span class="n">categories</span><span class="o">.</span><span class="n">get_indexer_for</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coerce_indexer_dtype</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">categories</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">recode_for_categories</span><span class="p">(</span>
    <span class="n">codes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">old_categories</span><span class="p">,</span> <span class="n">new_categories</span><span class="p">,</span> <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a set of codes for to a new set of categories</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    codes : np.ndarray</span>
<span class="sd">    old_categories, new_categories : Index</span>
<span class="sd">    copy: bool, default True</span>
<span class="sd">        Whether to copy if the codes are unchanged.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    new_codes : np.ndarray[np.int64]</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; old_cat = pd.Index([&#39;b&#39;, &#39;a&#39;, &#39;c&#39;])</span>
<span class="sd">    &gt;&gt;&gt; new_cat = pd.Index([&#39;a&#39;, &#39;b&#39;])</span>
<span class="sd">    &gt;&gt;&gt; codes = np.array([0, 1, 1, 2])</span>
<span class="sd">    &gt;&gt;&gt; recode_for_categories(codes, old_cat, new_cat)</span>
<span class="sd">    array([ 1,  0,  0, -1], dtype=int8)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_categories</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># All null anyway, so just retain the nulls</span>
        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">codes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">codes</span>
    <span class="k">elif</span> <span class="n">new_categories</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">old_categories</span><span class="p">):</span>
        <span class="c1"># Same categories, so no need to actually recode</span>
        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">codes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">codes</span>

    <span class="n">indexer</span> <span class="o">=</span> <span class="n">coerce_indexer_dtype</span><span class="p">(</span>
        <span class="n">new_categories</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">(</span><span class="n">old_categories</span><span class="p">),</span> <span class="n">new_categories</span>
    <span class="p">)</span>
    <span class="n">new_codes</span> <span class="o">=</span> <span class="n">take_nd</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">codes</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_codes</span>


<span class="k">def</span> <span class="nf">factorize_from_iterable</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Index</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Factorize an input `values` into `categories` and `codes`. Preserves</span>
<span class="sd">    categorical dtype in `categories`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    values : list-like</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    codes : ndarray</span>
<span class="sd">    categories : Index</span>
<span class="sd">        If `values` has a categorical dtype, then `categories` is</span>
<span class="sd">        a CategoricalIndex keeping the categories and order of `values`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">CategoricalIndex</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_list_like</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input must be list-like&quot;</span><span class="p">)</span>

    <span class="n">categories</span><span class="p">:</span> <span class="n">Index</span>
    <span class="k">if</span> <span class="n">is_categorical_dtype</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="c1"># The Categorical we want to build has the same categories</span>
        <span class="c1"># as values but its codes are by def [0, ..., len(n_categories) - 1]</span>
        <span class="n">cat_codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">categories</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="n">Categorical</span><span class="o">.</span><span class="n">from_codes</span><span class="p">(</span><span class="n">cat_codes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="n">categories</span> <span class="o">=</span> <span class="n">CategoricalIndex</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">codes</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># The value of ordered is irrelevant since we don&#39;t use cat as such,</span>
        <span class="c1"># but only the resulting categories, the order of which is independent</span>
        <span class="c1"># from ordered. Set ordered to False as default. See GH #15457</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="n">Categorical</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">categories</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">categories</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
    <span class="k">return</span> <span class="n">codes</span><span class="p">,</span> <span class="n">categories</span>


<span class="k">def</span> <span class="nf">factorize_from_iterables</span><span class="p">(</span><span class="n">iterables</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">Index</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A higher-level wrapper over `factorize_from_iterable`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    iterables : list-like of list-likes</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    codes : list of ndarrays</span>
<span class="sd">    categories : list of Indexes</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    See `factorize_from_iterable` for more info.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iterables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># For consistency, it should return two empty lists.</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="n">codes</span><span class="p">,</span> <span class="n">categories</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">factorize_from_iterable</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">iterables</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">codes</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Tommaso Furlanello, and Daniel Hug.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>