<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pandas.io.sql &mdash; BabyDragon  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            BabyDragon
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tasks:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks/llm_task.html">llm_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks/multi_kernel_task.html">multi_kernel_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks/base_task.html">base_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks/topic_tree_task.html">topic_tree_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks/embedding_task.html">embedding_task</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Memory/Kernels:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/kernels/memory_kernel.html">memory_kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/kernels/kernel_clustering.html">kernel_clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/kernels/multi_kernel.html">multi_kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/kernels/multi_kernel_visualization.html">multi_kernel_visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/kernels/kernel_utils.html">kernel_utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Memory/Threads:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/threads/base_thread.html">base_thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/threads/fifo_thread.html">fifo_thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/threads/vector_thread.html">vector_thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/threads/todo/python_thread.html">python_thread</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Memory/Indexes:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/python_index.html">python_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/memory_index.html">memory_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/pandas_index.html">pandas_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/todo/youtube_index.html">youtube_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/todo/parquet_index.html">parquet_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/todo/wiki_index.html">wiki_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/todo/gutenberg_index.html">gutenberg_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/todo/github_index.html">github_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/todo/multi_index.html">multi_index</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Chat:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../chat/base_chat.html">base_chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chat/memory_chat.html">memory_chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chat/chat.html">chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chat/prompts/perspective_prompt.html">perspective_prompt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chat/prompts/default_prompts.html">default_prompts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Utils:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../utils/multithreading.html">multithreading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utils/pandas.html">pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utils/hf_datasets.html">hf_datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utils/chatml.html">chatml</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Models/embedders:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../models/embedders/ada2.html">ada2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models/embedders/cohere.html">cohere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models/embedders/sbert.html">sbert</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Models/generators:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../models/generators/cohere.html">cohere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models/generators/chatgpt.html">chatgpt</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Processors:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/github_processors.html">github_processors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/os_processor.html">os_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/git_metadata.html">git_metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/visitors.html">visitors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/python_parser.html">python_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/todo/subs_parser.html">subs_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/todo/latex_parser.html">latex_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/todo/md_parser.html">md_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/todo/wiki_parser.html">wiki_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/todo/git_processor.html">git_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/todo/arxiv_processor.html">arxiv_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/todo/wiki_processor.html">wiki_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/todo/chatgpt_processor.html">chatgpt_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/todo/mit_course_processor.html">mit_course_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/todo/youtube_processor.html">youtube_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/todo/pubmed_processor.html">pubmed_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/todo/gutenberg_processor.html">gutenberg_processor</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Apps:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../apps/auto_perspective/perspective.html">perspective</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">BabyDragon</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pandas.io.sql</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pandas.io.sql</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Collection of query wrappers / abstractions to both facilitate data</span>
<span class="sd">retrieval and to reduce dependency on DB-specific API.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ABC</span><span class="p">,</span>
    <span class="n">abstractmethod</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ExitStack</span><span class="p">,</span>
    <span class="n">contextmanager</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">date</span><span class="p">,</span>
    <span class="n">datetime</span><span class="p">,</span>
    <span class="n">time</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TYPE_CHECKING</span><span class="p">,</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Iterator</span><span class="p">,</span>
    <span class="n">Literal</span><span class="p">,</span>
    <span class="n">cast</span><span class="p">,</span>
    <span class="n">overload</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pandas._libs</span> <span class="kn">import</span> <span class="n">lib</span>
<span class="kn">from</span> <span class="nn">pandas._typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DateTimeErrorChoices</span><span class="p">,</span>
    <span class="n">DtypeArg</span><span class="p">,</span>
    <span class="n">DtypeBackend</span><span class="p">,</span>
    <span class="n">IndexLabel</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.compat._optional</span> <span class="kn">import</span> <span class="n">import_optional_dependency</span>
<span class="kn">from</span> <span class="nn">pandas.errors</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AbstractMethodError</span><span class="p">,</span>
    <span class="n">DatabaseError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.util._exceptions</span> <span class="kn">import</span> <span class="n">find_stack_level</span>
<span class="kn">from</span> <span class="nn">pandas.util._validators</span> <span class="kn">import</span> <span class="n">check_dtype_backend</span>

<span class="kn">from</span> <span class="nn">pandas.core.dtypes.common</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">is_datetime64tz_dtype</span><span class="p">,</span>
    <span class="n">is_dict_like</span><span class="p">,</span>
    <span class="n">is_integer</span><span class="p">,</span>
    <span class="n">is_list_like</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.dtypes.dtypes</span> <span class="kn">import</span> <span class="n">DatetimeTZDtype</span>
<span class="kn">from</span> <span class="nn">pandas.core.dtypes.missing</span> <span class="kn">import</span> <span class="n">isna</span>

<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">get_option</span>
<span class="kn">from</span> <span class="nn">pandas.core.api</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">Series</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.arrays</span> <span class="kn">import</span> <span class="n">ArrowExtensionArray</span>
<span class="kn">from</span> <span class="nn">pandas.core.base</span> <span class="kn">import</span> <span class="n">PandasObject</span>
<span class="kn">import</span> <span class="nn">pandas.core.common</span> <span class="k">as</span> <span class="nn">com</span>
<span class="kn">from</span> <span class="nn">pandas.core.internals.construction</span> <span class="kn">import</span> <span class="n">convert_object_array</span>
<span class="kn">from</span> <span class="nn">pandas.core.tools.datetimes</span> <span class="kn">import</span> <span class="n">to_datetime</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span>
    <span class="kn">from</span> <span class="nn">sqlalchemy.sql.expression</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">Select</span><span class="p">,</span>
        <span class="n">TextClause</span><span class="p">,</span>
    <span class="p">)</span>


<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># -- Helper functions</span>


<span class="k">def</span> <span class="nf">_process_parse_dates_argument</span><span class="p">(</span><span class="n">parse_dates</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process parse_dates argument for read_sql functions&quot;&quot;&quot;</span>
    <span class="c1"># handle non-list entries for parse_dates gracefully</span>
    <span class="k">if</span> <span class="n">parse_dates</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">parse_dates</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">parse_dates</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">parse_dates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parse_dates</span><span class="p">,</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">):</span>
        <span class="n">parse_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">parse_dates</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">parse_dates</span>


<span class="k">def</span> <span class="nf">_handle_date_column</span><span class="p">(</span>
    <span class="n">col</span><span class="p">,</span> <span class="n">utc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="c1"># GH35185 Allow custom error values in parse_dates argument of</span>
        <span class="c1"># read_sql like functions.</span>
        <span class="c1"># Format can take on custom to_datetime argument values such as</span>
        <span class="c1"># {&quot;errors&quot;: &quot;coerce&quot;} or {&quot;dayfirst&quot;: True}</span>
        <span class="n">error</span><span class="p">:</span> <span class="n">DateTimeErrorChoices</span> <span class="o">=</span> <span class="nb">format</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;errors&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;ignore&quot;</span>
        <span class="k">return</span> <span class="n">to_datetime</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="o">**</span><span class="nb">format</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Allow passing of formatting string for integers</span>
        <span class="c1"># GH17855</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="nb">issubclass</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;us&quot;</span><span class="p">,</span> <span class="s2">&quot;ns&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">to_datetime</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="n">utc</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_datetime64tz_dtype</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="c1"># coerce to UTC timezone</span>
            <span class="c1"># GH11216</span>
            <span class="k">return</span> <span class="n">to_datetime</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">to_datetime</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="n">utc</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_parse_date_columns</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">parse_dates</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Force non-datetime columns to be read as such.</span>
<span class="sd">    Supports both string formatted and integer timestamp columns.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parse_dates</span> <span class="o">=</span> <span class="n">_process_parse_dates_argument</span><span class="p">(</span><span class="n">parse_dates</span><span class="p">)</span>

    <span class="c1"># we want to coerce datetime64_tz dtypes for now to UTC</span>
    <span class="c1"># we could in theory do a &#39;nice&#39; conversion from a FixedOffset tz</span>
    <span class="c1"># GH11216</span>
    <span class="k">for</span> <span class="n">col_name</span><span class="p">,</span> <span class="n">df_col</span> <span class="ow">in</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">is_datetime64tz_dtype</span><span class="p">(</span><span class="n">df_col</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="ow">or</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">parse_dates</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="n">parse_dates</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">data_frame</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_handle_date_column</span><span class="p">(</span><span class="n">df_col</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data_frame</span>


<span class="k">def</span> <span class="nf">_convert_arrays_to_dataframe</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">,</span>
    <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">to_object_array_tuples</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">arrays</span> <span class="o">=</span> <span class="n">convert_object_array</span><span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">T</span><span class="p">),</span>
        <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
        <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">dtype_backend</span> <span class="o">==</span> <span class="s2">&quot;pyarrow&quot;</span><span class="p">:</span>
        <span class="n">pa</span> <span class="o">=</span> <span class="n">import_optional_dependency</span><span class="p">(</span><span class="s2">&quot;pyarrow&quot;</span><span class="p">)</span>
        <span class="n">arrays</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ArrowExtensionArray</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">from_pandas</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrays</span>
        <span class="p">]</span>
    <span class="k">if</span> <span class="n">arrays</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">arrays</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_wrap_result</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">,</span>
    <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">parse_dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrap result set of query in a DataFrame.&quot;&quot;&quot;</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">_convert_arrays_to_dataframe</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">coerce_float</span><span class="p">,</span> <span class="n">dtype_backend</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dtype</span><span class="p">:</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

    <span class="n">frame</span> <span class="o">=</span> <span class="n">_parse_date_columns</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">parse_dates</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">index_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">index_col</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">frame</span>


<span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute the given SQL query using the provided connection object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sql : string</span>
<span class="sd">        SQL query to be executed.</span>
<span class="sd">    con : SQLAlchemy connection or sqlite3 connection</span>
<span class="sd">        If a DBAPI2 object, only sqlite3 is supported.</span>
<span class="sd">    params : list or tuple, optional, default: None</span>
<span class="sd">        List of parameters to pass to execute method.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Results Iterable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;`pandas.io.sql.execute` is deprecated and &quot;</span>
        <span class="s2">&quot;will be removed in the future version.&quot;</span><span class="p">,</span>
        <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="n">stacklevel</span><span class="o">=</span><span class="n">find_stack_level</span><span class="p">(),</span>
    <span class="p">)</span>  <span class="c1"># GH50185</span>
    <span class="n">sqlalchemy</span> <span class="o">=</span> <span class="n">import_optional_dependency</span><span class="p">(</span><span class="s2">&quot;sqlalchemy&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sqlalchemy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;pandas.io.sql.execute requires a connection&quot;</span><span class="p">)</span>  <span class="c1"># GH50185</span>
    <span class="k">with</span> <span class="n">pandasSQL_builder</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">need_transaction</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">pandas_sql</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pandas_sql</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>


<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># -- Read and write to DataFrames</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">read_sql_table</span><span class="p">(</span>
    <span class="n">table_name</span><span class="p">,</span>
    <span class="n">con</span><span class="p">,</span>
    <span class="n">schema</span><span class="o">=...</span><span class="p">,</span>
    <span class="n">index_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">coerce_float</span><span class="o">=...</span><span class="p">,</span>
    <span class="n">parse_dates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">chunksize</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">lib</span><span class="o">.</span><span class="n">NoDefault</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">read_sql_table</span><span class="p">(</span>
    <span class="n">table_name</span><span class="p">,</span>
    <span class="n">con</span><span class="p">,</span>
    <span class="n">schema</span><span class="o">=...</span><span class="p">,</span>
    <span class="n">index_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">coerce_float</span><span class="o">=...</span><span class="p">,</span>
    <span class="n">parse_dates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">lib</span><span class="o">.</span><span class="n">NoDefault</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">]:</span>
    <span class="o">...</span>


<div class="viewcode-block" id="read_sql_table"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.read_sql_table">[docs]</a><span class="k">def</span> <span class="nf">read_sql_table</span><span class="p">(</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">con</span><span class="p">,</span>
    <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">index_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">parse_dates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">lib</span><span class="o">.</span><span class="n">NoDefault</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">no_default</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read SQL database table into a DataFrame.</span>

<span class="sd">    Given a table name and a SQLAlchemy connectable, returns a DataFrame.</span>
<span class="sd">    This function does not support DBAPI connections.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    table_name : str</span>
<span class="sd">        Name of SQL table in database.</span>
<span class="sd">    con : SQLAlchemy connectable or str</span>
<span class="sd">        A database URI could be provided as str.</span>
<span class="sd">        SQLite DBAPI connection mode not supported.</span>
<span class="sd">    schema : str, default None</span>
<span class="sd">        Name of SQL schema in database to query (if database flavor</span>
<span class="sd">        supports this). Uses default schema if None (default).</span>
<span class="sd">    index_col : str or list of str, optional, default: None</span>
<span class="sd">        Column(s) to set as index(MultiIndex).</span>
<span class="sd">    coerce_float : bool, default True</span>
<span class="sd">        Attempts to convert values of non-string, non-numeric objects (like</span>
<span class="sd">        decimal.Decimal) to floating point. Can result in loss of Precision.</span>
<span class="sd">    parse_dates : list or dict, default None</span>
<span class="sd">        - List of column names to parse as dates.</span>
<span class="sd">        - Dict of ``{column_name: format string}`` where format string is</span>
<span class="sd">          strftime compatible in case of parsing string times or is one of</span>
<span class="sd">          (D, s, ns, ms, us) in case of parsing integer timestamps.</span>
<span class="sd">        - Dict of ``{column_name: arg dict}``, where the arg dict corresponds</span>
<span class="sd">          to the keyword arguments of :func:`pandas.to_datetime`</span>
<span class="sd">          Especially useful with databases without native Datetime support,</span>
<span class="sd">          such as SQLite.</span>
<span class="sd">    columns : list, default None</span>
<span class="sd">        List of column names to select from SQL table.</span>
<span class="sd">    chunksize : int, default None</span>
<span class="sd">        If specified, returns an iterator where `chunksize` is the number of</span>
<span class="sd">        rows to include in each chunk.</span>
<span class="sd">    dtype_backend : {&quot;numpy_nullable&quot;, &quot;pyarrow&quot;}, defaults to NumPy backed DataFrames</span>
<span class="sd">        Which dtype_backend to use, e.g. whether a DataFrame should have NumPy</span>
<span class="sd">        arrays, nullable dtypes are used for all dtypes that have a nullable</span>
<span class="sd">        implementation when &quot;numpy_nullable&quot; is set, pyarrow is used for all</span>
<span class="sd">        dtypes if &quot;pyarrow&quot; is set.</span>

<span class="sd">        The dtype_backends are still experimential.</span>

<span class="sd">        .. versionadded:: 2.0</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame or Iterator[DataFrame]</span>
<span class="sd">        A SQL table is returned as two-dimensional data structure with labeled</span>
<span class="sd">        axes.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    read_sql_query : Read SQL query into a DataFrame.</span>
<span class="sd">    read_sql : Read SQL query or database table into a DataFrame.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Any datetime values with time zone information will be converted to UTC.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; pd.read_sql_table(&#39;table_name&#39;, &#39;postgres:///db_name&#39;)  # doctest:+SKIP</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_dtype_backend</span><span class="p">(</span><span class="n">dtype_backend</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dtype_backend</span> <span class="ow">is</span> <span class="n">lib</span><span class="o">.</span><span class="n">no_default</span><span class="p">:</span>
        <span class="n">dtype_backend</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span>  <span class="c1"># type: ignore[assignment]</span>

    <span class="k">with</span> <span class="n">pandasSQL_builder</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span> <span class="n">need_transaction</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">pandas_sql</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pandas_sql</span><span class="o">.</span><span class="n">has_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">pandas_sql</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span>
            <span class="n">table_name</span><span class="p">,</span>
            <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
            <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
            <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
            <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
            <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">table</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span></div>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">read_sql_query</span><span class="p">(</span>
    <span class="n">sql</span><span class="p">,</span>
    <span class="n">con</span><span class="p">,</span>
    <span class="n">index_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">coerce_float</span><span class="o">=...</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">parse_dates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">chunksize</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">lib</span><span class="o">.</span><span class="n">NoDefault</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">read_sql_query</span><span class="p">(</span>
    <span class="n">sql</span><span class="p">,</span>
    <span class="n">con</span><span class="p">,</span>
    <span class="n">index_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">coerce_float</span><span class="o">=...</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">parse_dates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">lib</span><span class="o">.</span><span class="n">NoDefault</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">]:</span>
    <span class="o">...</span>


<div class="viewcode-block" id="read_sql_query"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.read_sql_query">[docs]</a><span class="k">def</span> <span class="nf">read_sql_query</span><span class="p">(</span>
    <span class="n">sql</span><span class="p">,</span>
    <span class="n">con</span><span class="p">,</span>
    <span class="n">index_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">parse_dates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">lib</span><span class="o">.</span><span class="n">NoDefault</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">no_default</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read SQL query into a DataFrame.</span>

<span class="sd">    Returns a DataFrame corresponding to the result set of the query</span>
<span class="sd">    string. Optionally provide an `index_col` parameter to use one of the</span>
<span class="sd">    columns as the index, otherwise default integer index will be used.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sql : str SQL query or SQLAlchemy Selectable (select or text object)</span>
<span class="sd">        SQL query to be executed.</span>
<span class="sd">    con : SQLAlchemy connectable, str, or sqlite3 connection</span>
<span class="sd">        Using SQLAlchemy makes it possible to use any DB supported by that</span>
<span class="sd">        library. If a DBAPI2 object, only sqlite3 is supported.</span>
<span class="sd">    index_col : str or list of str, optional, default: None</span>
<span class="sd">        Column(s) to set as index(MultiIndex).</span>
<span class="sd">    coerce_float : bool, default True</span>
<span class="sd">        Attempts to convert values of non-string, non-numeric objects (like</span>
<span class="sd">        decimal.Decimal) to floating point. Useful for SQL result sets.</span>
<span class="sd">    params : list, tuple or dict, optional, default: None</span>
<span class="sd">        List of parameters to pass to execute method.  The syntax used</span>
<span class="sd">        to pass parameters is database driver dependent. Check your</span>
<span class="sd">        database driver documentation for which of the five syntax styles,</span>
<span class="sd">        described in PEP 249&#39;s paramstyle, is supported.</span>
<span class="sd">        Eg. for psycopg2, uses %(name)s so use params={&#39;name&#39; : &#39;value&#39;}.</span>
<span class="sd">    parse_dates : list or dict, default: None</span>
<span class="sd">        - List of column names to parse as dates.</span>
<span class="sd">        - Dict of ``{column_name: format string}`` where format string is</span>
<span class="sd">          strftime compatible in case of parsing string times, or is one of</span>
<span class="sd">          (D, s, ns, ms, us) in case of parsing integer timestamps.</span>
<span class="sd">        - Dict of ``{column_name: arg dict}``, where the arg dict corresponds</span>
<span class="sd">          to the keyword arguments of :func:`pandas.to_datetime`</span>
<span class="sd">          Especially useful with databases without native Datetime support,</span>
<span class="sd">          such as SQLite.</span>
<span class="sd">    chunksize : int, default None</span>
<span class="sd">        If specified, return an iterator where `chunksize` is the number of</span>
<span class="sd">        rows to include in each chunk.</span>
<span class="sd">    dtype : Type name or dict of columns</span>
<span class="sd">        Data type for data or columns. E.g. np.float64 or</span>
<span class="sd">        {a: np.float64, b: np.int32, c: Int64}.</span>

<span class="sd">        .. versionadded:: 1.3.0</span>
<span class="sd">    dtype_backend : {&quot;numpy_nullable&quot;, &quot;pyarrow&quot;}, defaults to NumPy backed DataFrames</span>
<span class="sd">        Which dtype_backend to use, e.g. whether a DataFrame should have NumPy</span>
<span class="sd">        arrays, nullable dtypes are used for all dtypes that have a nullable</span>
<span class="sd">        implementation when &quot;numpy_nullable&quot; is set, pyarrow is used for all</span>
<span class="sd">        dtypes if &quot;pyarrow&quot; is set.</span>

<span class="sd">        The dtype_backends are still experimential.</span>

<span class="sd">        .. versionadded:: 2.0</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame or Iterator[DataFrame]</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    read_sql_table : Read SQL database table into a DataFrame.</span>
<span class="sd">    read_sql : Read SQL query or database table into a DataFrame.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Any datetime values with time zone information parsed via the `parse_dates`</span>
<span class="sd">    parameter will be converted to UTC.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_dtype_backend</span><span class="p">(</span><span class="n">dtype_backend</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dtype_backend</span> <span class="ow">is</span> <span class="n">lib</span><span class="o">.</span><span class="n">no_default</span><span class="p">:</span>
        <span class="n">dtype_backend</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span>  <span class="c1"># type: ignore[assignment]</span>

    <span class="k">with</span> <span class="n">pandasSQL_builder</span><span class="p">(</span><span class="n">con</span><span class="p">)</span> <span class="k">as</span> <span class="n">pandas_sql</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pandas_sql</span><span class="o">.</span><span class="n">read_query</span><span class="p">(</span>
            <span class="n">sql</span><span class="p">,</span>
            <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
            <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
            <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
            <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
        <span class="p">)</span></div>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">read_sql</span><span class="p">(</span>
    <span class="n">sql</span><span class="p">,</span>
    <span class="n">con</span><span class="p">,</span>
    <span class="n">index_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">coerce_float</span><span class="o">=...</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=...</span><span class="p">,</span>
    <span class="n">parse_dates</span><span class="o">=...</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">chunksize</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">lib</span><span class="o">.</span><span class="n">NoDefault</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">read_sql</span><span class="p">(</span>
    <span class="n">sql</span><span class="p">,</span>
    <span class="n">con</span><span class="p">,</span>
    <span class="n">index_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">coerce_float</span><span class="o">=...</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=...</span><span class="p">,</span>
    <span class="n">parse_dates</span><span class="o">=...</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">lib</span><span class="o">.</span><span class="n">NoDefault</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">]:</span>
    <span class="o">...</span>


<div class="viewcode-block" id="read_sql"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.read_sql">[docs]</a><span class="k">def</span> <span class="nf">read_sql</span><span class="p">(</span>
    <span class="n">sql</span><span class="p">,</span>
    <span class="n">con</span><span class="p">,</span>
    <span class="n">index_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">parse_dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">lib</span><span class="o">.</span><span class="n">NoDefault</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">no_default</span><span class="p">,</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read SQL query or database table into a DataFrame.</span>

<span class="sd">    This function is a convenience wrapper around ``read_sql_table`` and</span>
<span class="sd">    ``read_sql_query`` (for backward compatibility). It will delegate</span>
<span class="sd">    to the specific function depending on the provided input. A SQL query</span>
<span class="sd">    will be routed to ``read_sql_query``, while a database table name will</span>
<span class="sd">    be routed to ``read_sql_table``. Note that the delegated function might</span>
<span class="sd">    have more specific notes about their functionality not listed here.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sql : str or SQLAlchemy Selectable (select or text object)</span>
<span class="sd">        SQL query to be executed or a table name.</span>
<span class="sd">    con : SQLAlchemy connectable, str, or sqlite3 connection</span>
<span class="sd">        Using SQLAlchemy makes it possible to use any DB supported by that</span>
<span class="sd">        library. If a DBAPI2 object, only sqlite3 is supported. The user is responsible</span>
<span class="sd">        for engine disposal and connection closure for the SQLAlchemy connectable; str</span>
<span class="sd">        connections are closed automatically. See</span>
<span class="sd">        `here &lt;https://docs.sqlalchemy.org/en/13/core/connections.html&gt;`_.</span>
<span class="sd">    index_col : str or list of str, optional, default: None</span>
<span class="sd">        Column(s) to set as index(MultiIndex).</span>
<span class="sd">    coerce_float : bool, default True</span>
<span class="sd">        Attempts to convert values of non-string, non-numeric objects (like</span>
<span class="sd">        decimal.Decimal) to floating point, useful for SQL result sets.</span>
<span class="sd">    params : list, tuple or dict, optional, default: None</span>
<span class="sd">        List of parameters to pass to execute method.  The syntax used</span>
<span class="sd">        to pass parameters is database driver dependent. Check your</span>
<span class="sd">        database driver documentation for which of the five syntax styles,</span>
<span class="sd">        described in PEP 249&#39;s paramstyle, is supported.</span>
<span class="sd">        Eg. for psycopg2, uses %(name)s so use params={&#39;name&#39; : &#39;value&#39;}.</span>
<span class="sd">    parse_dates : list or dict, default: None</span>
<span class="sd">        - List of column names to parse as dates.</span>
<span class="sd">        - Dict of ``{column_name: format string}`` where format string is</span>
<span class="sd">          strftime compatible in case of parsing string times, or is one of</span>
<span class="sd">          (D, s, ns, ms, us) in case of parsing integer timestamps.</span>
<span class="sd">        - Dict of ``{column_name: arg dict}``, where the arg dict corresponds</span>
<span class="sd">          to the keyword arguments of :func:`pandas.to_datetime`</span>
<span class="sd">          Especially useful with databases without native Datetime support,</span>
<span class="sd">          such as SQLite.</span>
<span class="sd">    columns : list, default: None</span>
<span class="sd">        List of column names to select from SQL table (only used when reading</span>
<span class="sd">        a table).</span>
<span class="sd">    chunksize : int, default None</span>
<span class="sd">        If specified, return an iterator where `chunksize` is the</span>
<span class="sd">        number of rows to include in each chunk.</span>
<span class="sd">    dtype_backend : {&quot;numpy_nullable&quot;, &quot;pyarrow&quot;}, defaults to NumPy backed DataFrames</span>
<span class="sd">        Which dtype_backend to use, e.g. whether a DataFrame should have NumPy</span>
<span class="sd">        arrays, nullable dtypes are used for all dtypes that have a nullable</span>
<span class="sd">        implementation when &quot;numpy_nullable&quot; is set, pyarrow is used for all</span>
<span class="sd">        dtypes if &quot;pyarrow&quot; is set.</span>

<span class="sd">        The dtype_backends are still experimential.</span>

<span class="sd">        .. versionadded:: 2.0</span>
<span class="sd">    dtype : Type name or dict of columns</span>
<span class="sd">        Data type for data or columns. E.g. np.float64 or</span>
<span class="sd">        {a: np.float64, b: np.int32, c: Int64}.</span>
<span class="sd">        The argument is ignored if a table is passed instead of a query.</span>

<span class="sd">        .. versionadded:: 2.0.0</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame or Iterator[DataFrame]</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    read_sql_table : Read SQL database table into a DataFrame.</span>
<span class="sd">    read_sql_query : Read SQL query into a DataFrame.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Read data from SQL via either a SQL query or a SQL tablename.</span>
<span class="sd">    When using a SQLite database only SQL queries are accepted,</span>
<span class="sd">    providing only the SQL tablename will result in an error.</span>

<span class="sd">    &gt;&gt;&gt; from sqlite3 import connect</span>
<span class="sd">    &gt;&gt;&gt; conn = connect(&#39;:memory:&#39;)</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame(data=[[0, &#39;10/11/12&#39;], [1, &#39;12/11/10&#39;]],</span>
<span class="sd">    ...                   columns=[&#39;int_column&#39;, &#39;date_column&#39;])</span>
<span class="sd">    &gt;&gt;&gt; df.to_sql(&#39;test_data&#39;, conn)</span>
<span class="sd">    2</span>

<span class="sd">    &gt;&gt;&gt; pd.read_sql(&#39;SELECT int_column, date_column FROM test_data&#39;, conn)</span>
<span class="sd">       int_column date_column</span>
<span class="sd">    0           0    10/11/12</span>
<span class="sd">    1           1    12/11/10</span>

<span class="sd">    &gt;&gt;&gt; pd.read_sql(&#39;test_data&#39;, &#39;postgres:///db_name&#39;)  # doctest:+SKIP</span>

<span class="sd">    Apply date parsing to columns through the ``parse_dates`` argument</span>
<span class="sd">    The ``parse_dates`` argument calls ``pd.to_datetime`` on the provided columns.</span>
<span class="sd">    Custom argument values for applying ``pd.to_datetime`` on a column are specified</span>
<span class="sd">    via a dictionary format:</span>

<span class="sd">    &gt;&gt;&gt; pd.read_sql(&#39;SELECT int_column, date_column FROM test_data&#39;,</span>
<span class="sd">    ...             conn,</span>
<span class="sd">    ...             parse_dates={&quot;date_column&quot;: {&quot;format&quot;: &quot;%d/%m/%y&quot;}})</span>
<span class="sd">       int_column date_column</span>
<span class="sd">    0           0  2012-11-10</span>
<span class="sd">    1           1  2010-11-12</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_dtype_backend</span><span class="p">(</span><span class="n">dtype_backend</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dtype_backend</span> <span class="ow">is</span> <span class="n">lib</span><span class="o">.</span><span class="n">no_default</span><span class="p">:</span>
        <span class="n">dtype_backend</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span>  <span class="c1"># type: ignore[assignment]</span>

    <span class="k">with</span> <span class="n">pandasSQL_builder</span><span class="p">(</span><span class="n">con</span><span class="p">)</span> <span class="k">as</span> <span class="n">pandas_sql</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pandas_sql</span><span class="p">,</span> <span class="n">SQLiteDatabase</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pandas_sql</span><span class="o">.</span><span class="n">read_query</span><span class="p">(</span>
                <span class="n">sql</span><span class="p">,</span>
                <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
                <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
                <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
                <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">_is_table_name</span> <span class="o">=</span> <span class="n">pandas_sql</span><span class="o">.</span><span class="n">has_table</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># using generic exception to catch errors from sql drivers (GH24988)</span>
            <span class="n">_is_table_name</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">_is_table_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pandas_sql</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span>
                <span class="n">sql</span><span class="p">,</span>
                <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
                <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
                <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
                <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
                <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
                <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pandas_sql</span><span class="o">.</span><span class="n">read_query</span><span class="p">(</span>
                <span class="n">sql</span><span class="p">,</span>
                <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
                <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
                <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
                <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="p">)</span></div>


<span class="k">def</span> <span class="nf">to_sql</span><span class="p">(</span>
    <span class="n">frame</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">con</span><span class="p">,</span>
    <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">if_exists</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">,</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">index_label</span><span class="p">:</span> <span class="n">IndexLabel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">engine</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">engine_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write records stored in a DataFrame to a SQL database.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frame : DataFrame, Series</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of SQL table.</span>
<span class="sd">    con : SQLAlchemy connectable(engine/connection) or database string URI</span>
<span class="sd">        or sqlite3 DBAPI2 connection</span>
<span class="sd">        Using SQLAlchemy makes it possible to use any DB supported by that</span>
<span class="sd">        library.</span>
<span class="sd">        If a DBAPI2 object, only sqlite3 is supported.</span>
<span class="sd">    schema : str, optional</span>
<span class="sd">        Name of SQL schema in database to write to (if database flavor</span>
<span class="sd">        supports this). If None, use default schema (default).</span>
<span class="sd">    if_exists : {&#39;fail&#39;, &#39;replace&#39;, &#39;append&#39;}, default &#39;fail&#39;</span>
<span class="sd">        - fail: If table exists, do nothing.</span>
<span class="sd">        - replace: If table exists, drop it, recreate it, and insert data.</span>
<span class="sd">        - append: If table exists, insert data. Create if does not exist.</span>
<span class="sd">    index : bool, default True</span>
<span class="sd">        Write DataFrame index as a column.</span>
<span class="sd">    index_label : str or sequence, optional</span>
<span class="sd">        Column label for index column(s). If None is given (default) and</span>
<span class="sd">        `index` is True, then the index names are used.</span>
<span class="sd">        A sequence should be given if the DataFrame uses MultiIndex.</span>
<span class="sd">    chunksize : int, optional</span>
<span class="sd">        Specify the number of rows in each batch to be written at a time.</span>
<span class="sd">        By default, all rows will be written at once.</span>
<span class="sd">    dtype : dict or scalar, optional</span>
<span class="sd">        Specifying the datatype for columns. If a dictionary is used, the</span>
<span class="sd">        keys should be the column names and the values should be the</span>
<span class="sd">        SQLAlchemy types or strings for the sqlite3 fallback mode. If a</span>
<span class="sd">        scalar is provided, it will be applied to all columns.</span>
<span class="sd">    method : {None, &#39;multi&#39;, callable}, optional</span>
<span class="sd">        Controls the SQL insertion clause used:</span>

<span class="sd">        - None : Uses standard SQL ``INSERT`` clause (one per row).</span>
<span class="sd">        - ``&#39;multi&#39;``: Pass multiple values in a single ``INSERT`` clause.</span>
<span class="sd">        - callable with signature ``(pd_table, conn, keys, data_iter) -&gt; int | None``.</span>

<span class="sd">        Details and a sample callable implementation can be found in the</span>
<span class="sd">        section :ref:`insert method &lt;io.sql.method&gt;`.</span>
<span class="sd">    engine : {&#39;auto&#39;, &#39;sqlalchemy&#39;}, default &#39;auto&#39;</span>
<span class="sd">        SQL engine library to use. If &#39;auto&#39;, then the option</span>
<span class="sd">        ``io.sql.engine`` is used. The default ``io.sql.engine``</span>
<span class="sd">        behavior is &#39;sqlalchemy&#39;</span>

<span class="sd">        .. versionadded:: 1.3.0</span>

<span class="sd">    **engine_kwargs</span>
<span class="sd">        Any additional kwargs are passed to the engine.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None or int</span>
<span class="sd">        Number of rows affected by to_sql. None is returned if the callable</span>
<span class="sd">        passed into ``method`` does not return an integer number of rows.</span>

<span class="sd">        .. versionadded:: 1.4.0</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The returned rows affected is the sum of the ``rowcount`` attribute of ``sqlite3.Cursor``</span>
<span class="sd">    or SQLAlchemy connectable. The returned value may not reflect the exact number of written</span>
<span class="sd">    rows as stipulated in the</span>
<span class="sd">    `sqlite3 &lt;https://docs.python.org/3/library/sqlite3.html#sqlite3.Cursor.rowcount&gt;`__ or</span>
<span class="sd">    `SQLAlchemy &lt;https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.BaseCursorResult.rowcount&gt;`__</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa:E501</span>
    <span class="k">if</span> <span class="n">if_exists</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">if_exists</span><span class="si">}</span><span class="s2">&#39; is not valid for if_exists&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;&#39;frame&#39; argument should be either a Series or a DataFrame&quot;</span>
        <span class="p">)</span>

    <span class="k">with</span> <span class="n">pandasSQL_builder</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span> <span class="n">need_transaction</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">pandas_sql</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pandas_sql</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span>
            <span class="n">frame</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">if_exists</span><span class="o">=</span><span class="n">if_exists</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">index_label</span><span class="o">=</span><span class="n">index_label</span><span class="p">,</span>
            <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
            <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">engine</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span>
            <span class="o">**</span><span class="n">engine_kwargs</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">def</span> <span class="nf">has_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if DataBase has named table.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    table_name: string</span>
<span class="sd">        Name of SQL table.</span>
<span class="sd">    con: SQLAlchemy connectable(engine/connection) or sqlite3 DBAPI2 connection</span>
<span class="sd">        Using SQLAlchemy makes it possible to use any DB supported by that</span>
<span class="sd">        library.</span>
<span class="sd">        If a DBAPI2 object, only sqlite3 is supported.</span>
<span class="sd">    schema : string, default None</span>
<span class="sd">        Name of SQL schema in database to write to (if database flavor supports</span>
<span class="sd">        this). If None, use default schema (default).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pandasSQL_builder</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span> <span class="k">as</span> <span class="n">pandas_sql</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pandas_sql</span><span class="o">.</span><span class="n">has_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>


<span class="n">table_exists</span> <span class="o">=</span> <span class="n">has_table</span>


<span class="k">def</span> <span class="nf">pandasSQL_builder</span><span class="p">(</span>
    <span class="n">con</span><span class="p">,</span>
    <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">need_transaction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PandasSQL</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience function to return the correct PandasSQL subclass based on the</span>
<span class="sd">    provided parameters.  Also creates a sqlalchemy connection and transaction</span>
<span class="sd">    if necessary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">sqlite3</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Connection</span><span class="p">)</span> <span class="ow">or</span> <span class="n">con</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SQLiteDatabase</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>

    <span class="n">sqlalchemy</span> <span class="o">=</span> <span class="n">import_optional_dependency</span><span class="p">(</span><span class="s2">&quot;sqlalchemy&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sqlalchemy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Using URI string without sqlalchemy installed.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sqlalchemy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Connectable</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">SQLDatabase</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">need_transaction</span><span class="p">)</span>

    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;pandas only supports SQLAlchemy connectable (engine/connection) or &quot;</span>
        <span class="s2">&quot;database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 &quot;</span>
        <span class="s2">&quot;objects are not tested. Please consider using SQLAlchemy.&quot;</span><span class="p">,</span>
        <span class="ne">UserWarning</span><span class="p">,</span>
        <span class="n">stacklevel</span><span class="o">=</span><span class="n">find_stack_level</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">SQLiteDatabase</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SQLTable</span><span class="p">(</span><span class="n">PandasObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For mapping Pandas tables to SQL tables.</span>
<span class="sd">    Uses fact that table is reflected by SQLAlchemy to</span>
<span class="sd">    do better type conversions.</span>
<span class="sd">    Also holds various flags needed to avoid having to</span>
<span class="sd">    pass them between functions all the time.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: support for multiIndex</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pandas_sql_engine</span><span class="p">,</span>
        <span class="n">frame</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">if_exists</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">,</span>
        <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pandas&quot;</span><span class="p">,</span>
        <span class="n">index_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pd_sql</span> <span class="o">=</span> <span class="n">pandas_sql_engine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_name</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">index_label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_exists</span> <span class="o">=</span> <span class="n">if_exists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>

        <span class="k">if</span> <span class="n">frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># We want to initialize based on a dataframe</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_table_setup</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># no data provided, read-only mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pd_sql</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not init table &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pd_sql</span><span class="o">.</span><span class="n">has_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sql_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy.schema</span> <span class="kn">import</span> <span class="n">CreateTable</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">CreateTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pd_sql</span><span class="o">.</span><span class="n">con</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_execute_create</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Inserting table into database, add to MetaData object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">to_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pd_sql</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pd_sql</span><span class="o">.</span><span class="n">run_transaction</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pd_sql</span><span class="o">.</span><span class="n">con</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; already exists.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pd_sql</span><span class="o">.</span><span class="n">drop_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_execute_create</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">if_exists</span><span class="si">}</span><span class="s2">&#39; is not valid for if_exists&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execute_create</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_execute_insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">data_iter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute SQL statement inserting data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        conn : sqlalchemy.engine.Engine or sqlalchemy.engine.Connection</span>
<span class="sd">        keys : list of str</span>
<span class="sd">           Column names</span>
<span class="sd">        data_iter : generator of list</span>
<span class="sd">           Each item contains a list of values to be inserted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data_iter</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">rowcount</span>

    <span class="k">def</span> <span class="nf">_execute_insert_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">data_iter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Alternative to _execute_insert for DBs support multivalue INSERT.</span>

<span class="sd">        Note: multi-value insert is usually faster for analytics DBs</span>
<span class="sd">        and tables containing a few columns</span>
<span class="sd">        but performance degrades quickly with increase of columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">insert</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data_iter</span><span class="p">]</span>
        <span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">rowcount</span>

    <span class="k">def</span> <span class="nf">insert_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;duplicate name in index/columns: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span>

        <span class="n">column_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">temp</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
        <span class="c1"># this just pre-allocates the list: None&#39;s will be replaced with ndarrays</span>
        <span class="c1"># error: List item 0 has incompatible type &quot;None&quot;; expected &quot;ndarray&quot;</span>
        <span class="n">data_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncols</span>  <span class="c1"># type: ignore[list-item]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">ser</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;M&quot;</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">ser</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">_values</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">ArrowExtensionArray</span><span class="p">):</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;m8[ns]&quot;</span><span class="p">))</span>
                <span class="c1"># store as integers, see GH#6921, GH#7076</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s2">&quot;i8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>

            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">_can_hold_na</span><span class="p">:</span>
                <span class="c1"># Note: this will miss timedeltas since they are converted to int</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">isna</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">data_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>

        <span class="k">return</span> <span class="n">column_names</span><span class="p">,</span> <span class="n">data_list</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># set insert method</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exec_insert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_insert</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;multi&quot;</span><span class="p">:</span>
            <span class="n">exec_insert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_insert_multi</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
            <span class="n">exec_insert</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid parameter `method`: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">keys</span><span class="p">,</span> <span class="n">data_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">insert_data</span><span class="p">()</span>

        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nrows</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">chunksize</span> <span class="o">=</span> <span class="n">nrows</span>
        <span class="k">elif</span> <span class="n">chunksize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;chunksize argument should be non-zero&quot;</span><span class="p">)</span>

        <span class="n">chunks</span> <span class="o">=</span> <span class="p">(</span><span class="n">nrows</span> <span class="o">//</span> <span class="n">chunksize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">total_inserted</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pd_sql</span><span class="o">.</span><span class="n">run_transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
                <span class="n">start_i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">chunksize</span>
                <span class="n">end_i</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">chunksize</span><span class="p">,</span> <span class="n">nrows</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">start_i</span> <span class="o">&gt;=</span> <span class="n">end_i</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="n">chunk_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">start_i</span><span class="p">:</span><span class="n">end_i</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">data_list</span><span class="p">))</span>
                <span class="n">num_inserted</span> <span class="o">=</span> <span class="n">exec_insert</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">chunk_iter</span><span class="p">)</span>
                <span class="c1"># GH 46891</span>
                <span class="k">if</span> <span class="n">is_integer</span><span class="p">(</span><span class="n">num_inserted</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">total_inserted</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">total_inserted</span> <span class="o">=</span> <span class="n">num_inserted</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">total_inserted</span> <span class="o">+=</span> <span class="n">num_inserted</span>
        <span class="k">return</span> <span class="n">total_inserted</span>

    <span class="k">def</span> <span class="nf">_query_iterator</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">result</span><span class="p">,</span>
        <span class="n">exit_stack</span><span class="p">:</span> <span class="n">ExitStack</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="p">,</span>
        <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">parse_dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return generator through chunked result set.&quot;&quot;&quot;</span>
        <span class="n">has_read_data</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">with</span> <span class="n">exit_stack</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fetchmany</span><span class="p">(</span><span class="n">chunksize</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_read_data</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span>
                            <span class="p">[],</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span>
                        <span class="p">)</span>
                    <span class="k">break</span>

                <span class="n">has_read_data</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">_convert_arrays_to_dataframe</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">coerce_float</span><span class="p">,</span> <span class="n">dtype_backend</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_harmonize_columns</span><span class="p">(</span>
                    <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span> <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">exit_stack</span><span class="p">:</span> <span class="n">ExitStack</span><span class="p">,</span>
        <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">parse_dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span>

        <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">cols</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">sql_select</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="n">cols</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sql_select</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pd_sql</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_select</span><span class="p">)</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_iterator</span><span class="p">(</span>
                <span class="n">result</span><span class="p">,</span>
                <span class="n">exit_stack</span><span class="p">,</span>
                <span class="n">chunksize</span><span class="p">,</span>
                <span class="n">column_names</span><span class="p">,</span>
                <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
                <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
                <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">_convert_arrays_to_dataframe</span><span class="p">(</span>
                <span class="n">data</span><span class="p">,</span> <span class="n">column_names</span><span class="p">,</span> <span class="n">coerce_float</span><span class="p">,</span> <span class="n">dtype_backend</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_harmonize_columns</span><span class="p">(</span>
                <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span> <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span>

    <span class="k">def</span> <span class="nf">_index_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">index_label</span><span class="p">):</span>
        <span class="c1"># for writing: index=True to include index in sql table</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">nlevels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nlevels</span>
            <span class="c1"># if index_label is specified, set this as index name(s)</span>
            <span class="k">if</span> <span class="n">index_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_label</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">index_label</span> <span class="o">=</span> <span class="p">[</span><span class="n">index_label</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_label</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nlevels</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Length of &#39;index_label&#39; should match number of &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;levels, which is </span><span class="si">{</span><span class="n">nlevels</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">index_label</span>
            <span class="c1"># return the used column labels for the index columns</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">nlevels</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="ow">and</span> <span class="s2">&quot;index&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">com</span><span class="o">.</span><span class="n">fill_missing_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>

        <span class="c1"># for reading: index=(list of) string to specify column to set as index</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_column_names_and_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype_mapper</span><span class="p">):</span>
        <span class="n">column_names_and_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx_label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
                <span class="n">idx_type</span> <span class="o">=</span> <span class="n">dtype_mapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">_get_level_values</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="n">column_names_and_types</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">idx_label</span><span class="p">),</span> <span class="n">idx_type</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

        <span class="n">column_names_and_types</span> <span class="o">+=</span> <span class="p">[</span>
            <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">dtype_mapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]),</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">column_names_and_types</span>

    <span class="k">def</span> <span class="nf">_create_table_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">Column</span><span class="p">,</span>
            <span class="n">PrimaryKeyConstraint</span><span class="p">,</span>
            <span class="n">Table</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy.schema</span> <span class="kn">import</span> <span class="n">MetaData</span>

        <span class="n">column_names_and_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_column_names_and_types</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sqlalchemy_type</span><span class="p">)</span>

        <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">is_index</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">is_index</span> <span class="ow">in</span> <span class="n">column_names_and_types</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_list_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">):</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span>
            <span class="n">pkc</span> <span class="o">=</span> <span class="n">PrimaryKeyConstraint</span><span class="p">(</span><span class="o">*</span><span class="n">keys</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_pk&quot;</span><span class="p">)</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pkc</span><span class="p">)</span>

        <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">pd_sql</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">schema</span>

        <span class="c1"># At this point, attach to new metadata, only attach to self.meta</span>
        <span class="c1"># once table is created.</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="o">*</span><span class="n">columns</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_harmonize_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parse_dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make the DataFrame&#39;s column types align with the SQL table</span>
<span class="sd">        column types.</span>
<span class="sd">        Need to work around limited NA value support. Floats are always</span>
<span class="sd">        fine, ints must always be floats if there are Null values.</span>
<span class="sd">        Booleans are hard because converting bool column with None replaces</span>
<span class="sd">        all Nones with false. Therefore only convert bool if there are no</span>
<span class="sd">        NA values.</span>
<span class="sd">        Datetimes should already be converted to np.datetime64 if supported,</span>
<span class="sd">        but here we also force conversion if required.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parse_dates</span> <span class="o">=</span> <span class="n">_process_parse_dates_argument</span><span class="p">(</span><span class="n">parse_dates</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">sql_col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">col_name</span> <span class="o">=</span> <span class="n">sql_col</span><span class="o">.</span><span class="n">name</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">df_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span>

                <span class="c1"># Handle date parsing upfront; don&#39;t try to convert columns</span>
                <span class="c1"># twice</span>
                <span class="k">if</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">parse_dates</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">fmt</span> <span class="o">=</span> <span class="n">parse_dates</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                        <span class="n">fmt</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_handle_date_column</span><span class="p">(</span><span class="n">df_col</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># the type the dataframe column should have</span>
                <span class="n">col_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dtype</span><span class="p">(</span><span class="n">sql_col</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">col_type</span> <span class="ow">is</span> <span class="n">datetime</span>
                    <span class="ow">or</span> <span class="n">col_type</span> <span class="ow">is</span> <span class="n">date</span>
                    <span class="ow">or</span> <span class="n">col_type</span> <span class="ow">is</span> <span class="n">DatetimeTZDtype</span>
                <span class="p">):</span>
                    <span class="c1"># Convert tz-aware Datetime SQL columns to UTC</span>
                    <span class="n">utc</span> <span class="o">=</span> <span class="n">col_type</span> <span class="ow">is</span> <span class="n">DatetimeTZDtype</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_handle_date_column</span><span class="p">(</span><span class="n">df_col</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="n">utc</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dtype_backend</span> <span class="o">==</span> <span class="s2">&quot;numpy&quot;</span> <span class="ow">and</span> <span class="n">col_type</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
                    <span class="c1"># floats support NA, can always convert!</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_col</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">col_type</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">dtype_backend</span> <span class="o">==</span> <span class="s2">&quot;numpy&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_col</span><span class="p">)</span> <span class="o">==</span> <span class="n">df_col</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
                    <span class="c1"># No NA values, can convert ints and bools</span>
                    <span class="k">if</span> <span class="n">col_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">col_type</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_col</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">col_type</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># this column not in results</span>

    <span class="k">def</span> <span class="nf">_sqlalchemy_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">is_dict_like</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">dtype</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">dtype</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># Infer type of column, while ignoring missing values.</span>
        <span class="c1"># Needed for inserting typed data containing NULLs, GH 8778.</span>
        <span class="n">col_type</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">infer_dtype</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">TIMESTAMP</span><span class="p">,</span>
            <span class="n">BigInteger</span><span class="p">,</span>
            <span class="n">Boolean</span><span class="p">,</span>
            <span class="n">Date</span><span class="p">,</span>
            <span class="n">DateTime</span><span class="p">,</span>
            <span class="n">Float</span><span class="p">,</span>
            <span class="n">Integer</span><span class="p">,</span>
            <span class="n">SmallInteger</span><span class="p">,</span>
            <span class="n">Text</span><span class="p">,</span>
            <span class="n">Time</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">col_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;datetime64&quot;</span><span class="p">,</span> <span class="s2">&quot;datetime&quot;</span><span class="p">):</span>
            <span class="c1"># GH 9086: TIMESTAMP is the suggested type if the column contains</span>
            <span class="c1"># timezone information</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">TIMESTAMP</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># The column is actually a DatetimeIndex</span>
                <span class="c1"># GH 26761 or an Index with date-like data e.g. 9999-01-01</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;tz&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">TIMESTAMP</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">DateTime</span>
        <span class="k">if</span> <span class="n">col_type</span> <span class="o">==</span> <span class="s2">&quot;timedelta64&quot;</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;the &#39;timedelta&#39; type is not supported, and will be &quot;</span>
                <span class="s2">&quot;written as integer values (ns frequency) to the database.&quot;</span><span class="p">,</span>
                <span class="ne">UserWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="n">find_stack_level</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">BigInteger</span>
        <span class="k">elif</span> <span class="n">col_type</span> <span class="o">==</span> <span class="s2">&quot;floating&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;float32&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Float</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Float</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">53</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">col_type</span> <span class="o">==</span> <span class="s2">&quot;integer&quot;</span><span class="p">:</span>
            <span class="c1"># GH35076 Map pandas integer to optimal SQLAlchemy integer type</span>
            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;int8&quot;</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">,</span> <span class="s2">&quot;int16&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">SmallInteger</span>
            <span class="k">elif</span> <span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;uint16&quot;</span><span class="p">,</span> <span class="s2">&quot;int32&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">Integer</span>
            <span class="k">elif</span> <span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;uint64&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsigned 64 bit integer datatype is not supported&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">BigInteger</span>
        <span class="k">elif</span> <span class="n">col_type</span> <span class="o">==</span> <span class="s2">&quot;boolean&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Boolean</span>
        <span class="k">elif</span> <span class="n">col_type</span> <span class="o">==</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Date</span>
        <span class="k">elif</span> <span class="n">col_type</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Time</span>
        <span class="k">elif</span> <span class="n">col_type</span> <span class="o">==</span> <span class="s2">&quot;complex&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Complex datatypes not supported&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Text</span>

    <span class="k">def</span> <span class="nf">_get_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sqltype</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">TIMESTAMP</span><span class="p">,</span>
            <span class="n">Boolean</span><span class="p">,</span>
            <span class="n">Date</span><span class="p">,</span>
            <span class="n">DateTime</span><span class="p">,</span>
            <span class="n">Float</span><span class="p">,</span>
            <span class="n">Integer</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqltype</span><span class="p">,</span> <span class="n">Float</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqltype</span><span class="p">,</span> <span class="n">Integer</span><span class="p">):</span>
            <span class="c1"># TODO: Refine integer size.</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqltype</span><span class="p">,</span> <span class="n">TIMESTAMP</span><span class="p">):</span>
            <span class="c1"># we have a timezone capable type</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sqltype</span><span class="o">.</span><span class="n">timezone</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">datetime</span>
            <span class="k">return</span> <span class="n">DatetimeTZDtype</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqltype</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">):</span>
            <span class="c1"># Caution: np.datetime64 is also a subclass of np.number.</span>
            <span class="k">return</span> <span class="n">datetime</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqltype</span><span class="p">,</span> <span class="n">Date</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">date</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqltype</span><span class="p">,</span> <span class="n">Boolean</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">bool</span>
        <span class="k">return</span> <span class="nb">object</span>


<span class="k">class</span> <span class="nc">PandasSQL</span><span class="p">(</span><span class="n">PandasObject</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subclasses Should define read_query and to_sql.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">read_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">index_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">parse_dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">read_query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sql</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">index_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">parse_dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">to_sql</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">frame</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">if_exists</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">index_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">engine</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">engine_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sql</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Select</span> <span class="o">|</span> <span class="n">TextClause</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">has_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_create_sql_schema</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">frame</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">BaseEngine</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">insert_records</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">table</span><span class="p">:</span> <span class="n">SQLTable</span><span class="p">,</span>
        <span class="n">con</span><span class="p">,</span>
        <span class="n">frame</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">engine_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inserts data into already-prepared table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">AbstractMethodError</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SQLAlchemyEngine</span><span class="p">(</span><span class="n">BaseEngine</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">import_optional_dependency</span><span class="p">(</span>
            <span class="s2">&quot;sqlalchemy&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;sqlalchemy is required for SQL support.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert_records</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">table</span><span class="p">:</span> <span class="n">SQLTable</span><span class="p">,</span>
        <span class="n">con</span><span class="p">,</span>
        <span class="n">frame</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">engine_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">exc</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">exc</span><span class="o">.</span><span class="n">StatementError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="c1"># GH34431</span>
            <span class="c1"># https://stackoverflow.com/a/67358288/6067848</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;(\(1054, &quot;Unknown column &#39;inf(e0)?&#39; in &#39;field list&#39;&quot;\))(?#</span>
<span class="s2">            )|inf can not be used with MySQL&quot;&quot;&quot;</span>
            <span class="n">err_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">orig</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">err_text</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;inf cannot be used with MySQL&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
            <span class="k">raise</span> <span class="n">err</span>


<span class="k">def</span> <span class="nf">get_engine</span><span class="p">(</span><span class="n">engine</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseEngine</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;return our implementation&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">engine</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
        <span class="n">engine</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;io.sql.engine&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">engine</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
        <span class="c1"># try engines in this order</span>
        <span class="n">engine_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">SQLAlchemyEngine</span><span class="p">]</span>

        <span class="n">error_msgs</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">engine_class</span> <span class="ow">in</span> <span class="n">engine_classes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">engine_class</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">error_msgs</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;Unable to find a usable engine; &quot;</span>
            <span class="s2">&quot;tried using: &#39;sqlalchemy&#39;.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;A suitable version of &quot;</span>
            <span class="s2">&quot;sqlalchemy is required for sql I/O &quot;</span>
            <span class="s2">&quot;support.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Trying to import the above resulted in these errors:&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error_msgs</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">engine</span> <span class="o">==</span> <span class="s2">&quot;sqlalchemy&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SQLAlchemyEngine</span><span class="p">()</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;engine must be one of &#39;auto&#39;, &#39;sqlalchemy&#39;&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SQLDatabase</span><span class="p">(</span><span class="n">PandasSQL</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class enables conversion between DataFrame and SQL databases</span>
<span class="sd">    using SQLAlchemy to handle DataBase abstraction.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    con : SQLAlchemy Connectable or URI string.</span>
<span class="sd">        Connectable to connect with the database. Using SQLAlchemy makes it</span>
<span class="sd">        possible to use any DB supported by that library.</span>
<span class="sd">    schema : string, default None</span>
<span class="sd">        Name of SQL schema in database to write to (if database flavor</span>
<span class="sd">        supports this). If None, use default schema (default).</span>
<span class="sd">    need_transaction : bool, default False</span>
<span class="sd">        If True, SQLDatabase will create a transaction.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">need_transaction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy.engine</span> <span class="kn">import</span> <span class="n">Engine</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy.schema</span> <span class="kn">import</span> <span class="n">MetaData</span>

        <span class="c1"># self.exit_stack cleans up the Engine and Connection and commits the</span>
        <span class="c1"># transaction if any of those objects was created below.</span>
        <span class="c1"># Cleanup happens either in self.__exit__ or at the end of the iterator</span>
        <span class="c1"># returned by read_sql when chunksize is not None.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exit_stack</span> <span class="o">=</span> <span class="n">ExitStack</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">con</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit_stack</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">dispose</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">Engine</span><span class="p">):</span>
            <span class="n">con</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">connect</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">need_transaction</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">con</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit_stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">begin</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">con</span> <span class="o">=</span> <span class="n">con</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">returns_generator</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">returns_generator</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit_stack</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">run_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">():</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">con</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">con</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sql</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Select</span> <span class="o">|</span> <span class="n">TextClause</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simple passthrough to SQLAlchemy connectable&quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">params</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="o">.</span><span class="n">exec_driver_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">index_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">parse_dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read SQL database table into a DataFrame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        table_name : str</span>
<span class="sd">            Name of SQL table in database.</span>
<span class="sd">        index_col : string, optional, default: None</span>
<span class="sd">            Column to set as index.</span>
<span class="sd">        coerce_float : bool, default True</span>
<span class="sd">            Attempts to convert values of non-string, non-numeric objects</span>
<span class="sd">            (like decimal.Decimal) to floating point. This can result in</span>
<span class="sd">            loss of precision.</span>
<span class="sd">        parse_dates : list or dict, default: None</span>
<span class="sd">            - List of column names to parse as dates.</span>
<span class="sd">            - Dict of ``{column_name: format string}`` where format string is</span>
<span class="sd">              strftime compatible in case of parsing string times, or is one of</span>
<span class="sd">              (D, s, ns, ms, us) in case of parsing integer timestamps.</span>
<span class="sd">            - Dict of ``{column_name: arg}``, where the arg corresponds</span>
<span class="sd">              to the keyword arguments of :func:`pandas.to_datetime`.</span>
<span class="sd">              Especially useful with databases without native Datetime support,</span>
<span class="sd">              such as SQLite.</span>
<span class="sd">        columns : list, default: None</span>
<span class="sd">            List of column names to select from SQL table.</span>
<span class="sd">        schema : string, default None</span>
<span class="sd">            Name of SQL schema in database to query (if database flavor</span>
<span class="sd">            supports this).  If specified, this overwrites the default</span>
<span class="sd">            schema of the SQL database object.</span>
<span class="sd">        chunksize : int, default None</span>
<span class="sd">            If specified, return an iterator where `chunksize` is the number</span>
<span class="sd">            of rows to include in each chunk.</span>
<span class="sd">        dtype_backend : {{&quot;numpy_nullable&quot;, &quot;pyarrow&quot;}}, defaults to NumPy dtypes</span>
<span class="sd">            Which dtype_backend to use, e.g. whether a DataFrame should have NumPy</span>
<span class="sd">            arrays, nullable dtypes are used for all dtypes that have a nullable</span>
<span class="sd">            implementation when &quot;numpy_nullable&quot; is set, pyarrow is used for all</span>
<span class="sd">            dtypes if &quot;pyarrow&quot; is set.</span>

<span class="sd">            The dtype_backends are still experimential.</span>

<span class="sd">            .. versionadded:: 2.0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DataFrame</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        pandas.read_sql_table</span>
<span class="sd">        SQLDatabase.read_query</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">reflect</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="p">[</span><span class="n">table_name</span><span class="p">])</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">SQLTable</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">returns_generator</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit_stack</span><span class="p">,</span>
            <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
            <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
            <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
            <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_query_iterator</span><span class="p">(</span>
        <span class="n">result</span><span class="p">,</span>
        <span class="n">exit_stack</span><span class="p">:</span> <span class="n">ExitStack</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">columns</span><span class="p">,</span>
        <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">parse_dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return generator through chunked result set&quot;&quot;&quot;</span>
        <span class="n">has_read_data</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">with</span> <span class="n">exit_stack</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fetchmany</span><span class="p">(</span><span class="n">chunksize</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_read_data</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="n">_wrap_result</span><span class="p">(</span>
                            <span class="p">[],</span>
                            <span class="n">columns</span><span class="p">,</span>
                            <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
                            <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
                            <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                            <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">break</span>

                <span class="n">has_read_data</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">yield</span> <span class="n">_wrap_result</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">,</span>
                    <span class="n">columns</span><span class="p">,</span>
                    <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
                    <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
                    <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                    <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sql</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">index_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">parse_dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read SQL query into a DataFrame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sql : str</span>
<span class="sd">            SQL query to be executed.</span>
<span class="sd">        index_col : string, optional, default: None</span>
<span class="sd">            Column name to use as index for the returned DataFrame object.</span>
<span class="sd">        coerce_float : bool, default True</span>
<span class="sd">            Attempt to convert values of non-string, non-numeric objects (like</span>
<span class="sd">            decimal.Decimal) to floating point, useful for SQL result sets.</span>
<span class="sd">        params : list, tuple or dict, optional, default: None</span>
<span class="sd">            List of parameters to pass to execute method.  The syntax used</span>
<span class="sd">            to pass parameters is database driver dependent. Check your</span>
<span class="sd">            database driver documentation for which of the five syntax styles,</span>
<span class="sd">            described in PEP 249&#39;s paramstyle, is supported.</span>
<span class="sd">            Eg. for psycopg2, uses %(name)s so use params={&#39;name&#39; : &#39;value&#39;}</span>
<span class="sd">        parse_dates : list or dict, default: None</span>
<span class="sd">            - List of column names to parse as dates.</span>
<span class="sd">            - Dict of ``{column_name: format string}`` where format string is</span>
<span class="sd">              strftime compatible in case of parsing string times, or is one of</span>
<span class="sd">              (D, s, ns, ms, us) in case of parsing integer timestamps.</span>
<span class="sd">            - Dict of ``{column_name: arg dict}``, where the arg dict</span>
<span class="sd">              corresponds to the keyword arguments of</span>
<span class="sd">              :func:`pandas.to_datetime` Especially useful with databases</span>
<span class="sd">              without native Datetime support, such as SQLite.</span>
<span class="sd">        chunksize : int, default None</span>
<span class="sd">            If specified, return an iterator where `chunksize` is the number</span>
<span class="sd">            of rows to include in each chunk.</span>
<span class="sd">        dtype : Type name or dict of columns</span>
<span class="sd">            Data type for data or columns. E.g. np.float64 or</span>
<span class="sd">            {a: np.float64, b: np.int32, c: Int64}</span>

<span class="sd">            .. versionadded:: 1.3.0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DataFrame</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        read_sql_table : Read SQL database table into a DataFrame.</span>
<span class="sd">        read_sql</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">returns_generator</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_iterator</span><span class="p">(</span>
                <span class="n">result</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exit_stack</span><span class="p">,</span>
                <span class="n">chunksize</span><span class="p">,</span>
                <span class="n">columns</span><span class="p">,</span>
                <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
                <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
                <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">_wrap_result</span><span class="p">(</span>
                <span class="n">data</span><span class="p">,</span>
                <span class="n">columns</span><span class="p">,</span>
                <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
                <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
                <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">frame</span>

    <span class="n">read_sql</span> <span class="o">=</span> <span class="n">read_query</span>

    <span class="k">def</span> <span class="nf">prep_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">frame</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">if_exists</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">index_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SQLTable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepares table in the database for data insertion. Creates it if needed, etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dtype</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dict_like</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
                <span class="c1"># error: Value expression in dictionary comprehension has incompatible</span>
                <span class="c1"># type &quot;Union[ExtensionDtype, str, dtype[Any], Type[object],</span>
                <span class="c1"># Dict[Hashable, Union[ExtensionDtype, Union[str, dtype[Any]],</span>
                <span class="c1"># Type[str], Type[float], Type[int], Type[complex], Type[bool],</span>
                <span class="c1"># Type[object]]]]&quot;; expected type &quot;Union[ExtensionDtype, str,</span>
                <span class="c1"># dtype[Any], Type[object]]&quot;</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="p">{</span><span class="n">col_name</span><span class="p">:</span> <span class="n">dtype</span> <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">}</span>  <span class="c1"># type: ignore[misc]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>

            <span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">TypeEngine</span>

            <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">my_type</span> <span class="ow">in</span> <span class="n">dtype</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">my_type</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">my_type</span><span class="p">,</span> <span class="n">TypeEngine</span><span class="p">):</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">my_type</span><span class="p">,</span> <span class="n">TypeEngine</span><span class="p">):</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The type of </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> is not a SQLAlchemy type&quot;</span><span class="p">)</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">SQLTable</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">frame</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">if_exists</span><span class="o">=</span><span class="n">if_exists</span><span class="p">,</span>
            <span class="n">index_label</span><span class="o">=</span><span class="n">index_label</span><span class="p">,</span>
            <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">table</span>

    <span class="k">def</span> <span class="nf">check_case_sensitive</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks table name for issues with case-sensitivity.</span>
<span class="sd">        Method is called after data is inserted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">islower</span><span class="p">():</span>
            <span class="c1"># check for potentially case sensitivity issues (GH7815)</span>
            <span class="c1"># Only check when name is not a number and name is not lower case</span>
            <span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">inspect</span> <span class="k">as</span> <span class="n">sqlalchemy_inspect</span>

            <span class="n">insp</span> <span class="o">=</span> <span class="n">sqlalchemy_inspect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="p">)</span>
            <span class="n">table_names</span> <span class="o">=</span> <span class="n">insp</span><span class="o">.</span><span class="n">get_table_names</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">schema</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">table_names</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The provided table name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is not found exactly as &quot;</span>
                    <span class="s2">&quot;such in the database after writing the table, possibly &quot;</span>
                    <span class="s2">&quot;due to case sensitivity issues. Consider using lower &quot;</span>
                    <span class="s2">&quot;case table names.&quot;</span>
                <span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="n">msg</span><span class="p">,</span>
                    <span class="ne">UserWarning</span><span class="p">,</span>
                    <span class="n">stacklevel</span><span class="o">=</span><span class="n">find_stack_level</span><span class="p">(),</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_sql</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">frame</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">if_exists</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">index_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">engine</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">engine_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write records stored in a DataFrame to a SQL database.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame : DataFrame</span>
<span class="sd">        name : string</span>
<span class="sd">            Name of SQL table.</span>
<span class="sd">        if_exists : {&#39;fail&#39;, &#39;replace&#39;, &#39;append&#39;}, default &#39;fail&#39;</span>
<span class="sd">            - fail: If table exists, do nothing.</span>
<span class="sd">            - replace: If table exists, drop it, recreate it, and insert data.</span>
<span class="sd">            - append: If table exists, insert data. Create if does not exist.</span>
<span class="sd">        index : boolean, default True</span>
<span class="sd">            Write DataFrame index as a column.</span>
<span class="sd">        index_label : string or sequence, default None</span>
<span class="sd">            Column label for index column(s). If None is given (default) and</span>
<span class="sd">            `index` is True, then the index names are used.</span>
<span class="sd">            A sequence should be given if the DataFrame uses MultiIndex.</span>
<span class="sd">        schema : string, default None</span>
<span class="sd">            Name of SQL schema in database to write to (if database flavor</span>
<span class="sd">            supports this). If specified, this overwrites the default</span>
<span class="sd">            schema of the SQLDatabase object.</span>
<span class="sd">        chunksize : int, default None</span>
<span class="sd">            If not None, then rows will be written in batches of this size at a</span>
<span class="sd">            time.  If None, all rows will be written at once.</span>
<span class="sd">        dtype : single type or dict of column name to SQL type, default None</span>
<span class="sd">            Optional specifying the datatype for columns. The SQL type should</span>
<span class="sd">            be a SQLAlchemy type. If all columns are of the same type, one</span>
<span class="sd">            single value can be used.</span>
<span class="sd">        method : {None&#39;, &#39;multi&#39;, callable}, default None</span>
<span class="sd">            Controls the SQL insertion clause used:</span>

<span class="sd">            * None : Uses standard SQL ``INSERT`` clause (one per row).</span>
<span class="sd">            * &#39;multi&#39;: Pass multiple values in a single ``INSERT`` clause.</span>
<span class="sd">            * callable with signature ``(pd_table, conn, keys, data_iter)``.</span>

<span class="sd">            Details and a sample callable implementation can be found in the</span>
<span class="sd">            section :ref:`insert method &lt;io.sql.method&gt;`.</span>
<span class="sd">        engine : {&#39;auto&#39;, &#39;sqlalchemy&#39;}, default &#39;auto&#39;</span>
<span class="sd">            SQL engine library to use. If &#39;auto&#39;, then the option</span>
<span class="sd">            ``io.sql.engine`` is used. The default ``io.sql.engine``</span>
<span class="sd">            behavior is &#39;sqlalchemy&#39;</span>

<span class="sd">            .. versionadded:: 1.3.0</span>

<span class="sd">        **engine_kwargs</span>
<span class="sd">            Any additional kwargs are passed to the engine.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql_engine</span> <span class="o">=</span> <span class="n">get_engine</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prep_table</span><span class="p">(</span>
            <span class="n">frame</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">if_exists</span><span class="o">=</span><span class="n">if_exists</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">index_label</span><span class="o">=</span><span class="n">index_label</span><span class="p">,</span>
            <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">total_inserted</span> <span class="o">=</span> <span class="n">sql_engine</span><span class="o">.</span><span class="n">insert_records</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">,</span>
            <span class="n">con</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="p">,</span>
            <span class="n">frame</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
            <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="o">**</span><span class="n">engine_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_case_sensitive</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">total_inserted</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">tables</span>

    <span class="k">def</span> <span class="nf">has_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">inspect</span> <span class="k">as</span> <span class="n">sqlalchemy_inspect</span>

        <span class="n">insp</span> <span class="o">=</span> <span class="n">sqlalchemy_inspect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">insp</span><span class="o">.</span><span class="n">has_table</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">Numeric</span><span class="p">,</span>
            <span class="n">Table</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">schema</span>
        <span class="n">tbl</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">autoload_with</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">tbl</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">Numeric</span><span class="p">):</span>
                <span class="n">column</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">asdecimal</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">tbl</span>

    <span class="k">def</span> <span class="nf">drop_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">schema</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">reflect</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="p">[</span><span class="n">table_name</span><span class="p">],</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_transaction</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_create_sql_schema</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">frame</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">SQLTable</span><span class="p">(</span>
            <span class="n">table_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">frame</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">sql_schema</span><span class="p">())</span>


<span class="c1"># ---- SQL without SQLAlchemy ---</span>
<span class="c1"># sqlite-specific sql strings and handler class</span>
<span class="c1"># dictionary used for readability purposes</span>
<span class="n">_SQL_TYPES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">,</span>
    <span class="s2">&quot;floating&quot;</span><span class="p">:</span> <span class="s2">&quot;REAL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;integer&quot;</span><span class="p">:</span> <span class="s2">&quot;INTEGER&quot;</span><span class="p">,</span>
    <span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="s2">&quot;TIMESTAMP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;DATE&quot;</span><span class="p">,</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;TIME&quot;</span><span class="p">,</span>
    <span class="s2">&quot;boolean&quot;</span><span class="p">:</span> <span class="s2">&quot;INTEGER&quot;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">_get_unicode_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">uname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">UnicodeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot convert identifier to UTF-8: &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
    <span class="k">return</span> <span class="n">uname</span>


<span class="k">def</span> <span class="nf">_get_valid_sqlite_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="c1"># See https://stackoverflow.com/questions/6514274/how-do-you-escape-strings\</span>
    <span class="c1"># -for-sqlite-table-column-names-in-python</span>
    <span class="c1"># Ensure the string can be encoded as UTF-8.</span>
    <span class="c1"># Ensure the string does not include any NUL characters.</span>
    <span class="c1"># Replace all &quot; with &quot;&quot;.</span>
    <span class="c1"># Wrap the entire thing in double quotes.</span>

    <span class="n">uname</span> <span class="o">=</span> <span class="n">_get_unicode_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">uname</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Empty table or column name specified&quot;</span><span class="p">)</span>

    <span class="n">nul_index</span> <span class="o">=</span> <span class="n">uname</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nul_index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;SQLite identifier cannot contain NULs&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">uname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>


<span class="k">class</span> <span class="nc">SQLiteTable</span><span class="p">(</span><span class="n">SQLTable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Patch the SQLTable for fallback support.</span>
<span class="sd">    Instead of a table variable just use the Create Table statement.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># GH 8341</span>
        <span class="c1"># register an adapter callable for datetime.time object</span>
        <span class="kn">import</span> <span class="nn">sqlite3</span>

        <span class="c1"># this will transform time(12,34,56,789) into &#39;12:34:56.000789&#39;</span>
        <span class="c1"># (this is what sqlalchemy does)</span>
        <span class="k">def</span> <span class="nf">_adapt_time</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="c1"># This is faster than strftime</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">hour</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">minute</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">second</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">microsecond</span><span class="si">:</span><span class="s2">06d</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">sqlite3</span><span class="o">.</span><span class="n">register_adapter</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">_adapt_time</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sql_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_execute_create</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pd_sql</span><span class="o">.</span><span class="n">run_transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">:</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">num_rows</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
        <span class="n">wld</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span>  <span class="c1"># wildcard char</span>
        <span class="n">escape</span> <span class="o">=</span> <span class="n">_get_valid_sqlite_name</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

        <span class="n">bracketed_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">escape</span><span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
        <span class="n">col_names</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bracketed_names</span><span class="p">)</span>

        <span class="n">row_wildcards</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">wld</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
        <span class="n">wildcards</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">row_wildcards</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rows</span><span class="p">)])</span>
        <span class="n">insert_statement</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">col_names</span><span class="si">}</span><span class="s2">) VALUES </span><span class="si">{</span><span class="n">wildcards</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">insert_statement</span>

    <span class="k">def</span> <span class="nf">_execute_insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">data_iter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_iter</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_statement</span><span class="p">(</span><span class="n">num_rows</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">data_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">conn</span><span class="o">.</span><span class="n">rowcount</span>

    <span class="k">def</span> <span class="nf">_execute_insert_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">data_iter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_iter</span><span class="p">)</span>
        <span class="n">flattened_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data_list</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_statement</span><span class="p">(</span><span class="n">num_rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)),</span> <span class="n">flattened_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">conn</span><span class="o">.</span><span class="n">rowcount</span>

    <span class="k">def</span> <span class="nf">_create_table_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of SQL statements that creates a table reflecting the</span>
<span class="sd">        structure of a DataFrame.  The first entry will be a CREATE TABLE</span>
<span class="sd">        statement while the rest will be CREATE INDEX statements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">column_names_and_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_column_names_and_types</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sql_type_name</span><span class="p">)</span>
        <span class="n">escape</span> <span class="o">=</span> <span class="n">_get_valid_sqlite_name</span>

        <span class="n">create_tbl_stmts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">escape</span><span class="p">(</span><span class="n">cname</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">ctype</span> <span class="k">for</span> <span class="n">cname</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">column_names_and_types</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_list_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">):</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span>
            <span class="n">cnames_br</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">escape</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">])</span>
            <span class="n">create_tbl_stmts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;CONSTRAINT </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_pk PRIMARY KEY (</span><span class="si">{</span><span class="n">cnames_br</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">:</span>
            <span class="n">schema_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">schema_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">create_stmts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;CREATE TABLE &quot;</span>
            <span class="o">+</span> <span class="n">schema_name</span>
            <span class="o">+</span> <span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot; (</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">create_tbl_stmts</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">)&quot;</span>
        <span class="p">]</span>

        <span class="n">ix_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">cname</span> <span class="k">for</span> <span class="n">cname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">is_index</span> <span class="ow">in</span> <span class="n">column_names_and_types</span> <span class="k">if</span> <span class="n">is_index</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ix_cols</span><span class="p">):</span>
            <span class="n">cnames</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ix_cols</span><span class="p">)</span>
            <span class="n">cnames_br</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">escape</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ix_cols</span><span class="p">])</span>
            <span class="n">create_stmts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;CREATE INDEX &quot;</span>
                <span class="o">+</span> <span class="n">escape</span><span class="p">(</span><span class="s2">&quot;ix_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">cnames</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;ON &quot;</span>
                <span class="o">+</span> <span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot; (&quot;</span>
                <span class="o">+</span> <span class="n">cnames_br</span>
                <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">create_stmts</span>

    <span class="k">def</span> <span class="nf">_sql_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">is_dict_like</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">dtype</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">dtype</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># Infer type of column, while ignoring missing values.</span>
        <span class="c1"># Needed for inserting typed data containing NULLs, GH 8778.</span>
        <span class="n">col_type</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">infer_dtype</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">col_type</span> <span class="o">==</span> <span class="s2">&quot;timedelta64&quot;</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;the &#39;timedelta&#39; type is not supported, and will be &quot;</span>
                <span class="s2">&quot;written as integer values (ns frequency) to the database.&quot;</span><span class="p">,</span>
                <span class="ne">UserWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="n">find_stack_level</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="n">col_type</span> <span class="o">=</span> <span class="s2">&quot;integer&quot;</span>

        <span class="k">elif</span> <span class="n">col_type</span> <span class="o">==</span> <span class="s2">&quot;datetime64&quot;</span><span class="p">:</span>
            <span class="n">col_type</span> <span class="o">=</span> <span class="s2">&quot;datetime&quot;</span>

        <span class="k">elif</span> <span class="n">col_type</span> <span class="o">==</span> <span class="s2">&quot;empty&quot;</span><span class="p">:</span>
            <span class="n">col_type</span> <span class="o">=</span> <span class="s2">&quot;string&quot;</span>

        <span class="k">elif</span> <span class="n">col_type</span> <span class="o">==</span> <span class="s2">&quot;complex&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Complex datatypes not supported&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">col_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_SQL_TYPES</span><span class="p">:</span>
            <span class="n">col_type</span> <span class="o">=</span> <span class="s2">&quot;string&quot;</span>

        <span class="k">return</span> <span class="n">_SQL_TYPES</span><span class="p">[</span><span class="n">col_type</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">SQLiteDatabase</span><span class="p">(</span><span class="n">PandasSQL</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Version of SQLDatabase to support SQLite connections (fallback without</span>
<span class="sd">    SQLAlchemy). This should only be used internally.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    con : sqlite connection object</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">con</span> <span class="o">=</span> <span class="n">con</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">run_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">cur</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">raise</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sql</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Select</span> <span class="o">|</span> <span class="n">TextClause</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Query must be a string unless using sqlalchemy.&quot;</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">params</span><span class="p">]</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cur</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">inner_exc</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                <span class="n">ex</span> <span class="o">=</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Execution failed on sql: </span><span class="si">{</span><span class="n">sql</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="se">\n</span><span class="s2">unable to rollback&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">ex</span> <span class="kn">from</span> <span class="nn">inner_exc</span>

            <span class="n">ex</span> <span class="o">=</span> <span class="n">DatabaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Execution failed on sql &#39;</span><span class="si">{</span><span class="n">sql</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ex</span> <span class="kn">from</span> <span class="nn">exc</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_query_iterator</span><span class="p">(</span>
        <span class="n">cursor</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">columns</span><span class="p">,</span>
        <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">parse_dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return generator through chunked result set&quot;&quot;&quot;</span>
        <span class="n">has_read_data</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchmany</span><span class="p">(</span><span class="n">chunksize</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">has_read_data</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span>
                        <span class="p">[],</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">dtype</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">result</span>
                <span class="k">break</span>

            <span class="n">has_read_data</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">yield</span> <span class="n">_wrap_result</span><span class="p">(</span>
                <span class="n">data</span><span class="p">,</span>
                <span class="n">columns</span><span class="p">,</span>
                <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
                <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
                <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sql</span><span class="p">,</span>
        <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">parse_dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype_backend</span><span class="p">:</span> <span class="n">DtypeBackend</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">col_desc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_iterator</span><span class="p">(</span>
                <span class="n">cursor</span><span class="p">,</span>
                <span class="n">chunksize</span><span class="p">,</span>
                <span class="n">columns</span><span class="p">,</span>
                <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
                <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
                <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetchall_as_list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="n">frame</span> <span class="o">=</span> <span class="n">_wrap_result</span><span class="p">(</span>
                <span class="n">data</span><span class="p">,</span>
                <span class="n">columns</span><span class="p">,</span>
                <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
                <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
                <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">frame</span>

    <span class="k">def</span> <span class="nf">_fetchall_as_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">to_sql</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">frame</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">index_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">engine</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">engine_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write records stored in a DataFrame to a SQL database.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame: DataFrame</span>
<span class="sd">        name: string</span>
<span class="sd">            Name of SQL table.</span>
<span class="sd">        if_exists: {&#39;fail&#39;, &#39;replace&#39;, &#39;append&#39;}, default &#39;fail&#39;</span>
<span class="sd">            fail: If table exists, do nothing.</span>
<span class="sd">            replace: If table exists, drop it, recreate it, and insert data.</span>
<span class="sd">            append: If table exists, insert data. Create if it does not exist.</span>
<span class="sd">        index : bool, default True</span>
<span class="sd">            Write DataFrame index as a column</span>
<span class="sd">        index_label : string or sequence, default None</span>
<span class="sd">            Column label for index column(s). If None is given (default) and</span>
<span class="sd">            `index` is True, then the index names are used.</span>
<span class="sd">            A sequence should be given if the DataFrame uses MultiIndex.</span>
<span class="sd">        schema : string, default None</span>
<span class="sd">            Ignored parameter included for compatibility with SQLAlchemy</span>
<span class="sd">            version of ``to_sql``.</span>
<span class="sd">        chunksize : int, default None</span>
<span class="sd">            If not None, then rows will be written in batches of this</span>
<span class="sd">            size at a time. If None, all rows will be written at once.</span>
<span class="sd">        dtype : single type or dict of column name to SQL type, default None</span>
<span class="sd">            Optional specifying the datatype for columns. The SQL type should</span>
<span class="sd">            be a string. If all columns are of the same type, one single value</span>
<span class="sd">            can be used.</span>
<span class="sd">        method : {None, &#39;multi&#39;, callable}, default None</span>
<span class="sd">            Controls the SQL insertion clause used:</span>

<span class="sd">            * None : Uses standard SQL ``INSERT`` clause (one per row).</span>
<span class="sd">            * &#39;multi&#39;: Pass multiple values in a single ``INSERT`` clause.</span>
<span class="sd">            * callable with signature ``(pd_table, conn, keys, data_iter)``.</span>

<span class="sd">            Details and a sample callable implementation can be found in the</span>
<span class="sd">            section :ref:`insert method &lt;io.sql.method&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dtype</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dict_like</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
                <span class="c1"># error: Value expression in dictionary comprehension has incompatible</span>
                <span class="c1"># type &quot;Union[ExtensionDtype, str, dtype[Any], Type[object],</span>
                <span class="c1"># Dict[Hashable, Union[ExtensionDtype, Union[str, dtype[Any]],</span>
                <span class="c1"># Type[str], Type[float], Type[int], Type[complex], Type[bool],</span>
                <span class="c1"># Type[object]]]]&quot;; expected type &quot;Union[ExtensionDtype, str,</span>
                <span class="c1"># dtype[Any], Type[object]]&quot;</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="p">{</span><span class="n">col_name</span><span class="p">:</span> <span class="n">dtype</span> <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">}</span>  <span class="c1"># type: ignore[misc]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">my_type</span> <span class="ow">in</span> <span class="n">dtype</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">my_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">my_type</span><span class="si">}</span><span class="s2">) not a string&quot;</span><span class="p">)</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">SQLiteTable</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">frame</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">if_exists</span><span class="o">=</span><span class="n">if_exists</span><span class="p">,</span>
            <span class="n">index_label</span><span class="o">=</span><span class="n">index_label</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">chunksize</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">has_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">wld</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT name FROM sqlite_master WHERE type=&#39;table&#39; AND name=</span><span class="si">{</span><span class="n">wld</span><span class="si">}</span><span class="s2">;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">[</span><span class="n">name</span><span class="p">])</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">get_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># not supported in fallback mode</span>

    <span class="k">def</span> <span class="nf">drop_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">drop_sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;DROP TABLE </span><span class="si">{</span><span class="n">_get_valid_sqlite_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">drop_sql</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_sql_schema</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">frame</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">SQLiteTable</span><span class="p">(</span>
            <span class="n">table_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">frame</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">sql_schema</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">get_schema</span><span class="p">(</span>
    <span class="n">frame</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">con</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the SQL db table schema for the given frame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frame : DataFrame</span>
<span class="sd">    name : str</span>
<span class="sd">        name of SQL table</span>
<span class="sd">    keys : string or sequence, default: None</span>
<span class="sd">        columns to use a primary key</span>
<span class="sd">    con: an open SQL database connection object or a SQLAlchemy connectable</span>
<span class="sd">        Using SQLAlchemy makes it possible to use any DB supported by that</span>
<span class="sd">        library, default: None</span>
<span class="sd">        If a DBAPI2 object, only sqlite3 is supported.</span>
<span class="sd">    dtype : dict of column name to SQL type, default None</span>
<span class="sd">        Optional specifying the datatype for columns. The SQL type should</span>
<span class="sd">        be a SQLAlchemy type, or a string for sqlite3 fallback connection.</span>
<span class="sd">    schema: str, default: None</span>
<span class="sd">        Optional specifying the schema to be used in creating the table.</span>

<span class="sd">        .. versionadded:: 1.2.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pandasSQL_builder</span><span class="p">(</span><span class="n">con</span><span class="o">=</span><span class="n">con</span><span class="p">)</span> <span class="k">as</span> <span class="n">pandas_sql</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pandas_sql</span><span class="o">.</span><span class="n">_create_sql_schema</span><span class="p">(</span>
            <span class="n">frame</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span>
        <span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Tommaso Furlanello, and Daniel Hug.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>