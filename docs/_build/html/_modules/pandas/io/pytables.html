<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pandas.io.pytables &mdash; BabyDragon  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            BabyDragon
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tasks:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks/llm_task.html">llm_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks/multi_kernel_task.html">multi_kernel_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks/base_task.html">base_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks/topic_tree_task.html">topic_tree_task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks/embedding_task.html">embedding_task</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Memory/Kernels:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/kernels/memory_kernel.html">memory_kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/kernels/kernel_clustering.html">kernel_clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/kernels/multi_kernel.html">multi_kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/kernels/multi_kernel_visualization.html">multi_kernel_visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/kernels/kernel_utils.html">kernel_utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Memory/Threads:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/threads/base_thread.html">base_thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/threads/fifo_thread.html">fifo_thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/threads/vector_thread.html">vector_thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/threads/todo/python_thread.html">python_thread</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Memory/Indexes:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/python_index.html">python_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/memory_index.html">memory_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/pandas_index.html">pandas_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/todo/youtube_index.html">youtube_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/todo/parquet_index.html">parquet_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/todo/wiki_index.html">wiki_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/todo/gutenberg_index.html">gutenberg_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/todo/github_index.html">github_index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory/indexes/todo/multi_index.html">multi_index</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Chat:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../chat/base_chat.html">base_chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chat/memory_chat.html">memory_chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chat/chat.html">chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chat/prompts/perspective_prompt.html">perspective_prompt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chat/prompts/default_prompts.html">default_prompts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Utils:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../utils/multithreading.html">multithreading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utils/pandas.html">pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utils/hf_datasets.html">hf_datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utils/chatml.html">chatml</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Models/embedders:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../models/embedders/ada2.html">ada2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models/embedders/cohere.html">cohere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models/embedders/sbert.html">sbert</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Models/generators:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../models/generators/cohere.html">cohere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models/generators/chatgpt.html">chatgpt</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Processors:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/github_processors.html">github_processors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/os_processor.html">os_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/git_metadata.html">git_metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/visitors.html">visitors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/python_parser.html">python_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/todo/subs_parser.html">subs_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/todo/latex_parser.html">latex_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/todo/md_parser.html">md_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/todo/wiki_parser.html">wiki_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/parsers/todo/git_processor.html">git_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/todo/arxiv_processor.html">arxiv_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/todo/wiki_processor.html">wiki_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/todo/chatgpt_processor.html">chatgpt_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/todo/mit_course_processor.html">mit_course_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/todo/youtube_processor.html">youtube_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/todo/pubmed_processor.html">pubmed_processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processors/todo/gutenberg_processor.html">gutenberg_processor</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Apps:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../apps/auto_perspective/perspective.html">perspective</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">BabyDragon</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pandas.io.pytables</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pandas.io.pytables</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">High level interface to PyTables for reading and writing pandas data structures</span>
<span class="sd">to disk</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">suppress</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">date</span><span class="p">,</span>
    <span class="n">tzinfo</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">dedent</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">TracebackType</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TYPE_CHECKING</span><span class="p">,</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Final</span><span class="p">,</span>
    <span class="n">Hashable</span><span class="p">,</span>
    <span class="n">Iterator</span><span class="p">,</span>
    <span class="n">Literal</span><span class="p">,</span>
    <span class="n">Sequence</span><span class="p">,</span>
    <span class="n">cast</span><span class="p">,</span>
    <span class="n">overload</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pandas._config</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">config</span><span class="p">,</span>
    <span class="n">get_option</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">pandas._libs</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">lib</span><span class="p">,</span>
    <span class="n">writers</span> <span class="k">as</span> <span class="n">libwriters</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas._libs.tslibs</span> <span class="kn">import</span> <span class="n">timezones</span>
<span class="kn">from</span> <span class="nn">pandas._typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AnyArrayLike</span><span class="p">,</span>
    <span class="n">ArrayLike</span><span class="p">,</span>
    <span class="n">AxisInt</span><span class="p">,</span>
    <span class="n">DtypeArg</span><span class="p">,</span>
    <span class="n">FilePath</span><span class="p">,</span>
    <span class="n">Shape</span><span class="p">,</span>
    <span class="n">npt</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.compat._optional</span> <span class="kn">import</span> <span class="n">import_optional_dependency</span>
<span class="kn">from</span> <span class="nn">pandas.compat.pickle_compat</span> <span class="kn">import</span> <span class="n">patch_pickle</span>
<span class="kn">from</span> <span class="nn">pandas.errors</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AttributeConflictWarning</span><span class="p">,</span>
    <span class="n">ClosedFileError</span><span class="p">,</span>
    <span class="n">IncompatibilityWarning</span><span class="p">,</span>
    <span class="n">PerformanceWarning</span><span class="p">,</span>
    <span class="n">PossibleDataLossError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.util._decorators</span> <span class="kn">import</span> <span class="n">cache_readonly</span>
<span class="kn">from</span> <span class="nn">pandas.util._exceptions</span> <span class="kn">import</span> <span class="n">find_stack_level</span>

<span class="kn">from</span> <span class="nn">pandas.core.dtypes.common</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ensure_object</span><span class="p">,</span>
    <span class="n">is_bool_dtype</span><span class="p">,</span>
    <span class="n">is_categorical_dtype</span><span class="p">,</span>
    <span class="n">is_complex_dtype</span><span class="p">,</span>
    <span class="n">is_datetime64_dtype</span><span class="p">,</span>
    <span class="n">is_datetime64tz_dtype</span><span class="p">,</span>
    <span class="n">is_extension_array_dtype</span><span class="p">,</span>
    <span class="n">is_integer_dtype</span><span class="p">,</span>
    <span class="n">is_list_like</span><span class="p">,</span>
    <span class="n">is_object_dtype</span><span class="p">,</span>
    <span class="n">is_string_dtype</span><span class="p">,</span>
    <span class="n">is_timedelta64_dtype</span><span class="p">,</span>
    <span class="n">needs_i8_conversion</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.dtypes.missing</span> <span class="kn">import</span> <span class="n">array_equivalent</span>

<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">DatetimeIndex</span><span class="p">,</span>
    <span class="n">Index</span><span class="p">,</span>
    <span class="n">MultiIndex</span><span class="p">,</span>
    <span class="n">PeriodIndex</span><span class="p">,</span>
    <span class="n">RangeIndex</span><span class="p">,</span>
    <span class="n">Series</span><span class="p">,</span>
    <span class="n">TimedeltaIndex</span><span class="p">,</span>
    <span class="n">concat</span><span class="p">,</span>
    <span class="n">isna</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.arrays</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Categorical</span><span class="p">,</span>
    <span class="n">DatetimeArray</span><span class="p">,</span>
    <span class="n">PeriodArray</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">pandas.core.common</span> <span class="k">as</span> <span class="nn">com</span>
<span class="kn">from</span> <span class="nn">pandas.core.computation.pytables</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PyTablesExpr</span><span class="p">,</span>
    <span class="n">maybe_expression</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pandas.core.construction</span> <span class="kn">import</span> <span class="n">extract_array</span>
<span class="kn">from</span> <span class="nn">pandas.core.indexes.api</span> <span class="kn">import</span> <span class="n">ensure_index</span>
<span class="kn">from</span> <span class="nn">pandas.core.internals</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ArrayManager</span><span class="p">,</span>
    <span class="n">BlockManager</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">pandas.io.common</span> <span class="kn">import</span> <span class="n">stringify_path</span>
<span class="kn">from</span> <span class="nn">pandas.io.formats.printing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">adjoin</span><span class="p">,</span>
    <span class="n">pprint_thing</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tables</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">Col</span><span class="p">,</span>
        <span class="n">File</span><span class="p">,</span>
        <span class="n">Node</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="kn">from</span> <span class="nn">pandas.core.internals</span> <span class="kn">import</span> <span class="n">Block</span>


<span class="c1"># versioning attribute</span>
<span class="n">_version</span> <span class="o">=</span> <span class="s2">&quot;0.15.2&quot;</span>

<span class="c1"># encoding</span>
<span class="n">_default_encoding</span> <span class="o">=</span> <span class="s2">&quot;UTF-8&quot;</span>


<span class="k">def</span> <span class="nf">_ensure_decoded</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;if we have bytes, decode them to unicode&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>


<span class="k">def</span> <span class="nf">_ensure_encoding</span><span class="p">(</span><span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># set the encoding if we need</span>
    <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="n">_default_encoding</span>

    <span class="k">return</span> <span class="n">encoding</span>


<span class="k">def</span> <span class="nf">_ensure_str</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure that an index / column name is a str (python 3); otherwise they</span>
<span class="sd">    may be np.string dtype. Non-string dtypes are passed through unchanged.</span>

<span class="sd">    https://github.com/pandas-dev/pandas/issues/13492</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">name</span>


<span class="n">Term</span> <span class="o">=</span> <span class="n">PyTablesExpr</span>


<span class="k">def</span> <span class="nf">_ensure_term</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">scope_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure that the where is a Term or a list of Term.</span>

<span class="sd">    This makes sure that we are capturing the scope of variables that are</span>
<span class="sd">    passed create the terms here with a frame_level=2 (we are 2 levels down)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># only consider list/tuple here as an ndarray is automatically a coordinate</span>
    <span class="c1"># list</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">scope_level</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">where</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Term</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">scope_level</span><span class="o">=</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">maybe_expression</span><span class="p">(</span><span class="n">term</span><span class="p">)</span> <span class="k">else</span> <span class="n">term</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">where</span>
            <span class="k">if</span> <span class="n">term</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>
    <span class="k">elif</span> <span class="n">maybe_expression</span><span class="p">(</span><span class="n">where</span><span class="p">):</span>
        <span class="n">where</span> <span class="o">=</span> <span class="n">Term</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">scope_level</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">where</span> <span class="k">if</span> <span class="n">where</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">where</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>


<span class="n">incompatibility_doc</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">where criteria is being ignored as this version [</span><span class="si">%s</span><span class="s2">] is too old (or</span>
<span class="s2">not-defined), read the file in and write it out to a new file to upgrade (with</span>
<span class="s2">the copy_to method)</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">attribute_conflict_doc</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">the [</span><span class="si">%s</span><span class="s2">] attribute of the existing index is [</span><span class="si">%s</span><span class="s2">] which conflicts with the new</span>
<span class="s2">[</span><span class="si">%s</span><span class="s2">], resetting the attribute to None</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">performance_doc</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">your performance may suffer as PyTables will pickle object types that it cannot</span>
<span class="s2">map directly to c-types [inferred_type-&gt;</span><span class="si">%s</span><span class="s2">,key-&gt;</span><span class="si">%s</span><span class="s2">] [items-&gt;</span><span class="si">%s</span><span class="s2">]</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># formats</span>
<span class="n">_FORMAT_MAP</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="s2">&quot;fixed&quot;</span><span class="p">,</span> <span class="s2">&quot;fixed&quot;</span><span class="p">:</span> <span class="s2">&quot;fixed&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;table&quot;</span><span class="p">}</span>

<span class="c1"># axes map</span>
<span class="n">_AXES_MAP</span> <span class="o">=</span> <span class="p">{</span><span class="n">DataFrame</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]}</span>

<span class="c1"># register our configuration options</span>
<span class="n">dropna_doc</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">: boolean</span>
<span class="s2">    drop ALL nan rows when appending to a table</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">format_doc</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">: format</span>
<span class="s2">    default format writing format, if None, then</span>
<span class="s2">    put will default to &#39;fixed&#39; and append will default to &#39;table&#39;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="k">with</span> <span class="n">config</span><span class="o">.</span><span class="n">config_prefix</span><span class="p">(</span><span class="s2">&quot;io.hdf&quot;</span><span class="p">):</span>
    <span class="n">config</span><span class="o">.</span><span class="n">register_option</span><span class="p">(</span><span class="s2">&quot;dropna_table&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dropna_doc</span><span class="p">,</span> <span class="n">validator</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">is_bool</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">register_option</span><span class="p">(</span>
        <span class="s2">&quot;default_format&quot;</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">format_doc</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">is_one_of_factory</span><span class="p">([</span><span class="s2">&quot;fixed&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]),</span>
    <span class="p">)</span>

<span class="c1"># oh the troubles to reduce import time</span>
<span class="n">_table_mod</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">_table_file_open_policy_is_strict</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_tables</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">_table_mod</span>
    <span class="k">global</span> <span class="n">_table_file_open_policy_is_strict</span>
    <span class="k">if</span> <span class="n">_table_mod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">tables</span>

        <span class="n">_table_mod</span> <span class="o">=</span> <span class="n">tables</span>

        <span class="c1"># set the file open policy</span>
        <span class="c1"># return the file open policy; this changes as of pytables 3.1</span>
        <span class="c1"># depending on the HDF5 version</span>
        <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
            <span class="n">_table_file_open_policy_is_strict</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">tables</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">_FILE_OPEN_POLICY</span> <span class="o">==</span> <span class="s2">&quot;strict&quot;</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">_table_mod</span>


<span class="c1"># interface to/from ###</span>


<span class="k">def</span> <span class="nf">to_hdf</span><span class="p">(</span>
    <span class="n">path_or_buf</span><span class="p">:</span> <span class="n">FilePath</span> <span class="o">|</span> <span class="n">HDFStore</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Series</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
    <span class="n">complevel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">complib</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">append</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">min_itemsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nan_rep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dropna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">data_columns</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;strict&quot;</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UTF-8&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;store this object, close it if we opened it&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">store</span><span class="p">:</span> <span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">min_itemsize</span><span class="o">=</span><span class="n">min_itemsize</span><span class="p">,</span>
            <span class="n">nan_rep</span><span class="o">=</span><span class="n">nan_rep</span><span class="p">,</span>
            <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
            <span class="n">data_columns</span><span class="o">=</span><span class="n">data_columns</span><span class="p">,</span>
            <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># NB: dropna is not passed to `put`</span>
        <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">store</span><span class="p">:</span> <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">min_itemsize</span><span class="o">=</span><span class="n">min_itemsize</span><span class="p">,</span>
            <span class="n">nan_rep</span><span class="o">=</span><span class="n">nan_rep</span><span class="p">,</span>
            <span class="n">data_columns</span><span class="o">=</span><span class="n">data_columns</span><span class="p">,</span>
            <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
            <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">path_or_buf</span> <span class="o">=</span> <span class="n">stringify_path</span><span class="p">(</span><span class="n">path_or_buf</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path_or_buf</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">HDFStore</span><span class="p">(</span>
            <span class="n">path_or_buf</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">complevel</span><span class="o">=</span><span class="n">complevel</span><span class="p">,</span> <span class="n">complib</span><span class="o">=</span><span class="n">complib</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">store</span><span class="p">:</span>
            <span class="n">f</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span><span class="p">(</span><span class="n">path_or_buf</span><span class="p">)</span>


<div class="viewcode-block" id="read_hdf"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.read_hdf">[docs]</a><span class="k">def</span> <span class="nf">read_hdf</span><span class="p">(</span>
    <span class="n">path_or_buf</span><span class="p">:</span> <span class="n">FilePath</span> <span class="o">|</span> <span class="n">HDFStore</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;strict&quot;</span><span class="p">,</span>
    <span class="n">where</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">iterator</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read from the store, close it if we opened it.</span>

<span class="sd">    Retrieve pandas object stored in file, optionally based on where</span>
<span class="sd">    criteria.</span>

<span class="sd">    .. warning::</span>

<span class="sd">       Pandas uses PyTables for reading and writing HDF5 files, which allows</span>
<span class="sd">       serializing object-dtype data with pickle when using the &quot;fixed&quot; format.</span>
<span class="sd">       Loading pickled data received from untrusted sources can be unsafe.</span>

<span class="sd">       See: https://docs.python.org/3/library/pickle.html for more.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path_or_buf : str, path object, pandas.HDFStore</span>
<span class="sd">        Any valid string path is acceptable. Only supports the local file system,</span>
<span class="sd">        remote URLs and file-like objects are not supported.</span>

<span class="sd">        If you want to pass in a path object, pandas accepts any</span>
<span class="sd">        ``os.PathLike``.</span>

<span class="sd">        Alternatively, pandas accepts an open :class:`pandas.HDFStore` object.</span>

<span class="sd">    key : object, optional</span>
<span class="sd">        The group identifier in the store. Can be omitted if the HDF file</span>
<span class="sd">        contains a single pandas object.</span>
<span class="sd">    mode : {&#39;r&#39;, &#39;r+&#39;, &#39;a&#39;}, default &#39;r&#39;</span>
<span class="sd">        Mode to use when opening the file. Ignored if path_or_buf is a</span>
<span class="sd">        :class:`pandas.HDFStore`. Default is &#39;r&#39;.</span>
<span class="sd">    errors : str, default &#39;strict&#39;</span>
<span class="sd">        Specifies how encoding and decoding errors are to be handled.</span>
<span class="sd">        See the errors argument for :func:`open` for a full list</span>
<span class="sd">        of options.</span>
<span class="sd">    where : list, optional</span>
<span class="sd">        A list of Term (or convertible) objects.</span>
<span class="sd">    start : int, optional</span>
<span class="sd">        Row number to start selection.</span>
<span class="sd">    stop  : int, optional</span>
<span class="sd">        Row number to stop selection.</span>
<span class="sd">    columns : list, optional</span>
<span class="sd">        A list of columns names to return.</span>
<span class="sd">    iterator : bool, optional</span>
<span class="sd">        Return an iterator object.</span>
<span class="sd">    chunksize : int, optional</span>
<span class="sd">        Number of rows to include in an iteration when using an iterator.</span>
<span class="sd">    **kwargs</span>
<span class="sd">        Additional keyword arguments passed to HDFStore.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    object</span>
<span class="sd">        The selected object. Return type depends on the object stored.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    DataFrame.to_hdf : Write a HDF file from a DataFrame.</span>
<span class="sd">    HDFStore : Low-level access to HDF files.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame([[1, 1.0, &#39;a&#39;]], columns=[&#39;x&#39;, &#39;y&#39;, &#39;z&#39;])  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; df.to_hdf(&#39;./store.h5&#39;, &#39;data&#39;)  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; reread = pd.read_hdf(&#39;./store.h5&#39;)  # doctest: +SKIP</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;r+&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;mode </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2"> is not allowed while performing a read. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Allowed modes are r, r+ and a.&quot;</span>
        <span class="p">)</span>
    <span class="c1"># grab the scope</span>
    <span class="k">if</span> <span class="n">where</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">where</span> <span class="o">=</span> <span class="n">_ensure_term</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">scope_level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path_or_buf</span><span class="p">,</span> <span class="n">HDFStore</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path_or_buf</span><span class="o">.</span><span class="n">is_open</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;The HDFStore must be open for reading.&quot;</span><span class="p">)</span>

        <span class="n">store</span> <span class="o">=</span> <span class="n">path_or_buf</span>
        <span class="n">auto_close</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path_or_buf</span> <span class="o">=</span> <span class="n">stringify_path</span><span class="p">(</span><span class="n">path_or_buf</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path_or_buf</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Support for generic buffers has not been implemented.&quot;</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_or_buf</span><span class="p">)</span>

        <span class="c1"># if filepath is too long</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">exists</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">path_or_buf</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

        <span class="n">store</span> <span class="o">=</span> <span class="n">HDFStore</span><span class="p">(</span><span class="n">path_or_buf</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># can&#39;t auto open/close if we are using an iterator</span>
        <span class="c1"># so delegate to the iterator</span>
        <span class="n">auto_close</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Dataset(s) incompatible with Pandas data types, &quot;</span>
                    <span class="s2">&quot;not table, or no datasets found in HDF5 file.&quot;</span>
                <span class="p">)</span>
            <span class="n">candidate_only_group</span> <span class="o">=</span> <span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># For the HDF file to have only one dataset, all other groups</span>
            <span class="c1"># should then be metadata groups for that candidate group. (This</span>
            <span class="c1"># assumes that the groups() method enumerates parent groups</span>
            <span class="c1"># before their children.)</span>
            <span class="k">for</span> <span class="n">group_to_check</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_metadata_of</span><span class="p">(</span><span class="n">group_to_check</span><span class="p">,</span> <span class="n">candidate_only_group</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;key must be provided when HDF5 &quot;</span>
                        <span class="s2">&quot;file contains multiple datasets.&quot;</span>
                    <span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">candidate_only_group</span><span class="o">.</span><span class="n">_v_pathname</span>
        <span class="k">return</span> <span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span>
            <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span>
            <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
            <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
            <span class="n">iterator</span><span class="o">=</span><span class="n">iterator</span><span class="p">,</span>
            <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
            <span class="n">auto_close</span><span class="o">=</span><span class="n">auto_close</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path_or_buf</span><span class="p">,</span> <span class="n">HDFStore</span><span class="p">):</span>
            <span class="c1"># if there is an error, close the store if we opened it.</span>
            <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
                <span class="n">store</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">raise</span></div>


<span class="k">def</span> <span class="nf">_is_metadata_of</span><span class="p">(</span><span class="n">group</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">parent_group</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a given group is a metadata group for a given parent_group.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">_v_depth</span> <span class="o">&lt;=</span> <span class="n">parent_group</span><span class="o">.</span><span class="n">_v_depth</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">current</span> <span class="o">=</span> <span class="n">group</span>
    <span class="k">while</span> <span class="n">current</span><span class="o">.</span><span class="n">_v_depth</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">_v_parent</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="o">==</span> <span class="n">parent_group</span> <span class="ow">and</span> <span class="n">current</span><span class="o">.</span><span class="n">_v_name</span> <span class="o">==</span> <span class="s2">&quot;meta&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">_v_parent</span>
    <span class="k">return</span> <span class="kc">False</span>


<div class="viewcode-block" id="HDFStore"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore">[docs]</a><span class="k">class</span> <span class="nc">HDFStore</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dict-like IO interface for storing pandas objects in PyTables.</span>

<span class="sd">    Either Fixed or Table format.</span>

<span class="sd">    .. warning::</span>

<span class="sd">       Pandas uses PyTables for reading and writing HDF5 files, which allows</span>
<span class="sd">       serializing object-dtype data with pickle when using the &quot;fixed&quot; format.</span>
<span class="sd">       Loading pickled data received from untrusted sources can be unsafe.</span>

<span class="sd">       See: https://docs.python.org/3/library/pickle.html for more.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str</span>
<span class="sd">        File path to HDF5 file.</span>
<span class="sd">    mode : {&#39;a&#39;, &#39;w&#39;, &#39;r&#39;, &#39;r+&#39;}, default &#39;a&#39;</span>

<span class="sd">        ``&#39;r&#39;``</span>
<span class="sd">            Read-only; no data can be modified.</span>
<span class="sd">        ``&#39;w&#39;``</span>
<span class="sd">            Write; a new file is created (an existing file with the same</span>
<span class="sd">            name would be deleted).</span>
<span class="sd">        ``&#39;a&#39;``</span>
<span class="sd">            Append; an existing file is opened for reading and writing,</span>
<span class="sd">            and if the file does not exist it is created.</span>
<span class="sd">        ``&#39;r+&#39;``</span>
<span class="sd">            It is similar to ``&#39;a&#39;``, but the file must already exist.</span>
<span class="sd">    complevel : int, 0-9, default None</span>
<span class="sd">        Specifies a compression level for data.</span>
<span class="sd">        A value of 0 or None disables compression.</span>
<span class="sd">    complib : {&#39;zlib&#39;, &#39;lzo&#39;, &#39;bzip2&#39;, &#39;blosc&#39;}, default &#39;zlib&#39;</span>
<span class="sd">        Specifies the compression library to be used.</span>
<span class="sd">        As of v0.20.2 these additional compressors for Blosc are supported</span>
<span class="sd">        (default if no compressor specified: &#39;blosc:blosclz&#39;):</span>
<span class="sd">        {&#39;blosc:blosclz&#39;, &#39;blosc:lz4&#39;, &#39;blosc:lz4hc&#39;, &#39;blosc:snappy&#39;,</span>
<span class="sd">         &#39;blosc:zlib&#39;, &#39;blosc:zstd&#39;}.</span>
<span class="sd">        Specifying a compression library which is not available issues</span>
<span class="sd">        a ValueError.</span>
<span class="sd">    fletcher32 : bool, default False</span>
<span class="sd">        If applying compression use the fletcher32 checksum.</span>
<span class="sd">    **kwargs</span>
<span class="sd">        These parameters will be passed to the PyTables open_file method.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; bar = pd.DataFrame(np.random.randn(10, 4))</span>
<span class="sd">    &gt;&gt;&gt; store = pd.HDFStore(&#39;test.h5&#39;)</span>
<span class="sd">    &gt;&gt;&gt; store[&#39;foo&#39;] = bar   # write to HDF5</span>
<span class="sd">    &gt;&gt;&gt; bar = store[&#39;foo&#39;]   # retrieve</span>
<span class="sd">    &gt;&gt;&gt; store.close()</span>

<span class="sd">    **Create or load HDF5 file in-memory**</span>

<span class="sd">    When passing the `driver` option to the PyTables open_file method through</span>
<span class="sd">    **kwargs, the HDF5 file is loaded or created in-memory and will only be</span>
<span class="sd">    written when closed:</span>

<span class="sd">    &gt;&gt;&gt; bar = pd.DataFrame(np.random.randn(10, 4))</span>
<span class="sd">    &gt;&gt;&gt; store = pd.HDFStore(&#39;test.h5&#39;, driver=&#39;H5FD_CORE&#39;)</span>
<span class="sd">    &gt;&gt;&gt; store[&#39;foo&#39;] = bar</span>
<span class="sd">    &gt;&gt;&gt; store.close()   # only now, data is written to disk</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_handle</span><span class="p">:</span> <span class="n">File</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">_mode</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
        <span class="n">complevel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">complib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fletcher32</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;format&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;format is not a defined argument for HDFStore&quot;</span><span class="p">)</span>

        <span class="n">tables</span> <span class="o">=</span> <span class="n">import_optional_dependency</span><span class="p">(</span><span class="s2">&quot;tables&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">complib</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">complib</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tables</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">all_complibs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;complib only supports </span><span class="si">{</span><span class="n">tables</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">all_complibs</span><span class="si">}</span><span class="s2"> compression.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">complib</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">complevel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">complib</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">default_complib</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">stringify_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_complevel</span> <span class="o">=</span> <span class="n">complevel</span> <span class="k">if</span> <span class="n">complevel</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_complib</span> <span class="o">=</span> <span class="n">complib</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fletcher32</span> <span class="o">=</span> <span class="n">fletcher32</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__fspath__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the root node&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_open</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># for mypy</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filename</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;allow attribute access to get stores&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">ClosedFileError</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; object has no attribute &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check for existence of this key</span>
<span class="sd">        can match the exact pathname or the pathnm w/o the leading &#39;/&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">_v_pathname</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">pstr</span> <span class="o">=</span> <span class="n">pprint_thing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">File path: </span><span class="si">{</span><span class="n">pstr</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HDFStore</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">exc_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exc_value</span><span class="p">:</span> <span class="ne">BaseException</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">traceback</span><span class="p">:</span> <span class="n">TracebackType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="HDFStore.keys"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pandas&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of keys corresponding to objects stored in HDFStore.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        include : str, default &#39;pandas&#39;</span>
<span class="sd">                When kind equals &#39;pandas&#39; return pandas objects.</span>
<span class="sd">                When kind equals &#39;native&#39; return native HDF5 Table objects.</span>

<span class="sd">                .. versionadded:: 1.1.0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of ABSOLUTE path-names (e.g. have the leading &#39;/&#39;).</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        raises ValueError if kind has an illegal value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">include</span> <span class="o">==</span> <span class="s2">&quot;pandas&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">_v_pathname</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">()]</span>

        <span class="k">elif</span> <span class="n">include</span> <span class="o">==</span> <span class="s2">&quot;native&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># mypy</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">n</span><span class="o">.</span><span class="n">_v_pathname</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">walk_nodes</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;Table&quot;</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;`include` should be either &#39;pandas&#39; or &#39;native&#39; but is &#39;</span><span class="si">{</span><span class="n">include</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<div class="viewcode-block" id="HDFStore.items"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        iterate on key-&gt;group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">g</span><span class="o">.</span><span class="n">_v_pathname</span><span class="p">,</span> <span class="n">g</span></div>

<div class="viewcode-block" id="HDFStore.open"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open the file in the specified mode</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mode : {&#39;a&#39;, &#39;w&#39;, &#39;r&#39;, &#39;r+&#39;}, default &#39;a&#39;</span>
<span class="sd">            See HDFStore docstring or tables.open_file for info about modes</span>
<span class="sd">        **kwargs</span>
<span class="sd">            These parameters will be passed to the PyTables open_file method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="n">_tables</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">!=</span> <span class="n">mode</span><span class="p">:</span>
            <span class="c1"># if we are changing a write mode to read, ok</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;r+&quot;</span><span class="p">]:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">]:</span>
                <span class="c1"># this would truncate, raise here</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_open</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PossibleDataLossError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Re-opening the file [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2">] with mode [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="si">}</span><span class="s2">] &quot;</span>
                        <span class="s2">&quot;will delete the current file!&quot;</span>
                    <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>

        <span class="c1"># close and reopen the handle</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_open</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_complevel</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_complevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filters</span> <span class="o">=</span> <span class="n">_tables</span><span class="p">()</span><span class="o">.</span><span class="n">Filters</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_complevel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_complib</span><span class="p">,</span> <span class="n">fletcher32</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fletcher32</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">_table_file_open_policy_is_strict</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_open</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Cannot open HDF5 file, which is already opened, &quot;</span>
                <span class="s2">&quot;even in read-only mode.&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="HDFStore.close"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the PyTables file handle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return a boolean indicating whether the file is open</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">isopen</span><span class="p">)</span>

<div class="viewcode-block" id="HDFStore.flush"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.flush">[docs]</a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fsync</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Force all buffered modifications to be written to disk.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fsync : bool (default False)</span>
<span class="sd">          call ``os.fsync()`` on the file handle to force writing to disk.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Without ``fsync=True``, flushing may not guarantee that the OS writes</span>
<span class="sd">        to disk. With fsync, the operation will block until the OS claims the</span>
<span class="sd">        file has been written; however, other caching layers may still</span>
<span class="sd">        interfere.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">fsync</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="ne">OSError</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">fsync</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">fileno</span><span class="p">())</span></div>

<div class="viewcode-block" id="HDFStore.get"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve pandas object stored in file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        object</span>
<span class="sd">            Same type as object stored in file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">patch_pickle</span><span class="p">():</span>
            <span class="c1"># GH#31167 Without this patch, pickle doesn&#39;t know how to unpickle</span>
            <span class="c1">#  old DateOffset objects now that they are cdef classes.</span>
            <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object named </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> in the file&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span></div>

<div class="viewcode-block" id="HDFStore.select"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.select">[docs]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">iterator</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">auto_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve pandas object stored in file, optionally based on where criteria.</span>

<span class="sd">        .. warning::</span>

<span class="sd">           Pandas uses PyTables for reading and writing HDF5 files, which allows</span>
<span class="sd">           serializing object-dtype data with pickle when using the &quot;fixed&quot; format.</span>
<span class="sd">           Loading pickled data received from untrusted sources can be unsafe.</span>

<span class="sd">           See: https://docs.python.org/3/library/pickle.html for more.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            Object being retrieved from file.</span>
<span class="sd">        where : list or None</span>
<span class="sd">            List of Term (or convertible) objects, optional.</span>
<span class="sd">        start : int or None</span>
<span class="sd">            Row number to start selection.</span>
<span class="sd">        stop : int, default None</span>
<span class="sd">            Row number to stop selection.</span>
<span class="sd">        columns : list or None</span>
<span class="sd">            A list of columns that if not None, will limit the return columns.</span>
<span class="sd">        iterator : bool or False</span>
<span class="sd">            Returns an iterator.</span>
<span class="sd">        chunksize : int or None</span>
<span class="sd">            Number or rows to include in iteration, return an iterator.</span>
<span class="sd">        auto_close : bool or False</span>
<span class="sd">            Should automatically close the store when finished.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        object</span>
<span class="sd">            Retrieved object from file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object named </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> in the file&quot;</span><span class="p">)</span>

        <span class="c1"># create the storer and axes</span>
        <span class="n">where</span> <span class="o">=</span> <span class="n">_ensure_term</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">scope_level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_storer</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">infer_axes</span><span class="p">()</span>

        <span class="c1"># function to call on iteration</span>
        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">_start</span><span class="p">,</span> <span class="n">_stop</span><span class="p">,</span> <span class="n">_where</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">_start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">_stop</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">_where</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

        <span class="c1"># create the iterator</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">TableIterator</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">s</span><span class="p">,</span>
            <span class="n">func</span><span class="p">,</span>
            <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span>
            <span class="n">nrows</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">nrows</span><span class="p">,</span>
            <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
            <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span>
            <span class="n">iterator</span><span class="o">=</span><span class="n">iterator</span><span class="p">,</span>
            <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
            <span class="n">auto_close</span><span class="o">=</span><span class="n">auto_close</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span></div>

<div class="viewcode-block" id="HDFStore.select_as_coordinates"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.select_as_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">select_as_coordinates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the selection as an Index</span>

<span class="sd">        .. warning::</span>

<span class="sd">           Pandas uses PyTables for reading and writing HDF5 files, which allows</span>
<span class="sd">           serializing object-dtype data with pickle when using the &quot;fixed&quot; format.</span>
<span class="sd">           Loading pickled data received from untrusted sources can be unsafe.</span>

<span class="sd">           See: https://docs.python.org/3/library/pickle.html for more.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">        where : list of Term (or convertible) objects, optional</span>
<span class="sd">        start : integer (defaults to None), row number to start selection</span>
<span class="sd">        stop  : integer (defaults to None), row number to stop selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">where</span> <span class="o">=</span> <span class="n">_ensure_term</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">scope_level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tbl</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;can only read_coordinates with a table&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tbl</span><span class="o">.</span><span class="n">read_coordinates</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span></div>

<div class="viewcode-block" id="HDFStore.select_column"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.select_column">[docs]</a>    <span class="k">def</span> <span class="nf">select_column</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return a single column from the table. This is generally only useful to</span>
<span class="sd">        select an indexable</span>

<span class="sd">        .. warning::</span>

<span class="sd">           Pandas uses PyTables for reading and writing HDF5 files, which allows</span>
<span class="sd">           serializing object-dtype data with pickle when using the &quot;fixed&quot; format.</span>
<span class="sd">           Loading pickled data received from untrusted sources can be unsafe.</span>

<span class="sd">           See: https://docs.python.org/3/library/pickle.html for more.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">        column : str</span>
<span class="sd">            The column of interest.</span>
<span class="sd">        start : int or None, default None</span>
<span class="sd">        stop : int or None, default None</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        raises KeyError if the column is not found (or key is not a valid</span>
<span class="sd">            store)</span>
<span class="sd">        raises ValueError if the column can not be extracted individually (it</span>
<span class="sd">            is part of a data block)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tbl</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;can only read_column with a table&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tbl</span><span class="o">.</span><span class="n">read_column</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">column</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span></div>

<div class="viewcode-block" id="HDFStore.select_as_multiple"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.select_as_multiple">[docs]</a>    <span class="k">def</span> <span class="nf">select_as_multiple</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">keys</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">iterator</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">auto_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve pandas objects from multiple tables.</span>

<span class="sd">        .. warning::</span>

<span class="sd">           Pandas uses PyTables for reading and writing HDF5 files, which allows</span>
<span class="sd">           serializing object-dtype data with pickle when using the &quot;fixed&quot; format.</span>
<span class="sd">           Loading pickled data received from untrusted sources can be unsafe.</span>

<span class="sd">           See: https://docs.python.org/3/library/pickle.html for more.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        keys : a list of the tables</span>
<span class="sd">        selector : the table to apply the where criteria (defaults to keys[0]</span>
<span class="sd">            if not supplied)</span>
<span class="sd">        columns : the columns I want back</span>
<span class="sd">        start : integer (defaults to None), row number to start selection</span>
<span class="sd">        stop  : integer (defaults to None), row number to stop selection</span>
<span class="sd">        iterator : bool, return an iterator, default False</span>
<span class="sd">        chunksize : nrows to include in iteration, return an iterator</span>
<span class="sd">        auto_close : bool, default False</span>
<span class="sd">            Should automatically close the store when finished.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        raises KeyError if keys or selector is not found or keys is empty</span>
<span class="sd">        raises TypeError if keys is not a list or tuple</span>
<span class="sd">        raises ValueError if the tables are not ALL THE SAME DIMENSIONS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># default to single select</span>
        <span class="n">where</span> <span class="o">=</span> <span class="n">_ensure_term</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">scope_level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">key</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span>
                <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span>
                <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
                <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span>
                <span class="n">iterator</span><span class="o">=</span><span class="n">iterator</span><span class="p">,</span>
                <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
                <span class="n">auto_close</span><span class="o">=</span><span class="n">auto_close</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;keys must be a list/tuple&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;keys must have a non-zero length&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">selector</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># collect the tables</span>
        <span class="n">tbls</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storer</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storer</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>

        <span class="c1"># validate rows</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">([(</span><span class="n">s</span><span class="p">,</span> <span class="n">selector</span><span class="p">)],</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tbls</span><span class="p">,</span> <span class="n">keys</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid table [</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="o">.</span><span class="n">is_table</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;object [</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">pathname</span><span class="si">}</span><span class="s2">] is not a table, and cannot be used in all &quot;</span>
                    <span class="s2">&quot;select as multiple&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">nrows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nrows</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">nrows</span>
            <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">nrows</span> <span class="o">!=</span> <span class="n">nrows</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;all tables must have exactly the same nrows!&quot;</span><span class="p">)</span>

        <span class="c1"># The isinstance checks here are redundant with the check above,</span>
        <span class="c1">#  but necessary for mypy; see GH#29757</span>
        <span class="n">_tbls</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tbls</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Table</span><span class="p">)]</span>

        <span class="c1"># axis is the concentration axes</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="o">.</span><span class="n">non_index_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_tbls</span><span class="p">}</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">_start</span><span class="p">,</span> <span class="n">_stop</span><span class="p">,</span> <span class="n">_where</span><span class="p">):</span>
            <span class="c1"># retrieve the objs, _where is always passed as a set of</span>
            <span class="c1"># coordinates here</span>
            <span class="n">objs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">t</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">_where</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">_start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">_stop</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tbls</span>
            <span class="p">]</span>

            <span class="c1"># concat and return</span>
            <span class="k">return</span> <span class="n">concat</span><span class="p">(</span><span class="n">objs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">verify_integrity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">_consolidate</span><span class="p">()</span>

        <span class="c1"># create the iterator</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">TableIterator</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">s</span><span class="p">,</span>
            <span class="n">func</span><span class="p">,</span>
            <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span>
            <span class="n">nrows</span><span class="o">=</span><span class="n">nrows</span><span class="p">,</span>
            <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
            <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span>
            <span class="n">iterator</span><span class="o">=</span><span class="n">iterator</span><span class="p">,</span>
            <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
            <span class="n">auto_close</span><span class="o">=</span><span class="n">auto_close</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">get_result</span><span class="p">(</span><span class="n">coordinates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="HDFStore.put"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.put">[docs]</a>    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Series</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">append</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">complib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">complevel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">min_itemsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nan_rep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data_columns</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;strict&quot;</span><span class="p">,</span>
        <span class="n">track_times</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">dropna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store object in HDFStore.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">        value : {Series, DataFrame}</span>
<span class="sd">        format : &#39;fixed(f)|table(t)&#39;, default is &#39;fixed&#39;</span>
<span class="sd">            Format to use when storing object in HDFStore. Value can be one of:</span>

<span class="sd">            ``&#39;fixed&#39;``</span>
<span class="sd">                Fixed format.  Fast writing/reading. Not-appendable, nor searchable.</span>
<span class="sd">            ``&#39;table&#39;``</span>
<span class="sd">                Table format.  Write as a PyTables Table structure which may perform</span>
<span class="sd">                worse but allow more flexible operations like searching / selecting</span>
<span class="sd">                subsets of the data.</span>
<span class="sd">        index : bool, default True</span>
<span class="sd">            Write DataFrame index as a column.</span>
<span class="sd">        append : bool, default False</span>
<span class="sd">            This will force Table format, append the input data to the existing.</span>
<span class="sd">        data_columns : list of columns or True, default None</span>
<span class="sd">            List of columns to create as data columns, or True to use all columns.</span>
<span class="sd">            See `here</span>
<span class="sd">            &lt;https://pandas.pydata.org/pandas-docs/stable/user_guide/io.html#query-via-data-columns&gt;`__.</span>
<span class="sd">        encoding : str, default None</span>
<span class="sd">            Provide an encoding for strings.</span>
<span class="sd">        track_times : bool, default True</span>
<span class="sd">            Parameter is propagated to &#39;create_table&#39; method of &#39;PyTables&#39;.</span>
<span class="sd">            If set to False it enables to have the same h5 files (same hashes)</span>
<span class="sd">            independent on creation time.</span>
<span class="sd">        dropna : bool, default False, optional</span>
<span class="sd">            Remove missing values.</span>

<span class="sd">            .. versionadded:: 1.1.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;io.hdf.default_format&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;fixed&quot;</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_format</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_to_group</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">append</span><span class="o">=</span><span class="n">append</span><span class="p">,</span>
            <span class="n">complib</span><span class="o">=</span><span class="n">complib</span><span class="p">,</span>
            <span class="n">complevel</span><span class="o">=</span><span class="n">complevel</span><span class="p">,</span>
            <span class="n">min_itemsize</span><span class="o">=</span><span class="n">min_itemsize</span><span class="p">,</span>
            <span class="n">nan_rep</span><span class="o">=</span><span class="n">nan_rep</span><span class="p">,</span>
            <span class="n">data_columns</span><span class="o">=</span><span class="n">data_columns</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
            <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
            <span class="n">track_times</span><span class="o">=</span><span class="n">track_times</span><span class="p">,</span>
            <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="HDFStore.remove"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove pandas object partially by specifying the where condition</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            Node to remove or delete rows from</span>
<span class="sd">        where : list of Term (or convertible) objects, optional</span>
<span class="sd">        start : integer (defaults to None), row number to start selection</span>
<span class="sd">        stop  : integer (defaults to None), row number to stop selection</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        number of rows removed (or None if not a Table)</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        raises KeyError if key is not a valid store</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">where</span> <span class="o">=</span> <span class="n">_ensure_term</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">scope_level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># the key is not a valid store, re-raising KeyError</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="c1"># surface any assertion errors for e.g. debugging</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="c1"># In tests we get here with ClosedFileError, TypeError, and</span>
            <span class="c1">#  _table_mod.NoSuchNodeError.  TODO: Catch only these?</span>

            <span class="k">if</span> <span class="n">where</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;trying to remove a node with a non-None where clause!&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>

            <span class="c1"># we are actually trying to remove a node (with children)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">_f_remove</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># remove the node</span>
        <span class="k">if</span> <span class="n">com</span><span class="o">.</span><span class="n">all_none</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">):</span>
            <span class="n">s</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">_f_remove</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># delete from the table</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">is_table</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;can only remove with where on objects written as tables&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span></div>

<div class="viewcode-block" id="HDFStore.append"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Series</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">append</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">complib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">complevel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">min_itemsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nan_rep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">expectedrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dropna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">data_columns</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;strict&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append to Table in file.</span>

<span class="sd">        Node must already exist and be Table format.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">        value : {Series, DataFrame}</span>
<span class="sd">        format : &#39;table&#39; is the default</span>
<span class="sd">            Format to use when storing object in HDFStore.  Value can be one of:</span>

<span class="sd">            ``&#39;table&#39;``</span>
<span class="sd">                Table format. Write as a PyTables Table structure which may perform</span>
<span class="sd">                worse but allow more flexible operations like searching / selecting</span>
<span class="sd">                subsets of the data.</span>
<span class="sd">        index : bool, default True</span>
<span class="sd">            Write DataFrame index as a column.</span>
<span class="sd">        append       : bool, default True</span>
<span class="sd">            Append the input data to the existing.</span>
<span class="sd">        data_columns : list of columns, or True, default None</span>
<span class="sd">            List of columns to create as indexed data columns for on-disk</span>
<span class="sd">            queries, or True to use all columns. By default only the axes</span>
<span class="sd">            of the object are indexed. See `here</span>
<span class="sd">            &lt;https://pandas.pydata.org/pandas-docs/stable/user_guide/io.html#query-via-data-columns&gt;`__.</span>
<span class="sd">        min_itemsize : dict of columns that specify minimum str sizes</span>
<span class="sd">        nan_rep      : str to use as str nan representation</span>
<span class="sd">        chunksize    : size to chunk the writing</span>
<span class="sd">        expectedrows : expected TOTAL row size of this table</span>
<span class="sd">        encoding     : default None, provide an encoding for str</span>
<span class="sd">        dropna : bool, default False, optional</span>
<span class="sd">            Do not write an ALL nan row to the store settable</span>
<span class="sd">            by the option &#39;io.hdf.dropna_table&#39;.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Does *not* check if data being appended overlaps with existing</span>
<span class="sd">        data in the table, so be careful</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;columns is not a supported keyword in append, try data_columns&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">dropna</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dropna</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;io.hdf.dropna_table&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;io.hdf.default_format&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;table&quot;</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_format</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_to_group</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span>
            <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">append</span><span class="o">=</span><span class="n">append</span><span class="p">,</span>
            <span class="n">complib</span><span class="o">=</span><span class="n">complib</span><span class="p">,</span>
            <span class="n">complevel</span><span class="o">=</span><span class="n">complevel</span><span class="p">,</span>
            <span class="n">min_itemsize</span><span class="o">=</span><span class="n">min_itemsize</span><span class="p">,</span>
            <span class="n">nan_rep</span><span class="o">=</span><span class="n">nan_rep</span><span class="p">,</span>
            <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
            <span class="n">expectedrows</span><span class="o">=</span><span class="n">expectedrows</span><span class="p">,</span>
            <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
            <span class="n">data_columns</span><span class="o">=</span><span class="n">data_columns</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
            <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="HDFStore.append_to_multiple"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.append_to_multiple">[docs]</a>    <span class="k">def</span> <span class="nf">append_to_multiple</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">value</span><span class="p">,</span>
        <span class="n">selector</span><span class="p">,</span>
        <span class="n">data_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dropna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append to multiple tables</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        d : a dict of table_name to table_columns, None is acceptable as the</span>
<span class="sd">            values of one node (this will get all the remaining columns)</span>
<span class="sd">        value : a pandas object</span>
<span class="sd">        selector : a string that designates the indexable table; all of its</span>
<span class="sd">            columns will be designed as data_columns, unless data_columns is</span>
<span class="sd">            passed, in which case these are used</span>
<span class="sd">        data_columns : list of columns to create as data columns, or True to</span>
<span class="sd">            use all columns</span>
<span class="sd">        dropna : if evaluates to True, drop rows from all tables if any single</span>
<span class="sd">                 row in each table has all NaN. Default False.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        axes parameter is currently not accepted</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;axes is currently not accepted as a parameter to append_to_multiple; &quot;</span>
                <span class="s2">&quot;you can create the tables independently instead&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;append_to_multiple must have a dictionary specified as the &quot;</span>
                <span class="s2">&quot;way to split the value&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">selector</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;append_to_multiple requires a selector that is in passed dict&quot;</span>
            <span class="p">)</span>

        <span class="c1"># figure out the splitting axis (the non_index_axis)</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">ndim</span><span class="p">))</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_AXES_MAP</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)]))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># figure out how to split the value</span>
        <span class="n">remain_key</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">remain_values</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">remain_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;append_to_multiple can only have one value in d that is None&quot;</span>
                    <span class="p">)</span>
                <span class="n">remain_key</span> <span class="o">=</span> <span class="n">k</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">remain_values</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">remain_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ordered</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
            <span class="n">ordd</span> <span class="o">=</span> <span class="n">ordered</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">Index</span><span class="p">(</span><span class="n">remain_values</span><span class="p">))</span>
            <span class="n">ordd</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ordered</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">(</span><span class="n">ordd</span><span class="p">))</span>
            <span class="n">d</span><span class="p">[</span><span class="n">remain_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ordered</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">ordd</span><span class="p">)</span>

        <span class="c1"># data_columns</span>
        <span class="k">if</span> <span class="n">data_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data_columns</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">selector</span><span class="p">]</span>

        <span class="c1"># ensure rows are synchronized across the tables</span>
        <span class="k">if</span> <span class="n">dropna</span><span class="p">:</span>
            <span class="n">idxs</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">valid_index</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">idxs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">:</span>
                <span class="n">valid_index</span> <span class="o">=</span> <span class="n">valid_index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">valid_index</span><span class="p">]</span>

        <span class="n">min_itemsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;min_itemsize&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># append</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dc</span> <span class="o">=</span> <span class="n">data_columns</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">selector</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="c1"># compute the val</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>

            <span class="n">filtered</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">min_itemsize</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">v</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">min_itemsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">data_columns</span><span class="o">=</span><span class="n">dc</span><span class="p">,</span> <span class="n">min_itemsize</span><span class="o">=</span><span class="n">filtered</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="HDFStore.create_table_index"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.create_table_index">[docs]</a>    <span class="k">def</span> <span class="nf">create_table_index</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">optlevel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a pytables index on the table.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">        columns : None, bool, or listlike[str]</span>
<span class="sd">            Indicate which columns to create an index on.</span>

<span class="sd">            * False : Do not create any indexes.</span>
<span class="sd">            * True : Create indexes on all columns.</span>
<span class="sd">            * None : Create indexes on all columns.</span>
<span class="sd">            * listlike : Create indexes on the given columns.</span>

<span class="sd">        optlevel : int or None, default None</span>
<span class="sd">            Optimization level, if None, pytables defaults to 6.</span>
<span class="sd">        kind : str or None, default None</span>
<span class="sd">            Kind of index, if None, pytables defaults to &quot;medium&quot;.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError: raises if the node is not a table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># version requirements</span>
        <span class="n">_tables</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;cannot create table index on a Fixed format store&quot;</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">optlevel</span><span class="o">=</span><span class="n">optlevel</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)</span></div>

<div class="viewcode-block" id="HDFStore.groups"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.groups">[docs]</a>    <span class="k">def</span> <span class="nf">groups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all the top-level nodes.</span>

<span class="sd">        Each node returned is not a pandas storage object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_tables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_open</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># for mypy</span>
        <span class="k">assert</span> <span class="n">_table_mod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># for mypy</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">g</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">walk_groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">_table_mod</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">Link</span><span class="p">)</span>
                <span class="ow">and</span> <span class="p">(</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">_v_attrs</span><span class="p">,</span> <span class="s2">&quot;pandas_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">_table_mod</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">)</span> <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">_v_name</span> <span class="o">!=</span> <span class="s2">&quot;table&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="HDFStore.walk"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.walk">[docs]</a>    <span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">where</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Walk the pytables group hierarchy for pandas objects.</span>

<span class="sd">        This generator will yield the group path, subgroups and pandas object</span>
<span class="sd">        names for each group.</span>

<span class="sd">        Any non-pandas PyTables objects that are not a group will be ignored.</span>

<span class="sd">        The `where` group itself is listed first (preorder), then each of its</span>
<span class="sd">        child groups (following an alphanumerical order) is also traversed,</span>
<span class="sd">        following the same procedure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        where : str, default &quot;/&quot;</span>
<span class="sd">            Group where to start walking.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        path : str</span>
<span class="sd">            Full path to a group (without trailing &#39;/&#39;).</span>
<span class="sd">        groups : list</span>
<span class="sd">            Names (strings) of the groups contained in `path`.</span>
<span class="sd">        leaves : list</span>
<span class="sd">            Names (strings) of the pandas objects contained in `path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_tables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_open</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># for mypy</span>
        <span class="k">assert</span> <span class="n">_table_mod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># for mypy</span>

        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">walk_groups</span><span class="p">(</span><span class="n">where</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">_v_attrs</span><span class="p">,</span> <span class="s2">&quot;pandas_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">groups</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">leaves</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">_v_children</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">pandas_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">_v_attrs</span><span class="p">,</span> <span class="s2">&quot;pandas_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pandas_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">_table_mod</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                        <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">_v_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">leaves</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">_v_name</span><span class="p">)</span>

            <span class="k">yield</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">_v_pathname</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">),</span> <span class="n">groups</span><span class="p">,</span> <span class="n">leaves</span><span class="p">)</span></div>

<div class="viewcode-block" id="HDFStore.get_node"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.get_node">[docs]</a>    <span class="k">def</span> <span class="nf">get_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the node with the key or None if it does not exist&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_open</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">key</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">_table_mod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># for mypy</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">_table_mod</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchNodeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">_table_mod</span><span class="o">.</span><span class="n">Node</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span></div>

<div class="viewcode-block" id="HDFStore.get_storer"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.get_storer">[docs]</a>    <span class="k">def</span> <span class="nf">get_storer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GenericFixed</span> <span class="o">|</span> <span class="n">Table</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the storer object for a key, raise if not in the file&quot;&quot;&quot;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object named </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> in the file&quot;</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_storer</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">infer_axes</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">s</span></div>

<div class="viewcode-block" id="HDFStore.copy"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">file</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
        <span class="n">propindexes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">complib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">complevel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fletcher32</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HDFStore</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy the existing store to a new file, updating in place.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        propindexes : bool, default True</span>
<span class="sd">            Restore indexes in copied file.</span>
<span class="sd">        keys : list, optional</span>
<span class="sd">            List of keys to include in the copy (defaults to all).</span>
<span class="sd">        overwrite : bool, default True</span>
<span class="sd">            Whether to overwrite (remove and replace) existing nodes in the new store.</span>
<span class="sd">        mode, complib, complevel, fletcher32 same as in HDFStore.__init__</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        open file handle of the new store</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_store</span> <span class="o">=</span> <span class="n">HDFStore</span><span class="p">(</span>
            <span class="n">file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">complib</span><span class="o">=</span><span class="n">complib</span><span class="p">,</span> <span class="n">complevel</span><span class="o">=</span><span class="n">complevel</span><span class="p">,</span> <span class="n">fletcher32</span><span class="o">=</span><span class="n">fletcher32</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">keys</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storer</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">new_store</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                        <span class="n">new_store</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
                    <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="n">propindexes</span><span class="p">:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">axes</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_indexed</span><span class="p">]</span>
                    <span class="n">new_store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">k</span><span class="p">,</span>
                        <span class="n">data</span><span class="p">,</span>
                        <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
                        <span class="n">data_columns</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;data_columns&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                        <span class="n">encoding</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_store</span></div>

<div class="viewcode-block" id="HDFStore.info"><a class="viewcode-back" href="../../../utils/pandas.html#pandas.HDFStore.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print detailed information on the store.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">pprint_thing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">File path: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_open</span><span class="p">:</span>
            <span class="n">lkeys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lkeys</span><span class="p">):</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lkeys</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storer</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pprint_thing</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">pathname</span> <span class="ow">or</span> <span class="n">k</span><span class="p">))</span>
                            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pprint_thing</span><span class="p">(</span><span class="n">s</span> <span class="ow">or</span> <span class="s2">&quot;invalid_HDFStore node&quot;</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
                        <span class="c1"># surface any assertion errors for e.g. debugging</span>
                        <span class="k">raise</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">detail</span><span class="p">:</span>
                        <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                        <span class="n">dstr</span> <span class="o">=</span> <span class="n">pprint_thing</span><span class="p">(</span><span class="n">detail</span><span class="p">)</span>
                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[invalid_HDFStore node: </span><span class="si">{</span><span class="n">dstr</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>

                <span class="n">output</span> <span class="o">+=</span> <span class="n">adjoin</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;Empty&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;File is CLOSED&quot;</span>

        <span class="k">return</span> <span class="n">output</span></div>

    <span class="c1"># ------------------------------------------------------------------------</span>
    <span class="c1"># private methods</span>

    <span class="k">def</span> <span class="nf">_check_if_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_open</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ClosedFileError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2"> file is not open!&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;validate / deprecate formats&quot;&quot;&quot;</span>
        <span class="c1"># validate</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="n">_FORMAT_MAP</span><span class="p">[</span><span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;invalid HDFStore format specified [</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>

        <span class="k">return</span> <span class="nb">format</span>

    <span class="k">def</span> <span class="nf">_create_storer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">group</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Series</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UTF-8&quot;</span><span class="p">,</span>
        <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;strict&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GenericFixed</span> <span class="o">|</span> <span class="n">Table</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return a suitable class to operate&quot;&quot;&quot;</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">GenericFixed</span><span class="p">]</span> <span class="o">|</span> <span class="nb">type</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">Series</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;value must be None, Series, or DataFrame&quot;</span><span class="p">)</span>

        <span class="n">pt</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">_v_attrs</span><span class="p">,</span> <span class="s2">&quot;pandas_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">_v_attrs</span><span class="p">,</span> <span class="s2">&quot;table_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="c1"># infer the pt from the passed value</span>
        <span class="k">if</span> <span class="n">pt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_tables</span><span class="p">()</span>
                <span class="k">assert</span> <span class="n">_table_mod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># for mypy</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">group</span><span class="p">,</span> <span class="n">_table_mod</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span>
                <span class="p">):</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="s2">&quot;frame_table&quot;</span>
                    <span class="n">tt</span> <span class="o">=</span> <span class="s2">&quot;generic_table&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;cannot create a storer if the object is not existing &quot;</span>
                        <span class="s2">&quot;nor a value are passed&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="s2">&quot;series&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="s2">&quot;frame&quot;</span>

                <span class="c1"># we are actually a table</span>
                <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span>
                    <span class="n">pt</span> <span class="o">+=</span> <span class="s2">&quot;_table&quot;</span>

        <span class="c1"># a storer node</span>
        <span class="k">if</span> <span class="s2">&quot;table&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pt</span><span class="p">:</span>
            <span class="n">_STORER_MAP</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;series&quot;</span><span class="p">:</span> <span class="n">SeriesFixed</span><span class="p">,</span> <span class="s2">&quot;frame&quot;</span><span class="p">:</span> <span class="n">FrameFixed</span><span class="p">}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">_STORER_MAP</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;cannot properly create the storer for: [_STORER_MAP] [group-&gt;&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">,value-&gt;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">,format-&gt;</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>

        <span class="c1"># existing node (and must be a table)</span>
        <span class="k">if</span> <span class="n">tt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if we are a writer, determine the tt</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pt</span> <span class="o">==</span> <span class="s2">&quot;series_table&quot;</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">tt</span> <span class="o">=</span> <span class="s2">&quot;appendable_series&quot;</span>
                        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">tt</span> <span class="o">=</span> <span class="s2">&quot;appendable_multiseries&quot;</span>
                <span class="k">elif</span> <span class="n">pt</span> <span class="o">==</span> <span class="s2">&quot;frame_table&quot;</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">tt</span> <span class="o">=</span> <span class="s2">&quot;appendable_frame&quot;</span>
                        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">tt</span> <span class="o">=</span> <span class="s2">&quot;appendable_multiframe&quot;</span>

        <span class="n">_TABLE_MAP</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;generic_table&quot;</span><span class="p">:</span> <span class="n">GenericTable</span><span class="p">,</span>
            <span class="s2">&quot;appendable_series&quot;</span><span class="p">:</span> <span class="n">AppendableSeriesTable</span><span class="p">,</span>
            <span class="s2">&quot;appendable_multiseries&quot;</span><span class="p">:</span> <span class="n">AppendableMultiSeriesTable</span><span class="p">,</span>
            <span class="s2">&quot;appendable_frame&quot;</span><span class="p">:</span> <span class="n">AppendableFrameTable</span><span class="p">,</span>
            <span class="s2">&quot;appendable_multiframe&quot;</span><span class="p">:</span> <span class="n">AppendableMultiFrameTable</span><span class="p">,</span>
            <span class="s2">&quot;worm&quot;</span><span class="p">:</span> <span class="n">WORMTable</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">_TABLE_MAP</span><span class="p">[</span><span class="n">tt</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;cannot properly create the storer for: [_TABLE_MAP] [group-&gt;&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">,value-&gt;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">,format-&gt;</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_to_group</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Series</span><span class="p">,</span>
        <span class="nb">format</span><span class="p">,</span>
        <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">append</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">complib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">complevel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fletcher32</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">min_itemsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">expectedrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dropna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">nan_rep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;strict&quot;</span><span class="p">,</span>
        <span class="n">track_times</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># we don&#39;t want to store a table node at all if our object is 0-len</span>
        <span class="c1"># as there are not dtypes</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;empty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span> <span class="ow">or</span> <span class="n">append</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_group</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">append</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_storer</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
            <span class="c1"># raise if we are trying to append to a Fixed format,</span>
            <span class="c1">#       or a table that exists (and we are putting)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">is_table</span> <span class="ow">or</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">is_table</span> <span class="ow">and</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;fixed&quot;</span> <span class="ow">and</span> <span class="n">s</span><span class="o">.</span><span class="n">is_exists</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can only append to Tables&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">is_exists</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">set_object_info</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">set_object_info</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">is_table</span> <span class="ow">and</span> <span class="n">complib</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Compression not supported on Fixed format stores&quot;</span><span class="p">)</span>

        <span class="c1"># write the object</span>
        <span class="n">s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">obj</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
            <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
            <span class="n">append</span><span class="o">=</span><span class="n">append</span><span class="p">,</span>
            <span class="n">complib</span><span class="o">=</span><span class="n">complib</span><span class="p">,</span>
            <span class="n">complevel</span><span class="o">=</span><span class="n">complevel</span><span class="p">,</span>
            <span class="n">fletcher32</span><span class="o">=</span><span class="n">fletcher32</span><span class="p">,</span>
            <span class="n">min_itemsize</span><span class="o">=</span><span class="n">min_itemsize</span><span class="p">,</span>
            <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
            <span class="n">expectedrows</span><span class="o">=</span><span class="n">expectedrows</span><span class="p">,</span>
            <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
            <span class="n">nan_rep</span><span class="o">=</span><span class="n">nan_rep</span><span class="p">,</span>
            <span class="n">data_columns</span><span class="o">=</span><span class="n">data_columns</span><span class="p">,</span>
            <span class="n">track_times</span><span class="o">=</span><span class="n">track_times</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span> <span class="ow">and</span> <span class="n">index</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="n">Node</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_storer</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">infer_axes</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_identify_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">append</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Identify HDF5 group based on key, delete/create group if needed.&quot;&quot;&quot;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="c1"># we make this assertion for mypy; the get_node call will already</span>
        <span class="c1"># have raised if this is incorrect</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="c1"># remove the node if we are not appending</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">append</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">group</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_nodes_and_group</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">group</span>

    <span class="k">def</span> <span class="nf">_create_nodes_and_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create nodes from key and return group name.&quot;&quot;&quot;</span>
        <span class="c1"># assertion for mypy</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="n">paths</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="c1"># recursively create the groups</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">new_path</span> <span class="o">=</span> <span class="n">path</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
                <span class="n">new_path</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
            <span class="n">new_path</span> <span class="o">+=</span> <span class="n">p</span>
            <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">new_path</span>
        <span class="k">return</span> <span class="n">group</span></div>


<span class="k">class</span> <span class="nc">TableIterator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the iteration interface on a table</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    store : HDFStore</span>
<span class="sd">    s     : the referred storer</span>
<span class="sd">    func  : the function to execute the query</span>
<span class="sd">    where : the where of the query</span>
<span class="sd">    nrows : the rows to iterate on</span>
<span class="sd">    start : the passed start value (default is None)</span>
<span class="sd">    stop  : the passed stop value (default is None)</span>
<span class="sd">    iterator : bool, default False</span>
<span class="sd">        Whether to use the default iterator.</span>
<span class="sd">    chunksize : the passed chunking value (default is 100000)</span>
<span class="sd">    auto_close : bool, default False</span>
<span class="sd">        Whether to automatically close the store at the end of iteration.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">store</span><span class="p">:</span> <span class="n">HDFStore</span>
    <span class="n">s</span><span class="p">:</span> <span class="n">GenericFixed</span> <span class="o">|</span> <span class="n">Table</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">store</span><span class="p">:</span> <span class="n">HDFStore</span><span class="p">,</span>
        <span class="n">s</span><span class="p">:</span> <span class="n">GenericFixed</span> <span class="o">|</span> <span class="n">Table</span><span class="p">,</span>
        <span class="n">func</span><span class="p">,</span>
        <span class="n">where</span><span class="p">,</span>
        <span class="n">nrows</span><span class="p">,</span>
        <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">iterator</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">auto_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">where</span> <span class="o">=</span> <span class="n">where</span>

        <span class="c1"># set start/stop if they are not set if we are a table</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">is_table</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nrows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nrows</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">nrows</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span> <span class="o">=</span> <span class="n">nrows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">iterator</span> <span class="ow">or</span> <span class="n">chunksize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">chunksize</span> <span class="o">=</span> <span class="mi">100000</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">chunksize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">auto_close</span> <span class="o">=</span> <span class="n">auto_close</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">:</span>
        <span class="c1"># iterate</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot iterate until get_result is called.&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">current</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">current</span><span class="p">:</span><span class="n">stop</span><span class="p">])</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">stop</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">yield</span> <span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_close</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="c1">#  return the actual iterator</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;can only use an iterator or chunksize on a table&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">read_coordinates</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span>

        <span class="c1"># if specified read via coordinates (necessary for multiple selections</span>
        <span class="k">if</span> <span class="n">coordinates</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;can only read_coordinates on a table&quot;</span><span class="p">)</span>
            <span class="n">where</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">read_coordinates</span><span class="p">(</span>
                <span class="n">where</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span>

        <span class="c1"># directly return the result</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">where</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span>


<span class="k">class</span> <span class="nc">IndexCol</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    an index column description class</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    axis   : axis which I reference</span>
<span class="sd">    values : the ndarray like converted values</span>
<span class="sd">    kind   : a string description of this type</span>
<span class="sd">    typ    : the pytables type</span>
<span class="sd">    pos    : the position in the pytables</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">is_an_indexable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">is_data_indexable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_info_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;tz&quot;</span><span class="p">,</span> <span class="s2">&quot;index_name&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">typ</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">index_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ordered</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">table</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`name` must be a str.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">typ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cname</span> <span class="o">=</span> <span class="n">cname</span> <span class="ow">or</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tz</span> <span class="o">=</span> <span class="n">tz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_name</span> <span class="o">=</span> <span class="n">index_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ordered</span> <span class="o">=</span> <span class="n">ordered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">meta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>

        <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_pos</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

        <span class="c1"># These are ensured as long as the passed arguments match the</span>
        <span class="c1">#  constructor annotations.</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cname</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">itemsize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="c1"># Assumes self.typ has already been initialized</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">.</span><span class="n">itemsize</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">kind_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_kind&quot;</span>

    <span class="k">def</span> <span class="nf">set_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;set the position of this column in the Table&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">.</span><span class="n">_v_pos</span> <span class="o">=</span> <span class="n">pos</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span><span class="n">pprint_thing</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">-&gt;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cname&quot;</span><span class="p">,</span> <span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">,</span> <span class="s2">&quot;kind&quot;</span><span class="p">],</span> <span class="n">temp</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;compare 2 col items&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cname&quot;</span><span class="p">,</span> <span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_indexed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return whether I am an indexed column&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="s2">&quot;cols&quot;</span><span class="p">):</span>
            <span class="c1"># e.g. if infer hasn&#39;t been called yet, self.table will be None.</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cname</span><span class="p">)</span><span class="o">.</span><span class="n">is_indexed</span>

    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">nan_rep</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Index</span><span class="p">,</span> <span class="n">Index</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the data from this selection to the appropriate pandas type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="c1"># values is a recarray</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Copy, otherwise values will be a view</span>
            <span class="c1"># preventing the original recarry from being free&#39;ed</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cname</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">val_kind</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">_maybe_convert</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">val_kind</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>

        <span class="n">factory</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span> <span class="o">|</span> <span class="nb">type</span><span class="p">[</span><span class="n">DatetimeIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">Index</span>
        <span class="k">if</span> <span class="n">is_datetime64_dtype</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_datetime64tz_dtype</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="n">factory</span> <span class="o">=</span> <span class="n">DatetimeIndex</span>
        <span class="k">elif</span> <span class="n">values</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;i8&quot;</span> <span class="ow">and</span> <span class="s2">&quot;freq&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># PeriodIndex data is stored as i8</span>
            <span class="c1"># error: Incompatible types in assignment (expression has type</span>
            <span class="c1"># &quot;Callable[[Any, KwArg(Any)], PeriodIndex]&quot;, variable has type</span>
            <span class="c1"># &quot;Union[Type[Index], Type[DatetimeIndex]]&quot;)</span>
            <span class="n">factory</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">:</span> <span class="n">PeriodIndex</span><span class="p">(</span>  <span class="c1"># type: ignore[assignment]</span>
                <span class="n">ordinal</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span>
            <span class="p">)</span>

        <span class="c1"># making an Index instance could throw a number of different errors</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_pd_index</span> <span class="o">=</span> <span class="n">factory</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># if the output freq is different that what we recorded,</span>
            <span class="c1"># it should be None (see also &#39;doc example part 2&#39;)</span>
            <span class="k">if</span> <span class="s2">&quot;freq&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">new_pd_index</span> <span class="o">=</span> <span class="n">factory</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">final_pd_index</span> <span class="o">=</span> <span class="n">_set_tz</span><span class="p">(</span><span class="n">new_pd_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">final_pd_index</span><span class="p">,</span> <span class="n">final_pd_index</span>

    <span class="k">def</span> <span class="nf">take_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the values&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">_v_attrs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">description</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">col</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return my current col description&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return my cython values&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">maybe_set_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_itemsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        maybe set a string col itemsize:</span>
<span class="sd">            min_itemsize can be an integer or a dict with this columns name</span>
<span class="sd">            with an integer size</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_itemsize</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">min_itemsize</span> <span class="o">=</span> <span class="n">min_itemsize</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">min_itemsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">.</span><span class="n">itemsize</span> <span class="o">&lt;</span> <span class="n">min_itemsize</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">_tables</span><span class="p">()</span><span class="o">.</span><span class="n">StringCol</span><span class="p">(</span><span class="n">itemsize</span><span class="o">=</span><span class="n">min_itemsize</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">validate_and_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">AppendableTable</span><span class="p">,</span> <span class="n">append</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_col</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_attr</span><span class="p">(</span><span class="n">append</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_metadata</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_attr</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">validate_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemsize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;validate this column: return the compared against itemsize&quot;&quot;&quot;</span>
        <span class="c1"># validate this column for string truncation (or reset to the max size)</span>
        <span class="k">if</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">itemsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">itemsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">itemsize</span>
                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">itemsize</span> <span class="o">&lt;</span> <span class="n">itemsize</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Trying to store a string with len [</span><span class="si">{</span><span class="n">itemsize</span><span class="si">}</span><span class="s2">] in &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cname</span><span class="si">}</span><span class="s2">] column but</span><span class="se">\n</span><span class="s2">this column has a limit of &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">itemsize</span><span class="si">}</span><span class="s2">]!</span><span class="se">\n</span><span class="s2">Consider using min_itemsize to &quot;</span>
                        <span class="s2">&quot;preset the sizes on these columns&quot;</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">itemsize</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">validate_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">append</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># check for backwards incompatibility</span>
        <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
            <span class="n">existing_kind</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind_attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">existing_kind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">existing_kind</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;incompatible kind in col [</span><span class="si">{</span><span class="n">existing_kind</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="si">}</span><span class="s2">]&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set/update the info for this indexable with the key/value</span>
<span class="sd">        if there is a conflict raise/warn as needed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_fields</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span>

            <span class="n">existing_value</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">idx</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">existing_value</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
                <span class="c1"># frequency/name just warn</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;index_name&quot;</span><span class="p">]:</span>
                    <span class="n">ws</span> <span class="o">=</span> <span class="n">attribute_conflict_doc</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">existing_value</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="n">ws</span><span class="p">,</span> <span class="n">AttributeConflictWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="n">find_stack_level</span><span class="p">()</span>
                    <span class="p">)</span>

                    <span class="c1"># reset</span>
                    <span class="n">idx</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;invalid info for [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] for [</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">], &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;existing_value [</span><span class="si">{</span><span class="n">existing_value</span><span class="si">}</span><span class="s2">] conflicts with &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;new value [</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">]&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">existing_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">idx</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">set_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;set my state from the passed info&quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;set the kind for this column&quot;&quot;&quot;</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">AppendableTable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;validate that kind=category does not change the categories&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">==</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span>
            <span class="n">new_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span>
            <span class="n">cur_metadata</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">read_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cname</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">new_metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">cur_metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="n">array_equivalent</span><span class="p">(</span><span class="n">new_metadata</span><span class="p">,</span> <span class="n">cur_metadata</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;cannot append a categorical with &quot;</span>
                    <span class="s2">&quot;different categories to the existing&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">AppendableTable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;set the meta data&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GenericIndexCol</span><span class="p">(</span><span class="n">IndexCol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;an index which is not represented in the data of the table&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_indexed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">nan_rep</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Index</span><span class="p">,</span> <span class="n">Index</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the data from this selection to the appropriate pandas type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        values : np.ndarray</span>
<span class="sd">        nan_rep : str</span>
<span class="sd">        encoding : str</span>
<span class="sd">        errors : str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">RangeIndex</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">index</span>

    <span class="k">def</span> <span class="nf">set_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">DataCol</span><span class="p">(</span><span class="n">IndexCol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    a data holding column, by definition this is not indexable</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data   : the actual data</span>
<span class="sd">    cname  : the column name in the table to hold the data (typically</span>
<span class="sd">                values)</span>
<span class="sd">    meta   : a string description of the metadata</span>
<span class="sd">    metadata : the actual metadata</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">is_an_indexable</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">is_data_indexable</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_info_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tz&quot;</span><span class="p">,</span> <span class="s2">&quot;ordered&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">typ</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ordered</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">table</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
            <span class="n">typ</span><span class="o">=</span><span class="n">typ</span><span class="p">,</span>
            <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
            <span class="n">cname</span><span class="o">=</span><span class="n">cname</span><span class="p">,</span>
            <span class="n">tz</span><span class="o">=</span><span class="n">tz</span><span class="p">,</span>
            <span class="n">ordered</span><span class="o">=</span><span class="n">ordered</span><span class="p">,</span>
            <span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_dtype&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">meta_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_meta&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="n">pprint_thing</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">-&gt;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cname&quot;</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="s2">&quot;kind&quot;</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">],</span> <span class="n">temp</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;compare 2 col items&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cname&quot;</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">dtype_name</span> <span class="o">=</span> <span class="n">_get_data_and_dtype_name</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">_dtype_to_kind</span><span class="p">(</span><span class="n">dtype_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">take_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the data&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_atom</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Col</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an appropriately typed and shaped pytables.Col object for values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">dtype</span>
        <span class="c1"># error: Item &quot;ExtensionDtype&quot; of &quot;Union[ExtensionDtype, dtype[Any]]&quot; has no</span>
        <span class="c1"># attribute &quot;itemsize&quot;</span>
        <span class="n">itemsize</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span>  <span class="c1"># type: ignore[union-attr]</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># EA, use block shape pretending it is 2D</span>
            <span class="c1"># TODO(EA2D): not necessary with 2D EAs</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">values</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">Categorical</span><span class="p">):</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">codes</span>
            <span class="n">atom</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_atom_data</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">codes</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_datetime64_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_datetime64tz_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
            <span class="n">atom</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_atom_datetime64</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_timedelta64_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
            <span class="n">atom</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_atom_timedelta64</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_complex_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
            <span class="n">atom</span> <span class="o">=</span> <span class="n">_tables</span><span class="p">()</span><span class="o">.</span><span class="n">ComplexCol</span><span class="p">(</span><span class="n">itemsize</span><span class="o">=</span><span class="n">itemsize</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">is_string_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
            <span class="n">atom</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_atom_string</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">itemsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">atom</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_atom_data</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">atom</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_atom_string</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">itemsize</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_tables</span><span class="p">()</span><span class="o">.</span><span class="n">StringCol</span><span class="p">(</span><span class="n">itemsize</span><span class="o">=</span><span class="n">itemsize</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_atom_coltype</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">[</span><span class="n">Col</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the PyTables column class for this column&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">kind</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;uint&quot;</span><span class="p">):</span>
            <span class="n">k4</span> <span class="o">=</span> <span class="n">kind</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
            <span class="n">col_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;UInt</span><span class="si">{</span><span class="n">k4</span><span class="si">}</span><span class="s2">Col&quot;</span>
        <span class="k">elif</span> <span class="n">kind</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;period&quot;</span><span class="p">):</span>
            <span class="c1"># we store as integer</span>
            <span class="n">col_name</span> <span class="o">=</span> <span class="s2">&quot;Int64Col&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kcap</span> <span class="o">=</span> <span class="n">kind</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
            <span class="n">col_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">kcap</span><span class="si">}</span><span class="s2">Col&quot;</span>

        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_tables</span><span class="p">(),</span> <span class="n">col_name</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_atom_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Col</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_atom_coltype</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_atom_datetime64</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_tables</span><span class="p">()</span><span class="o">.</span><span class="n">Int64Col</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_atom_timedelta64</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_tables</span><span class="p">()</span><span class="o">.</span><span class="n">Int64Col</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return my cython values&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">validate_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">append</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;validate that we have the same order as the existing &amp; same dtype&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
            <span class="n">existing_fields</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind_attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">existing_fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">existing_fields</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;appended items do not match existing items in table!&quot;</span><span class="p">)</span>

            <span class="n">existing_dtype</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">existing_dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">existing_dtype</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;appended items dtype do not match existing items dtype in table!&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">nan_rep</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the data from this selection to the appropriate pandas type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        values : np.ndarray</span>
<span class="sd">        nan_rep :</span>
<span class="sd">        encoding : str</span>
<span class="sd">        errors : str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        index : listlike to become an Index</span>
<span class="sd">        data : ndarraylike to become a column</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="c1"># values is a recarray</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cname</span><span class="p">]</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Note: in tests we never have timedelta64 or datetime64,</span>
            <span class="c1">#  so the _get_data_and_dtype_name may be unnecessary</span>
            <span class="n">converted</span><span class="p">,</span> <span class="n">dtype_name</span> <span class="o">=</span> <span class="n">_get_data_and_dtype_name</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="n">_dtype_to_kind</span><span class="p">(</span><span class="n">dtype_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">converted</span> <span class="o">=</span> <span class="n">values</span>
            <span class="n">dtype_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">converted</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>  <span class="c1"># for mypy</span>

        <span class="c1"># use the meta if needed</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">ordered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered</span>
        <span class="n">tz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tz</span>

        <span class="k">assert</span> <span class="n">dtype_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="c1"># convert to the correct dtype</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="n">dtype_name</span><span class="p">)</span>

        <span class="c1"># reverse converts</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;datetime64&quot;</span><span class="p">:</span>
            <span class="c1"># recreate with tz if indicated</span>
            <span class="n">converted</span> <span class="o">=</span> <span class="n">_set_tz</span><span class="p">(</span><span class="n">converted</span><span class="p">,</span> <span class="n">tz</span><span class="p">,</span> <span class="n">coerce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;timedelta64&quot;</span><span class="p">:</span>
            <span class="n">converted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">converted</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;m8[ns]&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">converted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">date</span><span class="o">.</span><span class="n">fromordinal</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">converted</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">converted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">date</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">converted</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">meta</span> <span class="o">==</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span>
            <span class="c1"># we have a categorical</span>
            <span class="n">categories</span> <span class="o">=</span> <span class="n">metadata</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="n">converted</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

            <span class="c1"># if we have stored a NaN in the categories</span>
            <span class="c1"># then strip it; in theory we could have BOTH</span>
            <span class="c1"># -1s in the codes and nulls :&lt;</span>
            <span class="k">if</span> <span class="n">categories</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Handle case of NaN-only categorical columns in which case</span>
                <span class="c1"># the categories are an empty array; when this is stored,</span>
                <span class="c1"># pytables cannot write a zero-len array, so on readback</span>
                <span class="c1"># the categories would be None and `read_hdf()` would fail.</span>
                <span class="n">categories</span> <span class="o">=</span> <span class="n">Index</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">isna</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="n">categories</span> <span class="o">=</span> <span class="n">categories</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>
                    <span class="n">codes</span><span class="p">[</span><span class="n">codes</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">.</span><span class="n">_values</span>

            <span class="n">converted</span> <span class="o">=</span> <span class="n">Categorical</span><span class="o">.</span><span class="n">from_codes</span><span class="p">(</span>
                <span class="n">codes</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="n">categories</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="n">ordered</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">converted</span> <span class="o">=</span> <span class="n">converted</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">converted</span> <span class="o">=</span> <span class="n">converted</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># convert nans / decode</span>
        <span class="k">if</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="n">kind</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
            <span class="n">converted</span> <span class="o">=</span> <span class="n">_unconvert_string_array</span><span class="p">(</span>
                <span class="n">converted</span><span class="p">,</span> <span class="n">nan_rep</span><span class="o">=</span><span class="n">nan_rep</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">converted</span>

    <span class="k">def</span> <span class="nf">set_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;set the data for this column&quot;&quot;&quot;</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DataIndexableCol</span><span class="p">(</span><span class="n">DataCol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;represent a data column that can be indexed&quot;&quot;&quot;</span>

    <span class="n">is_data_indexable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">validate_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_object_dtype</span><span class="p">(</span><span class="n">Index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
            <span class="c1"># TODO: should the message here be more specifically non-str?</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot have non-object label DataIndexableCol&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_atom_string</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">itemsize</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_tables</span><span class="p">()</span><span class="o">.</span><span class="n">StringCol</span><span class="p">(</span><span class="n">itemsize</span><span class="o">=</span><span class="n">itemsize</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_atom_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Col</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_atom_coltype</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_atom_datetime64</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_tables</span><span class="p">()</span><span class="o">.</span><span class="n">Int64Col</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_atom_timedelta64</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_tables</span><span class="p">()</span><span class="o">.</span><span class="n">Int64Col</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">GenericDataIndexableCol</span><span class="p">(</span><span class="n">DataIndexableCol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;represent a generic pytables data column&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">Fixed</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    represent an object in my store</span>
<span class="sd">    facilitate read/write of various types of objects</span>
<span class="sd">    this is an abstract base class</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parent : HDFStore</span>
<span class="sd">    group : Node</span>
<span class="sd">        The group node where the table resides.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pandas_kind</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">format_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fixed&quot;</span>  <span class="c1"># GH#30962 needed by dask</span>
    <span class="n">obj_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Series</span><span class="p">]</span>
    <span class="n">ndim</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">parent</span><span class="p">:</span> <span class="n">HDFStore</span>
    <span class="n">is_table</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">HDFStore</span><span class="p">,</span>
        <span class="n">group</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;UTF-8&quot;</span><span class="p">,</span>
        <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;strict&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">HDFStore</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">_table_mod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># needed for mypy</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">_table_mod</span><span class="o">.</span><span class="n">Node</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">group</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">_ensure_encoding</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="n">errors</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_old_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">10</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;compute and set our version&quot;&quot;&quot;</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">_v_attrs</span><span class="p">,</span> <span class="s2">&quot;pandas_version&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="n">version</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">version</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pandas_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">_v_attrs</span><span class="p">,</span> <span class="s2">&quot;pandas_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return a pretty representation of myself&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infer_axes</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">jshape</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">pprint_thing</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="p">])</span>
                <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">jshape</span><span class="si">}</span><span class="s2">]&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pandas_type</span><span class="si">:</span><span class="s2">12.12</span><span class="si">}</span><span class="s2"> (shape-&gt;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pandas_type</span>

    <span class="k">def</span> <span class="nf">set_object_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;set my pandas type &amp; version&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">pandas_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pandas_kind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">pandas_version</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_version</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fixed</span><span class="p">:</span>
        <span class="n">new_self</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pathname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">_v_pathname</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_handle</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_filters</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_complevel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_complevel</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_fletcher32</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_fletcher32</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">_v_attrs</span>

    <span class="k">def</span> <span class="nf">set_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;set our object attributes&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get our object attributes&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">storable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return my storable&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nrows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storable</span><span class="p">,</span> <span class="s2">&quot;nrows&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;validate against an existing storable&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">validate_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;are we trying to operate on an old version?&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">infer_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        infer the axes of my storer</span>
<span class="sd">        return a boolean indicating if we have a valid storer or not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storable</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_attrs</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;cannot read on an abstract storer: subclasses should implement&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;cannot write on an abstract storer: subclasses should implement&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        support fully deleting the node in its entirety (only) - where</span>
<span class="sd">        specification must be None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">com</span><span class="o">.</span><span class="n">all_none</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;cannot delete on an abstract storer&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GenericFixed</span><span class="p">(</span><span class="n">Fixed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a generified fixed version&quot;&quot;&quot;</span>

    <span class="n">_index_type_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">DatetimeIndex</span><span class="p">:</span> <span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="n">PeriodIndex</span><span class="p">:</span> <span class="s2">&quot;period&quot;</span><span class="p">}</span>
    <span class="n">_reverse_index_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_index_type_map</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">attributes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># indexer helpers</span>
    <span class="k">def</span> <span class="nf">_class_to_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_type_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_alias_to_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
            <span class="c1"># compat: for a short period of time master stored types</span>
            <span class="k">return</span> <span class="n">alias</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reverse_index_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">Index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_index_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="n">index_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alias_to_class</span><span class="p">(</span>
            <span class="n">_ensure_decoded</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="s2">&quot;index_class&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">factory</span><span class="p">:</span> <span class="n">Callable</span>

        <span class="k">if</span> <span class="n">index_class</span> <span class="o">==</span> <span class="n">DatetimeIndex</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                <span class="c1"># data are already in UTC, localize and convert if tz present</span>
                <span class="n">dta</span> <span class="o">=</span> <span class="n">DatetimeArray</span><span class="o">.</span><span class="n">_simple_new</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">DatetimeIndex</span><span class="o">.</span><span class="n">_simple_new</span><span class="p">(</span><span class="n">dta</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span>

            <span class="n">factory</span> <span class="o">=</span> <span class="n">f</span>
        <span class="k">elif</span> <span class="n">index_class</span> <span class="o">==</span> <span class="n">PeriodIndex</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">parr</span> <span class="o">=</span> <span class="n">PeriodArray</span><span class="o">.</span><span class="n">_simple_new</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">PeriodIndex</span><span class="o">.</span><span class="n">_simple_new</span><span class="p">(</span><span class="n">parr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="n">factory</span> <span class="o">=</span> <span class="n">f</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">factory</span> <span class="o">=</span> <span class="n">index_class</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s2">&quot;freq&quot;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">index_class</span> <span class="ow">is</span> <span class="n">Index</span><span class="p">:</span>
                <span class="c1"># DTI/PI would be gotten by _alias_to_class</span>
                <span class="n">factory</span> <span class="o">=</span> <span class="n">TimedeltaIndex</span>

        <span class="k">if</span> <span class="s2">&quot;tz&quot;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;tz&quot;</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="c1"># created by python2</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;tz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;tz&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># created by python3</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;tz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;tz&quot;</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">index_class</span> <span class="ow">is</span> <span class="n">DatetimeIndex</span>  <span class="c1"># just checking</span>

        <span class="k">return</span> <span class="n">factory</span><span class="p">,</span> <span class="n">kwargs</span>

    <span class="k">def</span> <span class="nf">validate_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">where</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        raise if any keywords are passed which are not-None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;cannot pass a column specification when reading &quot;</span>
                <span class="s2">&quot;a Fixed format store. this store must be selected in its entirety&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">where</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;cannot pass a where specification when reading &quot;</span>
                <span class="s2">&quot;from a Fixed format store. this store must be selected in its entirety&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;set our object attributes&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span>

    <span class="k">def</span> <span class="nf">get_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;retrieve our attributes&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">_ensure_encoding</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="s2">&quot;errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="kc">None</span><span class="p">)))</span>

    <span class="c1"># error: Signature of &quot;write&quot; incompatible with supertype &quot;Fixed&quot;</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore[override]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_attrs</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">read_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;read an array for the specified node (off of group&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">tables</span>

        <span class="n">node</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span>

        <span class="n">transposed</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="s2">&quot;transposed&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">tables</span><span class="o">.</span><span class="n">VLArray</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="s2">&quot;value_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># length 0 axis</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;datetime64&quot;</span><span class="p">:</span>
                <span class="c1"># reconstruct a timezone if indicated</span>
                <span class="n">tz</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="s2">&quot;tz&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">_set_tz</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">tz</span><span class="p">,</span> <span class="n">coerce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;timedelta64&quot;</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;m8[ns]&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">transposed</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">read_index</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Index</span><span class="p">:</span>
        <span class="n">variety</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_variety&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">variety</span> <span class="o">==</span> <span class="s2">&quot;multi&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_multi_index</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">variety</span> <span class="o">==</span> <span class="s2">&quot;regular&quot;</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_index_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">index</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unrecognized index variety: </span><span class="si">{</span><span class="n">variety</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">MultiIndex</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_variety&quot;</span><span class="p">,</span> <span class="s2">&quot;multi&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_multi_index</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_variety&quot;</span><span class="p">,</span> <span class="s2">&quot;regular&quot;</span><span class="p">)</span>
            <span class="n">converted</span> <span class="o">=</span> <span class="n">_convert_index</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">converted</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

            <span class="n">node</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">converted</span><span class="o">.</span><span class="n">kind</span>
            <span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">name</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">PeriodIndex</span><span class="p">)):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">index_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_to_alias</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">PeriodIndex</span><span class="p">,</span> <span class="n">TimedeltaIndex</span><span class="p">)):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">freq</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">DatetimeIndex</span><span class="p">)</span> <span class="ow">and</span> <span class="n">index</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">tz</span> <span class="o">=</span> <span class="n">_get_tz</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_multi_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">MultiIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_nlevels&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">.</span><span class="n">nlevels</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lev</span><span class="p">,</span> <span class="n">level_codes</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="n">index</span><span class="o">.</span><span class="n">codes</span><span class="p">,</span> <span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># write the level</span>
            <span class="k">if</span> <span class="n">is_extension_array_dtype</span><span class="p">(</span><span class="n">lev</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;Saving a MultiIndex with an extension dtype is not supported.&quot;</span>
                <span class="p">)</span>
            <span class="n">level_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_level</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">conv_level</span> <span class="o">=</span> <span class="n">_convert_index</span><span class="p">(</span><span class="n">level_key</span><span class="p">,</span> <span class="n">lev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">level_key</span><span class="p">,</span> <span class="n">conv_level</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">level_key</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">conv_level</span><span class="o">.</span><span class="n">kind</span>
            <span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

            <span class="c1"># write the name</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_name</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

            <span class="c1"># write the labels</span>
            <span class="n">label_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_label</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">label_key</span><span class="p">,</span> <span class="n">level_codes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_multi_index</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MultiIndex</span><span class="p">:</span>
        <span class="n">nlevels</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_nlevels&quot;</span><span class="p">)</span>

        <span class="n">levels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlevels</span><span class="p">):</span>
            <span class="n">level_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_level</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">node</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">level_key</span><span class="p">)</span>
            <span class="n">lev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_index_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
            <span class="n">levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lev</span><span class="p">)</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lev</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="n">label_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_label</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">level_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_array</span><span class="p">(</span><span class="n">label_key</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
            <span class="n">codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level_codes</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">MultiIndex</span><span class="p">(</span>
            <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">codes</span><span class="o">=</span><span class="n">codes</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">verify_integrity</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_index_node</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Index</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="c1"># If the index was an empty array write_array_empty() will</span>
        <span class="c1"># have written a sentinel. Here we replace it with the original.</span>
        <span class="k">if</span> <span class="s2">&quot;shape&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">value_type</span><span class="p">)</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">_ensure_str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span>
        <span class="n">factory</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_index_factory</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;object&quot;</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">factory</span><span class="p">(</span>
                <span class="n">_unconvert_index</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span>
                <span class="p">),</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">factory</span><span class="p">(</span>
                <span class="n">_unconvert_index</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span>
                <span class="p">),</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="k">return</span> <span class="n">index</span>

    <span class="k">def</span> <span class="nf">write_array_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;write a 0-len array&quot;&quot;&quot;</span>
        <span class="c1"># ugly hack for length 0 axes</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="n">value</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">create_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">value_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">def</span> <span class="nf">write_array</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">AnyArrayLike</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="n">Index</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># TODO: we only have a few tests that get here, the only EA</span>
        <span class="c1">#  that gets passed is DatetimeArray, and we never have</span>
        <span class="c1">#  both self._filters and EA</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">extract_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

        <span class="c1"># Transform needed to interface with pytables row/col notation</span>
        <span class="n">empty_array</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">transposed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">is_categorical_dtype</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot store a category dtype in a HDF5 dataset that uses format=&quot;</span>
                <span class="s1">&#39;&quot;fixed&quot;. Use format=&quot;table&quot;.&#39;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">empty_array</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">):</span>
                <span class="c1"># ExtensionArrays (1d) may not have transpose.</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">T</span>
                <span class="n">transposed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">atom</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
                <span class="c1"># get the atom for this datatype</span>
                <span class="n">atom</span> <span class="o">=</span> <span class="n">_tables</span><span class="p">()</span><span class="o">.</span><span class="n">Atom</span><span class="o">.</span><span class="n">from_dtype</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">atom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># We only get here if self._filters is non-None and</span>
            <span class="c1">#  the Atom.from_dtype call succeeded</span>

            <span class="c1"># create an empty chunked array and fill it from value</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">empty_array</span><span class="p">:</span>
                <span class="n">ca</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">create_carray</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">atom</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_filters</span>
                <span class="p">)</span>
                <span class="n">ca</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_array_empty</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">:</span>
            <span class="c1"># infer the type, warn if we have a non-string type here (for</span>
            <span class="c1"># performance)</span>
            <span class="n">inferred_type</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">infer_dtype</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">empty_array</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">inferred_type</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ws</span> <span class="o">=</span> <span class="n">performance_doc</span> <span class="o">%</span> <span class="p">(</span><span class="n">inferred_type</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">PerformanceWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="n">find_stack_level</span><span class="p">())</span>

            <span class="n">vlarr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">create_vlarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">_tables</span><span class="p">()</span><span class="o">.</span><span class="n">ObjectAtom</span><span class="p">())</span>
            <span class="n">vlarr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">is_datetime64_dtype</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">create_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s2">&quot;i8&quot;</span><span class="p">))</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">value_type</span> <span class="o">=</span> <span class="s2">&quot;datetime64&quot;</span>
        <span class="k">elif</span> <span class="n">is_datetime64tz_dtype</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="c1"># store as UTC</span>
            <span class="c1"># with a zone</span>

            <span class="c1"># error: Item &quot;ExtensionArray&quot; of &quot;Union[Any, ExtensionArray]&quot; has no</span>
            <span class="c1"># attribute &quot;asi8&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">create_array</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">asi8</span>  <span class="c1"># type: ignore[union-attr]</span>
            <span class="p">)</span>

            <span class="n">node</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="c1"># error: Item &quot;ExtensionArray&quot; of &quot;Union[Any, ExtensionArray]&quot; has no</span>
            <span class="c1"># attribute &quot;tz&quot;</span>
            <span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">tz</span> <span class="o">=</span> <span class="n">_get_tz</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
            <span class="n">node</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">value_type</span> <span class="o">=</span> <span class="s2">&quot;datetime64&quot;</span>
        <span class="k">elif</span> <span class="n">is_timedelta64_dtype</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">create_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s2">&quot;i8&quot;</span><span class="p">))</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">value_type</span> <span class="o">=</span> <span class="s2">&quot;timedelta64&quot;</span>
        <span class="k">elif</span> <span class="n">empty_array</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_array_empty</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">create_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">transposed</span> <span class="o">=</span> <span class="n">transposed</span>


<span class="k">class</span> <span class="nc">SeriesFixed</span><span class="p">(</span><span class="n">GenericFixed</span><span class="p">):</span>
    <span class="n">pandas_kind</span> <span class="o">=</span> <span class="s2">&quot;series&quot;</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

    <span class="n">name</span><span class="p">:</span> <span class="n">Hashable</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">values</span><span class="p">),)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_read</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">where</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_index</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_array</span><span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Series</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># error: Signature of &quot;write&quot; incompatible with supertype &quot;Fixed&quot;</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore[override]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_index</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>


<span class="k">class</span> <span class="nc">BlockManagerFixed</span><span class="p">(</span><span class="n">GenericFixed</span><span class="p">):</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ndim&quot;</span><span class="p">,</span> <span class="s2">&quot;nblocks&quot;</span><span class="p">]</span>

    <span class="n">nblocks</span><span class="p">:</span> <span class="nb">int</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Shape</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ndim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span>

            <span class="c1"># items</span>
            <span class="n">items</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nblocks</span><span class="p">):</span>
                <span class="n">node</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;block</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_items&quot;</span><span class="p">)</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">items</span> <span class="o">+=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># data shape</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">block0_values</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">shape</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="c1"># start, stop applied to rows, so 0th axis only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_read</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">where</span><span class="p">)</span>
        <span class="n">select_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_type</span><span class="p">()</span><span class="o">.</span><span class="n">_get_block_manager_axis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">):</span>
            <span class="n">_start</span><span class="p">,</span> <span class="n">_stop</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">select_axis</span> <span class="k">else</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_index</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;axis</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">_start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">_stop</span><span class="p">)</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">items</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nblocks</span><span class="p">):</span>
            <span class="n">blk_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_index</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;block</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_items&quot;</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_array</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;block</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_values&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">_start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">_stop</span><span class="p">)</span>

            <span class="n">columns</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">items</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">(</span><span class="n">blk_items</span><span class="p">)]</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">items</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># error: Signature of &quot;write&quot; incompatible with supertype &quot;Fixed&quot;</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore[override]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># TODO(ArrayManager) HDFStore relies on accessing the blocks</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">_mgr</span><span class="p">,</span> <span class="n">ArrayManager</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_as_manager</span><span class="p">(</span><span class="s2">&quot;block&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_mgr</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">is_consolidated</span><span class="p">():</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">consolidate</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ax</span><span class="o">.</span><span class="n">is_unique</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Columns index has to be unique for fixed format&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_index</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;axis</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

        <span class="c1"># Supporting mixed-type DataFrame objects...nontrivial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">nblocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">blk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">blocks</span><span class="p">):</span>
            <span class="c1"># I have no idea why, but writing values before items fixed #2299</span>
            <span class="n">blk_items</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">blk</span><span class="o">.</span><span class="n">mgr_locs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;block</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_values&quot;</span><span class="p">,</span> <span class="n">blk</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">blk_items</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_index</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;block</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_items&quot;</span><span class="p">,</span> <span class="n">blk_items</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FrameFixed</span><span class="p">(</span><span class="n">BlockManagerFixed</span><span class="p">):</span>
    <span class="n">pandas_kind</span> <span class="o">=</span> <span class="s2">&quot;frame&quot;</span>
    <span class="n">obj_type</span> <span class="o">=</span> <span class="n">DataFrame</span>


<span class="k">class</span> <span class="nc">Table</span><span class="p">(</span><span class="n">Fixed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    represent a table:</span>
<span class="sd">        facilitate read/write of various types of tables</span>

<span class="sd">    Attrs in Table Node</span>
<span class="sd">    -------------------</span>
<span class="sd">    These are attributes that are store in the main table node, they are</span>
<span class="sd">    necessary to recreate these tables when read back in.</span>

<span class="sd">    index_axes    : a list of tuples of the (original indexing axis and</span>
<span class="sd">        index column)</span>
<span class="sd">    non_index_axes: a list of tuples of the (original index axis and</span>
<span class="sd">        columns on a non-indexing axis)</span>
<span class="sd">    values_axes   : a list of the columns which comprise the data of this</span>
<span class="sd">        table</span>
<span class="sd">    data_columns  : a list of the columns that we are allowing indexing</span>
<span class="sd">        (these become single columns in values_axes)</span>
<span class="sd">    nan_rep       : the string to use for nan representations for string</span>
<span class="sd">        objects</span>
<span class="sd">    levels        : the names of levels</span>
<span class="sd">    metadata      : the names of the metadata columns</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pandas_kind</span> <span class="o">=</span> <span class="s2">&quot;wide_table&quot;</span>
    <span class="n">format_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;table&quot;</span>  <span class="c1"># GH#30962 needed by dask</span>
    <span class="n">table_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">levels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">is_table</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">metadata</span><span class="p">:</span> <span class="nb">list</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">HDFStore</span><span class="p">,</span>
        <span class="n">group</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;strict&quot;</span><span class="p">,</span>
        <span class="n">index_axes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">IndexCol</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">non_index_axes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AxisInt</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">values_axes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataCol</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">data_columns</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">info</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nan_rep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_axes</span> <span class="o">=</span> <span class="n">index_axes</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_index_axes</span> <span class="o">=</span> <span class="n">non_index_axes</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values_axes</span> <span class="o">=</span> <span class="n">values_axes</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_columns</span> <span class="o">=</span> <span class="n">data_columns</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nan_rep</span> <span class="o">=</span> <span class="n">nan_rep</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">table_type_short</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return a pretty representation of myself&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infer_axes</span><span class="p">()</span>
        <span class="n">jdc</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_columns</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_columns</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">dc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;,dc-&gt;[</span><span class="si">{</span><span class="n">jdc</span><span class="si">}</span><span class="s2">]&quot;</span>

        <span class="n">ver</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_old_version</span><span class="p">:</span>
            <span class="n">jver</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">])</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">jver</span><span class="si">}</span><span class="s2">]&quot;</span>

        <span class="n">jindex_axes</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_axes</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pandas_type</span><span class="si">:</span><span class="s2">12.12</span><span class="si">}{</span><span class="n">ver</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(typ-&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_type_short</span><span class="si">}</span><span class="s2">,nrows-&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;ncols-&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="si">}</span><span class="s2">,indexers-&gt;[</span><span class="si">{</span><span class="n">jindex_axes</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">dc</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the axis for c&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">a</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;validate against an existing table&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">table_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;incompatible table_type with existing &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">other</span><span class="o">.</span><span class="n">table_type</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_type</span><span class="si">}</span><span class="s2">]&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;index_axes&quot;</span><span class="p">,</span> <span class="s2">&quot;non_index_axes&quot;</span><span class="p">,</span> <span class="s2">&quot;values_axes&quot;</span><span class="p">]:</span>
            <span class="n">sv</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">ov</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sv</span> <span class="o">!=</span> <span class="n">ov</span><span class="p">:</span>
                <span class="c1"># show the error for the specific axes</span>
                <span class="c1"># Argument 1 to &quot;enumerate&quot; has incompatible type</span>
                <span class="c1"># &quot;Optional[Any]&quot;; expected &quot;Iterable[Any]&quot;  [arg-type]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sv</span><span class="p">):</span>  <span class="c1"># type: ignore[arg-type]</span>
                    <span class="c1"># Value of type &quot;Optional[Any]&quot; is not indexable  [index]</span>
                    <span class="n">oax</span> <span class="o">=</span> <span class="n">ov</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># type: ignore[index]</span>
                    <span class="k">if</span> <span class="n">sax</span> <span class="o">!=</span> <span class="n">oax</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;invalid combination of [</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">] on appending data &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">sax</span><span class="si">}</span><span class="s2">] vs current table [</span><span class="si">{</span><span class="n">oax</span><span class="si">}</span><span class="s2">]&quot;</span>
                        <span class="p">)</span>

                <span class="c1"># should never get here</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;invalid combination of [</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">] on appending data [</span><span class="si">{</span><span class="n">sv</span><span class="si">}</span><span class="s2">] vs &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;current table [</span><span class="si">{</span><span class="n">ov</span><span class="si">}</span><span class="s2">]&quot;</span>
                <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_multi_index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;the levels attribute is 1 or a list in the case of a multi-index&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_multiindex</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Series</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        validate that we can store the multi-index; reset and return the</span>
<span class="sd">        new object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">fill_missing_names</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">reset_obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;duplicate names/columns in the multi-index when storing as a table&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reset_obj</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">)</span>  <span class="c1"># for mypy</span>
        <span class="k">return</span> <span class="n">reset_obj</span><span class="p">,</span> <span class="n">levels</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nrows_expected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;based on our axes, compute the expected nrows&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">cvalues</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_axes</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;has this table been created&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;table&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">storable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the table group (this is my storable)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storable</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">dtype</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">description</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_axes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_axes</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ncols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;the number of total columns in the values axes&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_axes</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_transposed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return a tuple of my permutated axes, non_indexable at the front&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_index_axes</span><span class="p">],</span>
                <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">axis</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_axes</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">queryables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return a dict of the kinds allowable columns for this object&quot;&quot;&quot;</span>
        <span class="c1"># mypy doesn&#39;t recognize DataFrame._AXIS_NAMES, so we re-write it here</span>
        <span class="n">axis_names</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;columns&quot;</span><span class="p">}</span>

        <span class="c1"># compute the values_axes queryables</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="o">.</span><span class="n">cname</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_axes</span><span class="p">]</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="p">[(</span><span class="n">axis_names</span><span class="p">[</span><span class="n">axis</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">axis</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_index_axes</span><span class="p">]</span>
        <span class="n">d3</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">cname</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_axes</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_columns</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">d1</span> <span class="o">+</span> <span class="n">d2</span> <span class="o">+</span> <span class="n">d3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">index_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return a list of my index cols&quot;&quot;&quot;</span>
        <span class="c1"># Note: each `i.cname` below is assured to be a str.</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">i</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">cname</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_axes</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">values_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return a list of my values cols&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">cname</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_axes</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_metadata_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the metadata pathname for this key&quot;&quot;&quot;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">_v_pathname</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">/meta/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">/meta&quot;</span>

    <span class="k">def</span> <span class="nf">write_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write out a metadata array to the key as a fixed-format Series.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">        values : ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_metadata_path</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
            <span class="n">Series</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;table&quot;</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
            <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span>
            <span class="n">nan_rep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nan_rep</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the meta data array for this key&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_metadata_path</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">set_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;set our table type &amp; indexables&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">table_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">index_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_cols</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">values_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_cols</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">non_index_axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_index_axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">data_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">nan_rep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nan_rep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span>

    <span class="k">def</span> <span class="nf">get_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;retrieve our attributes&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_index_axes</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="s2">&quot;non_index_axes&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_columns</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="s2">&quot;data_columns&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nan_rep</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="s2">&quot;nan_rep&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">_ensure_encoding</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="s2">&quot;errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="s2">&quot;levels&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexables</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_an_indexable</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexables</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">is_an_indexable</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">validate_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;are we trying to operate on an old version?&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">where</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_old_version</span><span class="p">:</span>
                <span class="n">ws</span> <span class="o">=</span> <span class="n">incompatibility_doc</span> <span class="o">%</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">])</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="n">ws</span><span class="p">,</span>
                    <span class="n">IncompatibilityWarning</span><span class="p">,</span>
                    <span class="n">stacklevel</span><span class="o">=</span><span class="n">find_stack_level</span><span class="p">(),</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_min_itemsize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_itemsize</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        validate the min_itemsize doesn&#39;t contain items that are not in the</span>
<span class="sd">        axes this needs data_columns to be defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">min_itemsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_itemsize</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryables</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">min_itemsize</span><span class="p">:</span>
            <span class="c1"># ok, apply generally</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;values&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">q</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;min_itemsize has the key [</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">] which is not an axis or &quot;</span>
                    <span class="s2">&quot;data_column&quot;</span>
                <span class="p">)</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">indexables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;create/cache the indexables if they don&#39;t exist&quot;&quot;&quot;</span>
        <span class="n">_indexables</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
        <span class="n">table_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">attrs</span>

        <span class="c1"># Note: each of the `name` kwargs below are str, ensured</span>
        <span class="c1">#  by the definition in index_cols.</span>
        <span class="c1"># index columns</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">index_cols</span><span class="p">):</span>
            <span class="n">atom</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">md</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_metadata</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="s2">&quot;category&quot;</span> <span class="k">if</span> <span class="n">md</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="n">kind_attr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_kind&quot;</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">table_attrs</span><span class="p">,</span> <span class="n">kind_attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="n">index_col</span> <span class="o">=</span> <span class="n">IndexCol</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span>
                <span class="n">pos</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
                <span class="n">typ</span><span class="o">=</span><span class="n">atom</span><span class="p">,</span>
                <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">,</span>
                <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">md</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">_indexables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index_col</span><span class="p">)</span>

        <span class="c1"># values columns</span>
        <span class="n">dc</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_columns</span><span class="p">)</span>
        <span class="n">base_pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_indexables</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="n">klass</span> <span class="o">=</span> <span class="n">DataCol</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">dc</span><span class="p">:</span>
                <span class="n">klass</span> <span class="o">=</span> <span class="n">DataIndexableCol</span>

            <span class="n">atom</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
            <span class="n">adj_name</span> <span class="o">=</span> <span class="n">_maybe_adjust_name</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>

            <span class="c1"># TODO: why kind_attr here?</span>
            <span class="n">values</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">table_attrs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">adj_name</span><span class="si">}</span><span class="s2">_kind&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">table_attrs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">adj_name</span><span class="si">}</span><span class="s2">_dtype&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="c1"># Argument 1 to &quot;_dtype_to_kind&quot; has incompatible type</span>
            <span class="c1"># &quot;Optional[Any]&quot;; expected &quot;str&quot;  [arg-type]</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="n">_dtype_to_kind</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>

            <span class="n">md</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_metadata</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="c1"># TODO: figure out why these two versions of `meta` dont always match.</span>
            <span class="c1">#  meta = &quot;category&quot; if md is not None else None</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">table_attrs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">adj_name</span><span class="si">}</span><span class="s2">_meta&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="n">obj</span> <span class="o">=</span> <span class="n">klass</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">adj_name</span><span class="p">,</span>
                <span class="n">cname</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
                <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
                <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
                <span class="n">pos</span><span class="o">=</span><span class="n">base_pos</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span>
                <span class="n">typ</span><span class="o">=</span><span class="n">atom</span><span class="p">,</span>
                <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">,</span>
                <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">md</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">obj</span>

        <span class="c1"># Note: the definition of `values_cols` ensures that each</span>
        <span class="c1">#  `c` below is a str.</span>
        <span class="n">_indexables</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">values_cols</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">_indexables</span>

    <span class="k">def</span> <span class="nf">create_index</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optlevel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a pytables index on the specified columns.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        columns : None, bool, or listlike[str]</span>
<span class="sd">            Indicate which columns to create an index on.</span>

<span class="sd">            * False : Do not create any indexes.</span>
<span class="sd">            * True : Create indexes on all columns.</span>
<span class="sd">            * None : Create indexes on all columns.</span>
<span class="sd">            * listlike : Create indexes on the given columns.</span>

<span class="sd">        optlevel : int or None, default None</span>
<span class="sd">            Optimization level, if None, pytables defaults to 6.</span>
<span class="sd">        kind : str or None, default None</span>
<span class="sd">            Kind of index, if None, pytables defaults to &quot;medium&quot;.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError if trying to create an index on a complex-type column.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Cannot index Time64Col or ComplexCol.</span>
<span class="sd">        Pytables must be &gt;= 3.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">infer_axes</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># index all indexables and data_columns</span>
        <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">columns</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">cname</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_data_indexable</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">columns</span><span class="p">]</span>

        <span class="n">kw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">optlevel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;optlevel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">optlevel</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;kind&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kind</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># remove the index if the kind/optlevel have changed</span>
                <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">is_indexed</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span>
                    <span class="n">cur_optlevel</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">optlevel</span>
                    <span class="n">cur_kind</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">kind</span>

                    <span class="k">if</span> <span class="n">kind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cur_kind</span> <span class="o">!=</span> <span class="n">kind</span><span class="p">:</span>
                        <span class="n">v</span><span class="o">.</span><span class="n">remove_index</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;kind&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_kind</span>

                    <span class="k">if</span> <span class="n">optlevel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cur_optlevel</span> <span class="o">!=</span> <span class="n">optlevel</span><span class="p">:</span>
                        <span class="n">v</span><span class="o">.</span><span class="n">remove_index</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;optlevel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_optlevel</span>

                <span class="c1"># create the index</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">is_indexed</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;complex&quot;</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                            <span class="s2">&quot;Columns containing complex values can be stored but &quot;</span>
                            <span class="s2">&quot;cannot be indexed when using table format. Either use &quot;</span>
                            <span class="s2">&quot;fixed format, set index=False, or do not include &quot;</span>
                            <span class="s2">&quot;the columns containing complex values to &quot;</span>
                            <span class="s2">&quot;data_columns when initializing the table.&quot;</span>
                        <span class="p">)</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_index_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># GH 28156</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;column </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> is not a data_column.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;In order to read column </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> you must reload the dataframe </span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;into HDFStore and include </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> with the data_columns argument.&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_axes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">where</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">,</span> <span class="n">ArrayLike</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the axes sniffed from the table.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        where : ???</span>
<span class="sd">        start : int or None, default None</span>
<span class="sd">        stop : int or None, default None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[Tuple[index_values, column_values]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create the selection</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># convert the data</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                <span class="n">values</span><span class="p">,</span>
                <span class="n">nan_rep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nan_rep</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
                <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">transposed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the data for this obj&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">validate_data_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_columns</span><span class="p">,</span> <span class="n">min_itemsize</span><span class="p">,</span> <span class="n">non_index_axes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        take the input data_columns and min_itemize and create a data</span>
<span class="sd">        columns spec</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_index_axes</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">axis</span><span class="p">,</span> <span class="n">axis_labels</span> <span class="o">=</span> <span class="n">non_index_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;MultiIndex&quot;</span> <span class="ow">and</span> <span class="n">data_columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;cannot use a multi-index on axis [</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2">] with &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;data_columns </span><span class="si">{</span><span class="n">data_columns</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># evaluate the passed data_columns, True == use all columns</span>
        <span class="c1"># take only valid axis labels</span>
        <span class="k">if</span> <span class="n">data_columns</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">data_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">axis_labels</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data_columns</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># if min_itemsize is a dict, add the keys (exclude &#39;values&#39;)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_itemsize</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">existing_data_columns</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">data_columns</span><span class="p">)</span>
            <span class="n">data_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_columns</span><span class="p">)</span>  <span class="c1"># ensure we do not modify</span>
            <span class="n">data_columns</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">k</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">min_itemsize</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;values&quot;</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing_data_columns</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># return valid columns in the order of our axis</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data_columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">axis_labels</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_create_axes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">axes</span><span class="p">,</span>
        <span class="n">obj</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">nan_rep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">min_itemsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and return the axes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        axes: list or None</span>
<span class="sd">            The names or numbers of the axes to create.</span>
<span class="sd">        obj : DataFrame</span>
<span class="sd">            The object to create axes on.</span>
<span class="sd">        validate: bool, default True</span>
<span class="sd">            Whether to validate the obj against an existing object already written.</span>
<span class="sd">        nan_rep :</span>
<span class="sd">            A value to use for string column nan_rep.</span>
<span class="sd">        data_columns : List[str], True, or None, default None</span>
<span class="sd">            Specify the columns that we want to create to allow indexing on.</span>

<span class="sd">            * True : Use all available columns.</span>
<span class="sd">            * None : Use no columns.</span>
<span class="sd">            * List[str] : Use the specified columns.</span>

<span class="sd">        min_itemsize: Dict[str, int] or None, default None</span>
<span class="sd">            The min itemsize for a column in bytes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">_v_name</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;cannot properly create the storer for: [group-&gt;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">,&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;value-&gt;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span>
            <span class="p">)</span>

        <span class="c1"># set the default axes if needed</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># map axes to numbers</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">_get_axis_number</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">]</span>

        <span class="c1"># do we have an existing table (if so, use its axes &amp; data_columns)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">infer_axes</span><span class="p">():</span>
            <span class="n">table_exists</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">axis</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_axes</span><span class="p">]</span>
            <span class="n">data_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_columns</span><span class="p">)</span>
            <span class="n">nan_rep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nan_rep</span>
            <span class="c1"># TODO: do we always have validate=True here?</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table_exists</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">new_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span>  <span class="c1"># with next check, we must have len(axes) == 1</span>
        <span class="c1"># currently support on ndim-1 axes</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;currently only support ndim-1 indexers in an AppendableTable&quot;</span>
            <span class="p">)</span>

        <span class="c1"># create according to the new data</span>
        <span class="n">new_non_index_axes</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># nan_representation</span>
        <span class="k">if</span> <span class="n">nan_rep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nan_rep</span> <span class="o">=</span> <span class="s2">&quot;nan&quot;</span>

        <span class="c1"># We construct the non-index-axis first, since that alters new_info</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="c1"># we might be able to change the axes on the appending data if necessary</span>
        <span class="n">append_axis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">table_exists</span><span class="p">:</span>
            <span class="n">indexer</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_non_index_axes</span><span class="p">)</span>  <span class="c1"># i.e. 0</span>
            <span class="n">exist_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_index_axes</span><span class="p">[</span><span class="n">indexer</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">array_equivalent</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">append_axis</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">exist_axis</span><span class="p">)):</span>
                <span class="c1"># ahah! -&gt; reindex</span>
                <span class="k">if</span> <span class="n">array_equivalent</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">append_axis</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">exist_axis</span><span class="p">))</span>
                <span class="p">):</span>
                    <span class="n">append_axis</span> <span class="o">=</span> <span class="n">exist_axis</span>

        <span class="c1"># the non_index_axes info</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">new_info</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="n">new_non_index_axes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">idx</span><span class="p">,</span> <span class="n">append_axis</span><span class="p">))</span>

        <span class="c1"># Now we can construct our new index axis</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">axis_name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_get_axis_name</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">new_index</span> <span class="o">=</span> <span class="n">_convert_index</span><span class="p">(</span><span class="n">axis_name</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
        <span class="n">new_index</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">idx</span>

        <span class="c1"># Because we are always 2D, there is only one new_index, so</span>
        <span class="c1">#  we know it will have pos=0</span>
        <span class="n">new_index</span><span class="o">.</span><span class="n">set_pos</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">new_index</span><span class="o">.</span><span class="n">update_info</span><span class="p">(</span><span class="n">new_info</span><span class="p">)</span>
        <span class="n">new_index</span><span class="o">.</span><span class="n">maybe_set_size</span><span class="p">(</span><span class="n">min_itemsize</span><span class="p">)</span>  <span class="c1"># check for column conflicts</span>

        <span class="n">new_index_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_index</span><span class="p">]</span>
        <span class="n">j</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_index_axes</span><span class="p">)</span>  <span class="c1"># i.e. 1</span>
        <span class="k">assert</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">1</span>

        <span class="c1"># reindex by our non_index_axes &amp; compute data_columns</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_non_index_axes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">new_non_index_axes</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">_reindex_axis</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">transposed</span> <span class="o">=</span> <span class="n">new_index</span><span class="o">.</span><span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span>

        <span class="c1"># figure out data_columns and get out blocks</span>
        <span class="n">data_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_data_columns</span><span class="p">(</span>
            <span class="n">data_columns</span><span class="p">,</span> <span class="n">min_itemsize</span><span class="p">,</span> <span class="n">new_non_index_axes</span>
        <span class="p">)</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">transposed</span><span class="p">)</span><span class="o">.</span><span class="n">_consolidate</span><span class="p">()</span>

        <span class="n">blocks</span><span class="p">,</span> <span class="n">blk_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_blocks_and_items</span><span class="p">(</span>
            <span class="n">frame</span><span class="p">,</span> <span class="n">table_exists</span><span class="p">,</span> <span class="n">new_non_index_axes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_axes</span><span class="p">,</span> <span class="n">data_columns</span>
        <span class="p">)</span>

        <span class="c1"># add my values</span>
        <span class="n">vaxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">blk</span><span class="p">,</span> <span class="n">b_items</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">blk_items</span><span class="p">)):</span>
            <span class="c1"># shape of the data column are the indexable axes</span>
            <span class="n">klass</span> <span class="o">=</span> <span class="n">DataCol</span>
            <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># we have a data_column</span>
            <span class="k">if</span> <span class="n">data_columns</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">b_items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b_items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">data_columns</span><span class="p">:</span>
                <span class="n">klass</span> <span class="o">=</span> <span class="n">DataIndexableCol</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">b_items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
                    <span class="c1"># TODO: should the message here be more specifically non-str?</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot have non-object label DataIndexableCol&quot;</span><span class="p">)</span>

            <span class="c1"># make sure that we match up the existing columns</span>
            <span class="c1"># if we have an existing table</span>
            <span class="n">existing_col</span><span class="p">:</span> <span class="n">DataCol</span> <span class="o">|</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">table_exists</span> <span class="ow">and</span> <span class="n">validate</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">existing_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Incompatible appended table [</span><span class="si">{</span><span class="n">blocks</span><span class="si">}</span><span class="s2">]&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;with existing table [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">values_axes</span><span class="si">}</span><span class="s2">]&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">existing_col</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">new_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;values_block_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">data_converted</span> <span class="o">=</span> <span class="n">_maybe_convert_for_string_atom</span><span class="p">(</span>
                <span class="n">new_name</span><span class="p">,</span>
                <span class="n">blk</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="n">existing_col</span><span class="o">=</span><span class="n">existing_col</span><span class="p">,</span>
                <span class="n">min_itemsize</span><span class="o">=</span><span class="n">min_itemsize</span><span class="p">,</span>
                <span class="n">nan_rep</span><span class="o">=</span><span class="n">nan_rep</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
                <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span>
                <span class="n">columns</span><span class="o">=</span><span class="n">b_items</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">adj_name</span> <span class="o">=</span> <span class="n">_maybe_adjust_name</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>

            <span class="n">typ</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">_get_atom</span><span class="p">(</span><span class="n">data_converted</span><span class="p">)</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="n">_dtype_to_kind</span><span class="p">(</span><span class="n">data_converted</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">tz</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">data_converted</span><span class="p">,</span> <span class="s2">&quot;tz&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tz</span> <span class="o">=</span> <span class="n">_get_tz</span><span class="p">(</span><span class="n">data_converted</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>

            <span class="n">meta</span> <span class="o">=</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">ordered</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">is_categorical_dtype</span><span class="p">(</span><span class="n">data_converted</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
                <span class="n">ordered</span> <span class="o">=</span> <span class="n">data_converted</span><span class="o">.</span><span class="n">ordered</span>
                <span class="n">meta</span> <span class="o">=</span> <span class="s2">&quot;category&quot;</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_converted</span><span class="o">.</span><span class="n">categories</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

            <span class="n">data</span><span class="p">,</span> <span class="n">dtype_name</span> <span class="o">=</span> <span class="n">_get_data_and_dtype_name</span><span class="p">(</span><span class="n">data_converted</span><span class="p">)</span>

            <span class="n">col</span> <span class="o">=</span> <span class="n">klass</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">adj_name</span><span class="p">,</span>
                <span class="n">cname</span><span class="o">=</span><span class="n">new_name</span><span class="p">,</span>
                <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">b_items</span><span class="p">),</span>
                <span class="n">typ</span><span class="o">=</span><span class="n">typ</span><span class="p">,</span>
                <span class="n">pos</span><span class="o">=</span><span class="n">j</span><span class="p">,</span>
                <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
                <span class="n">tz</span><span class="o">=</span><span class="n">tz</span><span class="p">,</span>
                <span class="n">ordered</span><span class="o">=</span><span class="n">ordered</span><span class="p">,</span>
                <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">dtype_name</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">col</span><span class="o">.</span><span class="n">update_info</span><span class="p">(</span><span class="n">new_info</span><span class="p">)</span>

            <span class="n">vaxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">dcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">vaxes</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">is_data_indexable</span><span class="p">]</span>

        <span class="n">new_table</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
            <span class="n">group</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
            <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span>
            <span class="n">index_axes</span><span class="o">=</span><span class="n">new_index_axes</span><span class="p">,</span>
            <span class="n">non_index_axes</span><span class="o">=</span><span class="n">new_non_index_axes</span><span class="p">,</span>
            <span class="n">values_axes</span><span class="o">=</span><span class="n">vaxes</span><span class="p">,</span>
            <span class="n">data_columns</span><span class="o">=</span><span class="n">dcs</span><span class="p">,</span>
            <span class="n">info</span><span class="o">=</span><span class="n">new_info</span><span class="p">,</span>
            <span class="n">nan_rep</span><span class="o">=</span><span class="n">nan_rep</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;levels&quot;</span><span class="p">):</span>
            <span class="c1"># TODO: get this into constructor, only for appropriate subclass</span>
            <span class="n">new_table</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels</span>

        <span class="n">new_table</span><span class="o">.</span><span class="n">validate_min_itemsize</span><span class="p">(</span><span class="n">min_itemsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">validate</span> <span class="ow">and</span> <span class="n">table_exists</span><span class="p">:</span>
            <span class="n">new_table</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_table</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_blocks_and_items</span><span class="p">(</span>
        <span class="n">frame</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">table_exists</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">new_non_index_axes</span><span class="p">,</span>
        <span class="n">values_axes</span><span class="p">,</span>
        <span class="n">data_columns</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># Helper to clarify non-state-altering parts of _create_axes</span>

        <span class="c1"># TODO(ArrayManager) HDFStore relies on accessing the blocks</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">_mgr</span><span class="p">,</span> <span class="n">ArrayManager</span><span class="p">):</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">_as_manager</span><span class="p">(</span><span class="s2">&quot;block&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_blk_items</span><span class="p">(</span><span class="n">mgr</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">mgr</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">blk</span><span class="o">.</span><span class="n">mgr_locs</span><span class="p">)</span> <span class="k">for</span> <span class="n">blk</span> <span class="ow">in</span> <span class="n">mgr</span><span class="o">.</span><span class="n">blocks</span><span class="p">]</span>

        <span class="n">mgr</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">_mgr</span>
        <span class="n">mgr</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">BlockManager</span><span class="p">,</span> <span class="n">mgr</span><span class="p">)</span>
        <span class="n">blocks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Block</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mgr</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>
        <span class="n">blk_items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_blk_items</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_columns</span><span class="p">):</span>
            <span class="c1"># TODO: prove that we only get here with axis == 1?</span>
            <span class="c1">#  It is the case in all extant tests, but NOT the case</span>
            <span class="c1">#  outside this `if len(data_columns)` check.</span>

            <span class="n">axis</span><span class="p">,</span> <span class="n">axis_labels</span> <span class="o">=</span> <span class="n">new_non_index_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_labels</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="n">axis_labels</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">Index</span><span class="p">(</span><span class="n">data_columns</span><span class="p">))</span>
            <span class="n">mgr</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">new_labels</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span><span class="o">.</span><span class="n">_mgr</span>
            <span class="n">mgr</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">BlockManager</span><span class="p">,</span> <span class="n">mgr</span><span class="p">)</span>

            <span class="n">blocks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mgr</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>
            <span class="n">blk_items</span> <span class="o">=</span> <span class="n">get_blk_items</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data_columns</span><span class="p">:</span>
                <span class="c1"># This reindex would raise ValueError if we had a duplicate</span>
                <span class="c1">#  index, so we can infer that (as long as axis==1) we</span>
                <span class="c1">#  get a single column back, so a single block.</span>
                <span class="n">mgr</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reindex</span><span class="p">([</span><span class="n">c</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span><span class="o">.</span><span class="n">_mgr</span>
                <span class="n">mgr</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">BlockManager</span><span class="p">,</span> <span class="n">mgr</span><span class="p">)</span>
                <span class="n">blocks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mgr</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>
                <span class="n">blk_items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_blk_items</span><span class="p">(</span><span class="n">mgr</span><span class="p">))</span>

        <span class="c1"># reorder the blocks in the same order as the existing table if we can</span>
        <span class="k">if</span> <span class="n">table_exists</span><span class="p">:</span>
            <span class="n">by_items</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nb">tuple</span><span class="p">(</span><span class="n">b_items</span><span class="o">.</span><span class="n">tolist</span><span class="p">()):</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_items</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">b_items</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">blk_items</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">new_blocks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Block</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">new_blk_items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ea</span> <span class="ow">in</span> <span class="n">values_axes</span><span class="p">:</span>
                <span class="n">items</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ea</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">b</span><span class="p">,</span> <span class="n">b_items</span> <span class="o">=</span> <span class="n">by_items</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
                    <span class="n">new_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="n">new_blk_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b_items</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="n">jitems</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">pprint_thing</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">])</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;cannot match existing table structure for [</span><span class="si">{</span><span class="n">jitems</span><span class="si">}</span><span class="s2">] &quot;</span>
                        <span class="s2">&quot;on appending data&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
            <span class="n">blocks</span> <span class="o">=</span> <span class="n">new_blocks</span>
            <span class="n">blk_items</span> <span class="o">=</span> <span class="n">new_blk_items</span>

        <span class="k">return</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">blk_items</span>

    <span class="k">def</span> <span class="nf">process_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">selection</span><span class="p">:</span> <span class="n">Selection</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;process axes filters&quot;&quot;&quot;</span>
        <span class="c1"># make a copy to avoid side effects</span>
        <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>

        <span class="c1"># make sure to include levels if we have them</span>
        <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multi_index</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>  <span class="c1"># assured by is_multi_index</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                    <span class="n">columns</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="c1"># reorder by any non_index_axes &amp; limit to the select columns</span>
        <span class="k">for</span> <span class="n">axis</span><span class="p">,</span> <span class="n">labels</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_index_axes</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">_reindex_axis</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">process_filter</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">axis_name</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_AXIS_ORDERS</span><span class="p">:</span>
                    <span class="n">axis_number</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_get_axis_number</span><span class="p">(</span><span class="n">axis_name</span><span class="p">)</span>
                    <span class="n">axis_values</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_get_axis</span><span class="p">(</span><span class="n">axis_name</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="n">axis_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

                    <span class="c1"># see if the field is the name of an axis</span>
                    <span class="k">if</span> <span class="n">field</span> <span class="o">==</span> <span class="n">axis_name</span><span class="p">:</span>
                        <span class="c1"># if we have a multi-index, then need to include</span>
                        <span class="c1"># the levels</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multi_index</span><span class="p">:</span>
                            <span class="n">filt</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">Index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">))</span>

                        <span class="n">takers</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="n">axis_values</span><span class="p">,</span> <span class="n">filt</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">loc</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis_number</span><span class="p">)[</span><span class="n">takers</span><span class="p">]</span>

                    <span class="c1"># this might be the name of a file IN an axis</span>
                    <span class="k">elif</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">axis_values</span><span class="p">:</span>
                        <span class="c1"># we need to filter on this dimension</span>
                        <span class="n">values</span> <span class="o">=</span> <span class="n">ensure_index</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                        <span class="n">filt</span> <span class="o">=</span> <span class="n">ensure_index</span><span class="p">(</span><span class="n">filt</span><span class="p">)</span>

                        <span class="c1"># hack until we support reversed dim flags</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">):</span>
                            <span class="n">axis_number</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">axis_number</span>

                        <span class="n">takers</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">filt</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">loc</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis_number</span><span class="p">)[</span><span class="n">takers</span><span class="p">]</span>

                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot find the field [</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">] for filtering!&quot;</span><span class="p">)</span>

        <span class="c1"># apply the selection filters (but keep in the same order)</span>
        <span class="k">if</span> <span class="n">selection</span><span class="o">.</span><span class="n">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="n">selection</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">format</span><span class="p">():</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">process_filter</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">create_description</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">complib</span><span class="p">,</span>
        <span class="n">complevel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fletcher32</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">expectedrows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;create the description of the table from the axes &amp; values&quot;&quot;&quot;</span>
        <span class="c1"># provided expected rows if its passed</span>
        <span class="k">if</span> <span class="n">expectedrows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expectedrows</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrows_expected</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="s2">&quot;expectedrows&quot;</span><span class="p">:</span> <span class="n">expectedrows</span><span class="p">}</span>

        <span class="c1"># description from the axes &amp; values</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">cname</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">typ</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">complib</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">complevel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">complevel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_complevel</span> <span class="ow">or</span> <span class="mi">9</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="n">_tables</span><span class="p">()</span><span class="o">.</span><span class="n">Filters</span><span class="p">(</span>
                <span class="n">complevel</span><span class="o">=</span><span class="n">complevel</span><span class="p">,</span>
                <span class="n">complib</span><span class="o">=</span><span class="n">complib</span><span class="p">,</span>
                <span class="n">fletcher32</span><span class="o">=</span><span class="n">fletcher32</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fletcher32</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filters</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filters</span>

        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">read_coordinates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        select coordinates (row numbers) from a table; return the</span>
<span class="sd">        coordinates object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># validate the version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_version</span><span class="p">(</span><span class="n">where</span><span class="p">)</span>

        <span class="c1"># infer the data kind</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">infer_axes</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># create the selection</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">select_coords</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">selection</span><span class="o">.</span><span class="n">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="n">selection</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">format</span><span class="p">():</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_column</span><span class="p">(</span>
                    <span class="n">field</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">coords</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">stop</span><span class="o">=</span><span class="n">coords</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>
                <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">op</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">coords</span> <span class="o">-</span> <span class="n">coords</span><span class="o">.</span><span class="n">min</span><span class="p">()],</span> <span class="n">filt</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">Index</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_column</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return a single column from the table, generally only indexables</span>
<span class="sd">        are interesting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># validate the version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_version</span><span class="p">()</span>

        <span class="c1"># infer the data kind</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">infer_axes</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">where</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;read_column does not currently accept a where clause&quot;</span><span class="p">)</span>

        <span class="c1"># find the axes</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">is_data_indexable</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;column [</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">] can not be extracted individually; &quot;</span>
                        <span class="s2">&quot;it is not data indexable&quot;</span>
                    <span class="p">)</span>

                <span class="c1"># column must be an indexable or a data column</span>
                <span class="n">c</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">set_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
                <span class="n">col_values</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                    <span class="n">c</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">],</span>
                    <span class="n">nan_rep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nan_rep</span><span class="p">,</span>
                    <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
                    <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">Series</span><span class="p">(</span><span class="n">_set_tz</span><span class="p">(</span><span class="n">col_values</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="o">.</span><span class="n">tz</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">column</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;column [</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">] not found in the table&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">WORMTable</span><span class="p">(</span><span class="n">Table</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    a write-once read-many table: this format DOES NOT ALLOW appending to a</span>
<span class="sd">    table. writing is a one-time operation the data are stored in a format</span>
<span class="sd">    that allows for searching the data on disk</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">table_type</span> <span class="o">=</span> <span class="s2">&quot;worm&quot;</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read the indices and the indexing array, calculate offset rows and return</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;WORMTable needs to implement read&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write in a format that we can search later on (but cannot append</span>
<span class="sd">        to): write out the indices and the values using _write_array</span>
<span class="sd">        (e.g. a CArray) create an indexing table so that we can search</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;WORMTable needs to implement write&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AppendableTable</span><span class="p">(</span><span class="n">Table</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;support the new appendable table formats&quot;&quot;&quot;</span>

    <span class="n">table_type</span> <span class="o">=</span> <span class="s2">&quot;appendable&quot;</span>

    <span class="c1"># error: Signature of &quot;write&quot; incompatible with supertype &quot;Fixed&quot;</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span>  <span class="c1"># type: ignore[override]</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">obj</span><span class="p">,</span>
        <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">append</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">complib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">complevel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fletcher32</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">min_itemsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">expectedrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dropna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">nan_rep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">track_times</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">append</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">)</span>

        <span class="c1"># create the axes</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_axes</span><span class="p">(</span>
            <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
            <span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span>
            <span class="n">validate</span><span class="o">=</span><span class="n">append</span><span class="p">,</span>
            <span class="n">min_itemsize</span><span class="o">=</span><span class="n">min_itemsize</span><span class="p">,</span>
            <span class="n">nan_rep</span><span class="o">=</span><span class="n">nan_rep</span><span class="p">,</span>
            <span class="n">data_columns</span><span class="o">=</span><span class="n">data_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">validate_names</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="o">.</span><span class="n">is_exists</span><span class="p">:</span>
            <span class="c1"># create the table</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">create_description</span><span class="p">(</span>
                <span class="n">complib</span><span class="o">=</span><span class="n">complib</span><span class="p">,</span>
                <span class="n">complevel</span><span class="o">=</span><span class="n">complevel</span><span class="p">,</span>
                <span class="n">fletcher32</span><span class="o">=</span><span class="n">fletcher32</span><span class="p">,</span>
                <span class="n">expectedrows</span><span class="o">=</span><span class="n">expectedrows</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># set the table attributes</span>
            <span class="n">table</span><span class="o">.</span><span class="n">set_attrs</span><span class="p">()</span>

            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;track_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">track_times</span>

            <span class="c1"># create the table</span>
            <span class="n">table</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

        <span class="c1"># update my info</span>
        <span class="n">table</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">info</span>

        <span class="c1"># validate the axes and set the kinds</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">validate_and_set</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">append</span><span class="p">)</span>

        <span class="c1"># add the rows</span>
        <span class="n">table</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">chunksize</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dropna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        we form the data into a 2-d including indexes,values,mask write chunk-by-chunk</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows_expected</span>

        <span class="c1"># if dropna==True, then drop ALL nan rows</span>
        <span class="n">masks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">dropna</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_axes</span><span class="p">:</span>
                <span class="c1"># figure the mask: only do if we can successfully process this</span>
                <span class="c1"># column, otherwise ignore the mask</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">isna</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">masks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;u1&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="c1"># consolidate masks</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">masks</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">masks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">masks</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&amp;</span> <span class="n">m</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># broadcast the indexes if needed</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">cvalues</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_axes</span><span class="p">]</span>
        <span class="n">nindexes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">nindexes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nindexes</span>  <span class="c1"># ensures we dont need to broadcast</span>

        <span class="c1"># transpose the values so first dimension is last</span>
        <span class="c1"># reshape the values if needed</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">take_data</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_axes</span><span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ndim</span><span class="p">),</span> <span class="n">v</span><span class="o">.</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
        <span class="n">bvalues</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="n">new_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">nrows</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">nindexes</span> <span class="o">+</span> <span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">bvalues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">new_shape</span><span class="p">))</span>

        <span class="c1"># write the chunks</span>
        <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">chunksize</span> <span class="o">=</span> <span class="mi">100000</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">chunksize</span><span class="p">,</span> <span class="n">nrows</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="n">nrows</span> <span class="o">//</span> <span class="n">chunksize</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
            <span class="n">start_i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">chunksize</span>
            <span class="n">end_i</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">chunksize</span><span class="p">,</span> <span class="n">nrows</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">start_i</span> <span class="o">&gt;=</span> <span class="n">end_i</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">write_data_chunk</span><span class="p">(</span>
                <span class="n">rows</span><span class="p">,</span>
                <span class="n">indexes</span><span class="o">=</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">start_i</span><span class="p">:</span><span class="n">end_i</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">],</span>
                <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">[</span><span class="n">start_i</span><span class="p">:</span><span class="n">end_i</span><span class="p">]</span> <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">start_i</span><span class="p">:</span><span class="n">end_i</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">bvalues</span><span class="p">],</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_data_chunk</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rows</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">indexes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">mask</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rows : an empty memory space where we are putting the chunk</span>
<span class="sd">        indexes : an array of the indexes</span>
<span class="sd">        mask : an array of the masks</span>
<span class="sd">        values : an array of the values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 0 len</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
                <span class="k">return</span>

        <span class="n">nrows</span> <span class="o">=</span> <span class="n">indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">nrows</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
        <span class="n">nindexes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span>

        <span class="c1"># indexes</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indexes</span><span class="p">):</span>
            <span class="n">rows</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">idx</span>

        <span class="c1"># values</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="n">rows</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">nindexes</span><span class="p">]]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="c1"># mask</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="o">~</span><span class="n">mask</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># delete all rows (and return the nrows)</span>
        <span class="k">if</span> <span class="n">where</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">where</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># pytables&lt;3.0 would remove a single row with stop=None</span>
                <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span>
                <span class="n">nrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">remove_rows</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">nrows</span>

        <span class="c1"># infer the data kind</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">infer_axes</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># create the selection</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">where</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">select_coords</span><span class="p">()</span>

        <span class="c1"># delete the rows in reverse order</span>
        <span class="n">sorted_series</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
        <span class="n">ln</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_series</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ln</span><span class="p">:</span>
            <span class="c1"># construct groups of consecutive rows</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">sorted_series</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

            <span class="c1"># 1 group</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
                <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># final element</span>
            <span class="k">if</span> <span class="n">groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ln</span><span class="p">:</span>
                <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>

            <span class="c1"># initial element</span>
            <span class="k">if</span> <span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">groups</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># we must remove in reverse order!</span>
            <span class="n">pg</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="n">sorted_series</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">pg</span><span class="p">))</span>
                <span class="n">table</span><span class="o">.</span><span class="n">remove_rows</span><span class="p">(</span>
                    <span class="n">start</span><span class="o">=</span><span class="n">rows</span><span class="p">[</span><span class="n">rows</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">stop</span><span class="o">=</span><span class="n">rows</span><span class="p">[</span><span class="n">rows</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>
                <span class="n">pg</span> <span class="o">=</span> <span class="n">g</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># return the number of rows removed</span>
        <span class="k">return</span> <span class="n">ln</span>


<span class="k">class</span> <span class="nc">AppendableFrameTable</span><span class="p">(</span><span class="n">AppendableTable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;support the new appendable table formats&quot;&quot;&quot;</span>

    <span class="n">pandas_kind</span> <span class="o">=</span> <span class="s2">&quot;frame_table&quot;</span>
    <span class="n">table_type</span> <span class="o">=</span> <span class="s2">&quot;appendable_frame&quot;</span>
    <span class="n">ndim</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">obj_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Series</span><span class="p">]</span> <span class="o">=</span> <span class="n">DataFrame</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_transposed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">transposed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;these are written transposed&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">transposed</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># validate the version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_version</span><span class="p">(</span><span class="n">where</span><span class="p">)</span>

        <span class="c1"># infer the data kind</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">infer_axes</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_axes</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>

        <span class="n">info</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_index_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_index_axes</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">{}</span>
        <span class="p">)</span>

        <span class="n">inds</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_axes</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">index_vals</span><span class="p">,</span> <span class="n">cvalues</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># we could have a multi-index constructor here</span>
            <span class="c1"># ensure_index doesn&#39;t recognized our list-of-tuples here</span>
            <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;MultiIndex&quot;</span><span class="p">:</span>
                <span class="n">cols</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="n">index_vals</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cols</span> <span class="o">=</span> <span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">index_vals</span><span class="p">)</span>

            <span class="n">names</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cols</span><span class="o">.</span><span class="n">set_names</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_transposed</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">cvalues</span>
                <span class="n">index_</span> <span class="o">=</span> <span class="n">cols</span>
                <span class="n">cols_</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">cvalues</span><span class="o">.</span><span class="n">T</span>
                <span class="n">index_</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="n">cols_</span> <span class="o">=</span> <span class="n">cols</span>

            <span class="c1"># if we have a DataIndexableCol, its shape will only be 1 dim</span>
            <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index_</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">Index</span><span class="p">):</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index_</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Categorical</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">_from_arrays</span><span class="p">([</span><span class="n">values</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index_</span><span class="p">)</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">concat</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">selection</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
        <span class="c1"># apply the selection filters &amp; axis orderings</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_axes</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="n">selection</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>


<span class="k">class</span> <span class="nc">AppendableSeriesTable</span><span class="p">(</span><span class="n">AppendableFrameTable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;support the new appendable table formats&quot;&quot;&quot;</span>

    <span class="n">pandas_kind</span> <span class="o">=</span> <span class="s2">&quot;series_table&quot;</span>
    <span class="n">table_type</span> <span class="o">=</span> <span class="s2">&quot;appendable_series&quot;</span>
    <span class="n">ndim</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">obj_type</span> <span class="o">=</span> <span class="n">Series</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_transposed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">transposed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">data_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;we are going to write this as a frame table&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;values&quot;</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">data_columns</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">:</span>
        <span class="n">is_multi_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multi_index</span>
        <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">is_multi_index</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>  <span class="c1"># needed for mypy</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                    <span class="n">columns</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_multi_index</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c1"># remove the default name</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;values&quot;</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">s</span>


<span class="k">class</span> <span class="nc">AppendableMultiSeriesTable</span><span class="p">(</span><span class="n">AppendableSeriesTable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;support the new appendable table formats&quot;&quot;&quot;</span>

    <span class="n">pandas_kind</span> <span class="o">=</span> <span class="s2">&quot;series_table&quot;</span>
    <span class="n">table_type</span> <span class="o">=</span> <span class="s2">&quot;appendable_multiseries&quot;</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;we are going to write this as a frame table&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;values&quot;</span>
        <span class="n">newobj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_multiindex</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>  <span class="c1"># for mypy</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>
        <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">newobj</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">newobj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GenericTable</span><span class="p">(</span><span class="n">AppendableFrameTable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a table that read/writes the generic pytables table format&quot;&quot;&quot;</span>

    <span class="n">pandas_kind</span> <span class="o">=</span> <span class="s2">&quot;frame_table&quot;</span>
    <span class="n">table_type</span> <span class="o">=</span> <span class="s2">&quot;generic_table&quot;</span>
    <span class="n">ndim</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">obj_type</span> <span class="o">=</span> <span class="n">DataFrame</span>
    <span class="n">levels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pandas_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pandas_kind</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">storable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span>

    <span class="k">def</span> <span class="nf">get_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;retrieve our attributes&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_index_axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nan_rep</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">index_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexables</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_an_indexable</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexables</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">is_an_indexable</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_axes</span><span class="p">]</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">indexables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;create the indexables from the table description&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>

        <span class="c1"># TODO: can we get a typ for this?  AFAICT it is the only place</span>
        <span class="c1">#  where we aren&#39;t passing one</span>
        <span class="c1"># the index columns is just a simple index</span>
        <span class="n">md</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_metadata</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="s2">&quot;category&quot;</span> <span class="k">if</span> <span class="n">md</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">index_col</span> <span class="o">=</span> <span class="n">GenericIndexCol</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">md</span>
        <span class="p">)</span>

        <span class="n">_indexables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">GenericIndexCol</span> <span class="o">|</span> <span class="n">GenericDataIndexableCol</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">index_col</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">_v_names</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

            <span class="n">atom</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">md</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_metadata</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="s2">&quot;category&quot;</span> <span class="k">if</span> <span class="n">md</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">dc</span> <span class="o">=</span> <span class="n">GenericDataIndexableCol</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                <span class="n">pos</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
                <span class="n">typ</span><span class="o">=</span><span class="n">atom</span><span class="p">,</span>
                <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">,</span>
                <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">md</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">_indexables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dc</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_indexables</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;cannot write on an generic table&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AppendableMultiFrameTable</span><span class="p">(</span><span class="n">AppendableFrameTable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a frame with a multi-index&quot;&quot;&quot;</span>

    <span class="n">table_type</span> <span class="o">=</span> <span class="s2">&quot;appendable_multiframe&quot;</span>
    <span class="n">obj_type</span> <span class="o">=</span> <span class="n">DataFrame</span>
    <span class="n">ndim</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">_re_levels</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^level_\d+$&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">table_type_short</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;appendable_multi&quot;</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">data_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data_columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">data_columns</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">data_columns</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_multiindex</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>  <span class="c1"># for mypy</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data_columns</span><span class="p">:</span>
                <span class="n">data_columns</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">data_columns</span><span class="o">=</span><span class="n">data_columns</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>

        <span class="c1"># remove names for &#39;level_%d&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">set_names</span><span class="p">(</span>
            <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_re_levels</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">else</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>


<span class="k">def</span> <span class="nf">_reindex_axis</span><span class="p">(</span>
    <span class="n">obj</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">AxisInt</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">Index</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_get_axis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">ensure_index</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

    <span class="c1"># try not to reindex even if other is provided</span>
    <span class="c1"># if it equals our current index</span>
    <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">ensure_index</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">labels</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="p">))</span> <span class="ow">and</span> <span class="n">labels</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="n">ensure_index</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">ensure_index</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">labels</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
        <span class="n">slicer</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">slice</span> <span class="o">|</span> <span class="n">Index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">ndim</span>
        <span class="n">slicer</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">slicer</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">obj</span>


<span class="c1"># tz to/from coercion</span>


<span class="k">def</span> <span class="nf">_get_tz</span><span class="p">(</span><span class="n">tz</span><span class="p">:</span> <span class="n">tzinfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">tzinfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;for a tz-aware type, return an encoded zone&quot;&quot;&quot;</span>
    <span class="n">zone</span> <span class="o">=</span> <span class="n">timezones</span><span class="o">.</span><span class="n">get_timezone</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">zone</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">_set_tz</span><span class="p">(</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">Index</span><span class="p">,</span> <span class="n">tz</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">tzinfo</span><span class="p">,</span> <span class="n">coerce</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatetimeIndex</span><span class="p">:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">_set_tz</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">Index</span><span class="p">,</span> <span class="n">tz</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="n">coerce</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="o">...</span>


<span class="k">def</span> <span class="nf">_set_tz</span><span class="p">(</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">Index</span><span class="p">,</span> <span class="n">tz</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">tzinfo</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">coerce</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">DatetimeIndex</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    coerce the values to a DatetimeIndex if tz is set</span>
<span class="sd">    preserve the input shape if possible</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    values : ndarray or Index</span>
<span class="sd">    tz : str or tzinfo</span>
<span class="sd">    coerce : if we do not have a passed timezone, coerce to M8[ns] ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">DatetimeIndex</span><span class="p">):</span>
        <span class="c1"># If values is tzaware, the tz gets dropped in the values.ravel()</span>
        <span class="c1">#  call below (which returns an ndarray).  So we are only non-lossy</span>
        <span class="c1">#  if `tz` matches `values.tz`.</span>
        <span class="k">assert</span> <span class="n">values</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">values</span><span class="o">.</span><span class="n">tz</span> <span class="o">==</span> <span class="n">tz</span>

    <span class="k">if</span> <span class="n">tz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">DatetimeIndex</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">name</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">asi8</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">tz</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">coerce</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;M8[ns]&quot;</span><span class="p">)</span>

    <span class="c1"># error: Incompatible return value type (got &quot;Union[ndarray, Index]&quot;,</span>
    <span class="c1"># expected &quot;Union[ndarray, DatetimeIndex]&quot;)</span>
    <span class="k">return</span> <span class="n">values</span>  <span class="c1"># type: ignore[return-value]</span>


<span class="k">def</span> <span class="nf">_convert_index</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Index</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndexCol</span><span class="p">:</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="n">index_name</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">name</span>
    <span class="c1"># error: Argument 1 to &quot;_get_data_and_dtype_name&quot; has incompatible type &quot;Index&quot;;</span>
    <span class="c1"># expected &quot;Union[ExtensionArray, ndarray]&quot;</span>
    <span class="n">converted</span><span class="p">,</span> <span class="n">dtype_name</span> <span class="o">=</span> <span class="n">_get_data_and_dtype_name</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
    <span class="n">kind</span> <span class="o">=</span> <span class="n">_dtype_to_kind</span><span class="p">(</span><span class="n">dtype_name</span><span class="p">)</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="n">DataIndexableCol</span><span class="o">.</span><span class="n">_get_atom</span><span class="p">(</span><span class="n">converted</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_integer_dtype</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="ow">or</span> <span class="n">needs_i8_conversion</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">is_bool_dtype</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="c1"># Includes Index, RangeIndex, DatetimeIndex, TimedeltaIndex, PeriodIndex,</span>
        <span class="c1">#  in which case &quot;kind&quot; is &quot;integer&quot;, &quot;integer&quot;, &quot;datetime64&quot;,</span>
        <span class="c1">#  &quot;timedelta64&quot;, and &quot;integer&quot;, respectively.</span>
        <span class="k">return</span> <span class="n">IndexCol</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="n">converted</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
            <span class="n">typ</span><span class="o">=</span><span class="n">atom</span><span class="p">,</span>
            <span class="n">freq</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">tz</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;tz&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">MultiIndex</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;MultiIndex not supported here!&quot;</span><span class="p">)</span>

    <span class="n">inferred_type</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">infer_dtype</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># we won&#39;t get inferred_type of &quot;datetime64&quot; or &quot;timedelta64&quot; as these</span>
    <span class="c1">#  would go through the DatetimeIndex/TimedeltaIndex paths above</span>

    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">inferred_type</span> <span class="o">==</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span>
        <span class="n">converted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="n">toordinal</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">IndexCol</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">converted</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">_tables</span><span class="p">()</span><span class="o">.</span><span class="n">Time32Col</span><span class="p">(),</span> <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">inferred_type</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
        <span class="n">converted</span> <span class="o">=</span> <span class="n">_convert_string_array</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
        <span class="n">itemsize</span> <span class="o">=</span> <span class="n">converted</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span>
        <span class="k">return</span> <span class="n">IndexCol</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">converted</span><span class="p">,</span>
            <span class="s2">&quot;string&quot;</span><span class="p">,</span>
            <span class="n">_tables</span><span class="p">()</span><span class="o">.</span><span class="n">StringCol</span><span class="p">(</span><span class="n">itemsize</span><span class="p">),</span>
            <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">inferred_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;floating&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">IndexCol</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">converted</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="n">atom</span><span class="p">,</span> <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">converted</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">converted</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">object</span>
        <span class="k">assert</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">kind</span>
        <span class="n">atom</span> <span class="o">=</span> <span class="n">_tables</span><span class="p">()</span><span class="o">.</span><span class="n">ObjectAtom</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">IndexCol</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">converted</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">atom</span><span class="p">,</span> <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_unconvert_index</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">Index</span><span class="p">:</span>
    <span class="n">index</span><span class="p">:</span> <span class="n">Index</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>

    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;datetime64&quot;</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;timedelta64&quot;</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">TimedeltaIndex</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">date</span><span class="o">.</span><span class="n">fromordinal</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">date</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">_unconvert_string_array</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">nan_rep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unrecognized index type </span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">index</span>


<span class="k">def</span> <span class="nf">_maybe_convert_for_string_atom</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">bvalues</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
    <span class="n">existing_col</span><span class="p">,</span>
    <span class="n">min_itemsize</span><span class="p">,</span>
    <span class="n">nan_rep</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">bvalues</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="nb">object</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">bvalues</span>

    <span class="n">bvalues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">bvalues</span><span class="p">)</span>

    <span class="n">dtype_name</span> <span class="o">=</span> <span class="n">bvalues</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span>
    <span class="n">inferred_type</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">infer_dtype</span><span class="p">(</span><span class="n">bvalues</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">inferred_type</span> <span class="o">==</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;[date] is not implemented as a table column&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">inferred_type</span> <span class="o">==</span> <span class="s2">&quot;datetime&quot;</span><span class="p">:</span>
        <span class="c1"># after GH#8260</span>
        <span class="c1"># this only would be hit for a multi-timezone dtype which is an error</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;too many timezones in this block, create separate data columns&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">inferred_type</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="ow">or</span> <span class="n">dtype_name</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">bvalues</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">isna</span><span class="p">(</span><span class="n">bvalues</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">bvalues</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">nan_rep</span>

    <span class="c1"># see if we have a valid string type</span>
    <span class="n">inferred_type</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">infer_dtype</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">inferred_type</span> <span class="o">!=</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
        <span class="c1"># we cannot serialize this data, so report an exception on a column</span>
        <span class="c1"># by column basis</span>

        <span class="c1"># expected behaviour:</span>
        <span class="c1"># search block for a non-string object column by column</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">inferred_type</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">infer_dtype</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">inferred_type</span> <span class="o">!=</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
                <span class="n">error_column_label</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;No.</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot serialize the column [</span><span class="si">{</span><span class="n">error_column_label</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;because its data contents are not [string] but &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">inferred_type</span><span class="si">}</span><span class="s2">] object dtype&quot;</span>
                <span class="p">)</span>

    <span class="c1"># itemsize is the maximum length of a string (along any dimension)</span>

    <span class="n">data_converted</span> <span class="o">=</span> <span class="n">_convert_string_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">itemsize</span> <span class="o">=</span> <span class="n">data_converted</span><span class="o">.</span><span class="n">itemsize</span>

    <span class="c1"># specified min_itemsize?</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_itemsize</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">min_itemsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">min_itemsize</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="n">min_itemsize</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">itemsize</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_itemsize</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="n">itemsize</span><span class="p">)</span>

    <span class="c1"># check for column in the values conflicts</span>
    <span class="k">if</span> <span class="n">existing_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">eci</span> <span class="o">=</span> <span class="n">existing_col</span><span class="o">.</span><span class="n">validate_col</span><span class="p">(</span><span class="n">itemsize</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eci</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">eci</span> <span class="o">&gt;</span> <span class="n">itemsize</span><span class="p">:</span>
            <span class="n">itemsize</span> <span class="o">=</span> <span class="n">eci</span>

    <span class="n">data_converted</span> <span class="o">=</span> <span class="n">data_converted</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;|S</span><span class="si">{</span><span class="n">itemsize</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data_converted</span>


<span class="k">def</span> <span class="nf">_convert_string_array</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Take a string-like that is object dtype and coerce to a fixed size string type.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : np.ndarray[object]</span>
<span class="sd">    encoding : str</span>
<span class="sd">    errors : str</span>
<span class="sd">        Handler for encoding errors.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray[fixed-length-string]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># encode if needed</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
            <span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># create the sized dtype</span>
    <span class="n">ensured</span> <span class="o">=</span> <span class="n">ensure_object</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="n">itemsize</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">libwriters</span><span class="o">.</span><span class="n">max_len_string_array</span><span class="p">(</span><span class="n">ensured</span><span class="p">))</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;S</span><span class="si">{</span><span class="n">itemsize</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">def</span> <span class="nf">_unconvert_string_array</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">nan_rep</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inverse of _convert_string_array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : np.ndarray[fixed-length-string]</span>
<span class="sd">    nan_rep : the storage repr of NaN</span>
<span class="sd">    encoding : str</span>
<span class="sd">    errors : str</span>
<span class="sd">        Handler for encoding errors.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray[object]</span>
<span class="sd">        Decoded data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">itemsize</span> <span class="o">=</span> <span class="n">libwriters</span><span class="o">.</span><span class="n">max_len_string_array</span><span class="p">(</span><span class="n">ensure_object</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;U</span><span class="si">{</span><span class="n">itemsize</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span><span class="o">.</span><span class="n">_values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">nan_rep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nan_rep</span> <span class="o">=</span> <span class="s2">&quot;nan&quot;</span>

    <span class="n">libwriters</span><span class="o">.</span><span class="n">string_array_replace_from_nan_rep</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">nan_rep</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_maybe_convert</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">val_kind</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_kind</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">val_kind</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_need_convert</span><span class="p">(</span><span class="n">val_kind</span><span class="p">):</span>
        <span class="n">conv</span> <span class="o">=</span> <span class="n">_get_converter</span><span class="p">(</span><span class="n">val_kind</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">conv</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span>


<span class="k">def</span> <span class="nf">_get_converter</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;datetime64&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;M8[ns]&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_unconvert_string_array</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">nan_rep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;invalid kind </span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_need_convert</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;datetime64&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_maybe_adjust_name</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prior to 0.10.1, we named values blocks like: values_block_0 an the</span>
<span class="sd">    name values_0, adjust the given name if necessary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">    version : Tuple[int, int, int]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Version is incorrect, expected sequence of 3 integers.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">version</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">version</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;values_block_(\d+)&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">grp</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;values_</span><span class="si">{</span><span class="n">grp</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">name</span>


<span class="k">def</span> <span class="nf">_dtype_to_kind</span><span class="p">(</span><span class="n">dtype_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the &quot;kind&quot; string describing the given dtype name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dtype_str</span> <span class="o">=</span> <span class="n">_ensure_decoded</span><span class="p">(</span><span class="n">dtype_str</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dtype_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dtype_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;bytes&quot;</span><span class="p">):</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;string&quot;</span>
    <span class="k">elif</span> <span class="n">dtype_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">):</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;float&quot;</span>
    <span class="k">elif</span> <span class="n">dtype_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;complex&quot;</span><span class="p">):</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;complex&quot;</span>
    <span class="k">elif</span> <span class="n">dtype_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dtype_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;uint&quot;</span><span class="p">):</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;integer&quot;</span>
    <span class="k">elif</span> <span class="n">dtype_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;datetime64&quot;</span><span class="p">):</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;datetime64&quot;</span>
    <span class="k">elif</span> <span class="n">dtype_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;timedelta&quot;</span><span class="p">):</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;timedelta64&quot;</span>
    <span class="k">elif</span> <span class="n">dtype_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">):</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;bool&quot;</span>
    <span class="k">elif</span> <span class="n">dtype_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">):</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;category&quot;</span>
    <span class="k">elif</span> <span class="n">dtype_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;period&quot;</span><span class="p">):</span>
        <span class="c1"># We store the `freq` attr so we can restore from integers</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;integer&quot;</span>
    <span class="k">elif</span> <span class="n">dtype_str</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">:</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;object&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot interpret dtype of [</span><span class="si">{</span><span class="n">dtype_str</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">kind</span>


<span class="k">def</span> <span class="nf">_get_data_and_dtype_name</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the passed data into a storable form and a dtype string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Categorical</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">codes</span>

    <span class="c1"># For datetime64tz we need to drop the TZ in tests TODO: why?</span>
    <span class="n">dtype_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">]:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s2">&quot;i8&quot;</span><span class="p">))</span>
        <span class="c1"># TODO: we used to reshape for the dt64tz case, but no longer</span>
        <span class="c1">#  doing that doesn&#39;t seem to break anything.  why?</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">PeriodIndex</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">asi8</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">dtype_name</span>


<span class="k">class</span> <span class="nc">Selection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Carries out a selection operation on a tables.Table object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    table : a Table object</span>
<span class="sd">    where : list of Terms (or convertible to)</span>
<span class="sd">    start, stop: indices to start and/or stop selection</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">where</span> <span class="o">=</span> <span class="n">where</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">condition</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">is_list_like</span><span class="p">(</span><span class="n">where</span><span class="p">):</span>
            <span class="c1"># see if we have a passed coordinate like</span>
            <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
                <span class="n">inferred</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">infer_dtype</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inferred</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;boolean&quot;</span><span class="p">):</span>
                    <span class="n">where</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">where</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">where</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">:</span>
                        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>
                        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">nrows</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)[</span><span class="n">where</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">where</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">where</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">where</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
                        <span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                <span class="s2">&quot;where must have index locations &gt;= start and &lt; stop&quot;</span>
                            <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">where</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">where</span><span class="p">)</span>

            <span class="c1"># create the numexpr &amp; the filter</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">terms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">where</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;where can be a : dict,list,tuple,string&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">where</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">queryables</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PyTablesExpr</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">queryables</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NameError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="c1"># raise a nice message, suggesting that the user should use</span>
            <span class="c1"># data_columns</span>
            <span class="n">qkeys</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">                The passed where expression: </span><span class="si">{</span><span class="n">where</span><span class="si">}</span>
<span class="s2">                            contains an invalid variable reference</span>
<span class="s2">                            all of the variable references must be a reference to</span>
<span class="s2">                            an axis (e.g. &#39;index&#39; or &#39;columns&#39;), or a data_column</span>
<span class="s2">                            The currently defined references are: </span><span class="si">{</span><span class="n">qkeys</span><span class="si">}</span>
<span class="s2">                &quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>

    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generate the selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">read_where</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="o">.</span><span class="n">format</span><span class="p">(),</span> <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">read_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">select_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generate the selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">nrows</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">+=</span> <span class="n">nrows</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">nrows</span>
        <span class="k">elif</span> <span class="n">stop</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">+=</span> <span class="n">nrows</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">get_where_list</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="o">.</span><span class="n">format</span><span class="p">(),</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Tommaso Furlanello, and Daniel Hug.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>